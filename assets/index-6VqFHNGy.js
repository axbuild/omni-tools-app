import{r as n,aA as q,j as M,B as z}from"./index-7JCrVMyd.js";import{T as B}from"./ToolContent-DrkA_-Xz.js";import"./TextField-DeGHHacn.js";var y=function(){return y=Object.assign||function(r){for(var c,a=1,i=arguments.length;a<i;a++)for(var e in c=arguments[a])Object.prototype.hasOwnProperty.call(c,e)&&(r[e]=c[e]);return r},y.apply(this,arguments)};function R(r,c,a,i){return new(a||(a=Promise))(function(e,o){function l(f){try{p(i.next(f))}catch(t){o(t)}}function v(f){try{p(i.throw(f))}catch(t){o(t)}}function p(f){var t;f.done?e(f.value):(t=f.value,t instanceof a?t:new a(function(E){E(t)})).then(l,v)}p((i=i.apply(r,c||[])).next())})}function L(r,c){var a,i,e,o={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]},l=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return l.next=v(0),l.throw=v(1),l.return=v(2),typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function v(p){return function(f){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;l&&(l=0,t[0]&&(o=0)),o;)try{if(a=1,i&&(e=2&t[0]?i.return:t[0]?i.throw||((e=i.return)&&e.call(i),0):i.next)&&!(e=e.call(i,t[1])).done)return e;switch(i=0,e&&(t=[2&t[0],e.value]),t[0]){case 0:case 1:e=t;break;case 4:return o.label++,{value:t[1],done:!1};case 5:o.label++,i=t[1],t=[0];continue;case 7:t=o.ops.pop(),o.trys.pop();continue;default:if(e=o.trys,!((e=e.length>0&&e[e.length-1])||t[0]!==6&&t[0]!==2)){o=0;continue}if(t[0]===3&&(!e||t[1]>e[0]&&t[1]<e[3])){o.label=t[1];break}if(t[0]===6&&o.label<e[1]){o.label=e[1],e=t;break}if(e&&o.label<e[2]){o.label=e[2],o.ops.push(t);break}e[2]&&o.ops.pop(),o.trys.pop();continue}t=c.call(r,o)}catch(E){t=[6,E],i=0}finally{a=e=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([p,f])}}}function j(r,c){var a=Math.random().toString(36).substring(2,15);return new Promise(function(i){var e;try{var o=function(p){var f=function(){try{var m=JSON.parse(p.data);return m.type!=="REQUEST_RESULT"?{data:{request_id:null}}:m}catch{return null}}(),t=p.source===r.contentWindow,E=f.data.request_id===a;t&&E&&(i(f.data.result),window.removeEventListener("message",o))};window.addEventListener("message",o),(e=r.contentWindow)===null||e===void 0||e.postMessage(JSON.stringify(y(y({},c),{request_id:a})),"*");var l=setTimeout(function(){i({success:!1,error:{code:"unexpected:request_timed_out",message:"The request timed out: try again"}}),window.removeEventListener("message",o)},5e3);window.addEventListener("message",function(){return clearTimeout(l)})}catch(p){var v=p;i({success:!1,error:{code:"unexpected:failed_processing_request",message:"The following error happened: ".concat(v.name,":").concat(v.message)}})}})}(function(r){if(typeof window>"u")return;const c=document.createElement("style");c.setAttribute("type","text/css"),c.innerHTML=r,document.head.appendChild(c)})(".simplePDF_container{-webkit-user-select:none;-moz-user-select:none;user-select:none;position:fixed;display:flex;box-sizing:border-box;align-items:center;justify-content:center;height:100vh;width:100%;z-index:999999;padding:16px;top:0;left:0;background:rgba(0,0,0,.5)}.simplePDF_content{width:100%;height:100%;position:relative;box-sizing:border-box}.simplePDF_iframeContainer{overflow:hidden;background:#f1f7ff;border-radius:6px;width:100%;height:100%}.simplePDF_iframe{border:none;border-radius:6px;width:100%;height:100%}.simplePDF_close{z-index:1;position:absolute;top:-12px;right:-12px;border:none;padding:6px;border-radius:50px;display:flex;align-items:center;justify-content:center;box-shadow:0 1px 3px rgba(0,0,0,.1),0 1px 2px rgba(0,0,0,.24);cursor:pointer;background:#ff5959;text-shadow:1px 1px #243889}.simplePDF_close svg{fill:#fff;width:14px;height:14px}.simplePDF_close:hover{box-shadow:0 2px 4px rgba(0,0,0,.1),0 4px 4px rgba(0,0,0,.24)}");var W=function(){return n.createElement("svg",{height:"512",viewBox:"0 0 512 512",width:"512",xmlSpace:"preserve",xmlns:"http://www.w3.org/2000/svg"},n.createElement("path",{d:"M443.6 387.1 312.4 255.4l131.5-130c5.4-5.4 5.4-14.2 0-19.6l-37.4-37.6c-2.6-2.6-6.1-4-9.8-4-3.7 0-7.2 1.5-9.8 4L256 197.8 124.9 68.3c-2.6-2.6-6.1-4-9.8-4-3.7 0-7.2 1.5-9.8 4L68 105.9c-5.4 5.4-5.4 14.2 0 19.6l131.5 130L68.4 387.1c-2.6 2.6-4.1 6.1-4.1 9.8 0 3.7 1.4 7.2 4.1 9.8l37.4 37.6c2.7 2.7 6.2 4.1 9.8 4.1 3.5 0 7.1-1.3 9.8-4.1L256 313.1l130.7 131.1c2.7 2.7 6.2 4.1 9.8 4.1 3.5 0 7.1-1.3 9.8-4.1l37.4-37.6c2.6-2.6 4.1-6.1 4.1-9.8-.1-3.6-1.6-7.1-4.2-9.7z"}))},I=function(r){return r.mode==="inline"},G=n.forwardRef(function(r,c){var a=r.className,i=r.style;return n.createElement("iframe",{ref:c,className:a,style:y({border:0},i)})}),H=n.forwardRef(function(r,c){var a=r.children,i=r.editorURL,e=n.useState(!1),o=e[0],l=e[1],v=n.useCallback(function(f){f.preventDefault(),l(!0)},[]),p=n.useCallback(function(){l(!1)},[]);return n.createElement(n.Fragment,null,o&&q.createPortal(n.createElement("div",{className:"simplePDF_container","aria-modal":"true"},n.createElement("div",{className:"simplePDF_content"},n.createElement("button",{onClick:p,className:"simplePDF_close","aria-label":"Close PDF editor modal"},n.createElement(W,null)),n.createElement("div",{className:"simplePDF_iframeContainer"},n.createElement("iframe",{ref:c,referrerPolicy:"no-referrer-when-downgrade",className:"simplePDF_iframe",src:i})))),document.body),n.isValidElement(a)?n.cloneElement(a,{onClick:v}):null)}),V=n.forwardRef(function(r,c){var a,i,e,o,l=r.context,v=r.companyIdentifier,p=r.locale,f=n.useRef(null),t=n.useRef(null),E=n.useState({type:null,value:null,isEditorReady:!1}),m=E[0],N=E[1],g=n.useRef(null),J=n.useCallback(function(s){return R(void 0,[s],void 0,function(u){var h=u.downloadCopyOnDevice;return L(this,function(d){switch(d.label){case 0:if(!g.current)throw Error("Unexpected");return[4,f.current];case 1:return d.sent(),[4,j(g.current,{type:"SUBMIT",data:{download_copy:h}})];case 2:return[2,d.sent()]}})})},[]),A=n.useCallback(function(s){return R(void 0,void 0,void 0,function(){return L(this,function(u){switch(u.label){case 0:if(!g.current)throw Error("Unexpected");return[4,f.current];case 1:return u.sent(),[4,j(g.current,{type:"SELECT_TOOL",data:{tool:s}})];case 2:return[2,u.sent()]}})})},[]);n.useImperativeHandle(c,function(){return{submit:J,selectTool:A}}),n.useEffect(function(){f.current=new Promise(function(s){t.current=s})},[]);var x=I(r)?(a=r.documentURL)!==null&&a!==void 0?a:null:(o=(e=(i=r.children)===null||i===void 0?void 0:i.props)===null||e===void 0?void 0:e.href)!==null&&o!==void 0?o:null;n.useEffect(function(){if(x){var s=x.substring(x.lastIndexOf("/")+1).split("?")[0];R(void 0,void 0,void 0,function(){var u,h,d;return L(this,function(w){switch(w.label){case 0:return[4,fetch(x,{method:"GET",credentials:"same-origin"})];case 1:if(!(u=w.sent()).ok)throw new Error("Failed to retrieve the document: ".concat(JSON.stringify({status:u.status,url:x})));return[4,u.blob()];case 2:return h=w.sent(),d=new FileReader,[4,new Promise(function(_,D){d.onload=_,d.onerror=D,d.readAsDataURL(h)})];case 3:return w.sent(),[2,d.result]}})}).then(function(u){return N(function(h){return y(y({},h),{type:"iframe_event",value:u,documentName:s})})}).catch(function(){N(function(u){return y(y({},u),{type:"cors_proxy_fallback",value:x})})})}},[x]);var P=n.useMemo(function(){return"https://".concat(v??"react-editor",".simplepdf.com")},[v]);n.useEffect(function(){m.isEditorReady&&m.type==="iframe_event"&&m.value!==null&&function(s){R(void 0,[s],void 0,function(u){var h,d,w,_=u.iframeRef,D=u.documentDataURL,b=u.documentName,S=u.editorDomain;return L(this,function(O){return h=new URL(S),(w=(d=_.current)===null||d===void 0?void 0:d.contentWindow)===null||w===void 0||w.postMessage(JSON.stringify({type:"LOAD_DOCUMENT",data:{data_url:D,name:b}}),h.origin),[2]})})}({iframeRef:g,documentDataURL:m.value,documentName:m.documentName,editorDomain:P})},[m,P]);var T=n.useCallback(function(s){return R(void 0,void 0,void 0,function(){var u,h,d,w,_;return L(this,function(D){switch(D.label){case 0:if(u=new URL(s.origin).origin,h=new URL(P).origin,u!==h)return[2];if(s.source!==((_=g.current)===null||_===void 0?void 0:_.contentWindow))return[2];switch(d=function(){try{return JSON.parse(s.data)}catch{return console.error("Failed to parse iFrame event payload"),null}}(),w=function(b){return R(void 0,void 0,void 0,function(){var S,O;return L(this,function(F){switch(F.label){case 0:return F.trys.push([0,2,,3]),[4,(O=r.onEmbedEvent)===null||O===void 0?void 0:O.call(r,b)];case 1:return F.sent(),[3,3];case 2:return S=F.sent(),console.error("onEmbedEvent failed to execute: ".concat(JSON.stringify(S))),[3,3];case 3:return[2]}})})},d==null?void 0:d.type){case"EDITOR_READY":return[3,1];case"DOCUMENT_LOADED":return[3,2];case"SUBMISSION_SENT":return[3,5]}return[3,7];case 1:return N(function(b){return y(y({},b),{isEditorReady:!0})}),[2];case 2:return[4,setTimeout(function(){var b;return(b=t.current)===null||b===void 0?void 0:b.call(t)},200)];case 3:return D.sent(),[4,w(d)];case 4:case 6:return D.sent(),[2];case 5:return[4,w(d)];case 7:return[2]}})})},[r.onEmbedEvent,P]);n.useEffect(function(){return window.addEventListener("message",T,!1),function(){return window.removeEventListener("message",T)}},[T]);var U=n.useMemo(function(){if(!l)return null;try{return encodeURIComponent(btoa(JSON.stringify(l)))}catch(s){return console.error("Failed to encode the context: ".concat(JSON.stringify(s)),{context:l}),null}},[JSON.stringify(l)]),k=n.useMemo(function(){var s=new URL("/".concat(p??"en","/editor"),P);return U&&s.searchParams.set("context",U),x&&s.searchParams.set("loadingPlaceholder","true"),(m==null?void 0:m.type)==="cors_proxy_fallback"&&(m==null?void 0:m.value)!==null&&s.searchParams.set("open",m.value),s.href},[P,x,U,m,p]),C=I(r);return n.useEffect(function(){C&&g&&g.current&&(g.current.src=k)},[k,C]),C?n.createElement(G,{className:r.className,style:r.style,ref:g}):n.createElement(H,{children:r.children,editorURL:k,ref:g})});function X({title:r}){return M.jsx(B,{title:r,initialValues:{},getGroups:null,input:null,inputComponent:M.jsx(z,{sx:{width:"100%",height:"80vh"},children:M.jsx(V,{mode:"inline",style:{width:"100%",height:"100%"}})}),toolInfo:{title:"PDF Editor",description:"Edit, annotate, highlight, fill forms, and export your PDFs entirely in the browser. Add text, drawings, signatures, and more to your PDF documents with this powerful online editor."},compute:()=>{}})}export{X as default};
