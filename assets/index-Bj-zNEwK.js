import{a as $,r as D,j as r,B as j}from"./index-7JCrVMyd.js";import{c as B,d as A}from"./index.esm-Cob4-rpC.js";import{T as F}from"./ToolImageInput-BfRmeQE8.js";import{T as k}from"./ToolFileResult-Div6pbTm.js";import{T as C}from"./TextFieldWithDesc-D98LnRRi.js";import{T as W}from"./ToolContent-DrkA_-Xz.js";import{S as b}from"./SimpleRadio-BbIGpl0h.js";import{C as H}from"./CheckboxWithDesc-Q6HObWmX.js";import{F as v,f as E}from"./index-on_GoYzL.js";import"./BaseFileInput-CTIURbfW.js";import"./ContentPaste-CJSvfBhK.js";import"./InputFooter-Cia2zmGJ.js";import"./grey-pattern-DMflWW5d.js";import"./lodash-jIFHsyXN.js";import"./ResultFooter-DAeFmDVK.js";import"./TextField-DeGHHacn.js";import"./Radio-Clz2uSlr.js";import"./SwitchBase-CZaFkbti.js";import"./FormControlLabel-Bkvpm43S.js";import"./Checkbox-Sy-FfrtZ.js";const q=async(s,e)=>{const{width:c,height:l,resizeMethod:y,percentage:I,dimensionType:T,maintainAspectRatio:g}=e;if(s.type==="image/svg+xml")try{const n=await s.text(),d=new DOMParser().parseFromString(n,"image/svg+xml"),a=d.documentElement,M=a.getAttribute("viewBox");let p=a.getAttribute("width"),h=a.getAttribute("height"),x=null;M&&(x=M.split(" ").map(Number)),!p&&x&&x.length===4&&(p=String(x[2])),!h&&x&&x.length===4&&(h=String(x[3])),p=p?parseFloat(p):300,h=h?parseFloat(h):150;let f=p,z=h;if(y==="pixels")T==="width"?(f=parseInt(c),g?z=Math.round(f/p*h):z=parseInt(l)):(z=parseInt(l),g?f=Math.round(z/h*p):f=parseInt(c));else{const S=parseInt(I)/100;f=Math.round(p*S),z=Math.round(h*S)}a.setAttribute("width",String(f)),a.setAttribute("height",String(z)),M||a.setAttribute("viewBox",`0 0 ${p} ${h}`);const P=new XMLSerializer().serializeToString(d);return new File([P],s.name,{type:"image/svg+xml"})}catch(n){console.error("Error processing SVG:",n)}else if(s.type==="image/gif")try{const n=new v;await n.load({wasmURL:"https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.12.9/dist/esm/ffmpeg-core.wasm"}),await n.writeFile("input.gif",await E(s));let m=0,d=0,a="";if(y==="pixels")T==="width"?(m=parseInt(c),g?a=`scale=${m}:-1`:(d=parseInt(l),a=`scale=${m}:${d}`)):(d=parseInt(l),g?a=`scale=-1:${d}`:(m=parseInt(c),a=`scale=${m}:${d}`));else{const p=parseInt(I)/100;a=`scale=iw*${p}:ih*${p}`}await n.exec(["-i","input.gif","-vf",a,"output.gif"]);const M=await n.readFile("output.gif");return new File([M],s.name,{type:"image/gif"})}catch(n){console.error("Error processing GIF with FFmpeg:",n)}const t=document.createElement("canvas"),o=t.getContext("2d");if(o==null)return null;const i=new Image;i.src=URL.createObjectURL(s),await i.decode();let u=i.width,w=i.height;if(y==="pixels")T==="width"?(u=parseInt(c),g?w=Math.round(u/i.width*i.height):w=parseInt(l)):(w=parseInt(l),g?u=Math.round(w/i.height*i.width):u=parseInt(c));else{const n=parseInt(I)/100;u=Math.round(i.width*n),w=Math.round(i.height*n)}t.width=u,t.height=w,o.drawImage(i,0,0,u,w);let R="image/png";return s.type&&(R=s.type),new Promise(n=>{t.toBlob(m=>{n(m?new File([m],s.name,{type:R}):null)},R)})},O={resizeMethod:"pixels",dimensionType:"width",width:"800",height:"600",percentage:"50",maintainAspectRatio:!0},L=B({width:A().when("resizeMethod",{is:"pixels",then:s=>s.min(1,"Width must be at least 1px").required("Width is required")}),height:A().when("resizeMethod",{is:"pixels",then:s=>s.min(1,"Height must be at least 1px").required("Height is required")}),percentage:A().when("resizeMethod",{is:"percentage",then:s=>s.min(1,"Percentage must be at least 1%").max(1e3,"Percentage must be at most 1000%").required("Percentage is required")})});function he({title:s}){const{t:e}=$("image"),[c,l]=D.useState(null),[y,I]=D.useState(null),T=async(t,o)=>{o&&I(await q(o,t))},g=({values:t,updateField:o})=>[{title:e("resize.resizeMethod"),component:r.jsxs(j,{children:[r.jsx(b,{onClick:()=>o("resizeMethod","pixels"),checked:t.resizeMethod==="pixels",description:e("resize.resizeByPixelsDescription"),title:e("resize.resizeByPixels")}),r.jsx(b,{onClick:()=>o("resizeMethod","percentage"),checked:t.resizeMethod==="percentage",description:e("resize.resizeByPercentageDescription"),title:e("resize.resizeByPercentage")})]})},...t.resizeMethod==="pixels"?[{title:e("resize.dimensionType"),component:r.jsxs(j,{children:[r.jsx(H,{checked:t.maintainAspectRatio,onChange:i=>o("maintainAspectRatio",i),description:e("resize.maintainAspectRatioDescription"),title:e("resize.maintainAspectRatio")}),t.maintainAspectRatio&&r.jsxs(j,{children:[r.jsx(b,{onClick:()=>o("dimensionType","width"),checked:t.dimensionType==="width",description:e("resize.setWidthDescription"),title:e("resize.setWidth")}),r.jsx(b,{onClick:()=>o("dimensionType","height"),checked:t.dimensionType==="height",description:e("resize.setHeightDescription"),title:e("resize.setHeight")})]}),r.jsx(C,{value:t.width,onOwnChange:i=>o("width",i),description:e("resize.widthDescription"),disabled:t.maintainAspectRatio&&t.dimensionType==="height",inputProps:{"data-testid":"width-input",type:"number",min:1}}),r.jsx(C,{value:t.height,onOwnChange:i=>o("height",i),description:e("resize.heightDescription"),disabled:t.maintainAspectRatio&&t.dimensionType==="width",inputProps:{"data-testid":"height-input",type:"number",min:1}})]})}]:[{title:e("resize.percentage"),component:r.jsx(j,{children:r.jsx(C,{value:t.percentage,onOwnChange:i=>o("percentage",i),description:e("resize.percentageDescription"),inputProps:{"data-testid":"percentage-input",type:"number",min:1,max:1e3}})})}]];return r.jsx(W,{title:s,initialValues:O,getGroups:g,compute:T,input:c,validationSchema:L,inputComponent:r.jsx(F,{value:c,onChange:l,accept:["image/jpeg","image/png","image/svg+xml","image/gif"],title:e("resize.inputTitle")}),resultComponent:r.jsx(k,{title:e("resize.resultTitle"),value:y,extension:(c==null?void 0:c.name.split(".").pop())||"png"}),toolInfo:{title:e("resize.toolInfo.title"),description:e("resize.toolInfo.description")}})}export{he as default};
