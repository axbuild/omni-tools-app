var Sg=Object.defineProperty;var Hu=g=>{throw TypeError(g)};var Eg=(g,e,t)=>e in g?Sg(g,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):g[e]=t;var K=(g,e,t)=>Eg(g,typeof e!="symbol"?e+"":e,t),Yc=(g,e,t)=>e.has(g)||Hu("Cannot "+t);var a=(g,e,t)=>(Yc(g,e,"read from private field"),t?t.call(g):e.get(g)),S=(g,e,t)=>e.has(g)?Hu("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(g):e.set(g,t),y=(g,e,t,s)=>(Yc(g,e,"write to private field"),s?s.call(g,t):e.set(g,t),t),E=(g,e,t)=>(Yc(g,e,"access private method"),t);var ke=(g,e,t,s)=>({set _(i){y(g,e,i,t)},get _(){return a(g,e,s)}});import{E as Th,A as xg}from"./index-7JCrVMyd.js";import{c as Rh}from"./_commonjs-dynamic-modules-TDtrdbi3.js";const Me=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),nd=[.001,0,0,.001,0,0],Kc=1.35,rs={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Xi={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Cg="pdfjs_internal_editor_",ft={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,SIGNATURE:101},At={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},kg={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Ae={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Oh={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Zt={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Qr={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},jc={ERRORS:0,WARNINGS:1,INFOS:5},pc={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},Ih={moveTo:0,lineTo:1,curveTo:2,closePath:3},Tg={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Gc=jc.WARNINGS;function Rg(g){Number.isInteger(g)&&(Gc=g)}function Ig(){return Gc}function $c(g){Gc>=jc.INFOS&&console.log(`Info: ${g}`)}function pt(g){Gc>=jc.WARNINGS&&console.log(`Warning: ${g}`)}function Lt(g){throw new Error(g)}function Qt(g,e){g||Lt(e)}function Pg(g){switch(g==null?void 0:g.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function cf(g,e=null,t=null){if(!g)return null;if(t&&typeof g=="string"){if(t.addDefaultProtocol&&g.startsWith("www.")){const i=g.match(/\./g);(i==null?void 0:i.length)>=2&&(g=`http://${g}`)}if(t.tryConvertEncoding)try{g=Ng(g)}catch{}}const s=e?URL.parse(g,e):URL.parse(g);return Pg(s)?s:null}function df(g,e,t=!1){const s=URL.parse(g);return s?(s.hash=e,s.href):t&&cf(g,"http://example.com")?g.split("#",1)[0]+`${e?`#${e}`:""}`:""}function wt(g,e,t,s=!1){return Object.defineProperty(g,e,{value:t,enumerable:!s,configurable:!0,writable:!1}),t}const Zr=function(){function e(t,s){this.message=t,this.name=s}return e.prototype=new Error,e.constructor=e,e}();class Uu extends Zr{constructor(e,t){super(e,"PasswordException"),this.code=t}}class Zc extends Zr{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class rd extends Zr{constructor(e){super(e,"InvalidPDFException")}}class gc extends Zr{constructor(e,t,s){super(e,"ResponseException"),this.status=t,this.missing=s}}class Lg extends Zr{constructor(e){super(e,"FormatError")}}class Ln extends Zr{constructor(e){super(e,"AbortException")}}function uf(g){(typeof g!="object"||(g==null?void 0:g.length)===void 0)&&Lt("Invalid argument for bytesToString");const e=g.length,t=8192;if(e<t)return String.fromCharCode.apply(null,g);const s=[];for(let i=0;i<e;i+=t){const n=Math.min(i+t,e),r=g.subarray(i,n);s.push(String.fromCharCode.apply(null,r))}return s.join("")}function _h(g){typeof g!="string"&&Lt("Invalid argument for stringToBytes");const e=g.length,t=new Uint8Array(e);for(let s=0;s<e;++s)t[s]=g.charCodeAt(s)&255;return t}function Mg(g){return String.fromCharCode(g>>24&255,g>>16&255,g>>8&255,g&255)}function Dg(){const g=new Uint8Array(4);return g[0]=1,new Uint32Array(g.buffer,0,1)[0]===1}function Fg(){try{return new Function(""),!0}catch{return!1}}class we{static get isLittleEndian(){return wt(this,"isLittleEndian",Dg())}static get isEvalSupported(){return wt(this,"isEvalSupported",Fg())}static get isOffscreenCanvasSupported(){return wt(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return wt(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){const{platform:e,userAgent:t}=navigator;return wt(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}static get isCSSRoundSupported(){var e,t;return wt(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const Jc=Array.from(Array(256).keys(),g=>g.toString(16).padStart(2,"0"));var Gi,Bh,ad;class lt{static makeHexColor(e,t,s){return`#${Jc[e]}${Jc[t]}${Jc[s]}`}static scaleMinMax(e,t){let s;e[0]?(e[0]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[3],t[3]*=e[3]):(s=t[0],t[0]=t[1],t[1]=s,s=t[2],t[2]=t[3],t[3]=s,e[1]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t,s=0){const i=e[s],n=e[s+1];e[s]=i*t[0]+n*t[2]+t[4],e[s+1]=i*t[1]+n*t[3]+t[5]}static applyTransformToBezier(e,t,s=0){const i=t[0],n=t[1],r=t[2],o=t[3],l=t[4],h=t[5];for(let c=0;c<6;c+=2){const d=e[s+c],f=e[s+c+1];e[s+c]=d*i+f*r+l,e[s+c+1]=d*n+f*o+h}}static applyInverseTransform(e,t){const s=e[0],i=e[1],n=t[0]*t[3]-t[1]*t[2];e[0]=(s*t[3]-i*t[2]+t[2]*t[5]-t[4]*t[3])/n,e[1]=(-s*t[1]+i*t[0]+t[4]*t[1]-t[5]*t[0])/n}static axialAlignedBoundingBox(e,t,s){const i=t[0],n=t[1],r=t[2],o=t[3],l=t[4],h=t[5],c=e[0],d=e[1],f=e[2],u=e[3];let m=i*c+l,p=m,_=i*f+l,b=_,A=o*d+h,x=A,k=o*u+h,C=k;if(n!==0||r!==0){const P=n*c,R=n*f,D=r*d,M=r*u;m+=D,b+=D,_+=M,p+=M,A+=P,C+=P,k+=R,x+=R}s[0]=Math.min(s[0],m,_,p,b),s[1]=Math.min(s[1],A,k,x,C),s[2]=Math.max(s[2],m,_,p,b),s[3]=Math.max(s[3],A,k,x,C)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const s=e[0],i=e[1],n=e[2],r=e[3],o=s**2+i**2,l=s*n+i*r,h=n**2+r**2,c=(o+h)/2,d=Math.sqrt(c**2-(o*h-l**2));t[0]=Math.sqrt(c+d||1),t[1]=Math.sqrt(c-d||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const s=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),i=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(s>i)return null;const n=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),r=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return n>r?null:[s,n,i,r]}static pointBoundingBox(e,t,s){s[0]=Math.min(s[0],e),s[1]=Math.min(s[1],t),s[2]=Math.max(s[2],e),s[3]=Math.max(s[3],t)}static rectBoundingBox(e,t,s,i,n){n[0]=Math.min(n[0],e,s),n[1]=Math.min(n[1],t,i),n[2]=Math.max(n[2],e,s),n[3]=Math.max(n[3],t,i)}static bezierBoundingBox(e,t,s,i,n,r,o,l,h){h[0]=Math.min(h[0],e,o),h[1]=Math.min(h[1],t,l),h[2]=Math.max(h[2],e,o),h[3]=Math.max(h[3],t,l),E(this,Gi,ad).call(this,e,s,n,o,t,i,r,l,3*(-e+3*(s-n)+o),6*(e-2*s+n),3*(s-e),h),E(this,Gi,ad).call(this,e,s,n,o,t,i,r,l,3*(-t+3*(i-r)+l),6*(t-2*i+r),3*(i-t),h)}}Gi=new WeakSet,Bh=function(e,t,s,i,n,r,o,l,h,c){if(h<=0||h>=1)return;const d=1-h,f=h*h,u=f*h,m=d*(d*(d*e+3*h*t)+3*f*s)+u*i,p=d*(d*(d*n+3*h*r)+3*f*o)+u*l;c[0]=Math.min(c[0],m),c[1]=Math.min(c[1],p),c[2]=Math.max(c[2],m),c[3]=Math.max(c[3],p)},ad=function(e,t,s,i,n,r,o,l,h,c,d,f){if(Math.abs(h)<1e-12){Math.abs(c)>=1e-12&&E(this,Gi,Bh).call(this,e,t,s,i,n,r,o,l,-d/c,f);return}const u=c**2-4*d*h;if(u<0)return;const m=Math.sqrt(u),p=2*h;E(this,Gi,Bh).call(this,e,t,s,i,n,r,o,l,(-c+m)/p,f),E(this,Gi,Bh).call(this,e,t,s,i,n,r,o,l,(-c-m)/p,f)},S(lt,Gi);function Ng(g){return decodeURIComponent(escape(g))}let Qc=null,ju=null;function Og(g){return Qc||(Qc=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,ju=new Map([["ﬅ","ſt"]])),g.replaceAll(Qc,(e,t,s)=>t?t.normalize("NFKC"):ju.get(s))}function ff(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const g=new Uint8Array(32);return crypto.getRandomValues(g),uf(g)}const vu="pdfjs_internal_id_";function Bg(g,e,t){if(!Array.isArray(t)||t.length<2)return!1;const[s,i,...n]=t;if(!g(s)&&!Number.isInteger(s)||!e(i))return!1;const r=n.length;let o=!0;switch(i.name){case"XYZ":if(r<2||r>3)return!1;break;case"Fit":case"FitB":return r===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(r>1)return!1;break;case"FitR":if(r!==4)return!1;o=!1;break;default:return!1}for(const l of n)if(!(typeof l=="number"||o&&l===null))return!1;return!0}function De(g,e,t){return Math.min(Math.max(g,e),t)}function pf(g){return Uint8Array.prototype.toBase64?g.toBase64():btoa(uf(g))}function zg(g){return Uint8Array.fromBase64?Uint8Array.fromBase64(g):_h(atob(g))}typeof Promise.try!="function"&&(Promise.try=function(g,...e){return new Promise(t=>{t(g(...e))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(g){return g.reduce((e,t)=>e+t,0)});const oi="http://www.w3.org/2000/svg",Hn=class Hn{};K(Hn,"CSS",96),K(Hn,"PDF",72),K(Hn,"PDF_TO_CSS_UNITS",Hn.CSS/Hn.PDF);let Mn=Hn;async function wh(g,e="text"){if(Eo(g,document.baseURI)){const t=await fetch(g);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,s)=>{const i=new XMLHttpRequest;i.open("GET",g,!0),i.responseType=e,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(i.response);return}t(i.responseText);return}s(new Error(i.statusText))}},i.send(null)})}class Ah{constructor({viewBox:e,userUnit:t,scale:s,rotation:i,offsetX:n=0,offsetY:r=0,dontFlip:o=!1}){this.viewBox=e,this.userUnit=t,this.scale=s,this.rotation=i,this.offsetX=n,this.offsetY=r,s*=t;const l=(e[2]+e[0])/2,h=(e[3]+e[1])/2;let c,d,f,u;switch(i%=360,i<0&&(i+=360),i){case 180:c=-1,d=0,f=0,u=1;break;case 90:c=0,d=1,f=1,u=0;break;case 270:c=0,d=-1,f=-1,u=0;break;case 0:c=1,d=0,f=0,u=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(f=-f,u=-u);let m,p,_,b;c===0?(m=Math.abs(h-e[1])*s+n,p=Math.abs(l-e[0])*s+r,_=(e[3]-e[1])*s,b=(e[2]-e[0])*s):(m=Math.abs(l-e[0])*s+n,p=Math.abs(h-e[1])*s+r,_=(e[2]-e[0])*s,b=(e[3]-e[1])*s),this.transform=[c*s,d*s,f*s,u*s,m-c*s*l-f*s*h,p-d*s*l-u*s*h],this.width=_,this.height=b}get rawDims(){const e=this.viewBox;return wt(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:s=this.offsetX,offsetY:i=this.offsetY,dontFlip:n=!1}={}){return new Ah({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:i,dontFlip:n})}convertToViewportPoint(e,t){const s=[e,t];return lt.applyTransform(s,this.transform),s}convertToViewportRectangle(e){const t=[e[0],e[1]];lt.applyTransform(t,this.transform);const s=[e[2],e[3]];return lt.applyTransform(s,this.transform),[t[0],t[1],s[0],s[1]]}convertToPdfPoint(e,t){const s=[e,t];return lt.applyInverseTransform(s,this.transform),s}}class Su extends Zr{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function Wc(g){const e=g.length;let t=0;for(;t<e&&g[t].trim()==="";)t++;return g.substring(t,t+5).toLowerCase()==="data:"}function Eu(g){return typeof g=="string"&&/\.pdf$/i.test(g)}function Hg(g){return[g]=g.split(/[#?]/,1),g.substring(g.lastIndexOf("/")+1)}function Ug(g,e="document.pdf"){if(typeof g!="string")return e;if(Wc(g))return pt('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,s=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,i=t.exec(g);let n=s.exec(i[1])||s.exec(i[2])||s.exec(i[3]);if(n&&(n=n[0],n.includes("%")))try{n=s.exec(decodeURIComponent(n))[0]}catch{}return n||e}class Gu{constructor(){K(this,"started",Object.create(null));K(this,"times",[])}time(e){e in this.started&&pt(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||pt(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:s}of this.times)t=Math.max(s.length,t);for(const{name:s,start:i,end:n}of this.times)e.push(`${s.padEnd(t)} ${n-i}ms
`);return e.join("")}}function Eo(g,e){const t=e?URL.parse(g,e):URL.parse(g);return(t==null?void 0:t.protocol)==="http:"||(t==null?void 0:t.protocol)==="https:"}function Ns(g){g.preventDefault()}function Jt(g){g.preventDefault(),g.stopPropagation()}function jg(g){console.log("Deprecated API usage: "+g)}var Vo;class xu{static toDateObject(e){if(!e||typeof e!="string")return null;a(this,Vo)||y(this,Vo,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=a(this,Vo).exec(e);if(!t)return null;const s=parseInt(t[1],10);let i=parseInt(t[2],10);i=i>=1&&i<=12?i-1:0;let n=parseInt(t[3],10);n=n>=1&&n<=31?n:1;let r=parseInt(t[4],10);r=r>=0&&r<=23?r:0;let o=parseInt(t[5],10);o=o>=0&&o<=59?o:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;const h=t[7]||"Z";let c=parseInt(t[8],10);c=c>=0&&c<=23?c:0;let d=parseInt(t[9],10)||0;return d=d>=0&&d<=59?d:0,h==="-"?(r+=c,o+=d):h==="+"&&(r-=c,o-=d),new Date(Date.UTC(s,i,n,r,o,l))}}Vo=new WeakMap,S(xu,Vo);function Gg(g,{scale:e=1,rotation:t=0}){const{width:s,height:i}=g.attributes.style,n=[0,0,parseInt(s),parseInt(i)];return new Ah({viewBox:n,userUnit:1,scale:e,rotation:t})}function Cu(g){if(g.startsWith("#")){const e=parseInt(g.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return g.startsWith("rgb(")?g.slice(4,-1).split(",").map(e=>parseInt(e)):g.startsWith("rgba(")?g.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(pt(`Not a valid color format: "${g}"`),[0,0,0])}function $g(g){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const t of g.keys()){e.style.color=t;const s=window.getComputedStyle(e).color;g.set(t,Cu(s))}e.remove()}function Gt(g){const{a:e,b:t,c:s,d:i,e:n,f:r}=g.getTransform();return[e,t,s,i,n,r]}function zs(g){const{a:e,b:t,c:s,d:i,e:n,f:r}=g.getTransform().invertSelf();return[e,t,s,i,n,r]}function qr(g,e,t=!1,s=!0){if(e instanceof Ah){const{pageWidth:i,pageHeight:n}=e.rawDims,{style:r}=g,o=we.isCSSRoundSupported,l=`var(--total-scale-factor) * ${i}px`,h=`var(--total-scale-factor) * ${n}px`,c=o?`round(down, ${l}, var(--scale-round-x))`:`calc(${l})`,d=o?`round(down, ${h}, var(--scale-round-y))`:`calc(${h})`;!t||e.rotation%180===0?(r.width=c,r.height=d):(r.width=d,r.height=c)}s&&g.setAttribute("data-main-rotation",e.rotation)}class ni{constructor(){const{pixelRatio:e}=ni;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,s,i,n=-1){let r=1/0,o=1/0,l=1/0;s=ni.capPixels(s,n),s>0&&(r=Math.sqrt(s/(e*t))),i!==-1&&(o=i/e,l=i/t);const h=Math.min(r,o,l);return this.sx>h||this.sy>h?(this.sx=h,this.sy=h,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){const s=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,s):s}return e}}const od=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];var qi,jn,ds,Yi,Xo,ca,qo,Sc,gf,_e,mf,bf,xo,yf,zh;const ci=class ci{constructor(e){S(this,_e);S(this,qi,null);S(this,jn,null);S(this,ds);S(this,Yi,null);S(this,Xo,null);S(this,ca,null);y(this,ds,e),a(ci,qo)||y(ci,qo,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"}))}render(){const e=y(this,qi,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=a(this,ds)._uiManager._signal;e.addEventListener("contextmenu",Ns,{signal:t}),e.addEventListener("pointerdown",E(ci,Sc,gf),{signal:t});const s=y(this,Yi,document.createElement("div"));s.className="buttons",e.append(s);const i=a(this,ds).toolbarPosition;if(i){const{style:n}=e,r=a(this,ds)._uiManager.direction==="ltr"?1-i[0]:i[0];n.insetInlineEnd=`${100*r}%`,n.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return E(this,_e,yf).call(this),e}get div(){return a(this,qi)}hide(){var e;a(this,qi).classList.add("hidden"),(e=a(this,jn))==null||e.hideDropdown()}show(){var e;a(this,qi).classList.remove("hidden"),(e=a(this,Xo))==null||e.shown()}async addAltText(e){const t=await e.render();E(this,_e,xo).call(this,t),a(this,Yi).prepend(t,a(this,_e,zh)),y(this,Xo,e)}addColorPicker(e){y(this,jn,e);const t=e.renderButton();E(this,_e,xo).call(this,t),a(this,Yi).prepend(t,a(this,_e,zh))}async addEditSignatureButton(e){const t=y(this,ca,await e.renderEditButton(a(this,ds)));E(this,_e,xo).call(this,t),a(this,Yi).prepend(t,a(this,_e,zh))}updateEditSignatureButton(e){a(this,ca)&&(a(this,ca).title=e)}remove(){var e;a(this,qi).remove(),(e=a(this,jn))==null||e.destroy(),y(this,jn,null)}};qi=new WeakMap,jn=new WeakMap,ds=new WeakMap,Yi=new WeakMap,Xo=new WeakMap,ca=new WeakMap,qo=new WeakMap,Sc=new WeakSet,gf=function(e){e.stopPropagation()},_e=new WeakSet,mf=function(e){a(this,ds)._focusEventsAllowed=!1,Jt(e)},bf=function(e){a(this,ds)._focusEventsAllowed=!0,Jt(e)},xo=function(e){const t=a(this,ds)._uiManager._signal;e.addEventListener("focusin",E(this,_e,mf).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",E(this,_e,bf).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",Ns,{signal:t})},yf=function(){const{editorType:e,_uiManager:t}=a(this,ds),s=document.createElement("button");s.className="delete",s.tabIndex=0,s.setAttribute("data-l10n-id",a(ci,qo)[e]),E(this,_e,xo).call(this,s),s.addEventListener("click",i=>{t.delete()},{signal:t._signal}),a(this,Yi).append(s)},zh=function(){const e=document.createElement("div");return e.className="divider",e},S(ci,Sc),S(ci,qo,null);let ld=ci;var Yo,Gn,$n,Dn,_f,wf,Af;class Wg{constructor(e){S(this,Dn);S(this,Yo,null);S(this,Gn,null);S(this,$n);y(this,$n,e)}show(e,t,s){const[i,n]=E(this,Dn,wf).call(this,t,s),{style:r}=a(this,Gn)||y(this,Gn,E(this,Dn,_f).call(this));e.append(a(this,Gn)),r.insetInlineEnd=`${100*i}%`,r.top=`calc(${100*n}% + var(--editor-toolbar-vert-offset))`}hide(){a(this,Gn).remove()}}Yo=new WeakMap,Gn=new WeakMap,$n=new WeakMap,Dn=new WeakSet,_f=function(){const e=y(this,Gn,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",Ns,{signal:a(this,$n)._signal});const t=y(this,Yo,document.createElement("div"));return t.className="buttons",e.append(t),E(this,Dn,Af).call(this),e},wf=function(e,t){let s=0,i=0;for(const n of e){const r=n.y+n.height;if(r<s)continue;const o=n.x+(t?n.width:0);if(r>s){i=o,s=r;continue}t?o>i&&(i=o):o<i&&(i=o)}return[t?1-i:i,s]},Af=function(){const e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const s=a(this,$n)._signal;e.addEventListener("contextmenu",Ns,{signal:s}),e.addEventListener("click",()=>{a(this,$n).highlightSelection("floating_button")},{signal:s}),a(this,Yo).append(e)};function vf(g,e,t){for(const s of t)e.addEventListener(s,g[s].bind(g))}var Ec;class Vg{constructor(){S(this,Ec,0)}get id(){return`${Cg}${ke(this,Ec)._++}`}}Ec=new WeakMap;var da,Ko,Se,ua,Hh;const Mu=class Mu{constructor(){S(this,ua);S(this,da,ff());S(this,Ko,0);S(this,Se,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=e;const n=i.decode().then(()=>(s.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return wt(this,"_isSVGFittingCanvas",n)}async getFromFile(e){const{lastModified:t,name:s,size:i,type:n}=e;return E(this,ua,Hh).call(this,`${t}_${s}_${i}_${n}`,e)}async getFromUrl(e){return E(this,ua,Hh).call(this,e,e)}async getFromBlob(e,t){const s=await t;return E(this,ua,Hh).call(this,e,s)}async getFromId(e){a(this,Se)||y(this,Se,new Map);const t=a(this,Se).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:s}=t;return delete t.blobPromise,this.getFromBlob(t.id,s)}return this.getFromUrl(t.url)}getFromCanvas(e,t){a(this,Se)||y(this,Se,new Map);let s=a(this,Se).get(e);if(s!=null&&s.bitmap)return s.refCounter+=1,s;const i=new OffscreenCanvas(t.width,t.height);return i.getContext("2d").drawImage(t,0,0),s={bitmap:i.transferToImageBitmap(),id:`image_${a(this,da)}_${ke(this,Ko)._++}`,refCounter:1,isSvg:!1},a(this,Se).set(e,s),a(this,Se).set(s.id,s),s}getSvgUrl(e){const t=a(this,Se).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var i;a(this,Se)||y(this,Se,new Map);const t=a(this,Se).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:s}=t;if(!t.url&&!t.file){const n=new OffscreenCanvas(s.width,s.height);n.getContext("bitmaprenderer").transferFromImageBitmap(s),t.blobPromise=n.convertToBlob()}(i=s.close)==null||i.call(s),t.bitmap=null}isValidId(e){return e.startsWith(`image_${a(this,da)}_`)}};da=new WeakMap,Ko=new WeakMap,Se=new WeakMap,ua=new WeakSet,Hh=async function(e,t){a(this,Se)||y(this,Se,new Map);let s=a(this,Se).get(e);if(s===null)return null;if(s!=null&&s.bitmap)return s.refCounter+=1,s;try{s||(s={bitmap:null,id:`image_${a(this,da)}_${ke(this,Ko)._++}`,refCounter:0,isSvg:!1});let i;if(typeof t=="string"?(s.url=t,i=await wh(t,"blob")):t instanceof File?i=s.file=t:t instanceof Blob&&(i=t),i.type==="image/svg+xml"){const n=Mu._isSVGFittingCanvas,r=new FileReader,o=new Image,l=new Promise((h,c)=>{o.onload=()=>{s.bitmap=o,s.isSvg=!0,h()},r.onload=async()=>{const d=s.svgUrl=r.result;o.src=await n?`${d}#svgView(preserveAspectRatio(none))`:d},o.onerror=r.onerror=c});r.readAsDataURL(i),await l}else s.bitmap=await createImageBitmap(i);s.refCounter=1}catch(i){pt(i),s=null}return a(this,Se).set(e,s),s&&a(this,Se).set(s.id,s),s};let hd=Mu;var Vt,Ki,Zo,jt;class Xg{constructor(e=128){S(this,Vt,[]);S(this,Ki,!1);S(this,Zo);S(this,jt,-1);y(this,Zo,e)}add({cmd:e,undo:t,post:s,mustExec:i,type:n=NaN,overwriteIfSameType:r=!1,keepUndo:o=!1}){if(i&&e(),a(this,Ki))return;const l={cmd:e,undo:t,post:s,type:n};if(a(this,jt)===-1){a(this,Vt).length>0&&(a(this,Vt).length=0),y(this,jt,0),a(this,Vt).push(l);return}if(r&&a(this,Vt)[a(this,jt)].type===n){o&&(l.undo=a(this,Vt)[a(this,jt)].undo),a(this,Vt)[a(this,jt)]=l;return}const h=a(this,jt)+1;h===a(this,Zo)?a(this,Vt).splice(0,1):(y(this,jt,h),h<a(this,Vt).length&&a(this,Vt).splice(h)),a(this,Vt).push(l)}undo(){if(a(this,jt)===-1)return;y(this,Ki,!0);const{undo:e,post:t}=a(this,Vt)[a(this,jt)];e(),t==null||t(),y(this,Ki,!1),y(this,jt,a(this,jt)-1)}redo(){if(a(this,jt)<a(this,Vt).length-1){y(this,jt,a(this,jt)+1),y(this,Ki,!0);const{cmd:e,post:t}=a(this,Vt)[a(this,jt)];e(),t==null||t(),y(this,Ki,!1)}}hasSomethingToUndo(){return a(this,jt)!==-1}hasSomethingToRedo(){return a(this,jt)<a(this,Vt).length-1}cleanType(e){if(a(this,jt)!==-1){for(let t=a(this,jt);t>=0;t--)if(a(this,Vt)[t].type!==e){a(this,Vt).splice(t+1,a(this,jt)-t),y(this,jt,t);return}a(this,Vt).length=0,y(this,jt,-1)}}destroy(){y(this,Vt,null)}}Vt=new WeakMap,Ki=new WeakMap,Zo=new WeakMap,jt=new WeakMap;var xc,Sf;class vh{constructor(e){S(this,xc);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=we.platform;for(const[s,i,n={}]of e)for(const r of s){const o=r.startsWith("mac+");t&&o?(this.callbacks.set(r.slice(4),{callback:i,options:n}),this.allKeys.add(r.split("+").at(-1))):!t&&!o&&(this.callbacks.set(r,{callback:i,options:n}),this.allKeys.add(r.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const s=this.callbacks.get(E(this,xc,Sf).call(this,t));if(!s)return;const{callback:i,options:{bubbles:n=!1,args:r=[],checker:o=null}}=s;o&&!o(e,t)||(i.bind(e,...r,t)(),n||Jt(t))}}xc=new WeakSet,Sf=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const Cc=class Cc{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return $g(e),wt(this,"_colors",e)}convert(e){const t=Cu(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[s,i]of this._colors)if(i.every((n,r)=>n===t[r]))return Cc._colorsMapping.get(s);return t}getHexCode(e){const t=this._colors.get(e);return t?lt.makeHexColor(...t):e}};K(Cc,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let cd=Cc;var fa,Ve,ie,ue,pa,ui,ga,us,Zi,Ji,ma,Wn,js,vs,Vn,Jo,Qo,ba,tl,Gs,Qi,ya,tn,$s,kc,en,el,sn,Xn,qn,nn,sl,ae,Rt,fi,rn,Yn,il,nl,an,Ws,pi,rl,fs,tt,Uh,dd,Ef,xf,jh,Cf,kf,Tf,ud,Rf,fd,pd,If,Te,li,Pf,Lf,gd,Mf,Co,md;const oa=class oa{constructor(e,t,s,i,n,r,o,l,h,c,d,f,u,m){S(this,tt);S(this,fa,new AbortController);S(this,Ve,null);S(this,ie,new Map);S(this,ue,new Map);S(this,pa,null);S(this,ui,null);S(this,ga,null);S(this,us,new Xg);S(this,Zi,null);S(this,Ji,null);S(this,ma,0);S(this,Wn,new Set);S(this,js,null);S(this,vs,null);S(this,Vn,new Set);K(this,"_editorUndoBar",null);S(this,Jo,!1);S(this,Qo,!1);S(this,ba,!1);S(this,tl,null);S(this,Gs,null);S(this,Qi,null);S(this,ya,null);S(this,tn,!1);S(this,$s,null);S(this,kc,new Vg);S(this,en,!1);S(this,el,!1);S(this,sn,null);S(this,Xn,null);S(this,qn,null);S(this,nn,null);S(this,sl,null);S(this,ae,ft.NONE);S(this,Rt,new Set);S(this,fi,null);S(this,rn,null);S(this,Yn,null);S(this,il,null);S(this,nl,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});S(this,an,[0,0]);S(this,Ws,null);S(this,pi,null);S(this,rl,null);S(this,fs,null);const p=this._signal=a(this,fa).signal;y(this,pi,e),y(this,rl,t),y(this,pa,s),y(this,rn,i),this._eventBus=n,n._on("editingaction",this.onEditingAction.bind(this),{signal:p}),n._on("pagechanging",this.onPageChanging.bind(this),{signal:p}),n._on("scalechanging",this.onScaleChanging.bind(this),{signal:p}),n._on("rotationchanging",this.onRotationChanging.bind(this),{signal:p}),n._on("setpreference",this.onSetPreference.bind(this),{signal:p}),n._on("switchannotationeditorparams",_=>this.updateParams(_.type,_.value),{signal:p}),E(this,tt,Cf).call(this),E(this,tt,If).call(this),E(this,tt,ud).call(this),y(this,ui,r.annotationStorage),y(this,tl,r.filterFactory),y(this,Yn,o),y(this,ya,l||null),y(this,Jo,h),y(this,Qo,c),y(this,ba,d),y(this,sl,f||null),this.viewParameters={realScale:Mn.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=u||null,this._supportsPinchToZoom=m!==!1}static get _keyboardManager(){const e=oa.prototype,t=r=>a(r,pi).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&r.hasSomethingToControl(),s=(r,{target:o})=>{if(o instanceof HTMLInputElement){const{type:l}=o;return l!=="text"&&l!=="number"}return!0},i=this.TRANSLATE_SMALL,n=this.TRANSLATE_BIG;return wt(this,"_keyboardManager",new vh([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],e.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:s}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(r,{target:o})=>!(o instanceof HTMLButtonElement)&&a(r,pi).contains(o)&&!r.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(r,{target:o})=>!(o instanceof HTMLButtonElement)&&a(r,pi).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-n,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[n,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-n],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,n],checker:t}]]))}destroy(){var e,t,s,i,n,r,o,l;(e=a(this,fs))==null||e.resolve(),y(this,fs,null),(t=a(this,fa))==null||t.abort(),y(this,fa,null),this._signal=null;for(const h of a(this,ue).values())h.destroy();a(this,ue).clear(),a(this,ie).clear(),a(this,Vn).clear(),(s=a(this,nn))==null||s.clear(),y(this,Ve,null),a(this,Rt).clear(),a(this,us).destroy(),(i=a(this,pa))==null||i.destroy(),(n=a(this,rn))==null||n.destroy(),(r=a(this,$s))==null||r.hide(),y(this,$s,null),(o=a(this,qn))==null||o.destroy(),y(this,qn,null),a(this,Gs)&&(clearTimeout(a(this,Gs)),y(this,Gs,null)),a(this,Ws)&&(clearTimeout(a(this,Ws)),y(this,Ws,null)),(l=this._editorUndoBar)==null||l.destroy()}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return a(this,sl)}get useNewAltTextFlow(){return a(this,Qo)}get useNewAltTextWhenAddingImage(){return a(this,ba)}get hcmFilter(){return wt(this,"hcmFilter",a(this,Yn)?a(this,tl).addHCMFilter(a(this,Yn).foreground,a(this,Yn).background):"none")}get direction(){return wt(this,"direction",getComputedStyle(a(this,pi)).direction)}get highlightColors(){return wt(this,"highlightColors",a(this,ya)?new Map(a(this,ya).split(",").map(e=>e.split("=").map(t=>t.trim()))):null)}get highlightColorNames(){return wt(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),y(this,Ji,e)}setMainHighlightColorPicker(e){y(this,qn,e)}editAltText(e,t=!1){var s;(s=a(this,pa))==null||s.editAltText(this,e,t)}getSignature(e){var t;(t=a(this,rn))==null||t.getSignature({uiManager:this,editor:e})}get signatureManager(){return a(this,rn)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":y(this,ba,t);break}}onPageChanging({pageNumber:e}){y(this,ma,e-1)}focusMainContainer(){a(this,pi).focus()}findParent(e,t){for(const s of a(this,ue).values()){const{x:i,y:n,width:r,height:o}=s.div.getBoundingClientRect();if(e>=i&&e<=i+r&&t>=n&&t<=n+o)return s}return null}disableUserSelect(e=!1){a(this,rl).classList.toggle("noUserSelect",e)}addShouldRescale(e){a(this,Vn).add(e)}removeShouldRescale(e){a(this,Vn).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*Mn.PDF_TO_CSS_UNITS;for(const s of a(this,Vn))s.onScaleChanging();(t=a(this,Ji))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e=""){const t=document.getSelection();if(!t||t.isCollapsed)return;const{anchorNode:s,anchorOffset:i,focusNode:n,focusOffset:r}=t,o=t.toString(),h=E(this,tt,Uh).call(this,t).closest(".textLayer"),c=this.getSelectionBoxes(h);if(!c)return;t.empty();const d=E(this,tt,dd).call(this,h),f=a(this,ae)===ft.NONE,u=()=>{d==null||d.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:c,anchorNode:s,anchorOffset:i,focusNode:n,focusOffset:r,text:o}),f&&this.showAllEditors("highlight",!0,!0)};if(f){this.switchToMode(ft.HIGHLIGHT,u);return}u()}addToAnnotationStorage(e){!e.isEmpty()&&a(this,ui)&&!a(this,ui).has(e.id)&&a(this,ui).setValue(e.id,e)}blur(){if(this.isShiftKeyDown=!1,a(this,tn)&&(y(this,tn,!1),E(this,tt,jh).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of a(this,Rt))if(t.div.contains(e)){y(this,Xn,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!a(this,Xn))return;const[e,t]=a(this,Xn);y(this,Xn,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){E(this,tt,ud).call(this),E(this,tt,fd).call(this)}removeEditListeners(){E(this,tt,Rf).call(this),E(this,tt,pd).call(this)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const s of a(this,vs))if(s.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const s of a(this,vs))if(s.isHandlingMimeForPasting(t.type)){s.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var s;if(e.preventDefault(),(s=a(this,Ve))==null||s.commitOrRemove(),!this.hasSelection)return;const t=[];for(const i of a(this,Rt)){const n=i.serialize(!0);n&&t.push(n)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const n of t.items)for(const r of a(this,vs))if(r.isHandlingMimeForPasting(n.type)){r.paste(n,this.currentLayer);return}let s=t.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(n){pt(`paste: "${n.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const i=this.currentLayer;try{const n=[];for(const l of s){const h=await i.deserialize(l);if(!h)return;n.push(h)}const r=()=>{for(const l of n)E(this,tt,gd).call(this,l);E(this,tt,md).call(this,n)},o=()=>{for(const l of n)l.remove()};this.addCommands({cmd:r,undo:o,mustExec:!0})}catch(n){pt(`paste: "${n.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),a(this,ae)!==ft.NONE&&!this.isEditorHandlingKeyboard&&oa._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,a(this,tn)&&(y(this,tn,!1),E(this,tt,jh).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(e){e?(E(this,tt,kf).call(this),E(this,tt,fd).call(this),E(this,tt,Te).call(this,{isEditing:a(this,ae)!==ft.NONE,isEmpty:E(this,tt,Co).call(this),hasSomethingToUndo:a(this,us).hasSomethingToUndo(),hasSomethingToRedo:a(this,us).hasSomethingToRedo(),hasSelectedEditor:!1})):(E(this,tt,Tf).call(this),E(this,tt,pd).call(this),E(this,tt,Te).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!a(this,vs)){y(this,vs,e);for(const t of a(this,vs))E(this,tt,li).call(this,t.defaultPropertiesToUpdate)}}getId(){return a(this,kc).id}get currentLayer(){return a(this,ue).get(a(this,ma))}getLayer(e){return a(this,ue).get(e)}get currentPageIndex(){return a(this,ma)}addLayer(e){a(this,ue).set(e.pageIndex,e),a(this,en)?e.enable():e.disable()}removeLayer(e){a(this,ue).delete(e.pageIndex)}async updateMode(e,t=null,s=!1){var i,n,r;if(a(this,ae)!==e&&!(a(this,fs)&&(await a(this,fs).promise,!a(this,fs)))){if(y(this,fs,Promise.withResolvers()),(i=a(this,Ji))==null||i.commitOrRemove(),y(this,ae,e),e===ft.NONE){this.setEditingState(!1),E(this,tt,Lf).call(this),(n=this._editorUndoBar)==null||n.hide(),a(this,fs).resolve();return}e===ft.SIGNATURE&&await((r=a(this,rn))==null?void 0:r.loadSignatures()),this.setEditingState(!0),await E(this,tt,Pf).call(this),this.unselectAll();for(const o of a(this,ue).values())o.updateMode(e);if(!t){s&&this.addNewEditorFromKeyboard(),a(this,fs).resolve();return}for(const o of a(this,ie).values())o.annotationElementId===t||o.id===t?(this.setSelected(o),o.enterInEditMode()):o.unselect();a(this,fs).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==a(this,ae)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,t){var s;if(a(this,vs)){switch(e){case At.CREATE:this.currentLayer.addNewEditor(t);return;case At.HIGHLIGHT_DEFAULT_COLOR:(s=a(this,qn))==null||s.updateColor(t);break;case At.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(a(this,il)||y(this,il,new Map)).set(e,t),this.showAllEditors("highlight",t);break}for(const i of a(this,Rt))i.updateParams(e,t);for(const i of a(this,vs))i.updateDefaultParams(e,t)}}showAllEditors(e,t,s=!1){var n;for(const r of a(this,ie).values())r.editorType===e&&r.show(t);(((n=a(this,il))==null?void 0:n.get(At.HIGHLIGHT_SHOW_ALL))??!0)!==t&&E(this,tt,li).call(this,[[At.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(a(this,el)!==e){y(this,el,e);for(const t of a(this,ue).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}getEditors(e){const t=[];for(const s of a(this,ie).values())s.pageIndex===e&&t.push(s);return t}getEditor(e){return a(this,ie).get(e)}addEditor(e){a(this,ie).set(e.id,e)}removeEditor(e){var t,s;e.div.contains(document.activeElement)&&(a(this,Gs)&&clearTimeout(a(this,Gs)),y(this,Gs,setTimeout(()=>{this.focusMainContainer(),y(this,Gs,null)},0))),a(this,ie).delete(e.id),e.annotationElementId&&((t=a(this,nn))==null||t.delete(e.annotationElementId)),this.unselect(e),(!e.annotationElementId||!a(this,Wn).has(e.annotationElementId))&&((s=a(this,ui))==null||s.remove(e.id))}addDeletedAnnotationElement(e){a(this,Wn).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return a(this,Wn).has(e)}removeDeletedAnnotationElement(e){a(this,Wn).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){a(this,Ve)!==e&&(y(this,Ve,e),e&&E(this,tt,li).call(this,e.propertiesToUpdate))}updateUI(e){a(this,tt,Mf)===e&&E(this,tt,li).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){E(this,tt,li).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(a(this,Rt).has(e)){a(this,Rt).delete(e),e.unselect(),E(this,tt,Te).call(this,{hasSelectedEditor:this.hasSelection});return}a(this,Rt).add(e),e.select(),E(this,tt,li).call(this,e.propertiesToUpdate),E(this,tt,Te).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;(t=a(this,Ji))==null||t.commitOrRemove();for(const s of a(this,Rt))s!==e&&s.unselect();a(this,Rt).clear(),a(this,Rt).add(e),e.select(),E(this,tt,li).call(this,e.propertiesToUpdate),E(this,tt,Te).call(this,{hasSelectedEditor:!0})}isSelected(e){return a(this,Rt).has(e)}get firstSelectedEditor(){return a(this,Rt).values().next().value}unselect(e){e.unselect(),a(this,Rt).delete(e),E(this,tt,Te).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return a(this,Rt).size!==0}get isEnterHandled(){return a(this,Rt).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;a(this,us).undo(),E(this,tt,Te).call(this,{hasSomethingToUndo:a(this,us).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:E(this,tt,Co).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){a(this,us).redo(),E(this,tt,Te).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:a(this,us).hasSomethingToRedo(),isEmpty:E(this,tt,Co).call(this)})}addCommands(e){a(this,us).add(e),E(this,tt,Te).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:E(this,tt,Co).call(this)})}cleanUndoStack(e){a(this,us).cleanType(e)}delete(){var n;this.commitOrRemove();const e=(n=this.currentLayer)==null?void 0:n.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...a(this,Rt)],s=()=>{var r;(r=this._editorUndoBar)==null||r.show(i,t.length===1?t[0].editorType:t.length);for(const o of t)o.remove()},i=()=>{for(const r of t)E(this,tt,gd).call(this,r)};this.addCommands({cmd:s,undo:i,mustExec:!0})}commitOrRemove(){var e;(e=a(this,Ve))==null||e.commitOrRemove()}hasSomethingToControl(){return a(this,Ve)||this.hasSelection}selectAll(){for(const e of a(this,Rt))e.commit();E(this,tt,md).call(this,a(this,ie).values())}unselectAll(){var e;if(!(a(this,Ve)&&(a(this,Ve).commitOrRemove(),a(this,ae)!==ft.NONE))&&!((e=a(this,Ji))!=null&&e.commitOrRemove())&&this.hasSelection){for(const t of a(this,Rt))t.unselect();a(this,Rt).clear(),E(this,tt,Te).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;a(this,an)[0]+=e,a(this,an)[1]+=t;const[i,n]=a(this,an),r=[...a(this,Rt)],o=1e3;a(this,Ws)&&clearTimeout(a(this,Ws)),y(this,Ws,setTimeout(()=>{y(this,Ws,null),a(this,an)[0]=a(this,an)[1]=0,this.addCommands({cmd:()=>{for(const l of r)a(this,ie).has(l.id)&&(l.translateInPage(i,n),l.translationDone())},undo:()=>{for(const l of r)a(this,ie).has(l.id)&&(l.translateInPage(-i,-n),l.translationDone())},mustExec:!1})},o));for(const l of r)l.translateInPage(e,t),l.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),y(this,js,new Map);for(const e of a(this,Rt))a(this,js).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!a(this,js))return!1;this.disableUserSelect(!1);const e=a(this,js);y(this,js,null);let t=!1;for(const[{x:i,y:n,pageIndex:r},o]of e)o.newX=i,o.newY=n,o.newPageIndex=r,t||(t=i!==o.savedX||n!==o.savedY||r!==o.savedPageIndex);if(!t)return!1;const s=(i,n,r,o)=>{if(a(this,ie).has(i.id)){const l=a(this,ue).get(o);l?i._setParentAndPosition(l,n,r):(i.pageIndex=o,i.x=n,i.y=r)}};return this.addCommands({cmd:()=>{for(const[i,{newX:n,newY:r,newPageIndex:o}]of e)s(i,n,r,o)},undo:()=>{for(const[i,{savedX:n,savedY:r,savedPageIndex:o}]of e)s(i,n,r,o)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(a(this,js))for(const s of a(this,js).keys())s.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||a(this,Rt).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return a(this,Ve)===e}getActive(){return a(this,Ve)}getMode(){return a(this,ae)}get imageManager(){return wt(this,"imageManager",new hd)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let h=0,c=t.rangeCount;h<c;h++)if(!e.contains(t.getRangeAt(h).commonAncestorContainer))return null;const{x:s,y:i,width:n,height:r}=e.getBoundingClientRect();let o;switch(e.getAttribute("data-main-rotation")){case"90":o=(h,c,d,f)=>({x:(c-i)/r,y:1-(h+d-s)/n,width:f/r,height:d/n});break;case"180":o=(h,c,d,f)=>({x:1-(h+d-s)/n,y:1-(c+f-i)/r,width:d/n,height:f/r});break;case"270":o=(h,c,d,f)=>({x:1-(c+f-i)/r,y:(h-s)/n,width:f/r,height:d/n});break;default:o=(h,c,d,f)=>({x:(h-s)/n,y:(c-i)/r,width:d/n,height:f/r});break}const l=[];for(let h=0,c=t.rangeCount;h<c;h++){const d=t.getRangeAt(h);if(!d.collapsed)for(const{x:f,y:u,width:m,height:p}of d.getClientRects())m===0||p===0||l.push(o(f,u,m,p))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:e,id:t}){(a(this,ga)||y(this,ga,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=a(this,ga))==null||t.delete(e)}renderAnnotationElement(e){var i;const t=(i=a(this,ga))==null?void 0:i.get(e.data.id);if(!t)return;const s=a(this,ui).getRawValue(t);s&&(a(this,ae)===ft.NONE&&!s.hasBeenModified||s.renderAnnotationElement(e))}setMissingCanvas(e,t,s){var n;const i=(n=a(this,nn))==null?void 0:n.get(e);i&&(i.setCanvas(t,s),a(this,nn).delete(e))}addMissingCanvas(e,t){(a(this,nn)||y(this,nn,new Map)).set(e,t)}};fa=new WeakMap,Ve=new WeakMap,ie=new WeakMap,ue=new WeakMap,pa=new WeakMap,ui=new WeakMap,ga=new WeakMap,us=new WeakMap,Zi=new WeakMap,Ji=new WeakMap,ma=new WeakMap,Wn=new WeakMap,js=new WeakMap,vs=new WeakMap,Vn=new WeakMap,Jo=new WeakMap,Qo=new WeakMap,ba=new WeakMap,tl=new WeakMap,Gs=new WeakMap,Qi=new WeakMap,ya=new WeakMap,tn=new WeakMap,$s=new WeakMap,kc=new WeakMap,en=new WeakMap,el=new WeakMap,sn=new WeakMap,Xn=new WeakMap,qn=new WeakMap,nn=new WeakMap,sl=new WeakMap,ae=new WeakMap,Rt=new WeakMap,fi=new WeakMap,rn=new WeakMap,Yn=new WeakMap,il=new WeakMap,nl=new WeakMap,an=new WeakMap,Ws=new WeakMap,pi=new WeakMap,rl=new WeakMap,fs=new WeakMap,tt=new WeakSet,Uh=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},dd=function(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const s of a(this,ue).values())if(s.hasTextLayer(e))return s;return null},Ef=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const s=E(this,tt,Uh).call(this,e).closest(".textLayer"),i=this.getSelectionBoxes(s);i&&(a(this,$s)||y(this,$s,new Wg(this)),a(this,$s).show(s,i,this.direction==="ltr"))},xf=function(){var n,r,o;const e=document.getSelection();if(!e||e.isCollapsed){a(this,fi)&&((n=a(this,$s))==null||n.hide(),y(this,fi,null),E(this,tt,Te).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===a(this,fi))return;const i=E(this,tt,Uh).call(this,e).closest(".textLayer");if(!i){a(this,fi)&&((r=a(this,$s))==null||r.hide(),y(this,fi,null),E(this,tt,Te).call(this,{hasSelectedText:!1}));return}if((o=a(this,$s))==null||o.hide(),y(this,fi,t),E(this,tt,Te).call(this,{hasSelectedText:!0}),!(a(this,ae)!==ft.HIGHLIGHT&&a(this,ae)!==ft.NONE)&&(a(this,ae)===ft.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),y(this,tn,this.isShiftKeyDown),!this.isShiftKeyDown)){const l=a(this,ae)===ft.HIGHLIGHT?E(this,tt,dd).call(this,i):null;l==null||l.toggleDrawing();const h=new AbortController,c=this.combinedSignal(h),d=f=>{f.type==="pointerup"&&f.button!==0||(h.abort(),l==null||l.toggleDrawing(!0),f.type==="pointerup"&&E(this,tt,jh).call(this,"main_toolbar"))};window.addEventListener("pointerup",d,{signal:c}),window.addEventListener("blur",d,{signal:c})}},jh=function(e=""){a(this,ae)===ft.HIGHLIGHT?this.highlightSelection(e):a(this,Jo)&&E(this,tt,Ef).call(this)},Cf=function(){document.addEventListener("selectionchange",E(this,tt,xf).bind(this),{signal:this._signal})},kf=function(){if(a(this,Qi))return;y(this,Qi,new AbortController);const e=this.combinedSignal(a(this,Qi));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},Tf=function(){var e;(e=a(this,Qi))==null||e.abort(),y(this,Qi,null)},ud=function(){if(a(this,sn))return;y(this,sn,new AbortController);const e=this.combinedSignal(a(this,sn));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},Rf=function(){var e;(e=a(this,sn))==null||e.abort(),y(this,sn,null)},fd=function(){if(a(this,Zi))return;y(this,Zi,new AbortController);const e=this.combinedSignal(a(this,Zi));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},pd=function(){var e;(e=a(this,Zi))==null||e.abort(),y(this,Zi,null)},If=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},Te=function(e){Object.entries(e).some(([s,i])=>a(this,nl)[s]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(a(this,nl),e)}),a(this,ae)===ft.HIGHLIGHT&&e.hasSelectedEditor===!1&&E(this,tt,li).call(this,[[At.HIGHLIGHT_FREE,!0]]))},li=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},Pf=async function(){if(!a(this,en)){y(this,en,!0);const e=[];for(const t of a(this,ue).values())e.push(t.enable());await Promise.all(e);for(const t of a(this,ie).values())t.enable()}},Lf=function(){if(this.unselectAll(),a(this,en)){y(this,en,!1);for(const e of a(this,ue).values())e.disable();for(const e of a(this,ie).values())e.disable()}},gd=function(e){const t=a(this,ue).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},Mf=function(){let e=null;for(e of a(this,Rt));return e},Co=function(){if(a(this,ie).size===0)return!0;if(a(this,ie).size===1)for(const e of a(this,ie).values())return e.isEmpty();return!1},md=function(e){for(const t of a(this,Rt))t.unselect();a(this,Rt).clear();for(const t of e)t.isEmpty()||(a(this,Rt).add(t),t.select());E(this,tt,Te).call(this,{hasSelectedEditor:this.hasSelection})},K(oa,"TRANSLATE_SMALL",1),K(oa,"TRANSLATE_BIG",10);let Yr=oa;var oe,Vs,Ss,_a,Xs,Xe,wa,qs,Ue,gi,Kn,Ys,on,Fs,ko,Gh;const Re=class Re{constructor(e){S(this,Fs);S(this,oe,null);S(this,Vs,!1);S(this,Ss,null);S(this,_a,null);S(this,Xs,null);S(this,Xe,null);S(this,wa,!1);S(this,qs,null);S(this,Ue,null);S(this,gi,null);S(this,Kn,null);S(this,Ys,!1);y(this,Ue,e),y(this,Ys,e._uiManager.useNewAltTextFlow),a(Re,on)||y(Re,on,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){Re._l10n??(Re._l10n=e)}async render(){const e=y(this,Ss,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=y(this,_a,document.createElement("span"));e.append(t),a(this,Ys)?(e.classList.add("new"),e.setAttribute("data-l10n-id",a(Re,on).missing),t.setAttribute("data-l10n-id",a(Re,on)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=a(this,Ue)._uiManager._signal;e.addEventListener("contextmenu",Ns,{signal:s}),e.addEventListener("pointerdown",n=>n.stopPropagation(),{signal:s});const i=n=>{n.preventDefault(),a(this,Ue)._uiManager.editAltText(a(this,Ue)),a(this,Ys)&&a(this,Ue)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:a(this,Fs,ko)}})};return e.addEventListener("click",i,{capture:!0,signal:s}),e.addEventListener("keydown",n=>{n.target===e&&n.key==="Enter"&&(y(this,wa,!0),i(n))},{signal:s}),await E(this,Fs,Gh).call(this),e}finish(){a(this,Ss)&&(a(this,Ss).focus({focusVisible:a(this,wa)}),y(this,wa,!1))}isEmpty(){return a(this,Ys)?a(this,oe)===null:!a(this,oe)&&!a(this,Vs)}hasData(){return a(this,Ys)?a(this,oe)!==null||!!a(this,gi):this.isEmpty()}get guessedText(){return a(this,gi)}async setGuessedText(e){a(this,oe)===null&&(y(this,gi,e),y(this,Kn,await Re._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),E(this,Fs,Gh).call(this))}toggleAltTextBadge(e=!1){var t;if(!a(this,Ys)||a(this,oe)){(t=a(this,qs))==null||t.remove(),y(this,qs,null);return}if(!a(this,qs)){const s=y(this,qs,document.createElement("div"));s.className="noAltTextBadge",a(this,Ue).div.append(s)}a(this,qs).classList.toggle("hidden",!e)}serialize(e){let t=a(this,oe);return!e&&a(this,gi)===t&&(t=a(this,Kn)),{altText:t,decorative:a(this,Vs),guessedText:a(this,gi),textWithDisclaimer:a(this,Kn)}}get data(){return{altText:a(this,oe),decorative:a(this,Vs)}}set data({altText:e,decorative:t,guessedText:s,textWithDisclaimer:i,cancel:n=!1}){s&&(y(this,gi,s),y(this,Kn,i)),!(a(this,oe)===e&&a(this,Vs)===t)&&(n||(y(this,oe,e),y(this,Vs,t)),E(this,Fs,Gh).call(this))}toggle(e=!1){a(this,Ss)&&(!e&&a(this,Xe)&&(clearTimeout(a(this,Xe)),y(this,Xe,null)),a(this,Ss).disabled=!e)}shown(){a(this,Ue)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:a(this,Fs,ko)}})}destroy(){var e,t;(e=a(this,Ss))==null||e.remove(),y(this,Ss,null),y(this,_a,null),y(this,Xs,null),(t=a(this,qs))==null||t.remove(),y(this,qs,null)}};oe=new WeakMap,Vs=new WeakMap,Ss=new WeakMap,_a=new WeakMap,Xs=new WeakMap,Xe=new WeakMap,wa=new WeakMap,qs=new WeakMap,Ue=new WeakMap,gi=new WeakMap,Kn=new WeakMap,Ys=new WeakMap,on=new WeakMap,Fs=new WeakSet,ko=function(){return a(this,oe)&&"added"||a(this,oe)===null&&this.guessedText&&"review"||"missing"},Gh=async function(){var i,n,r;const e=a(this,Ss);if(!e)return;if(a(this,Ys)){if(e.classList.toggle("done",!!a(this,oe)),e.setAttribute("data-l10n-id",a(Re,on)[a(this,Fs,ko)]),(i=a(this,_a))==null||i.setAttribute("data-l10n-id",a(Re,on)[`${a(this,Fs,ko)}-label`]),!a(this,oe)){(n=a(this,Xs))==null||n.remove();return}}else{if(!a(this,oe)&&!a(this,Vs)){e.classList.remove("done"),(r=a(this,Xs))==null||r.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=a(this,Xs);if(!t){y(this,Xs,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${a(this,Ue).id}`;const o=100,l=a(this,Ue)._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(a(this,Xe)),y(this,Xe,null)},{once:!0}),e.addEventListener("mouseenter",()=>{y(this,Xe,setTimeout(()=>{y(this,Xe,null),a(this,Xs).classList.add("show"),a(this,Ue)._reportTelemetry({action:"alt_text_tooltip"})},o))},{signal:l}),e.addEventListener("mouseleave",()=>{var h;a(this,Xe)&&(clearTimeout(a(this,Xe)),y(this,Xe,null)),(h=a(this,Xs))==null||h.classList.remove("show")},{signal:l})}a(this,Vs)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=a(this,oe)),t.parentNode||e.append(t);const s=a(this,Ue).getElementForAltText();s==null||s.setAttribute("aria-describedby",t.id)},S(Re,on,null),K(Re,"_l10n",null);let mc=Re;var Aa,Zn,al,ol,ll,hl,cl,mi,Jn,bi,Qn,yi,Fn,Df,Ff,Nf;const Du=class Du{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:s=null,onPinchStart:i=null,onPinching:n=null,onPinchEnd:r=null,signal:o}){S(this,Fn);S(this,Aa);S(this,Zn,!1);S(this,al,null);S(this,ol);S(this,ll);S(this,hl);S(this,cl);S(this,mi,null);S(this,Jn);S(this,bi,null);S(this,Qn);S(this,yi,null);y(this,Aa,e),y(this,al,s),y(this,ol,t),y(this,ll,i),y(this,hl,n),y(this,cl,r),y(this,Qn,new AbortController),y(this,Jn,AbortSignal.any([o,a(this,Qn).signal])),e.addEventListener("touchstart",E(this,Fn,Df).bind(this),{passive:!1,signal:a(this,Jn)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/ni.pixelRatio}destroy(){var e,t;(e=a(this,Qn))==null||e.abort(),y(this,Qn,null),(t=a(this,mi))==null||t.abort(),y(this,mi,null)}};Aa=new WeakMap,Zn=new WeakMap,al=new WeakMap,ol=new WeakMap,ll=new WeakMap,hl=new WeakMap,cl=new WeakMap,mi=new WeakMap,Jn=new WeakMap,bi=new WeakMap,Qn=new WeakMap,yi=new WeakMap,Fn=new WeakSet,Df=function(e){var i,n,r;if((i=a(this,ol))!=null&&i.call(this))return;if(e.touches.length===1){if(a(this,mi))return;const o=y(this,mi,new AbortController),l=AbortSignal.any([a(this,Jn),o.signal]),h=a(this,Aa),c={capture:!0,signal:l,passive:!1},d=f=>{var u;f.pointerType==="touch"&&((u=a(this,mi))==null||u.abort(),y(this,mi,null))};h.addEventListener("pointerdown",f=>{f.pointerType==="touch"&&(Jt(f),d(f))},c),h.addEventListener("pointerup",d,c),h.addEventListener("pointercancel",d,c);return}if(!a(this,yi)){y(this,yi,new AbortController);const o=AbortSignal.any([a(this,Jn),a(this,yi).signal]),l=a(this,Aa),h={signal:o,capture:!1,passive:!1};l.addEventListener("touchmove",E(this,Fn,Ff).bind(this),h);const c=E(this,Fn,Nf).bind(this);l.addEventListener("touchend",c,h),l.addEventListener("touchcancel",c,h),h.capture=!0,l.addEventListener("pointerdown",Jt,h),l.addEventListener("pointermove",Jt,h),l.addEventListener("pointercancel",Jt,h),l.addEventListener("pointerup",Jt,h),(n=a(this,ll))==null||n.call(this)}if(Jt(e),e.touches.length!==2||(r=a(this,al))!=null&&r.call(this)){y(this,bi,null);return}let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]),y(this,bi,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:s.screenX,touch1Y:s.screenY})},Ff=function(e){var k;if(!a(this,bi)||e.touches.length!==2)return;Jt(e);let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]);const{screenX:i,screenY:n}=t,{screenX:r,screenY:o}=s,l=a(this,bi),{touch0X:h,touch0Y:c,touch1X:d,touch1Y:f}=l,u=d-h,m=f-c,p=r-i,_=o-n,b=Math.hypot(p,_)||1,A=Math.hypot(u,m)||1;if(!a(this,Zn)&&Math.abs(A-b)<=Du.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=i,l.touch0Y=n,l.touch1X=r,l.touch1Y=o,!a(this,Zn)){y(this,Zn,!0);return}const x=[(i+r)/2,(n+o)/2];(k=a(this,hl))==null||k.call(this,x,A,b)},Nf=function(e){var t;e.touches.length>=2||(a(this,yi)&&(a(this,yi).abort(),y(this,yi,null),(t=a(this,cl))==null||t.call(this)),a(this,bi)&&(Jt(e),y(this,bi,null),y(this,Zn,!1)))};let bc=Du;var tr,Es,Bt,va,ln,dl,er,fe,sr,_i,hn,ul,ir,qe,fl,nr,wi,Ks,Sa,Ea,ps,rr,pl,Tc,ut,bd,gl,yd,$h,Of,Bf,_d,Wh,wd,zf,Hf,Uf,Ad,jf,vd,Gf,$f,Wf,Sd,To;const bt=class bt{constructor(e){S(this,ut);S(this,tr,null);S(this,Es,null);S(this,Bt,null);S(this,va,!1);S(this,ln,null);S(this,dl,"");S(this,er,!1);S(this,fe,null);S(this,sr,null);S(this,_i,null);S(this,hn,null);S(this,ul,"");S(this,ir,!1);S(this,qe,null);S(this,fl,!1);S(this,nr,!1);S(this,wi,!1);S(this,Ks,null);S(this,Sa,0);S(this,Ea,0);S(this,ps,null);S(this,rr,null);K(this,"isSelected",!1);K(this,"_isCopy",!1);K(this,"_editToolbar",null);K(this,"_initialOptions",Object.create(null));K(this,"_initialData",null);K(this,"_isVisible",!0);K(this,"_uiManager",null);K(this,"_focusEventsAllowed",!0);S(this,pl,!1);S(this,Tc,bt._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;const{rotation:t,rawDims:{pageWidth:s,pageHeight:i,pageX:n,pageY:r}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,i],this.pageTranslation=[n,r];const[o,l]=this.parentDimensions;this.x=e.x/o,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=bt.prototype._resizeWithKeyboard,t=Yr.TRANSLATE_SMALL,s=Yr.TRANSLATE_BIG;return wt(this,"_resizerKeyboardManager",new vh([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,s]}],[["Escape","mac+Escape"],bt.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return wt(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new qg({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(bt._l10n??(bt._l10n=e),bt._l10nResizer||(bt._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),bt._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);bt._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){Lt("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return a(this,pl)}set _isDraggable(e){var t;y(this,pl,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=a(this,Tc)}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):E(this,ut,To).call(this),this.parent=e}focusin(e){this._focusEventsAllowed&&(a(this,ir)?y(this,ir,!1):this.parent.setSelected(this))}focusout(e){var s;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(s=this.parent)!=null&&s.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,s,i){const[n,r]=this.parentDimensions;[s,i]=this.screenToPageTranslation(s,i),this.x=(e+s)/n,this.y=(t+i)/r,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[s,i]=this.parentDimensions;this.setAt(e*s,t*i,this.width*s,this.height*i),this._onTranslated()}translate(e,t){E(this,ut,bd).call(this,this.parentDimensions,e,t)}translateInPage(e,t){a(this,qe)||y(this,qe,[this.x,this.y,this.width,this.height]),E(this,ut,bd).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){a(this,qe)||y(this,qe,[this.x,this.y,this.width,this.height]);const{div:s,parentDimensions:[i,n]}=this;if(this.x+=e/i,this.y+=t/n,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:d,y:f}=this.div.getBoundingClientRect();this.parent.findNewParent(this,d,f)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:r,y:o}=this;const[l,h]=this.getBaseTranslation();r+=l,o+=h;const{style:c}=s;c.left=`${(100*r).toFixed(2)}%`,c.top=`${(100*o).toFixed(2)}%`,this._onTranslating(r,o),s.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!a(this,qe)&&(a(this,qe)[0]!==this.x||a(this,qe)[1]!==this.y)}get _hasBeenResized(){return!!a(this,qe)&&(a(this,qe)[2]!==this.width||a(this,qe)[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:s}=bt,i=s/e,n=s/t;switch(this.rotation){case 90:return[-i,n];case 180:return[i,n];case 270:return[i,-n];default:return[-i,-n]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[s,i]}=this;let{x:n,y:r,width:o,height:l}=this;if(o*=s,l*=i,n*=s,r*=i,this._mustFixPosition)switch(e){case 0:n=De(n,0,s-o),r=De(r,0,i-l);break;case 90:n=De(n,0,s-l),r=De(r,o,i);break;case 180:n=De(n,o,s),r=De(r,l,i);break;case 270:n=De(n,l,s),r=De(r,0,i-o);break}this.x=n/=s,this.y=r/=i;const[h,c]=this.getBaseTranslation();n+=h,r+=c,t.left=`${(100*n).toFixed(2)}%`,t.top=`${(100*r).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var s;return E(s=bt,gl,yd).call(s,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var s;return E(s=bt,gl,yd).call(s,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,s]}=this;return[t*e,s*e]}setDims(e,t){const[s,i]=this.parentDimensions,{style:n}=this.div;n.width=`${(100*e/s).toFixed(2)}%`,a(this,er)||(n.height=`${(100*t/i).toFixed(2)}%`)}fixDims(){const{style:e}=this.div,{height:t,width:s}=e,i=s.endsWith("%"),n=!a(this,er)&&t.endsWith("%");if(i&&n)return;const[r,o]=this.parentDimensions;i||(e.width=`${(100*parseFloat(s)/r).toFixed(2)}%`),!a(this,er)&&!n&&(e.height=`${(100*parseFloat(t)/o).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=a(this,Bt))==null||e.finish()}async addEditToolbar(){return this._editToolbar||a(this,nr)?this._editToolbar:(this._editToolbar=new ld(this),this.div.append(this._editToolbar.render()),a(this,Bt)&&await this._editToolbar.addAltText(a(this,Bt)),this._editToolbar)}removeEditToolbar(){var e;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(e=a(this,Bt))==null||e.destroy())}addContainer(e){var s;const t=(s=this._editToolbar)==null?void 0:s.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){a(this,Bt)||(mc.initialize(bt._l10n),y(this,Bt,new mc(this)),a(this,tr)&&(a(this,Bt).data=a(this,tr),y(this,tr,null)),await this.addEditToolbar())}get altTextData(){var e;return(e=a(this,Bt))==null?void 0:e.data}set altTextData(e){a(this,Bt)&&(a(this,Bt).data=e)}get guessedAltText(){var e;return(e=a(this,Bt))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=a(this,Bt))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=a(this,Bt))==null?void 0:t.serialize(e)}hasAltText(){return!!a(this,Bt)&&!a(this,Bt).isEmpty()}hasAltTextData(){var e;return((e=a(this,Bt))==null?void 0:e.hasData())??!1}render(){var r;const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=a(this,va)?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),E(this,ut,vd).call(this);const[t,s]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*s/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/s).toFixed(2)}%`);const[i,n]=this.getInitialTranslation();return this.translate(i,n),vf(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(a(this,rr)||y(this,rr,new bc({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:E(this,ut,zf).bind(this),onPinching:E(this,ut,Hf).bind(this),onPinchEnd:E(this,ut,Uf).bind(this),signal:this._uiManager._signal}))),(r=this._uiManager._editorUndoBar)==null||r.hide(),e}pointerdown(e){const{isMac:t}=we.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(y(this,ir,!0),this._isDraggable){E(this,ut,jf).call(this,e);return}E(this,ut,Ad).call(this,e)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){a(this,Ks)&&clearTimeout(a(this,Ks)),y(this,Ks,setTimeout(()=>{var e;y(this,Ks,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,s){e.changeParent(this),this.x=t,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,s=this.rotation){const i=this.parentScale,[n,r]=this.pageDimensions,[o,l]=this.pageTranslation,h=e/i,c=t/i,d=this.x*n,f=this.y*r,u=this.width*n,m=this.height*r;switch(s){case 0:return[d+h+o,r-f-c-m+l,d+h+u+o,r-f-c+l];case 90:return[d+c+o,r-f+h+l,d+c+m+o,r-f+h+u+l];case 180:return[d-h-u+o,r-f+c+l,d-h+o,r-f+c+m+l];case 270:return[d-c-m+o,r-f-h-u+l,d-c+o,r-f-h+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[s,i,n,r]=e,o=n-s,l=r-i;switch(this.rotation){case 0:return[s,t-r,o,l];case 90:return[s,t-i,l,o];case 180:return[n,t-i,o,l];case 270:return[n,t-r,l,o];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),y(this,nr,!0),!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),y(this,nr,!1),!0):!1}isInEditMode(){return a(this,nr)}shouldGetKeyboardEvents(){return a(this,wi)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:s,right:i}=this.getClientDimensions(),{innerHeight:n,innerWidth:r}=window;return t<r&&i>0&&e<n&&s>0}rebuild(){E(this,ut,vd).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){Lt("An editor must be serializable")}static async deserialize(e,t,s){const i=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:s});i.rotation=e.rotation,y(i,tr,e.accessibilityData),i._isCopy=e.isCopy||!1;const[n,r]=i.pageDimensions,[o,l,h,c]=i.getRectInCurrentCoords(e.rect,r);return i.x=o/n,i.y=l/r,i.width=h/n,i.height=c/r,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t;if((e=a(this,hn))==null||e.abort(),y(this,hn,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),a(this,Ks)&&(clearTimeout(a(this,Ks)),y(this,Ks,null)),E(this,ut,To).call(this),this.removeEditToolbar(),a(this,ps)){for(const s of a(this,ps).values())clearTimeout(s);y(this,ps,null)}this.parent=null,(t=a(this,rr))==null||t.destroy(),y(this,rr,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(E(this,ut,Of).call(this),a(this,fe).classList.remove("hidden"))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),y(this,_i,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=a(this,fe).children;if(!a(this,Es)){y(this,Es,Array.from(t));const r=E(this,ut,Gf).bind(this),o=E(this,ut,$f).bind(this),l=this._uiManager._signal;for(const h of a(this,Es)){const c=h.getAttribute("data-resizer-name");h.setAttribute("role","spinbutton"),h.addEventListener("keydown",r,{signal:l}),h.addEventListener("blur",o,{signal:l}),h.addEventListener("focus",E(this,ut,Wf).bind(this,c),{signal:l}),h.setAttribute("data-l10n-id",bt._l10nResizer[c])}}const s=a(this,Es)[0];let i=0;for(const r of t){if(r===s)break;i++}const n=(360-this.rotation+this.parentRotation)%360/90*(a(this,Es).length/4);if(n!==i){if(n<i)for(let o=0;o<i-n;o++)a(this,fe).append(a(this,fe).firstChild);else if(n>i)for(let o=0;o<n-i;o++)a(this,fe).firstChild.before(a(this,fe).lastChild);let r=0;for(const o of t){const h=a(this,Es)[r++].getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",bt._l10nResizer[h])}}E(this,ut,Sd).call(this,0),y(this,wi,!0),a(this,fe).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){a(this,wi)&&E(this,ut,wd).call(this,a(this,ul),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){E(this,ut,To).call(this),this.div.focus()}select(){var e,t,s;if(!(this.isSelected&&this._editToolbar)){if(this.isSelected=!0,this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var i,n;(i=this.div)!=null&&i.classList.contains("selectedEditor")&&((n=this._editToolbar)==null||n.show())});return}(t=this._editToolbar)==null||t.show(),(s=a(this,Bt))==null||s.toggleAltTextBadge(!1)}}unselect(){var e,t,s,i,n;this.isSelected&&(this.isSelected=!1,(e=a(this,fe))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(s=this.div)!=null&&s.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(i=this._editToolbar)==null||i.hide(),(n=a(this,Bt))==null||n.toggleAltTextBadge(!0))}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id})}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return a(this,fl)}set isEditing(e){y(this,fl,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){y(this,er,!0);const s=e/t,{style:i}=this.div;i.aspectRatio=s,i.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){a(this,ps)||y(this,ps,new Map);const{action:s}=e;let i=a(this,ps).get(s);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(e),a(this,ps).delete(s),a(this,ps).size===0&&y(this,ps,null)},bt._telemetryTimeout),a(this,ps).set(s,i);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),y(this,va,!1)}disable(){this.div&&(this.div.tabIndex=-1),y(this,va,!0)}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const s=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),s.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};tr=new WeakMap,Es=new WeakMap,Bt=new WeakMap,va=new WeakMap,ln=new WeakMap,dl=new WeakMap,er=new WeakMap,fe=new WeakMap,sr=new WeakMap,_i=new WeakMap,hn=new WeakMap,ul=new WeakMap,ir=new WeakMap,qe=new WeakMap,fl=new WeakMap,nr=new WeakMap,wi=new WeakMap,Ks=new WeakMap,Sa=new WeakMap,Ea=new WeakMap,ps=new WeakMap,rr=new WeakMap,pl=new WeakMap,Tc=new WeakMap,ut=new WeakSet,bd=function([e,t],s,i){[s,i]=this.screenToPageTranslation(s,i),this.x+=s/e,this.y+=i/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},gl=new WeakSet,yd=function(e,t,s){switch(s){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},$h=function(e){switch(e){case 90:{const[t,s]=this.pageDimensions;return[0,-t/s,s/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,s]=this.pageDimensions;return[0,t/s,-s/t,0]}default:return[1,0,0,1]}},Of=function(){if(a(this,fe))return;y(this,fe,document.createElement("div")),a(this,fe).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const s of e){const i=document.createElement("div");a(this,fe).append(i),i.classList.add("resizer",s),i.setAttribute("data-resizer-name",s),i.addEventListener("pointerdown",E(this,ut,Bf).bind(this,s),{signal:t}),i.addEventListener("contextmenu",Ns,{signal:t}),i.tabIndex=-1}this.div.prepend(a(this,fe))},Bf=function(e,t){var c;t.preventDefault();const{isMac:s}=we.platform;if(t.button!==0||t.ctrlKey&&s)return;(c=a(this,Bt))==null||c.toggle(!1);const i=this._isDraggable;this._isDraggable=!1,y(this,sr,[t.screenX,t.screenY]);const n=new AbortController,r=this._uiManager.combinedSignal(n);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",E(this,ut,wd).bind(this,e),{passive:!0,capture:!0,signal:r}),window.addEventListener("touchmove",Jt,{passive:!1,signal:r}),window.addEventListener("contextmenu",Ns,{signal:r}),y(this,_i,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const o=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const h=()=>{var d;n.abort(),this.parent.togglePointerEvents(!0),(d=a(this,Bt))==null||d.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=o,this.div.style.cursor=l,E(this,ut,Wh).call(this)};window.addEventListener("pointerup",h,{signal:r}),window.addEventListener("blur",h,{signal:r})},_d=function(e,t,s,i){this.width=s,this.height=i,this.x=e,this.y=t;const[n,r]=this.parentDimensions;this.setDims(n*s,r*i),this.fixAndSetPosition(),this._onResized()},Wh=function(){if(!a(this,_i))return;const{savedX:e,savedY:t,savedWidth:s,savedHeight:i}=a(this,_i);y(this,_i,null);const n=this.x,r=this.y,o=this.width,l=this.height;n===e&&r===t&&o===s&&l===i||this.addCommands({cmd:E(this,ut,_d).bind(this,n,r,o,l),undo:E(this,ut,_d).bind(this,e,t,s,i),mustExec:!0})},wd=function(e,t){const[s,i]=this.parentDimensions,n=this.x,r=this.y,o=this.width,l=this.height,h=bt.MIN_SIZE/s,c=bt.MIN_SIZE/i,d=E(this,ut,$h).call(this,this.rotation),f=(V,O)=>[d[0]*V+d[2]*O,d[1]*V+d[3]*O],u=E(this,ut,$h).call(this,360-this.rotation),m=(V,O)=>[u[0]*V+u[2]*O,u[1]*V+u[3]*O];let p,_,b=!1,A=!1;switch(e){case"topLeft":b=!0,p=(V,O)=>[0,0],_=(V,O)=>[V,O];break;case"topMiddle":p=(V,O)=>[V/2,0],_=(V,O)=>[V/2,O];break;case"topRight":b=!0,p=(V,O)=>[V,0],_=(V,O)=>[0,O];break;case"middleRight":A=!0,p=(V,O)=>[V,O/2],_=(V,O)=>[0,O/2];break;case"bottomRight":b=!0,p=(V,O)=>[V,O],_=(V,O)=>[0,0];break;case"bottomMiddle":p=(V,O)=>[V/2,O],_=(V,O)=>[V/2,0];break;case"bottomLeft":b=!0,p=(V,O)=>[0,O],_=(V,O)=>[V,0];break;case"middleLeft":A=!0,p=(V,O)=>[0,O/2],_=(V,O)=>[V,O/2];break}const x=p(o,l),k=_(o,l);let C=f(...k);const P=bt._round(n+C[0]),R=bt._round(r+C[1]);let D=1,M=1,U,$;if(t.fromKeyboard)({deltaX:U,deltaY:$}=t);else{const{screenX:V,screenY:O}=t,[dt,Y]=a(this,sr);[U,$]=this.screenToPageTranslation(V-dt,O-Y),a(this,sr)[0]=V,a(this,sr)[1]=O}if([U,$]=m(U/s,$/i),b){const V=Math.hypot(o,l);D=M=Math.max(Math.min(Math.hypot(k[0]-x[0]-U,k[1]-x[1]-$)/V,1/o,1/l),h/o,c/l)}else A?D=De(Math.abs(k[0]-x[0]-U),h,1)/o:M=De(Math.abs(k[1]-x[1]-$),c,1)/l;const L=bt._round(o*D),z=bt._round(l*M);C=f(..._(L,z));const v=P-C[0],G=R-C[1];a(this,qe)||y(this,qe,[this.x,this.y,this.width,this.height]),this.width=L,this.height=z,this.x=v,this.y=G,this.setDims(s*L,i*z),this.fixAndSetPosition(),this._onResizing()},zf=function(){var e;y(this,_i,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=a(this,Bt))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},Hf=function(e,t,s){let n=.7*(s/t)+1-.7;if(n===1)return;const r=E(this,ut,$h).call(this,this.rotation),o=(P,R)=>[r[0]*P+r[2]*R,r[1]*P+r[3]*R],[l,h]=this.parentDimensions,c=this.x,d=this.y,f=this.width,u=this.height,m=bt.MIN_SIZE/l,p=bt.MIN_SIZE/h;n=Math.max(Math.min(n,1/f,1/u),m/f,p/u);const _=bt._round(f*n),b=bt._round(u*n);if(_===f&&b===u)return;a(this,qe)||y(this,qe,[c,d,f,u]);const A=o(f/2,u/2),x=bt._round(c+A[0]),k=bt._round(d+A[1]),C=o(_/2,b/2);this.x=x-C[0],this.y=k-C[1],this.width=_,this.height=b,this.setDims(l*_,h*b),this.fixAndSetPosition(),this._onResizing()},Uf=function(){var e;(e=a(this,Bt))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),E(this,ut,Wh).call(this)},Ad=function(e){const{isMac:t}=we.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},jf=function(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let s=!1;const i=new AbortController,n=this._uiManager.combinedSignal(i),r={capture:!0,passive:!1,signal:n},o=h=>{i.abort(),y(this,ln,null),y(this,ir,!1),this._uiManager.endDragSession()||E(this,ut,Ad).call(this,h),s&&this._onStopDragging()};t&&(y(this,Sa,e.clientX),y(this,Ea,e.clientY),y(this,ln,e.pointerId),y(this,dl,e.pointerType),window.addEventListener("pointermove",h=>{s||(s=!0,this._onStartDragging());const{clientX:c,clientY:d,pointerId:f}=h;if(f!==a(this,ln)){Jt(h);return}const[u,m]=this.screenToPageTranslation(c-a(this,Sa),d-a(this,Ea));y(this,Sa,c),y(this,Ea,d),this._uiManager.dragSelectedEditors(u,m)},r),window.addEventListener("touchmove",Jt,r),window.addEventListener("pointerdown",h=>{h.pointerType===a(this,dl)&&(a(this,rr)||h.isPrimary)&&o(h),Jt(h)},r));const l=h=>{if(!a(this,ln)||a(this,ln)===h.pointerId){o(h);return}Jt(h)};window.addEventListener("pointerup",l,{signal:n}),window.addEventListener("blur",l,{signal:n})},vd=function(){if(a(this,hn)||!this.div)return;y(this,hn,new AbortController);const e=this._uiManager.combinedSignal(a(this,hn));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},Gf=function(e){bt._resizerKeyboardManager.exec(this,e)},$f=function(e){var t;a(this,wi)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==a(this,fe)&&E(this,ut,To).call(this)},Wf=function(e){y(this,ul,a(this,wi)?e:"")},Sd=function(e){if(a(this,Es))for(const t of a(this,Es))t.tabIndex=e},To=function(){y(this,wi,!1),E(this,ut,Sd).call(this,-1),E(this,ut,Wh).call(this)},S(bt,gl),K(bt,"_l10n",null),K(bt,"_l10nResizer",null),K(bt,"_borderLineWidth",-1),K(bt,"_colorManager",new cd),K(bt,"_zIndex",1),K(bt,"_telemetryTimeout",1e3);let Nt=bt;class qg extends Nt{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const $u=3285377520,cs=4294901760,Hs=65535;class Vf{constructor(e){this.h1=e?e&4294967295:$u,this.h2=e?e&4294967295:$u}update(e){let t,s;if(typeof e=="string"){t=new Uint8Array(e.length*2),s=0;for(let p=0,_=e.length;p<_;p++){const b=e.charCodeAt(p);b<=255?t[s++]=b:(t[s++]=b>>>8,t[s++]=b&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),s=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const i=s>>2,n=s-i*4,r=new Uint32Array(t.buffer,0,i);let o=0,l=0,h=this.h1,c=this.h2;const d=3432918353,f=461845907,u=d&Hs,m=f&Hs;for(let p=0;p<i;p++)p&1?(o=r[p],o=o*d&cs|o*u&Hs,o=o<<15|o>>>17,o=o*f&cs|o*m&Hs,h^=o,h=h<<13|h>>>19,h=h*5+3864292196):(l=r[p],l=l*d&cs|l*u&Hs,l=l<<15|l>>>17,l=l*f&cs|l*m&Hs,c^=l,c=c<<13|c>>>19,c=c*5+3864292196);switch(o=0,n){case 3:o^=t[i*4+2]<<16;case 2:o^=t[i*4+1]<<8;case 1:o^=t[i*4],o=o*d&cs|o*u&Hs,o=o<<15|o>>>17,o=o*f&cs|o*m&Hs,i&1?h^=o:c^=o}this.h1=h,this.h2=c}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&cs|e*36045&Hs,t=t*4283543511&cs|((t<<16|e>>>16)*2950163797&cs)>>>16,e^=t>>>1,e=e*444984403&cs|e*60499&Hs,t=t*3301882366&cs|((t<<16|e>>>16)*3120437893&cs)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const Ed=Object.freeze({map:null,hash:"",transfer:void 0});var ar,or,pe,Rc,Xf;class ku{constructor(){S(this,Rc);S(this,ar,!1);S(this,or,null);S(this,pe,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const s=a(this,pe).get(e);return s===void 0?t:Object.assign(t,s)}getRawValue(e){return a(this,pe).get(e)}remove(e){if(a(this,pe).delete(e),a(this,pe).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const t of a(this,pe).values())if(t instanceof Nt)return;this.onAnnotationEditor(null)}}setValue(e,t){const s=a(this,pe).get(e);let i=!1;if(s!==void 0)for(const[n,r]of Object.entries(t))s[n]!==r&&(i=!0,s[n]=r);else i=!0,a(this,pe).set(e,t);i&&E(this,Rc,Xf).call(this),t instanceof Nt&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return a(this,pe).has(e)}get size(){return a(this,pe).size}resetModified(){a(this,ar)&&(y(this,ar,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new qf(this)}get serializable(){if(a(this,pe).size===0)return Ed;const e=new Map,t=new Vf,s=[],i=Object.create(null);let n=!1;for(const[r,o]of a(this,pe)){const l=o instanceof Nt?o.serialize(!1,i):o;l&&(e.set(r,l),t.update(`${r}:${JSON.stringify(l)}`),n||(n=!!l.bitmap))}if(n)for(const r of e.values())r.bitmap&&s.push(r.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:s}:Ed}get editorStats(){let e=null;const t=new Map;for(const s of a(this,pe).values()){if(!(s instanceof Nt))continue;const i=s.telemetryFinalData;if(!i)continue;const{type:n}=i;t.has(n)||t.set(n,Object.getPrototypeOf(s).constructor),e||(e=Object.create(null));const r=e[n]||(e[n]=new Map);for(const[o,l]of Object.entries(i)){if(o==="type")continue;let h=r.get(o);h||(h=new Map,r.set(o,h));const c=h.get(l)??0;h.set(l,c+1)}}for(const[s,i]of t)e[s]=i.computeTelemetryFinalData(e[s]);return e}resetModifiedIds(){y(this,or,null)}get modifiedIds(){if(a(this,or))return a(this,or);const e=[];for(const t of a(this,pe).values())!(t instanceof Nt)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return y(this,or,{ids:new Set(e),hash:e.join(",")})}[Symbol.iterator](){return a(this,pe).entries()}}ar=new WeakMap,or=new WeakMap,pe=new WeakMap,Rc=new WeakSet,Xf=function(){a(this,ar)||(y(this,ar,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var ml;class qf extends ku{constructor(t){super();S(this,ml);const{map:s,hash:i,transfer:n}=t.serializable,r=structuredClone(s,n?{transfer:n}:null);y(this,ml,{map:r,hash:i,transfer:n})}get print(){Lt("Should not call PrintAnnotationStorage.print")}get serializable(){return a(this,ml)}get modifiedIds(){return wt(this,"modifiedIds",{ids:new Set,hash:""})}}ml=new WeakMap;var xa;class Yg{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){S(this,xa,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),a(this,xa).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,disableFontFace:t,_inspectFont:s}){if(!(!e||a(this,xa).has(e.loadedName))){if(Qt(!t,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:i,src:n,style:r}=e,o=new FontFace(i,n,r);this.addNativeFontFace(o);try{await o.load(),a(this,xa).add(i),s==null||s(e)}catch{pt(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}Lt("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const s=e.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(i){throw pt(`Failed to load font '${s.family}': '${i}'.`),e.disableFontFace=!0,i}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const i=this._queueLoadingCallback(s);this._prepareFontLoadEvent(e,i)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return wt(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){return wt(this,"isSyncFontLoadingSupported",Me||we.platform.isFirefox)}_queueLoadingCallback(e){function t(){for(Qt(!i.done,"completeRequest() cannot be called twice."),i.done=!0;s.length>0&&s[0].done;){const n=s.shift();setTimeout(n.callback,0)}}const{loadingRequests:s}=this,i={done:!1,complete:t,callback:e};return s.push(i),i}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return wt(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function s(k,C){return k.charCodeAt(C)<<24|k.charCodeAt(C+1)<<16|k.charCodeAt(C+2)<<8|k.charCodeAt(C+3)&255}function i(k,C,P,R){const D=k.substring(0,C),M=k.substring(C+P);return D+R+M}let n,r;const o=this._document.createElement("canvas");o.width=1,o.height=1;const l=o.getContext("2d");let h=0;function c(k,C){if(++h>30){pt("Load test font never loaded."),C();return}if(l.font="30px "+k,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){C();return}setTimeout(c.bind(null,k,C))}const d=`lt${Date.now()}${this.loadTestFontId++}`;let f=this._loadTestFont;f=i(f,976,d.length,d);const m=16,p=1482184792;let _=s(f,m);for(n=0,r=d.length-3;n<r;n+=4)_=_-p+s(d,n)|0;n<d.length&&(_=_-p+s(d+"XXX",n)|0),f=i(f,m,4,Mg(_));const b=`url(data:font/opentype;base64,${btoa(f)});`,A=`@font-face {font-family:"${d}";src:${b}}`;this.insertRule(A);const x=this._document.createElement("div");x.style.visibility="hidden",x.style.width=x.style.height="10px",x.style.position="absolute",x.style.top=x.style.left="0px";for(const k of[e.loadedName,d]){const C=this._document.createElement("span");C.textContent="Hi",C.style.fontFamily=k,x.append(C)}this._document.body.append(x),c(d,()=>{x.remove(),t.complete()})}}xa=new WeakMap;class Kg{constructor(e,t=null){this.compiledGlyphs=Object.create(null);for(const s in e)this[s]=e[s];this._inspectFont=t}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const s={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(s.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,s)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var s;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${pf(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${e}}`}return(s=this._inspectFont)==null||s.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const s=this.loadedName+"_path_"+t;let i;try{i=e.get(s)}catch(r){pt(`getPathGenerator - ignoring character: "${r}".`)}const n=new Path2D(i||"");return this.fontExtraProperties||e.delete(s),this.compiledGlyphs[t]=n}}function Zg(g){if(g instanceof URL)return g.href;if(typeof g=="string"){if(Me)return g;const e=URL.parse(g,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function Jg(g){if(Me&&typeof Buffer<"u"&&g instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(g instanceof Uint8Array&&g.byteLength===g.buffer.byteLength)return g;if(typeof g=="string")return _h(g);if(g instanceof ArrayBuffer||ArrayBuffer.isView(g)||typeof g=="object"&&!isNaN(g==null?void 0:g.length))return new Uint8Array(g);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Ph(g){if(typeof g!="string")return null;if(g.endsWith("/"))return g;throw new Error(`Invalid factory url: "${g}" must include trailing slash.`)}const xd=g=>typeof g=="object"&&Number.isInteger(g==null?void 0:g.num)&&g.num>=0&&Number.isInteger(g==null?void 0:g.gen)&&g.gen>=0,Qg=g=>typeof g=="object"&&typeof(g==null?void 0:g.name)=="string",tm=Bg.bind(null,xd,Qg);var Ai,Ic;class em{constructor(){S(this,Ai,new Map);S(this,Ic,Promise.resolve())}postMessage(e,t){const s={data:structuredClone(e,t?{transfer:t}:null)};a(this,Ic).then(()=>{for(const[i]of a(this,Ai))i.call(this,s)})}addEventListener(e,t,s=null){let i=null;if((s==null?void 0:s.signal)instanceof AbortSignal){const{signal:n}=s;if(n.aborted){pt("LoopbackPort - cannot use an `aborted` signal.");return}const r=()=>this.removeEventListener(e,t);i=()=>n.removeEventListener("abort",r),n.addEventListener("abort",r)}a(this,Ai).set(t,i)}removeEventListener(e,t){const s=a(this,Ai).get(t);s==null||s(),a(this,Ai).delete(t)}terminate(){for(const[,e]of a(this,Ai))e==null||e();a(this,Ai).clear()}}Ai=new WeakMap,Ic=new WeakMap;const Lh={DATA:1,ERROR:2},Kt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Wu(){}function ze(g){if(g instanceof Ln||g instanceof rd||g instanceof Uu||g instanceof gc||g instanceof Zc)return g;switch(g instanceof Error||typeof g=="object"&&g!==null||Lt('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),g.name){case"AbortException":return new Ln(g.message);case"InvalidPDFException":return new rd(g.message);case"PasswordException":return new Uu(g.message,g.code);case"ResponseException":return new gc(g.message,g.status,g.missing);case"UnknownErrorException":return new Zc(g.message,g.details)}return new Zc(g.message,g.toString())}var Ca,ws,Yf,Kf,Zf,Vh;class Ro{constructor(e,t,s){S(this,ws);S(this,Ca,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",E(this,ws,Yf).bind(this),{signal:a(this,Ca).signal})}on(e,t){const s=this.actionHandler;if(s[e])throw new Error(`There is already an actionName called "${e}"`);s[e]=t}send(e,t,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},s)}sendWithPromise(e,t,s){const i=this.callbackId++,n=Promise.withResolvers();this.callbackCapabilities[i]=n;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:i,data:t},s)}catch(r){n.reject(r)}return n.promise}sendWithStream(e,t,s,i){const n=this.streamId++,r=this.sourceName,o=this.targetName,l=this.comObj;return new ReadableStream({start:h=>{const c=Promise.withResolvers();return this.streamControllers[n]={controller:h,startCall:c,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:r,targetName:o,action:e,streamId:n,data:t,desiredSize:h.desiredSize},i),c.promise},pull:h=>{const c=Promise.withResolvers();return this.streamControllers[n].pullCall=c,l.postMessage({sourceName:r,targetName:o,stream:Kt.PULL,streamId:n,desiredSize:h.desiredSize}),c.promise},cancel:h=>{Qt(h instanceof Error,"cancel must have a valid reason");const c=Promise.withResolvers();return this.streamControllers[n].cancelCall=c,this.streamControllers[n].isClosed=!0,l.postMessage({sourceName:r,targetName:o,stream:Kt.CANCEL,streamId:n,reason:ze(h)}),c.promise}},s)}destroy(){var e;(e=a(this,Ca))==null||e.abort(),y(this,Ca,null)}}Ca=new WeakMap,ws=new WeakSet,Yf=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){E(this,ws,Zf).call(this,e);return}if(e.callback){const s=e.callbackId,i=this.callbackCapabilities[s];if(!i)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],e.callback===Lh.DATA)i.resolve(e.data);else if(e.callback===Lh.ERROR)i.reject(ze(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const s=this.sourceName,i=e.sourceName,n=this.comObj;Promise.try(t,e.data).then(function(r){n.postMessage({sourceName:s,targetName:i,callback:Lh.DATA,callbackId:e.callbackId,data:r})},function(r){n.postMessage({sourceName:s,targetName:i,callback:Lh.ERROR,callbackId:e.callbackId,reason:ze(r)})});return}if(e.streamId){E(this,ws,Kf).call(this,e);return}t(e.data)},Kf=function(e){const t=e.streamId,s=this.sourceName,i=e.sourceName,n=this.comObj,r=this,o=this.actionHandler[e.action],l={enqueue(h,c=1,d){if(this.isCancelled)return;const f=this.desiredSize;this.desiredSize-=c,f>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),n.postMessage({sourceName:s,targetName:i,stream:Kt.ENQUEUE,streamId:t,chunk:h},d)},close(){this.isCancelled||(this.isCancelled=!0,n.postMessage({sourceName:s,targetName:i,stream:Kt.CLOSE,streamId:t}),delete r.streamSinks[t])},error(h){Qt(h instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,n.postMessage({sourceName:s,targetName:i,stream:Kt.ERROR,streamId:t,reason:ze(h)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(o,e.data,l).then(function(){n.postMessage({sourceName:s,targetName:i,stream:Kt.START_COMPLETE,streamId:t,success:!0})},function(h){n.postMessage({sourceName:s,targetName:i,stream:Kt.START_COMPLETE,streamId:t,reason:ze(h)})})},Zf=function(e){const t=e.streamId,s=this.sourceName,i=e.sourceName,n=this.comObj,r=this.streamControllers[t],o=this.streamSinks[t];switch(e.stream){case Kt.START_COMPLETE:e.success?r.startCall.resolve():r.startCall.reject(ze(e.reason));break;case Kt.PULL_COMPLETE:e.success?r.pullCall.resolve():r.pullCall.reject(ze(e.reason));break;case Kt.PULL:if(!o){n.postMessage({sourceName:s,targetName:i,stream:Kt.PULL_COMPLETE,streamId:t,success:!0});break}o.desiredSize<=0&&e.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=e.desiredSize,Promise.try(o.onPull||Wu).then(function(){n.postMessage({sourceName:s,targetName:i,stream:Kt.PULL_COMPLETE,streamId:t,success:!0})},function(h){n.postMessage({sourceName:s,targetName:i,stream:Kt.PULL_COMPLETE,streamId:t,reason:ze(h)})});break;case Kt.ENQUEUE:if(Qt(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(e.chunk);break;case Kt.CLOSE:if(Qt(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),E(this,ws,Vh).call(this,r,t);break;case Kt.ERROR:Qt(r,"error should have stream controller"),r.controller.error(ze(e.reason)),E(this,ws,Vh).call(this,r,t);break;case Kt.CANCEL_COMPLETE:e.success?r.cancelCall.resolve():r.cancelCall.reject(ze(e.reason)),E(this,ws,Vh).call(this,r,t);break;case Kt.CANCEL:if(!o)break;const l=ze(e.reason);Promise.try(o.onCancel||Wu,l).then(function(){n.postMessage({sourceName:s,targetName:i,stream:Kt.CANCEL_COMPLETE,streamId:t,success:!0})},function(h){n.postMessage({sourceName:s,targetName:i,stream:Kt.CANCEL_COMPLETE,streamId:t,reason:ze(h)})}),o.sinkCapability.reject(l),o.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},Vh=async function(e,t){var s,i,n;await Promise.allSettled([(s=e.startCall)==null?void 0:s.promise,(i=e.pullCall)==null?void 0:i.promise,(n=e.cancelCall)==null?void 0:n.promise]),delete this.streamControllers[t]};var bl;class Jf{constructor({enableHWA:e=!1}){S(this,bl,!1);y(this,bl,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(e,t);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!a(this,bl)})}}reset(e,t,s){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||s<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=s}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){Lt("Abstract method `_createCanvas` called.")}}bl=new WeakMap;class sm extends Jf{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const s=this._document.createElement("canvas");return s.width=e,s.height=t,s}}class Qf{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){Lt("Abstract method `_fetch` called.")}}class Vu extends Qf{async _fetch(e){const t=await wh(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):_h(t)}}class tp{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,s,i,n){return"none"}destroy(e=!1){}}var lr,ka,vi,Si,Ee,hr,cr,it,ve,Io,ta,Xh,ea,ep,Cd,sa,Po,Lo,kd,Mo;class im extends tp{constructor({docId:t,ownerDocument:s=globalThis.document}){super();S(this,it);S(this,lr);S(this,ka);S(this,vi);S(this,Si);S(this,Ee);S(this,hr);S(this,cr,0);y(this,Si,t),y(this,Ee,s)}addFilter(t){if(!t)return"none";let s=a(this,it,ve).get(t);if(s)return s;const[i,n,r]=E(this,it,Xh).call(this,t),o=t.length===1?i:`${i}${n}${r}`;if(s=a(this,it,ve).get(o),s)return a(this,it,ve).set(t,s),s;const l=`g_${a(this,Si)}_transfer_map_${ke(this,cr)._++}`,h=E(this,it,ea).call(this,l);a(this,it,ve).set(t,h),a(this,it,ve).set(o,h);const c=E(this,it,sa).call(this,l);return E(this,it,Lo).call(this,i,n,r,c),h}addHCMFilter(t,s){var m;const i=`${t}-${s}`,n="base";let r=a(this,it,Io).get(n);if((r==null?void 0:r.key)===i||(r?((m=r.filter)==null||m.remove(),r.key=i,r.url="none",r.filter=null):(r={key:i,url:"none",filter:null},a(this,it,Io).set(n,r)),!t||!s))return r.url;const o=E(this,it,Mo).call(this,t);t=lt.makeHexColor(...o);const l=E(this,it,Mo).call(this,s);if(s=lt.makeHexColor(...l),a(this,it,ta).style.color="",t==="#000000"&&s==="#ffffff"||t===s)return r.url;const h=new Array(256);for(let p=0;p<=255;p++){const _=p/255;h[p]=_<=.03928?_/12.92:((_+.055)/1.055)**2.4}const c=h.join(","),d=`g_${a(this,Si)}_hcm_filter`,f=r.filter=E(this,it,sa).call(this,d);E(this,it,Lo).call(this,c,c,c,f),E(this,it,Cd).call(this,f);const u=(p,_)=>{const b=o[p]/255,A=l[p]/255,x=new Array(_+1);for(let k=0;k<=_;k++)x[k]=b+k/_*(A-b);return x.join(",")};return E(this,it,Lo).call(this,u(0,5),u(1,5),u(2,5),f),r.url=E(this,it,ea).call(this,d),r.url}addAlphaFilter(t){let s=a(this,it,ve).get(t);if(s)return s;const[i]=E(this,it,Xh).call(this,[t]),n=`alpha_${i}`;if(s=a(this,it,ve).get(n),s)return a(this,it,ve).set(t,s),s;const r=`g_${a(this,Si)}_alpha_map_${ke(this,cr)._++}`,o=E(this,it,ea).call(this,r);a(this,it,ve).set(t,o),a(this,it,ve).set(n,o);const l=E(this,it,sa).call(this,r);return E(this,it,kd).call(this,i,l),o}addLuminosityFilter(t){let s=a(this,it,ve).get(t||"luminosity");if(s)return s;let i,n;if(t?([i]=E(this,it,Xh).call(this,[t]),n=`luminosity_${i}`):n="luminosity",s=a(this,it,ve).get(n),s)return a(this,it,ve).set(t,s),s;const r=`g_${a(this,Si)}_luminosity_map_${ke(this,cr)._++}`,o=E(this,it,ea).call(this,r);a(this,it,ve).set(t,o),a(this,it,ve).set(n,o);const l=E(this,it,sa).call(this,r);return E(this,it,ep).call(this,l),t&&E(this,it,kd).call(this,i,l),o}addHighlightHCMFilter(t,s,i,n,r){var A;const o=`${s}-${i}-${n}-${r}`;let l=a(this,it,Io).get(t);if((l==null?void 0:l.key)===o||(l?((A=l.filter)==null||A.remove(),l.key=o,l.url="none",l.filter=null):(l={key:o,url:"none",filter:null},a(this,it,Io).set(t,l)),!s||!i))return l.url;const[h,c]=[s,i].map(E(this,it,Mo).bind(this));let d=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),f=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),[u,m]=[n,r].map(E(this,it,Mo).bind(this));f<d&&([d,f,u,m]=[f,d,m,u]),a(this,it,ta).style.color="";const p=(x,k,C)=>{const P=new Array(256),R=(f-d)/C,D=x/255,M=(k-x)/(255*C);let U=0;for(let $=0;$<=C;$++){const L=Math.round(d+$*R),z=D+$*M;for(let v=U;v<=L;v++)P[v]=z;U=L+1}for(let $=U;$<256;$++)P[$]=P[U-1];return P.join(",")},_=`g_${a(this,Si)}_hcm_${t}_filter`,b=l.filter=E(this,it,sa).call(this,_);return E(this,it,Cd).call(this,b),E(this,it,Lo).call(this,p(u[0],m[0],5),p(u[1],m[1],5),p(u[2],m[2],5),b),l.url=E(this,it,ea).call(this,_),l.url}destroy(t=!1){var s,i,n,r;t&&((s=a(this,hr))!=null&&s.size)||((i=a(this,vi))==null||i.parentNode.parentNode.remove(),y(this,vi,null),(n=a(this,ka))==null||n.clear(),y(this,ka,null),(r=a(this,hr))==null||r.clear(),y(this,hr,null),y(this,cr,0))}}lr=new WeakMap,ka=new WeakMap,vi=new WeakMap,Si=new WeakMap,Ee=new WeakMap,hr=new WeakMap,cr=new WeakMap,it=new WeakSet,ve=function(){return a(this,ka)||y(this,ka,new Map)},Io=function(){return a(this,hr)||y(this,hr,new Map)},ta=function(){if(!a(this,vi)){const t=a(this,Ee).createElement("div"),{style:s}=t;s.visibility="hidden",s.contain="strict",s.width=s.height=0,s.position="absolute",s.top=s.left=0,s.zIndex=-1;const i=a(this,Ee).createElementNS(oi,"svg");i.setAttribute("width",0),i.setAttribute("height",0),y(this,vi,a(this,Ee).createElementNS(oi,"defs")),t.append(i),i.append(a(this,vi)),a(this,Ee).body.append(t)}return a(this,vi)},Xh=function(t){if(t.length===1){const h=t[0],c=new Array(256);for(let f=0;f<256;f++)c[f]=h[f]/255;const d=c.join(",");return[d,d,d]}const[s,i,n]=t,r=new Array(256),o=new Array(256),l=new Array(256);for(let h=0;h<256;h++)r[h]=s[h]/255,o[h]=i[h]/255,l[h]=n[h]/255;return[r.join(","),o.join(","),l.join(",")]},ea=function(t){if(a(this,lr)===void 0){y(this,lr,"");const s=a(this,Ee).URL;s!==a(this,Ee).baseURI&&(Wc(s)?pt('#createUrl: ignore "data:"-URL for performance reasons.'):y(this,lr,df(s,"")))}return`url(${a(this,lr)}#${t})`},ep=function(t){const s=a(this,Ee).createElementNS(oi,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(s)},Cd=function(t){const s=a(this,Ee).createElementNS(oi,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(s)},sa=function(t){const s=a(this,Ee).createElementNS(oi,"filter");return s.setAttribute("color-interpolation-filters","sRGB"),s.setAttribute("id",t),a(this,it,ta).append(s),s},Po=function(t,s,i){const n=a(this,Ee).createElementNS(oi,s);n.setAttribute("type","discrete"),n.setAttribute("tableValues",i),t.append(n)},Lo=function(t,s,i,n){const r=a(this,Ee).createElementNS(oi,"feComponentTransfer");n.append(r),E(this,it,Po).call(this,r,"feFuncR",t),E(this,it,Po).call(this,r,"feFuncG",s),E(this,it,Po).call(this,r,"feFuncB",i)},kd=function(t,s){const i=a(this,Ee).createElementNS(oi,"feComponentTransfer");s.append(i),E(this,it,Po).call(this,i,"feFuncA",t)},Mo=function(t){return a(this,it,ta).style.color=t,Cu(getComputedStyle(a(this,it,ta)).getPropertyValue("color"))};class sp{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(s=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){Lt("Abstract method `_fetch` called.")}}class Xu extends sp{async _fetch(e){const t=await wh(e,"arraybuffer");return new Uint8Array(t)}}class ip{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw new Error("Wasm filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(s=>{throw new Error(`Unable to load wasm data at: ${t}`)})}async _fetch(e){Lt("Abstract method `_fetch` called.")}}class qu extends ip{async _fetch(e){const t=await wh(e,"arraybuffer");return new Uint8Array(t)}}Me&&pt("Please use the `legacy` build in Node.js environments.");async function Tu(g){const t=await process.getBuiltinModule("fs").promises.readFile(g);return new Uint8Array(t)}class nm extends tp{}class rm extends Jf{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class am extends Qf{async _fetch(e){return Tu(e)}}class om extends sp{async _fetch(e){return Tu(e)}}class lm extends ip{async _fetch(e){return Tu(e)}}const be={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Td(g,e){if(!e)return;const t=e[2]-e[0],s=e[3]-e[1],i=new Path2D;i.rect(e[0],e[1],t,s),g.clip(i)}class Ru{isModifyingCurrentTransform(){return!1}getPattern(){Lt("Abstract method `getPattern` called.")}}class hm extends Ru{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const s of this._colorStops)t.addColorStop(s[0],s[1]);return t}getPattern(e,t,s,i){let n;if(i===be.STROKE||i===be.FILL){const r=t.current.getClippedPathBoundingBox(i,Gt(e))||[0,0,0,0],o=Math.ceil(r[2]-r[0])||1,l=Math.ceil(r[3]-r[1])||1,h=t.cachedCanvases.getCanvas("pattern",o,l),c=h.context;c.clearRect(0,0,c.canvas.width,c.canvas.height),c.beginPath(),c.rect(0,0,c.canvas.width,c.canvas.height),c.translate(-r[0],-r[1]),s=lt.transform(s,[1,0,0,1,r[0],r[1]]),c.transform(...t.baseTransform),this.matrix&&c.transform(...this.matrix),Td(c,this._bbox),c.fillStyle=this._createGradient(c),c.fill(),n=e.createPattern(h.canvas,"no-repeat");const d=new DOMMatrix(s);n.setTransform(d)}else Td(e,this._bbox),n=this._createGradient(e);return n}}function td(g,e,t,s,i,n,r,o){const l=e.coords,h=e.colors,c=g.data,d=g.width*4;let f;l[t+1]>l[s+1]&&(f=t,t=s,s=f,f=n,n=r,r=f),l[s+1]>l[i+1]&&(f=s,s=i,i=f,f=r,r=o,o=f),l[t+1]>l[s+1]&&(f=t,t=s,s=f,f=n,n=r,r=f);const u=(l[t]+e.offsetX)*e.scaleX,m=(l[t+1]+e.offsetY)*e.scaleY,p=(l[s]+e.offsetX)*e.scaleX,_=(l[s+1]+e.offsetY)*e.scaleY,b=(l[i]+e.offsetX)*e.scaleX,A=(l[i+1]+e.offsetY)*e.scaleY;if(m>=A)return;const x=h[n],k=h[n+1],C=h[n+2],P=h[r],R=h[r+1],D=h[r+2],M=h[o],U=h[o+1],$=h[o+2],L=Math.round(m),z=Math.round(A);let v,G,V,O,dt,Y,ht,H;for(let N=L;N<=z;N++){if(N<_){const yt=N<m?0:(m-N)/(m-_);v=u-(u-p)*yt,G=x-(x-P)*yt,V=k-(k-R)*yt,O=C-(C-D)*yt}else{let yt;N>A?yt=1:_===A?yt=0:yt=(_-N)/(_-A),v=p-(p-b)*yt,G=P-(P-M)*yt,V=R-(R-U)*yt,O=D-(D-$)*yt}let st;N<m?st=0:N>A?st=1:st=(m-N)/(m-A),dt=u-(u-b)*st,Y=x-(x-M)*st,ht=k-(k-U)*st,H=C-(C-$)*st;const et=Math.round(Math.min(v,dt)),Z=Math.round(Math.max(v,dt));let kt=d*N+et*4;for(let yt=et;yt<=Z;yt++)st=(v-yt)/(v-dt),st<0?st=0:st>1&&(st=1),c[kt++]=G-(G-Y)*st|0,c[kt++]=V-(V-ht)*st|0,c[kt++]=O-(O-H)*st|0,c[kt++]=255}}function cm(g,e,t){const s=e.coords,i=e.colors;let n,r;switch(e.type){case"lattice":const o=e.verticesPerRow,l=Math.floor(s.length/o)-1,h=o-1;for(n=0;n<l;n++){let c=n*o;for(let d=0;d<h;d++,c++)td(g,t,s[c],s[c+1],s[c+o],i[c],i[c+1],i[c+o]),td(g,t,s[c+o+1],s[c+1],s[c+o],i[c+o+1],i[c+1],i[c+o])}break;case"triangles":for(n=0,r=s.length;n<r;n+=3)td(g,t,s[n],s[n+1],s[n+2],i[n],i[n+1],i[n+2]);break;default:throw new Error("illegal figure")}}class dm extends Ru{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,s){const o=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),h=Math.ceil(this._bounds[2])-o,c=Math.ceil(this._bounds[3])-l,d=Math.min(Math.ceil(Math.abs(h*e[0]*1.1)),3e3),f=Math.min(Math.ceil(Math.abs(c*e[1]*1.1)),3e3),u=h/d,m=c/f,p={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-l,scaleX:1/u,scaleY:1/m},_=d+2*2,b=f+2*2,A=s.getCanvas("mesh",_,b),x=A.context,k=x.createImageData(d,f);if(t){const P=k.data;for(let R=0,D=P.length;R<D;R+=4)P[R]=t[0],P[R+1]=t[1],P[R+2]=t[2],P[R+3]=255}for(const P of this._figures)cm(k,P,p);return x.putImageData(k,2,2),{canvas:A.canvas,offsetX:o-2*u,offsetY:l-2*m,scaleX:u,scaleY:m}}isModifyingCurrentTransform(){return!0}getPattern(e,t,s,i){Td(e,this._bbox);const n=new Float32Array(2);if(i===be.SHADING)lt.singularValueDecompose2dScale(Gt(e),n);else if(this.matrix){lt.singularValueDecompose2dScale(this.matrix,n);const[o,l]=n;lt.singularValueDecompose2dScale(t.baseTransform,n),n[0]*=o,n[1]*=l}else lt.singularValueDecompose2dScale(t.baseTransform,n);const r=this._createMeshCanvas(n,i===be.SHADING?null:this._background,t.cachedCanvases);return i!==be.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(r.offsetX,r.offsetY),e.scale(r.scaleX,r.scaleY),e.createPattern(r.canvas,"no-repeat")}}class um extends Ru{getPattern(){return"hotpink"}}function fm(g){switch(g[0]){case"RadialAxial":return new hm(g);case"Mesh":return new dm(g);case"Dummy":return new um}throw new Error(`Unknown IR type: ${g[0]}`)}const Yu={COLORED:1,UNCOLORED:2},Pc=class Pc{constructor(e,t,s,i){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=s,this.baseTransform=i}createPatternCanvas(e){const{bbox:t,operatorList:s,paintType:i,tilingType:n,color:r,canvasGraphicsFactory:o}=this;let{xstep:l,ystep:h}=this;l=Math.abs(l),h=Math.abs(h),$c("TilingType: "+n);const c=t[0],d=t[1],f=t[2],u=t[3],m=f-c,p=u-d,_=new Float32Array(2);lt.singularValueDecompose2dScale(this.matrix,_);const[b,A]=_;lt.singularValueDecompose2dScale(this.baseTransform,_);const x=b*_[0],k=A*_[1];let C=m,P=p,R=!1,D=!1;const M=Math.ceil(l*x),U=Math.ceil(h*k),$=Math.ceil(m*x),L=Math.ceil(p*k);M>=$?C=l:R=!0,U>=L?P=h:D=!0;const z=this.getSizeAndScale(C,this.ctx.canvas.width,x),v=this.getSizeAndScale(P,this.ctx.canvas.height,k),G=e.cachedCanvases.getCanvas("pattern",z.size,v.size),V=G.context,O=o.createCanvasGraphics(V);if(O.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(O,i,r),V.translate(-z.scale*c,-v.scale*d),O.transform(z.scale,0,0,v.scale,0,0),V.save(),this.clipBbox(O,c,d,f,u),O.baseTransform=Gt(O.ctx),O.executeOperatorList(s),O.endDrawing(),V.restore(),R||D){const dt=G.canvas;R&&(C=l),D&&(P=h);const Y=this.getSizeAndScale(C,this.ctx.canvas.width,x),ht=this.getSizeAndScale(P,this.ctx.canvas.height,k),H=Y.size,N=ht.size,st=e.cachedCanvases.getCanvas("pattern-workaround",H,N),et=st.context,Z=R?Math.floor(m/l):0,kt=D?Math.floor(p/h):0;for(let yt=0;yt<=Z;yt++)for(let mt=0;mt<=kt;mt++)et.drawImage(dt,H*yt,N*mt,H,N,0,0,H,N);return{canvas:st.canvas,scaleX:Y.scale,scaleY:ht.scale,offsetX:c,offsetY:d}}return{canvas:G.canvas,scaleX:z.scale,scaleY:v.scale,offsetX:c,offsetY:d}}getSizeAndScale(e,t,s){const i=Math.max(Pc.MAX_PATTERN_SIZE,t);let n=Math.ceil(e*s);return n>=i?n=i:s=n/e,{scale:s,size:n}}clipBbox(e,t,s,i,n){const r=i-t,o=n-s;e.ctx.rect(t,s,r,o),lt.axialAlignedBoundingBox([t,s,i,n],Gt(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,s){const i=e.ctx,n=e.current;switch(t){case Yu.COLORED:const{fillStyle:r,strokeStyle:o}=this.ctx;i.fillStyle=n.fillColor=r,i.strokeStyle=n.strokeColor=o;break;case Yu.UNCOLORED:i.fillStyle=i.strokeStyle=s,n.fillColor=n.strokeColor=s;break;default:throw new Lg(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,s,i){let n=s;i!==be.SHADING&&(n=lt.transform(n,t.baseTransform),this.matrix&&(n=lt.transform(n,this.matrix)));const r=this.createPatternCanvas(t);let o=new DOMMatrix(n);o=o.translate(r.offsetX,r.offsetY),o=o.scale(1/r.scaleX,1/r.scaleY);const l=e.createPattern(r.canvas,"repeat");return l.setTransform(o),l}};K(Pc,"MAX_PATTERN_SIZE",3e3);let Rd=Pc;function pm({src:g,srcPos:e=0,dest:t,width:s,height:i,nonBlackColor:n=4294967295,inverseDecode:r=!1}){const o=we.isLittleEndian?4278190080:255,[l,h]=r?[n,o]:[o,n],c=s>>3,d=s&7,f=g.length;t=new Uint32Array(t.buffer);let u=0;for(let m=0;m<i;m++){for(const _=e+c;e<_;e++){const b=e<f?g[e]:255;t[u++]=b&128?h:l,t[u++]=b&64?h:l,t[u++]=b&32?h:l,t[u++]=b&16?h:l,t[u++]=b&8?h:l,t[u++]=b&4?h:l,t[u++]=b&2?h:l,t[u++]=b&1?h:l}if(d===0)continue;const p=e<f?g[e++]:255;for(let _=0;_<d;_++)t[u++]=p&1<<7-_?h:l}return{srcPos:e,destPos:u}}const Ku=16,Zu=100,gm=15,Ju=10,$e=16,ed=new DOMMatrix,as=new Float32Array(2),aa=new Float32Array([1/0,1/0,-1/0,-1/0]);function mm(g,e){if(g._removeMirroring)throw new Error("Context is already forwarding operations.");g.__originalSave=g.save,g.__originalRestore=g.restore,g.__originalRotate=g.rotate,g.__originalScale=g.scale,g.__originalTranslate=g.translate,g.__originalTransform=g.transform,g.__originalSetTransform=g.setTransform,g.__originalResetTransform=g.resetTransform,g.__originalClip=g.clip,g.__originalMoveTo=g.moveTo,g.__originalLineTo=g.lineTo,g.__originalBezierCurveTo=g.bezierCurveTo,g.__originalRect=g.rect,g.__originalClosePath=g.closePath,g.__originalBeginPath=g.beginPath,g._removeMirroring=()=>{g.save=g.__originalSave,g.restore=g.__originalRestore,g.rotate=g.__originalRotate,g.scale=g.__originalScale,g.translate=g.__originalTranslate,g.transform=g.__originalTransform,g.setTransform=g.__originalSetTransform,g.resetTransform=g.__originalResetTransform,g.clip=g.__originalClip,g.moveTo=g.__originalMoveTo,g.lineTo=g.__originalLineTo,g.bezierCurveTo=g.__originalBezierCurveTo,g.rect=g.__originalRect,g.closePath=g.__originalClosePath,g.beginPath=g.__originalBeginPath,delete g._removeMirroring},g.save=function(){e.save(),this.__originalSave()},g.restore=function(){e.restore(),this.__originalRestore()},g.translate=function(t,s){e.translate(t,s),this.__originalTranslate(t,s)},g.scale=function(t,s){e.scale(t,s),this.__originalScale(t,s)},g.transform=function(t,s,i,n,r,o){e.transform(t,s,i,n,r,o),this.__originalTransform(t,s,i,n,r,o)},g.setTransform=function(t,s,i,n,r,o){e.setTransform(t,s,i,n,r,o),this.__originalSetTransform(t,s,i,n,r,o)},g.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},g.rotate=function(t){e.rotate(t),this.__originalRotate(t)},g.clip=function(t){e.clip(t),this.__originalClip(t)},g.moveTo=function(t,s){e.moveTo(t,s),this.__originalMoveTo(t,s)},g.lineTo=function(t,s){e.lineTo(t,s),this.__originalLineTo(t,s)},g.bezierCurveTo=function(t,s,i,n,r,o){e.bezierCurveTo(t,s,i,n,r,o),this.__originalBezierCurveTo(t,s,i,n,r,o)},g.rect=function(t,s,i,n){e.rect(t,s,i,n),this.__originalRect(t,s,i,n)},g.closePath=function(){e.closePath(),this.__originalClosePath()},g.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class bm{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,s){let i;return this.cache[e]!==void 0?(i=this.cache[e],this.canvasFactory.reset(i,t,s)):(i=this.canvasFactory.create(t,s),this.cache[e]=i),i}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function Mh(g,e,t,s,i,n,r,o,l,h){const[c,d,f,u,m,p]=Gt(g);if(d===0&&f===0){const A=r*c+m,x=Math.round(A),k=o*u+p,C=Math.round(k),P=(r+l)*c+m,R=Math.abs(Math.round(P)-x)||1,D=(o+h)*u+p,M=Math.abs(Math.round(D)-C)||1;return g.setTransform(Math.sign(c),0,0,Math.sign(u),x,C),g.drawImage(e,t,s,i,n,0,0,R,M),g.setTransform(c,d,f,u,m,p),[R,M]}if(c===0&&u===0){const A=o*f+m,x=Math.round(A),k=r*d+p,C=Math.round(k),P=(o+h)*f+m,R=Math.abs(Math.round(P)-x)||1,D=(r+l)*d+p,M=Math.abs(Math.round(D)-C)||1;return g.setTransform(0,Math.sign(d),Math.sign(f),0,x,C),g.drawImage(e,t,s,i,n,0,0,M,R),g.setTransform(c,d,f,u,m,p),[M,R]}g.drawImage(e,t,s,i,n,r,o,l,h);const _=Math.hypot(c,d),b=Math.hypot(f,u);return[_*l,b*h]}class Qu{constructor(e,t){K(this,"alphaIsShape",!1);K(this,"fontSize",0);K(this,"fontSizeScale",1);K(this,"textMatrix",null);K(this,"textMatrixScale",1);K(this,"fontMatrix",nd);K(this,"leading",0);K(this,"x",0);K(this,"y",0);K(this,"lineX",0);K(this,"lineY",0);K(this,"charSpacing",0);K(this,"wordSpacing",0);K(this,"textHScale",1);K(this,"textRenderingMode",Ae.FILL);K(this,"textRise",0);K(this,"fillColor","#000000");K(this,"strokeColor","#000000");K(this,"patternFill",!1);K(this,"patternStroke",!1);K(this,"fillAlpha",1);K(this,"strokeAlpha",1);K(this,"lineWidth",1);K(this,"activeSMask",null);K(this,"transferMaps","none");this.clipBox=new Float32Array([0,0,e,t]),this.minMax=aa.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=be.FILL,t=null){const s=this.minMax.slice();if(e===be.STROKE){t||Lt("Stroke bounding box must include transform."),lt.singularValueDecompose2dScale(t,as);const i=as[0]*this.lineWidth/2,n=as[1]*this.lineWidth/2;s[0]-=i,s[1]-=n,s[2]+=i,s[3]+=n}return s}updateClipFromPath(){const e=lt.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(aa,0)}getClippedPathBoundingBox(e=be.FILL,t=null){return lt.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function tf(g,e){if(e instanceof ImageData){g.putImageData(e,0,0);return}const t=e.height,s=e.width,i=t%$e,n=(t-i)/$e,r=i===0?n:n+1,o=g.createImageData(s,$e);let l=0,h;const c=e.data,d=o.data;let f,u,m,p;if(e.kind===Oh.GRAYSCALE_1BPP){const _=c.byteLength,b=new Uint32Array(d.buffer,0,d.byteLength>>2),A=b.length,x=s+7>>3,k=4294967295,C=we.isLittleEndian?4278190080:255;for(f=0;f<r;f++){for(m=f<n?$e:i,h=0,u=0;u<m;u++){const P=_-l;let R=0;const D=P>x?s:P*8-7,M=D&-8;let U=0,$=0;for(;R<M;R+=8)$=c[l++],b[h++]=$&128?k:C,b[h++]=$&64?k:C,b[h++]=$&32?k:C,b[h++]=$&16?k:C,b[h++]=$&8?k:C,b[h++]=$&4?k:C,b[h++]=$&2?k:C,b[h++]=$&1?k:C;for(;R<D;R++)U===0&&($=c[l++],U=128),b[h++]=$&U?k:C,U>>=1}for(;h<A;)b[h++]=0;g.putImageData(o,0,f*$e)}}else if(e.kind===Oh.RGBA_32BPP){for(u=0,p=s*$e*4,f=0;f<n;f++)d.set(c.subarray(l,l+p)),l+=p,g.putImageData(o,0,u),u+=$e;f<r&&(p=s*i*4,d.set(c.subarray(l,l+p)),g.putImageData(o,0,u))}else if(e.kind===Oh.RGB_24BPP)for(m=$e,p=s*m,f=0;f<r;f++){for(f>=n&&(m=i,p=s*m),h=0,u=p;u--;)d[h++]=c[l++],d[h++]=c[l++],d[h++]=c[l++],d[h++]=255;g.putImageData(o,0,f*$e)}else throw new Error(`bad image kind: ${e.kind}`)}function ef(g,e){if(e.bitmap){g.drawImage(e.bitmap,0,0);return}const t=e.height,s=e.width,i=t%$e,n=(t-i)/$e,r=i===0?n:n+1,o=g.createImageData(s,$e);let l=0;const h=e.data,c=o.data;for(let d=0;d<r;d++){const f=d<n?$e:i;({srcPos:l}=pm({src:h,srcPos:l,dest:c,width:s,height:f,nonBlackColor:0})),g.putImageData(o,0,d*$e)}}function wo(g,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of t)g[s]!==void 0&&(e[s]=g[s]);g.setLineDash!==void 0&&(e.setLineDash(g.getLineDash()),e.lineDashOffset=g.lineDashOffset)}function Dh(g){g.strokeStyle=g.fillStyle="#000000",g.fillRule="nonzero",g.globalAlpha=1,g.lineWidth=1,g.lineCap="butt",g.lineJoin="miter",g.miterLimit=10,g.globalCompositeOperation="source-over",g.font="10px sans-serif",g.setLineDash!==void 0&&(g.setLineDash([]),g.lineDashOffset=0);const{filter:e}=g;e!=="none"&&e!==""&&(g.filter="none")}function sf(g,e){if(e)return!0;lt.singularValueDecompose2dScale(g,as);const t=Math.fround(ni.pixelRatio*Mn.PDF_TO_CSS_UNITS);return as[0]<=t&&as[1]<=t}const ym=["butt","round","square"],_m=["miter","round","bevel"],wm={},nf={};var Os,Id,Pd,Ld;const Fu=class Fu{constructor(e,t,s,i,n,{optionalContentConfig:r,markedContentStack:o=null},l,h){S(this,Os);this.ctx=e,this.current=new Qu(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=s,this.canvasFactory=i,this.filterFactory=n,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=r,this.cachedCanvases=new bm(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=h,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:s=!1,background:i=null}){const n=this.ctx.canvas.width,r=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,n,r),this.ctx.fillStyle=o,s){const l=this.cachedCanvases.getCanvas("transparent",n,r);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...Gt(this.compositeCtx))}this.ctx.save(),Dh(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=Gt(this.ctx)}executeOperatorList(e,t,s,i){const n=e.argsArray,r=e.fnArray;let o=t||0;const l=n.length;if(l===o)return o;const h=l-o>Ju&&typeof s=="function",c=h?Date.now()+gm:0;let d=0;const f=this.commonObjs,u=this.objs;let m;for(;;){if(i!==void 0&&o===i.nextBreakPoint)return i.breakIt(o,s),o;if(m=r[o],m!==pc.dependency)this[m].apply(this,n[o]);else for(const p of n[o]){const _=p.startsWith("g_")?f:u;if(!_.has(p))return _.get(p,s),o}if(o++,o===l)return o;if(h&&++d>Ju){if(Date.now()>c)return s(),o;d=0}}}endDrawing(){E(this,Os,Id).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),E(this,Os,Pd).call(this)}_scaleImage(e,t){const s=e.width??e.displayWidth,i=e.height??e.displayHeight;let n=Math.max(Math.hypot(t[0],t[1]),1),r=Math.max(Math.hypot(t[2],t[3]),1),o=s,l=i,h="prescale1",c,d;for(;n>2&&o>1||r>2&&l>1;){let f=o,u=l;n>2&&o>1&&(f=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),n/=o/f),r>2&&l>1&&(u=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,r/=l/u),c=this.cachedCanvases.getCanvas(h,f,u),d=c.context,d.clearRect(0,0,f,u),d.drawImage(e,0,0,o,l,0,0,f,u),e=c.canvas,o=f,l=u,h=h==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:o,paintHeight:l}}_createMaskCanvas(e){const t=this.ctx,{width:s,height:i}=e,n=this.current.fillColor,r=this.current.patternFill,o=Gt(t);let l,h,c,d;if((e.bitmap||e.data)&&e.count>1){const M=e.bitmap||e.data.buffer;h=JSON.stringify(r?o:[o.slice(0,4),n]),l=this._cachedBitmapsMap.get(M),l||(l=new Map,this._cachedBitmapsMap.set(M,l));const U=l.get(h);if(U&&!r){const $=Math.round(Math.min(o[0],o[2])+o[4]),L=Math.round(Math.min(o[1],o[3])+o[5]);return{canvas:U,offsetX:$,offsetY:L}}c=U}c||(d=this.cachedCanvases.getCanvas("maskCanvas",s,i),ef(d.context,e));let f=lt.transform(o,[1/s,0,0,-1/i,0,0]);f=lt.transform(f,[1,0,0,1,0,-i]);const u=aa.slice();lt.axialAlignedBoundingBox([0,0,s,i],f,u);const[m,p,_,b]=u,A=Math.round(_-m)||1,x=Math.round(b-p)||1,k=this.cachedCanvases.getCanvas("fillCanvas",A,x),C=k.context,P=m,R=p;C.translate(-P,-R),C.transform(...f),c||(c=this._scaleImage(d.canvas,zs(C)),c=c.img,l&&r&&l.set(h,c)),C.imageSmoothingEnabled=sf(Gt(C),e.interpolate),Mh(C,c,0,0,c.width,c.height,0,0,s,i),C.globalCompositeOperation="source-in";const D=lt.transform(zs(C),[1,0,0,1,-P,-R]);return C.fillStyle=r?n.getPattern(t,this,D,be.FILL):n,C.fillRect(0,0,s,i),l&&!r&&(this.cachedCanvases.delete("fillCanvas"),l.set(h,k.canvas)),{canvas:k.canvas,offsetX:Math.round(P),offsetY:Math.round(R)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=ym[e]}setLineJoin(e){this.ctx.lineJoin=_m[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(e),s.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,s]of e)switch(t){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"RI":this.setRenderingIntent(s);break;case"FL":this.setFlatness(s);break;case"Font":this.setFont(s[0],s[1]);break;case"CA":this.current.strokeAlpha=s;break;case"ca":this.ctx.globalAlpha=this.current.fillAlpha=s;break;case"BM":this.ctx.globalCompositeOperation=s;break;case"SMask":this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,t=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(s,e,t);this.suspendedCtx=this.ctx;const n=this.ctx=i.context;n.setTransform(this.suspendedCtx.getTransform()),wo(this.suspendedCtx,n),mm(n,this.suspendedCtx),this.setGState([["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),wo(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,s,i){const n=i[0],r=i[1],o=i[2]-n,l=i[3]-r;o===0||l===0||(this.genericComposeSMask(t.context,s,o,l,t.subtype,t.backdrop,t.transferMap,n,r,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(s.canvas,0,0),e.restore())}genericComposeSMask(e,t,s,i,n,r,o,l,h,c,d){let f=e.canvas,u=l-c,m=h-d;if(r)if(u<0||m<0||u+s>f.width||m+i>f.height){const _=this.cachedCanvases.getCanvas("maskExtension",s,i),b=_.context;b.drawImage(f,-u,-m),b.globalCompositeOperation="destination-atop",b.fillStyle=r,b.fillRect(0,0,s,i),b.globalCompositeOperation="source-over",f=_.canvas,u=m=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const _=new Path2D;_.rect(u,m,s,i),e.clip(_),e.globalCompositeOperation="destination-atop",e.fillStyle=r,e.fillRect(u,m,s,i),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),n==="Alpha"&&o?t.filter=this.filterFactory.addAlphaFilter(o):n==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(o));const p=new Path2D;p.rect(l,h,s,i),t.clip(p),t.globalCompositeOperation="destination-in",t.drawImage(f,u,m,s,i,l,h,s,i),t.restore()}save(){this.inSMaskMode&&wo(this.ctx,this.suspendedCtx),this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){if(this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&wo(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(e,t,s,i,n,r){this.ctx.transform(e,t,s,i,n,r),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,s){let[i]=t;if(!s){i||(i=t[0]=new Path2D),this[e](i);return}if(!(i instanceof Path2D)){const n=t[0]=new Path2D;for(let r=0,o=i.length;r<o;)switch(i[r++]){case Ih.moveTo:n.moveTo(i[r++],i[r++]);break;case Ih.lineTo:n.lineTo(i[r++],i[r++]);break;case Ih.curveTo:n.bezierCurveTo(i[r++],i[r++],i[r++],i[r++],i[r++],i[r++]);break;case Ih.closePath:n.closePath();break;default:pt(`Unrecognized drawing path operator: ${i[r-1]}`);break}i=n}lt.axialAlignedBoundingBox(s,Gt(this.ctx),this.current.minMax),this[e](i)}closePath(){this.ctx.closePath()}stroke(e,t=!0){const s=this.ctx,i=this.current.strokeColor;if(s.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof i=="object"&&(i!=null&&i.getPattern)){const n=i.isModifyingCurrentTransform()?s.getTransform():null;if(s.save(),s.strokeStyle=i.getPattern(s,this,zs(s),be.STROKE),n){const r=new Path2D;r.addPath(e,s.getTransform().invertSelf().multiplySelf(n)),e=r}this.rescaleAndStroke(e,!1),s.restore()}else this.rescaleAndStroke(e,!0);t&&this.consumePath(e,this.current.getClippedPathBoundingBox(be.STROKE,Gt(this.ctx))),s.globalAlpha=this.current.fillAlpha}closeStroke(e){this.stroke(e)}fill(e,t=!0){const s=this.ctx,i=this.current.fillColor,n=this.current.patternFill;let r=!1;if(n){const l=i.isModifyingCurrentTransform()?s.getTransform():null;if(s.save(),s.fillStyle=i.getPattern(s,this,zs(s),be.FILL),l){const h=new Path2D;h.addPath(e,s.getTransform().invertSelf().multiplySelf(l)),e=h}r=!0}const o=this.current.getClippedPathBoundingBox();this.contentVisible&&o!==null&&(this.pendingEOFill?(s.fill(e,"evenodd"),this.pendingEOFill=!1):s.fill(e)),r&&s.restore(),t&&this.consumePath(e,o)}eoFill(e){this.pendingEOFill=!0,this.fill(e)}fillStroke(e){this.fill(e,!1),this.stroke(e,!1),this.consumePath(e)}eoFillStroke(e){this.pendingEOFill=!0,this.fillStroke(e)}closeFillStroke(e){this.fillStroke(e)}closeEOFillStroke(e){this.pendingEOFill=!0,this.fillStroke(e)}endPath(e){this.consumePath(e)}rawFillPath(e){this.ctx.fill(e)}clip(){this.pendingClip=wm}eoClip(){this.pendingClip=nf}beginText(){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(e===void 0)return;const s=new Path2D,i=t.getTransform().invertSelf();for(const{transform:n,x:r,y:o,fontSize:l,path:h}of e)s.addPath(h,new DOMMatrix(n).preMultiplySelf(i).translate(r,o).scale(l,-l));t.clip(s),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){var c;const s=this.commonObjs.get(e),i=this.current;if(!s)throw new Error(`Can't find font for ${e}`);if(i.fontMatrix=s.fontMatrix||nd,(i.fontMatrix[0]===0||i.fontMatrix[3]===0)&&pt("Invalid font matrix for font "+e),t<0?(t=-t,i.fontDirection=-1):i.fontDirection=1,this.current.font=s,this.current.fontSize=t,s.isType3Font)return;const n=s.loadedName||"sans-serif",r=((c=s.systemFontInfo)==null?void 0:c.css)||`"${n}", ${s.fallbackName}`;let o="normal";s.black?o="900":s.bold&&(o="bold");const l=s.italic?"italic":"normal";let h=t;t<Ku?h=Ku:t>Zu&&(h=Zu),this.current.fontSizeScale=t/h,this.ctx.font=`${l} ${o} ${h}px ${r}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e){const{current:t}=this;t.textMatrix=e,t.textMatrixScale=Math.hypot(e[0],e[1]),t.x=t.lineX=0,t.y=t.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,s,i,n){const r=this.ctx,o=this.current,l=o.font,h=o.textRenderingMode,c=o.fontSize/o.fontSizeScale,d=h&Ae.FILL_STROKE_MASK,f=!!(h&Ae.ADD_TO_PATH_FLAG),u=o.patternFill&&!l.missingFile,m=o.patternStroke&&!l.missingFile;let p;if((l.disableFontFace||f||u||m)&&(p=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||u||m){r.save(),r.translate(t,s),r.scale(c,-c);let _;if((d===Ae.FILL||d===Ae.FILL_STROKE)&&(i?(_=r.getTransform(),r.setTransform(...i),r.fill(E(this,Os,Ld).call(this,p,_,i))):r.fill(p)),d===Ae.STROKE||d===Ae.FILL_STROKE)if(n){_||(_=r.getTransform()),r.setTransform(...n);const{a:b,b:A,c:x,d:k}=_,C=lt.inverseTransform(n),P=lt.transform([b,A,x,k,0,0],C);lt.singularValueDecompose2dScale(P,as),r.lineWidth*=Math.max(as[0],as[1])/c,r.stroke(E(this,Os,Ld).call(this,p,_,n))}else r.lineWidth/=c,r.stroke(p);r.restore()}else(d===Ae.FILL||d===Ae.FILL_STROKE)&&r.fillText(e,t,s),(d===Ae.STROKE||d===Ae.FILL_STROKE)&&r.strokeText(e,t,s);f&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:Gt(r),x:t,y:s,fontSize:c,path:p})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let s=!1;for(let i=3;i<t.length;i+=4)if(t[i]>0&&t[i]<255){s=!0;break}return wt(this,"isFontSubpixelAAEnabled",s)}showText(e){const t=this.current,s=t.font;if(s.isType3Font)return this.showType3Text(e);const i=t.fontSize;if(i===0)return;const n=this.ctx,r=t.fontSizeScale,o=t.charSpacing,l=t.wordSpacing,h=t.fontDirection,c=t.textHScale*h,d=e.length,f=s.vertical,u=f?1:-1,m=s.defaultVMetrics,p=i*t.fontMatrix[0],_=t.textRenderingMode===Ae.FILL&&!s.disableFontFace&&!t.patternFill;n.save(),t.textMatrix&&n.transform(...t.textMatrix),n.translate(t.x,t.y+t.textRise),h>0?n.scale(c,-1):n.scale(c,1);let b,A;if(t.patternFill){n.save();const R=t.fillColor.getPattern(n,this,zs(n),be.FILL);b=Gt(n),n.restore(),n.fillStyle=R}if(t.patternStroke){n.save();const R=t.strokeColor.getPattern(n,this,zs(n),be.STROKE);A=Gt(n),n.restore(),n.strokeStyle=R}let x=t.lineWidth;const k=t.textMatrixScale;if(k===0||x===0){const R=t.textRenderingMode&Ae.FILL_STROKE_MASK;(R===Ae.STROKE||R===Ae.FILL_STROKE)&&(x=this.getSinglePixelWidth())}else x/=k;if(r!==1&&(n.scale(r,r),x/=r),n.lineWidth=x,s.isInvalidPDFjsFont){const R=[];let D=0;for(const M of e)R.push(M.unicode),D+=M.width;n.fillText(R.join(""),0,0),t.x+=D*p*c,n.restore(),this.compose();return}let C=0,P;for(P=0;P<d;++P){const R=e[P];if(typeof R=="number"){C+=u*R*i/1e3;continue}let D=!1;const M=(R.isSpace?l:0)+o,U=R.fontChar,$=R.accent;let L,z,v=R.width;if(f){const V=R.vmetric||m,O=-(R.vmetric?V[1]:v*.5)*p,dt=V[2]*p;v=V?-V[0]:v,L=O/r,z=(C+dt)/r}else L=C/r,z=0;if(s.remeasure&&v>0){const V=n.measureText(U).width*1e3/i*r;if(v<V&&this.isFontSubpixelAAEnabled){const O=v/V;D=!0,n.save(),n.scale(O,1),L/=O}else v!==V&&(L+=(v-V)/2e3*i/r)}if(this.contentVisible&&(R.isInFont||s.missingFile)){if(_&&!$)n.fillText(U,L,z);else if(this.paintChar(U,L,z,b,A),$){const V=L+i*$.offset.x/r,O=z-i*$.offset.y/r;this.paintChar($.fontChar,V,O,b,A)}}const G=f?v*p-M*h:v*p+M*h;C+=G,D&&n.restore()}f?t.y-=C:t.x+=C*c,n.restore(),this.compose()}showType3Text(e){const t=this.ctx,s=this.current,i=s.font,n=s.fontSize,r=s.fontDirection,o=i.vertical?1:-1,l=s.charSpacing,h=s.wordSpacing,c=s.textHScale*r,d=s.fontMatrix||nd,f=e.length,u=s.textRenderingMode===Ae.INVISIBLE;let m,p,_,b;if(!(u||n===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),s.textMatrix&&t.transform(...s.textMatrix),t.translate(s.x,s.y+s.textRise),t.scale(c,r),m=0;m<f;++m){if(p=e[m],typeof p=="number"){b=o*p*n/1e3,this.ctx.translate(b,0),s.x+=b*c;continue}const A=(p.isSpace?h:0)+l,x=i.charProcOperatorList[p.operatorListId];x?this.contentVisible&&(this.save(),t.scale(n,n),t.transform(...d),this.executeOperatorList(x),this.restore()):pt(`Type3 character "${p.operatorListId}" is not available.`);const k=[p.width,0];lt.applyTransform(k,d),_=k[0]*n+A,t.translate(_,0),s.x+=_*c}t.restore()}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,s,i,n,r){const o=new Path2D;o.rect(s,i,n-s,r-i),this.ctx.clip(o),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){const s=this.baseTransform||Gt(this.ctx),i={createCanvasGraphics:n=>new Fu(n,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new Rd(e,this.ctx,i,s)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e){this.ctx.strokeStyle=this.current.strokeColor=e,this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e){this.ctx.fillStyle=this.current.fillColor=e,this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let s;return this.cachedPatterns.has(e)?s=this.cachedPatterns.get(e):(s=fm(this.getObject(e)),this.cachedPatterns.set(e,s)),t&&(s.matrix=t),s}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const s=this._getPattern(e);t.fillStyle=s.getPattern(t,this,zs(t),be.SHADING);const i=zs(t);if(i){const{width:n,height:r}=t.canvas,o=aa.slice();lt.axialAlignedBoundingBox([0,0,n,r],i,o);const[l,h,c,d]=o;this.ctx.fillRect(l,h,c-l,d-h)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){Lt("Should not call beginInlineImage")}beginImageData(){Lt("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=Gt(this.ctx),t)){lt.axialAlignedBoundingBox(t,this.baseTransform,this.current.minMax);const[s,i,n,r]=t,o=new Path2D;o.rect(s,i,n-s,r-i),this.ctx.clip(o),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||$c("TODO: Support non-isolated groups."),e.knockout&&pt("Knockout groups not supported.");const s=Gt(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let i=aa.slice();lt.axialAlignedBoundingBox(e.bbox,Gt(t),i);const n=[0,0,t.canvas.width,t.canvas.height];i=lt.intersect(i,n)||[0,0,0,0];const r=Math.floor(i[0]),o=Math.floor(i[1]),l=Math.max(Math.ceil(i[2])-r,1),h=Math.max(Math.ceil(i[3])-o,1);this.current.startNewPathAndClipBox([0,0,l,h]);let c="groupAt"+this.groupLevel;e.smask&&(c+="_smask_"+this.smaskCounter++%2);const d=this.cachedCanvases.getCanvas(c,l,h),f=d.context;f.translate(-r,-o),f.transform(...s);let u=new Path2D;const[m,p,_,b]=e.bbox;if(u.rect(m,p,_-m,b-p),e.matrix){const A=new Path2D;A.addPath(u,new DOMMatrix(e.matrix)),u=A}f.clip(u),e.smask?this.smaskStack.push({canvas:d.canvas,context:f,offsetX:r,offsetY:o,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(r,o),t.save()),wo(t,f),this.ctx=f,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const i=Gt(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...i);const n=aa.slice();lt.axialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],i,n),this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(n)}}beginAnnotation(e,t,s,i,n){if(E(this,Os,Id).call(this),Dh(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){const r=t[2]-t[0],o=t[3]-t[1];if(n&&this.annotationCanvasMap){s=s.slice(),s[4]-=t[0],s[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=r,t[3]=o,lt.singularValueDecompose2dScale(Gt(this.ctx),as);const{viewportScale:l}=this,h=Math.ceil(r*this.outputScaleX*l),c=Math.ceil(o*this.outputScaleY*l);this.annotationCanvas=this.canvasFactory.create(h,c);const{canvas:d,context:f}=this.annotationCanvas;this.annotationCanvasMap.set(e,d),this.annotationCanvas.savedCtx=this.ctx,this.ctx=f,this.ctx.save(),this.ctx.setTransform(as[0],0,0,-as[1],0,o*as[1]),Dh(this.ctx)}else{Dh(this.ctx),this.endPath();const l=new Path2D;l.rect(t[0],t[1],r,o),this.ctx.clip(l)}}this.current=new Qu(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...s),this.transform(...i)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),E(this,Os,Pd).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=e.count;e=this.getObject(e.data,e),e.count=t;const s=this.ctx,i=this._createMaskCanvas(e),n=i.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(n,i.offsetX,i.offsetY),s.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,s=0,i=0,n,r){if(!this.contentVisible)return;e=this.getObject(e.data,e);const o=this.ctx;o.save();const l=Gt(o);o.transform(t,s,i,n,0,0);const h=this._createMaskCanvas(e);o.setTransform(1,0,0,1,h.offsetX-l[4],h.offsetY-l[5]);for(let c=0,d=r.length;c<d;c+=2){const f=lt.transform(l,[t,s,i,n,r[c],r[c+1]]);o.drawImage(h.canvas,f[4],f[5])}o.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,s=this.current.fillColor,i=this.current.patternFill;for(const n of e){const{data:r,width:o,height:l,transform:h}=n,c=this.cachedCanvases.getCanvas("maskCanvas",o,l),d=c.context;d.save();const f=this.getObject(r,n);ef(d,f),d.globalCompositeOperation="source-in",d.fillStyle=i?s.getPattern(d,this,zs(t),be.FILL):s,d.fillRect(0,0,o,l),d.restore(),t.save(),t.transform(...h),t.scale(1,-1),Mh(t,c.canvas,0,0,o,l,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=this.getObject(e);if(!t){pt("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,s,i){if(!this.contentVisible)return;const n=this.getObject(e);if(!n){pt("Dependent image isn't ready yet");return}const r=n.width,o=n.height,l=[];for(let h=0,c=i.length;h<c;h+=2)l.push({transform:[t,0,0,s,i[h],i[h+1]],x:0,y:0,w:r,h:o});this.paintInlineImageXObjectGroup(n,l)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:s,height:i}=e,n=this.cachedCanvases.getCanvas("inlineImage",s,i),r=n.context;return r.filter=this.current.transferMaps,r.drawImage(t,0,0),r.filter="none",n.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,s=e.height,i=this.ctx;this.save();const{filter:n}=i;n!=="none"&&n!==""&&(i.filter="none"),i.scale(1/t,-1/s);let r;if(e.bitmap)r=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)r=e;else{const h=this.cachedCanvases.getCanvas("inlineImage",t,s).context;tf(h,e),r=this.applyTransferMapsToCanvas(h)}const o=this._scaleImage(r,zs(i));i.imageSmoothingEnabled=sf(Gt(i),e.interpolate),Mh(i,o.img,0,0,o.paintWidth,o.paintHeight,0,-s,t,s),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const s=this.ctx;let i;if(e.bitmap)i=e.bitmap;else{const n=e.width,r=e.height,l=this.cachedCanvases.getCanvas("inlineImage",n,r).context;tf(l,e),i=this.applyTransferMapsToCanvas(l)}for(const n of t)s.save(),s.transform(...n.transform),s.scale(1,-1),Mh(s,i,n.x,n.y,n.w,n.h,0,-1,1,1),s.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e,t){const s=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(t);const i=this.ctx;this.pendingClip&&(s||(this.pendingClip===nf?i.clip(e,"evenodd"):i.clip(e)),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=Gt(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),s=Math.hypot(e[0],e[2]),i=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(s,i)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:s,c:i,d:n}=this.ctx.getTransform();let r,o;if(s===0&&i===0){const l=Math.abs(t),h=Math.abs(n);if(l===h)if(e===0)r=o=1/l;else{const c=l*e;r=o=c<1?1/c:1}else if(e===0)r=1/l,o=1/h;else{const c=l*e,d=h*e;r=c<1?1/c:1,o=d<1?1/d:1}}else{const l=Math.abs(t*n-s*i),h=Math.hypot(t,s),c=Math.hypot(i,n);if(e===0)r=c/l,o=h/l;else{const d=e*l;r=c>d?c/d:1,o=h>d?h/d:1}}this._cachedScaleForStroking[0]=r,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:s,current:{lineWidth:i}}=this,[n,r]=this.getScaleForStroking();if(n===r){s.lineWidth=(i||1)*n,s.stroke(e);return}const o=s.getLineDash();t&&s.save(),s.scale(n,r),ed.a=1/n,ed.d=1/r;const l=new Path2D;if(l.addPath(e,ed),o.length>0){const h=Math.max(n,r);s.setLineDash(o.map(c=>c/h)),s.lineDashOffset/=h}s.lineWidth=i||1,s.stroke(l),t&&s.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};Os=new WeakSet,Id=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Pd=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},Ld=function(e,t,s){const i=new Path2D;return i.addPath(e,new DOMMatrix(s).invertSelf().multiplySelf(t)),i};let ha=Fu;for(const g in pc)ha.prototype[g]!==void 0&&(ha.prototype[pc[g]]=ha.prototype[g]);var yl,_l;class Ui{static get workerPort(){return a(this,yl)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");y(this,yl,e)}static get workerSrc(){return a(this,_l)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");y(this,_l,e)}}yl=new WeakMap,_l=new WeakMap,S(Ui,yl,null),S(Ui,_l,"");var Ta,wl;class Am{constructor({parsedData:e,rawData:t}){S(this,Ta);S(this,wl);y(this,Ta,e),y(this,wl,t)}getRaw(){return a(this,wl)}get(e){return a(this,Ta).get(e)??null}[Symbol.iterator](){return a(this,Ta).entries()}}Ta=new WeakMap,wl=new WeakMap;const ia=Symbol("INTERNAL");var Al,vl,Sl,Ra;class vm{constructor(e,{name:t,intent:s,usage:i,rbGroups:n}){S(this,Al,!1);S(this,vl,!1);S(this,Sl,!1);S(this,Ra,!0);y(this,Al,!!(e&rs.DISPLAY)),y(this,vl,!!(e&rs.PRINT)),this.name=t,this.intent=s,this.usage=i,this.rbGroups=n}get visible(){if(a(this,Sl))return a(this,Ra);if(!a(this,Ra))return!1;const{print:e,view:t}=this.usage;return a(this,Al)?(t==null?void 0:t.viewState)!=="OFF":a(this,vl)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,s=!1){e!==ia&&Lt("Internal method `_setVisible` called."),y(this,Sl,s),y(this,Ra,t)}}Al=new WeakMap,vl=new WeakMap,Sl=new WeakMap,Ra=new WeakMap;var cn,It,Ia,Pa,El,Md;class Sm{constructor(e,t=rs.DISPLAY){S(this,El);S(this,cn,null);S(this,It,new Map);S(this,Ia,null);S(this,Pa,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,y(this,Pa,e.order);for(const s of e.groups)a(this,It).set(s.id,new vm(t,s));if(e.baseState==="OFF")for(const s of a(this,It).values())s._setVisible(ia,!1);for(const s of e.on)a(this,It).get(s)._setVisible(ia,!0);for(const s of e.off)a(this,It).get(s)._setVisible(ia,!1);y(this,Ia,this.getHash())}}isVisible(e){if(a(this,It).size===0)return!0;if(!e)return $c("Optional content group not defined."),!0;if(e.type==="OCG")return a(this,It).has(e.id)?a(this,It).get(e.id).visible:(pt(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return E(this,El,Md).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!a(this,It).has(t))return pt(`Optional content group not found: ${t}`),!0;if(a(this,It).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!a(this,It).has(t))return pt(`Optional content group not found: ${t}`),!0;if(!a(this,It).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!a(this,It).has(t))return pt(`Optional content group not found: ${t}`),!0;if(!a(this,It).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!a(this,It).has(t))return pt(`Optional content group not found: ${t}`),!0;if(a(this,It).get(t).visible)return!1}return!0}return pt(`Unknown optional content policy ${e.policy}.`),!0}return pt(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,s=!0){var n;const i=a(this,It).get(e);if(!i){pt(`Optional content group not found: ${e}`);return}if(s&&t&&i.rbGroups.length)for(const r of i.rbGroups)for(const o of r)o!==e&&((n=a(this,It).get(o))==null||n._setVisible(ia,!1,!0));i._setVisible(ia,!!t,!0),y(this,cn,null)}setOCGState({state:e,preserveRB:t}){let s;for(const i of e){switch(i){case"ON":case"OFF":case"Toggle":s=i;continue}const n=a(this,It).get(i);if(n)switch(s){case"ON":this.setVisibility(i,!0,t);break;case"OFF":this.setVisibility(i,!1,t);break;case"Toggle":this.setVisibility(i,!n.visible,t);break}}y(this,cn,null)}get hasInitialVisibility(){return a(this,Ia)===null||this.getHash()===a(this,Ia)}getOrder(){return a(this,It).size?a(this,Pa)?a(this,Pa).slice():[...a(this,It).keys()]:null}getGroup(e){return a(this,It).get(e)||null}getHash(){if(a(this,cn)!==null)return a(this,cn);const e=new Vf;for(const[t,s]of a(this,It))e.update(`${t}:${s.visible}`);return y(this,cn,e.hexdigest())}[Symbol.iterator](){return a(this,It).entries()}}cn=new WeakMap,It=new WeakMap,Ia=new WeakMap,Pa=new WeakMap,El=new WeakSet,Md=function(e){const t=e.length;if(t<2)return!0;const s=e[0];for(let i=1;i<t;i++){const n=e[i];let r;if(Array.isArray(n))r=E(this,El,Md).call(this,n);else if(a(this,It).has(n))r=a(this,It).get(n).visible;else return pt(`Optional content group not found: ${n}`),!0;switch(s){case"And":if(!r)return!1;break;case"Or":if(r)return!0;break;case"Not":return!r;default:return!0}}return s==="And"};class Em{constructor(e,{disableRange:t=!1,disableStream:s=!1}){Qt(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:n,progressiveDone:r,contentDispositionFilename:o}=e;if(this._queuedChunks=[],this._progressiveDone=r,this._contentDispositionFilename=o,(n==null?void 0:n.length)>0){const l=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!s,this._isRangeSupported=!t,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((l,h)=>{this._onReceiveData({begin:l,chunk:h})}),e.addProgressListener((l,h)=>{this._onProgress({loaded:l,total:h})}),e.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const s=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const i=this._rangeReaders.some(function(n){return n._begin!==e?!1:(n._enqueue(s),!0)});Qt(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var t,s,i,n;e.total===void 0?(s=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||s.call(t,{loaded:e.loaded}):(n=(i=this._fullRequestReader)==null?void 0:i.onProgress)==null||n.call(i,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){Qt(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new xm(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new Cm(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeReaders.slice(0))s.cancel(e);this._pdfDataRangeTransport.abort()}}class xm{constructor(e,t,s=!1,i=null){this._stream=e,this._done=s||!1,this._filename=Eu(i)?i:null,this._queuedChunks=t||[],this._loaded=0;for(const n of this._queuedChunks)this._loaded+=n.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class Cm{constructor(e,t,s){this._stream=e,this._begin=t,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function km(g){let e=!0,t=s("filename\\*","i").exec(g);if(t){t=t[1];let c=o(t);return c=unescape(c),c=l(c),c=h(c),n(c)}if(t=r(g),t){const c=h(t);return n(c)}if(t=s("filename","i").exec(g),t){t=t[1];let c=o(t);return c=h(c),n(c)}function s(c,d){return new RegExp("(?:^|;)\\s*"+c+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',d)}function i(c,d){if(c){if(!/^[\x00-\xFF]+$/.test(d))return d;try{const f=new TextDecoder(c,{fatal:!0}),u=_h(d);d=f.decode(u),e=!1}catch{}}return d}function n(c){return e&&/[\x80-\xff]/.test(c)&&(c=i("utf-8",c),e&&(c=i("iso-8859-1",c))),c}function r(c){const d=[];let f;const u=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(f=u.exec(c))!==null;){let[,p,_,b]=f;if(p=parseInt(p,10),p in d){if(p===0)break;continue}d[p]=[_,b]}const m=[];for(let p=0;p<d.length&&p in d;++p){let[_,b]=d[p];b=o(b),_&&(b=unescape(b),p===0&&(b=l(b))),m.push(b)}return m.join("")}function o(c){if(c.startsWith('"')){const d=c.slice(1).split('\\"');for(let f=0;f<d.length;++f){const u=d[f].indexOf('"');u!==-1&&(d[f]=d[f].slice(0,u),d.length=f+1),d[f]=d[f].replaceAll(/\\(.)/g,"$1")}c=d.join('"')}return c}function l(c){const d=c.indexOf("'");if(d===-1)return c;const f=c.slice(0,d),m=c.slice(d+1).replace(/^[^']*'/,"");return i(f,m)}function h(c){return!c.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(c)?c:c.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(d,f,u,m){if(u==="q"||u==="Q")return m=m.replaceAll("_"," "),m=m.replaceAll(/=([0-9a-fA-F]{2})/g,function(p,_){return String.fromCharCode(parseInt(_,16))}),i(f,m);try{m=atob(m)}catch{}return i(f,m)})}return""}function np(g,e){const t=new Headers;if(!g||!e||typeof e!="object")return t;for(const s in e){const i=e[s];i!==void 0&&t.append(s,i)}return t}function Vc(g){var e;return((e=URL.parse(g))==null?void 0:e.origin)??null}function rp({responseHeaders:g,isHttp:e,rangeChunkSize:t,disableRange:s}){const i={allowRangeRequests:!1,suggestedLength:void 0},n=parseInt(g.get("Content-Length"),10);return!Number.isInteger(n)||(i.suggestedLength=n,n<=2*t)||s||!e||g.get("Accept-Ranges")!=="bytes"||(g.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function ap(g){const e=g.get("Content-Disposition");if(e){let t=km(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(Eu(t))return t}return null}function Sh(g,e){return new gc(`Unexpected server response (${g}) while retrieving PDF "${e}".`,g,g===404||g===0&&e.startsWith("file:"))}function op(g){return g===200||g===206}function lp(g,e,t){return{method:"GET",headers:g,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function hp(g){return g instanceof Uint8Array?g.buffer:g instanceof ArrayBuffer?g:(pt(`getArrayBuffer - unexpected data format: ${g}`),new Uint8Array(g).buffer)}class Tm{constructor(e){K(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=np(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return Qt(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Rm(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new Im(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class Rm{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const s=new Headers(e.headers),i=t.url;fetch(i,lp(s,this._withCredentials,this._abortController)).then(n=>{if(e._responseOrigin=Vc(n.url),!op(n.status))throw Sh(n.status,i);this._reader=n.body.getReader(),this._headersCapability.resolve();const r=n.headers,{allowRangeRequests:o,suggestedLength:l}=rp({responseHeaders:r,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=l||this._contentLength,this._filename=ap(r),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Ln("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:hp(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}class Im{constructor(e,t,s){this._stream=e,this._reader=null,this._loaded=0;const i=e.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;const n=new Headers(e.headers);n.append("Range",`bytes=${t}-${s-1}`);const r=i.url;fetch(r,lp(n,this._withCredentials,this._abortController)).then(o=>{const l=Vc(o.url);if(l!==e._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${e._responseOrigin}".`);if(!op(o.status))throw Sh(o.status,r);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:hp(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}const sd=200,id=206;function Pm(g){const e=g.response;return typeof e!="string"?e:_h(e).buffer}class Lm{constructor({url:e,httpHeaders:t,withCredentials:s}){K(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=np(this.isHttp,t),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,s=this.currXhrId++,i=this.pendingRequests[s]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[n,r]of this.headers)t.setRequestHeader(n,r);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),i.expectedStatus=id):i.expectedStatus=sd,t.responseType="arraybuffer",Qt(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,s),t.onprogress=this.onProgress.bind(this,s),i.onHeadersReceived=e.onHeadersReceived,i.onDone=e.onDone,i.onError=e.onError,i.onProgress=e.onProgress,t.send(null),s}onProgress(e,t){var i;const s=this.pendingRequests[e];s&&((i=s.onProgress)==null||i.call(s,t))}onStateChange(e,t){const s=this.pendingRequests[e];if(!s)return;const i=s.xhr;if(i.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),i.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],i.status===0&&this.isHttp){s.onError(i.status);return}const n=i.status||sd;if(!(n===sd&&s.expectedStatus===id)&&n!==s.expectedStatus){s.onError(i.status);return}const o=Pm(i);if(n===id){const l=i.getResponseHeader("Content-Range"),h=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);h?s.onDone({begin:parseInt(h[1],10),chunk:o}):(pt('Missing or invalid "Content-Range" header.'),s.onError(0))}else o?s.onDone({begin:0,chunk:o}):s.onError(i.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class Mm{constructor(e){this._source=e,this._manager=new Lm(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return Qt(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Dm(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const s=new Fm(this._manager,e,t);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class Dm{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=Vc(t.responseURL);const s=t.getAllResponseHeaders(),i=new Headers(s?s.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(o=>{const[l,...h]=o.split(": ");return[l,h.join(": ")]}):[]),{allowRangeRequests:n,suggestedLength:r}=rp({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});n&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=ap(i),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=Sh(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Fm{constructor(e,t,s){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:s,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;const e=Vc((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??(this._storedError=Sh(e,this._url));for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const Nm=/^[a-z][a-z0-9\-+.]+:/i;function Om(g){if(Nm.test(g))return new URL(g);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(g))}class Bm{constructor(e){this.source=e,this.url=Om(e.url),Qt(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return Qt(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new zm(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new Hm(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class zm{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const s=process.getBuiltinModule("fs");s.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(s.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=Sh(0,this._url.href)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Ln("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class Hm{constructor(e,t,s){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const i=e.source;this._isStreamingSupported=!i.disableStream;const n=process.getBuiltinModule("fs");this._setReadableStream(n.createReadStream(this._url,{start:t,end:s-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const Ao=Symbol("INITIAL_DATA");var Ye,xl,Dd;class cp{constructor(){S(this,xl);S(this,Ye,Object.create(null))}get(e,t=null){if(t){const i=E(this,xl,Dd).call(this,e);return i.promise.then(()=>t(i.data)),null}const s=a(this,Ye)[e];if(!s||s.data===Ao)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return s.data}has(e){const t=a(this,Ye)[e];return!!t&&t.data!==Ao}delete(e){const t=a(this,Ye)[e];return!t||t.data===Ao?!1:(delete a(this,Ye)[e],!0)}resolve(e,t=null){const s=E(this,xl,Dd).call(this,e);s.data=t,s.resolve()}clear(){var e;for(const t in a(this,Ye)){const{data:s}=a(this,Ye)[t];(e=s==null?void 0:s.bitmap)==null||e.close()}y(this,Ye,Object.create(null))}*[Symbol.iterator](){for(const e in a(this,Ye)){const{data:t}=a(this,Ye)[e];t!==Ao&&(yield[e,t])}}}Ye=new WeakMap,xl=new WeakSet,Dd=function(e){var t;return(t=a(this,Ye))[e]||(t[e]={...Promise.withResolvers(),data:Ao})};const Um=1e5,rf=30;var hf,dn,je,Cl,kl,dr,Ei,Tl,Rl,ur,La,Ma,un,Da,Il,Fa,fr,Pl,Ll,Na,pr,Ml,fn,Oa,Wi,dp,up,Fd,ls,qh,Nd,fp,pp;const ee=class ee{constructor({textContentSource:e,container:t,viewport:s}){S(this,Wi);S(this,dn,Promise.withResolvers());S(this,je,null);S(this,Cl,!1);S(this,kl,!!((hf=globalThis.FontInspector)!=null&&hf.enabled));S(this,dr,null);S(this,Ei,null);S(this,Tl,0);S(this,Rl,0);S(this,ur,null);S(this,La,null);S(this,Ma,0);S(this,un,0);S(this,Da,Object.create(null));S(this,Il,[]);S(this,Fa,null);S(this,fr,[]);S(this,Pl,new WeakMap);S(this,Ll,null);var l;if(e instanceof ReadableStream)y(this,Fa,e);else if(typeof e=="object")y(this,Fa,new ReadableStream({start(h){h.enqueue(e),h.close()}}));else throw new Error('No "textContentSource" parameter specified.');y(this,je,y(this,La,t)),y(this,un,s.scale*ni.pixelRatio),y(this,Ma,s.rotation),y(this,Ei,{div:null,properties:null,ctx:null});const{pageWidth:i,pageHeight:n,pageX:r,pageY:o}=s.rawDims;y(this,Ll,[1,0,0,-1,-r,o+n]),y(this,Rl,i),y(this,Tl,n),E(l=ee,ls,fp).call(l),qr(t,s),a(this,dn).promise.finally(()=>{a(ee,Oa).delete(this),y(this,Ei,null),y(this,Da,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=we.platform;return wt(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{a(this,ur).read().then(({value:t,done:s})=>{if(s){a(this,dn).resolve();return}a(this,dr)??y(this,dr,t.lang),Object.assign(a(this,Da),t.styles),E(this,Wi,dp).call(this,t.items),e()},a(this,dn).reject)};return y(this,ur,a(this,Fa).getReader()),a(ee,Oa).add(this),e(),a(this,dn).promise}update({viewport:e,onBefore:t=null}){var n;const s=e.scale*ni.pixelRatio,i=e.rotation;if(i!==a(this,Ma)&&(t==null||t(),y(this,Ma,i),qr(a(this,La),{rotation:i})),s!==a(this,un)){t==null||t(),y(this,un,s);const r={div:null,properties:null,ctx:E(n=ee,ls,qh).call(n,a(this,dr))};for(const o of a(this,fr))r.properties=a(this,Pl).get(o),r.div=o,E(this,Wi,Fd).call(this,r)}}cancel(){var t;const e=new Ln("TextLayer task cancelled.");(t=a(this,ur))==null||t.cancel(e).catch(()=>{}),y(this,ur,null),a(this,dn).reject(e)}get textDivs(){return a(this,fr)}get textContentItemsStr(){return a(this,Il)}static cleanup(){if(!(a(this,Oa).size>0)){a(this,Na).clear();for(const{canvas:e}of a(this,pr).values())e.remove();a(this,pr).clear()}}};dn=new WeakMap,je=new WeakMap,Cl=new WeakMap,kl=new WeakMap,dr=new WeakMap,Ei=new WeakMap,Tl=new WeakMap,Rl=new WeakMap,ur=new WeakMap,La=new WeakMap,Ma=new WeakMap,un=new WeakMap,Da=new WeakMap,Il=new WeakMap,Fa=new WeakMap,fr=new WeakMap,Pl=new WeakMap,Ll=new WeakMap,Na=new WeakMap,pr=new WeakMap,Ml=new WeakMap,fn=new WeakMap,Oa=new WeakMap,Wi=new WeakSet,dp=function(e){var i,n;if(a(this,Cl))return;(n=a(this,Ei)).ctx??(n.ctx=E(i=ee,ls,qh).call(i,a(this,dr)));const t=a(this,fr),s=a(this,Il);for(const r of e){if(t.length>Um){pt("Ignoring additional textDivs for performance reasons."),y(this,Cl,!0);return}if(r.str===void 0){if(r.type==="beginMarkedContentProps"||r.type==="beginMarkedContent"){const o=a(this,je);y(this,je,document.createElement("span")),a(this,je).classList.add("markedContent"),r.id!==null&&a(this,je).setAttribute("id",`${r.id}`),o.append(a(this,je))}else r.type==="endMarkedContent"&&y(this,je,a(this,je).parentNode);continue}s.push(r.str),E(this,Wi,up).call(this,r)}},up=function(e){var p;const t=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};a(this,fr).push(t);const i=lt.transform(a(this,Ll),e.transform);let n=Math.atan2(i[1],i[0]);const r=a(this,Da)[e.fontName];r.vertical&&(n+=Math.PI/2);let o=a(this,kl)&&r.fontSubstitution||r.fontFamily;o=ee.fontFamilyMap.get(o)||o;const l=Math.hypot(i[2],i[3]),h=l*E(p=ee,ls,pp).call(p,o,r,a(this,dr));let c,d;n===0?(c=i[4],d=i[5]-h):(c=i[4]+h*Math.sin(n),d=i[5]-h*Math.cos(n));const f="calc(var(--total-scale-factor) *",u=t.style;a(this,je)===a(this,La)?(u.left=`${(100*c/a(this,Rl)).toFixed(2)}%`,u.top=`${(100*d/a(this,Tl)).toFixed(2)}%`):(u.left=`${f}${c.toFixed(2)}px)`,u.top=`${f}${d.toFixed(2)}px)`),u.fontSize=`${f}${(a(ee,fn)*l).toFixed(2)}px)`,u.fontFamily=o,s.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,a(this,kl)&&(t.dataset.fontName=r.fontSubstitutionLoadedName||e.fontName),n!==0&&(s.angle=n*(180/Math.PI));let m=!1;if(e.str.length>1)m=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const _=Math.abs(e.transform[0]),b=Math.abs(e.transform[3]);_!==b&&Math.max(_,b)/Math.min(_,b)>1.5&&(m=!0)}if(m&&(s.canvasWidth=r.vertical?e.height:e.width),a(this,Pl).set(t,s),a(this,Ei).div=t,a(this,Ei).properties=s,E(this,Wi,Fd).call(this,a(this,Ei)),s.hasText&&a(this,je).append(t),s.hasEOL){const _=document.createElement("br");_.setAttribute("role","presentation"),a(this,je).append(_)}},Fd=function(e){var o;const{div:t,properties:s,ctx:i}=e,{style:n}=t;let r="";if(a(ee,fn)>1&&(r=`scale(${1/a(ee,fn)})`),s.canvasWidth!==0&&s.hasText){const{fontFamily:l}=n,{canvasWidth:h,fontSize:c}=s;E(o=ee,ls,Nd).call(o,i,c*a(this,un),l);const{width:d}=i.measureText(t.textContent);d>0&&(r=`scaleX(${h*a(this,un)/d}) ${r}`)}s.angle!==0&&(r=`rotate(${s.angle}deg) ${r}`),r.length>0&&(n.transform=r)},ls=new WeakSet,qh=function(e=null){let t=a(this,pr).get(e||(e=""));if(!t){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=e,document.body.append(s),t=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),a(this,pr).set(e,t),a(this,Ml).set(t,{size:0,family:""})}return t},Nd=function(e,t,s){const i=a(this,Ml).get(e);t===i.size&&s===i.family||(e.font=`${t}px ${s}`,i.size=t,i.family=s)},fp=function(){if(a(this,fn)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),y(this,fn,e.getBoundingClientRect().height),e.remove()},pp=function(e,t,s){const i=a(this,Na).get(e);if(i)return i;const n=E(this,ls,qh).call(this,s);n.canvas.width=n.canvas.height=rf,E(this,ls,Nd).call(this,n,rf,e);const r=n.measureText(""),o=r.fontBoundingBoxAscent,l=Math.abs(r.fontBoundingBoxDescent);n.canvas.width=n.canvas.height=0;let h=.8;return o?h=o/(o+l):(we.platform.isFirefox&&pt("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?h=t.ascent:t.descent&&(h=1+t.descent)),a(this,Na).set(e,h),h},S(ee,ls),S(ee,Na,new Map),S(ee,pr,new Map),S(ee,Ml,new WeakMap),S(ee,fn,null),S(ee,Oa,new Set);let Go=ee;class $o{static textContent(e){const t=[],s={items:t,styles:Object.create(null)};function i(n){var l;if(!n)return;let r=null;const o=n.name;if(o==="#text")r=n.value;else if($o.shouldBuildText(o))(l=n==null?void 0:n.attributes)!=null&&l.textContent?r=n.attributes.textContent:n.value&&(r=n.value);else return;if(r!==null&&t.push({str:r}),!!n.children)for(const h of n.children)i(h)}return i(e),s}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}const jm=100;function Gm(g={}){typeof g=="string"||g instanceof URL?g={url:g}:(g instanceof ArrayBuffer||ArrayBuffer.isView(g))&&(g={data:g});const e=new Od,{docId:t}=e,s=g.url?Zg(g.url):null,i=g.data?Jg(g.data):null,n=g.httpHeaders||null,r=g.withCredentials===!0,o=g.password??null,l=g.range instanceof gp?g.range:null,h=Number.isInteger(g.rangeChunkSize)&&g.rangeChunkSize>0?g.rangeChunkSize:2**16;let c=g.worker instanceof Wo?g.worker:null;const d=g.verbosity,f=typeof g.docBaseUrl=="string"&&!Wc(g.docBaseUrl)?g.docBaseUrl:null,u=Ph(g.cMapUrl),m=g.cMapPacked!==!1,p=g.CMapReaderFactory||(Me?am:Vu),_=Ph(g.iccUrl),b=Ph(g.standardFontDataUrl),A=g.StandardFontDataFactory||(Me?om:Xu),x=Ph(g.wasmUrl),k=g.WasmFactory||(Me?lm:qu),C=g.stopAtErrors!==!0,P=Number.isInteger(g.maxImageSize)&&g.maxImageSize>-1?g.maxImageSize:-1,R=g.isEvalSupported!==!1,D=typeof g.isOffscreenCanvasSupported=="boolean"?g.isOffscreenCanvasSupported:!Me,M=typeof g.isImageDecoderSupported=="boolean"?g.isImageDecoderSupported:!Me&&(we.platform.isFirefox||!globalThis.chrome),U=Number.isInteger(g.canvasMaxAreaInBytes)?g.canvasMaxAreaInBytes:-1,$=typeof g.disableFontFace=="boolean"?g.disableFontFace:Me,L=g.fontExtraProperties===!0,z=g.enableXfa===!0,v=g.ownerDocument||globalThis.document,G=g.disableRange===!0,V=g.disableStream===!0,O=g.disableAutoFetch===!0,dt=g.pdfBug===!0,Y=g.CanvasFactory||(Me?rm:sm),ht=g.FilterFactory||(Me?nm:im),H=g.enableHWA===!0,N=g.useWasm!==!1,st=l?l.length:g.length??NaN,et=typeof g.useSystemFonts=="boolean"?g.useSystemFonts:!Me&&!$,Z=typeof g.useWorkerFetch=="boolean"?g.useWorkerFetch:!!(p===Vu&&A===Xu&&k===qu&&u&&b&&x&&Eo(u,document.baseURI)&&Eo(b,document.baseURI)&&Eo(x,document.baseURI)),kt=null;Rg(d);const yt={canvasFactory:new Y({ownerDocument:v,enableHWA:H}),filterFactory:new ht({docId:t,ownerDocument:v}),cMapReaderFactory:Z?null:new p({baseUrl:u,isCompressed:m}),standardFontDataFactory:Z?null:new A({baseUrl:b}),wasmFactory:Z?null:new k({baseUrl:x})};c||(c=Wo.create({verbosity:d,port:Ui.workerPort}),e._worker=c);const mt={docId:t,apiVersion:"5.3.31",data:i,password:o,disableAutoFetch:O,rangeChunkSize:h,length:st,docBaseUrl:f,enableXfa:z,evaluatorOptions:{maxImageSize:P,disableFontFace:$,ignoreErrors:C,isEvalSupported:R,isOffscreenCanvasSupported:D,isImageDecoderSupported:M,canvasMaxAreaInBytes:U,fontExtraProperties:L,useSystemFonts:et,useWasm:N,useWorkerFetch:Z,cMapUrl:u,iccUrl:_,standardFontDataUrl:b,wasmUrl:x}},xt={ownerDocument:v,pdfBug:dt,styleElement:kt,loadingParams:{disableAutoFetch:O,enableXfa:z}};return c.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const Yt=c.messageHandler.sendWithPromise("GetDocRequest",mt,i?[i.buffer]:null);let Ot;if(l)Ot=new Em(l,{disableRange:G,disableStream:V});else if(!i){if(!s)throw new Error("getDocument - no `url` parameter provided.");const Oe=Eo(s)?Tm:Me?Bm:Mm;Ot=new Oe({url:s,length:st,httpHeaders:n,withCredentials:r,rangeChunkSize:h,disableRange:G,disableStream:V})}return Yt.then(Oe=>{if(e.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const Be=new Ro(t,Oe,c.port),w=new Vm(Be,e,Ot,xt,yt);e._transport=w,Be.send("Ready",null)})}).catch(e._capability.reject),e}var Lc;const Mc=class Mc{constructor(){K(this,"_capability",Promise.withResolvers());K(this,"_transport",null);K(this,"_worker",null);K(this,"docId",`d${ke(Mc,Lc)._++}`);K(this,"destroyed",!1);K(this,"onPassword",null);K(this,"onProgress",null)}get promise(){return this._capability.promise}async destroy(){var e,t,s,i;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(n){throw(s=this._worker)!=null&&s.port&&delete this._worker._pendingDestroy,n}this._transport=null,(i=this._worker)==null||i.destroy(),this._worker=null}async getData(){return this._transport.getData()}};Lc=new WeakMap,S(Mc,Lc,0);let Od=Mc;var gr,Dl,Fl,Nl,Ol;class gp{constructor(e,t,s=!1,i=null){S(this,gr,Promise.withResolvers());S(this,Dl,[]);S(this,Fl,[]);S(this,Nl,[]);S(this,Ol,[]);this.length=e,this.initialData=t,this.progressiveDone=s,this.contentDispositionFilename=i}addRangeListener(e){a(this,Ol).push(e)}addProgressListener(e){a(this,Nl).push(e)}addProgressiveReadListener(e){a(this,Fl).push(e)}addProgressiveDoneListener(e){a(this,Dl).push(e)}onDataRange(e,t){for(const s of a(this,Ol))s(e,t)}onDataProgress(e,t){a(this,gr).promise.then(()=>{for(const s of a(this,Nl))s(e,t)})}onDataProgressiveRead(e){a(this,gr).promise.then(()=>{for(const t of a(this,Fl))t(e)})}onDataProgressiveDone(){a(this,gr).promise.then(()=>{for(const e of a(this,Dl))e()})}transportReady(){a(this,gr).resolve()}requestDataRange(e,t){Lt("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}gr=new WeakMap,Dl=new WeakMap,Fl=new WeakMap,Nl=new WeakMap,Ol=new WeakMap;class $m{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return wt(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var xi,mr,Do;class Wm{constructor(e,t,s,i=!1){S(this,mr);S(this,xi,!1);this._pageIndex=e,this._pageInfo=t,this._transport=s,this._stats=i?new Gu:null,this._pdfBug=i,this.commonObjs=s.commonObjs,this.objs=new cp,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:s=0,offsetY:i=0,dontFlip:n=!1}={}){return new Ah({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:i,dontFlip:n})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return wt(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,viewport:t,intent:s="display",annotationMode:i=Xi.ENABLE,transform:n=null,background:r=null,optionalContentConfigPromise:o=null,annotationCanvasMap:l=null,pageColors:h=null,printAnnotationStorage:c=null,isEditing:d=!1}){var k,C;(k=this._stats)==null||k.time("Overall");const f=this._transport.getRenderingIntent(s,i,c,d),{renderingIntent:u,cacheKey:m}=f;y(this,xi,!1),o||(o=this._transport.getOptionalContentConfig(u));let p=this._intentStates.get(m);p||(p=Object.create(null),this._intentStates.set(m,p)),p.streamReaderCancelTimeout&&(clearTimeout(p.streamReaderCancelTimeout),p.streamReaderCancelTimeout=null);const _=!!(u&rs.PRINT);p.displayReadyCapability||(p.displayReadyCapability=Promise.withResolvers(),p.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(C=this._stats)==null||C.time("Page Request"),this._pumpOperatorList(f));const b=P=>{var R;p.renderTasks.delete(A),_&&y(this,xi,!0),E(this,mr,Do).call(this),P?(A.capability.reject(P),this._abortOperatorList({intentState:p,reason:P instanceof Error?P:new Error(P)})):A.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(R=globalThis.Stats)!=null&&R.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},A=new Bd({callback:b,params:{canvasContext:e,viewport:t,transform:n,background:r},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:p.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!_,pdfBug:this._pdfBug,pageColors:h});(p.renderTasks||(p.renderTasks=new Set)).add(A);const x=A.task;return Promise.all([p.displayReadyCapability.promise,o]).then(([P,R])=>{var D;if(this.destroyed){b();return}if((D=this._stats)==null||D.time("Rendering"),!(R.renderingIntent&u))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");A.initializeGraphics({transparency:P,optionalContentConfig:R}),A.operatorListChanged()}).catch(b),x}getOperatorList({intent:e="display",annotationMode:t=Xi.ENABLE,printAnnotationStorage:s=null,isEditing:i=!1}={}){var h;function n(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(l))}const r=this._transport.getRenderingIntent(e,t,s,i,!0);let o=this._intentStates.get(r.cacheKey);o||(o=Object.create(null),this._intentStates.set(r.cacheKey,o));let l;return o.opListReadCapability||(l=Object.create(null),l.operatorListChanged=n,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||(o.renderTasks=new Set)).add(l),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(h=this._stats)==null||h.time("Page Request"),this._pumpOperatorList(r)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>$o.textContent(s));const t=this.streamTextContent(e);return new Promise(function(s,i){function n(){r.read().then(function({value:l,done:h}){if(h){s(o);return}o.lang??(o.lang=l.lang),Object.assign(o.styles,l.styles),o.items.push(...l.items),n()},i)}const r=t.getReader(),o={items:[],styles:Object.create(null),lang:null};n()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const s of t.renderTasks)e.push(s.completed),s.cancel();return this.objs.clear(),y(this,xi,!1),Promise.all(e)}cleanup(e=!1){y(this,xi,!0);const t=E(this,mr,Do).call(this);return e&&t&&this._stats&&(this._stats=new Gu),t}_startRenderPage(e,t){var i,n;const s=this._intentStates.get(t);s&&((i=this._stats)==null||i.timeEnd("Page Request"),(n=s.displayReadyCapability)==null||n.resolve(e))}_renderPageChunk(e,t){for(let s=0,i=e.length;s<i;s++)t.operatorList.fnArray.push(e.fnArray[s]),t.operatorList.argsArray.push(e.argsArray[s]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const s of t.renderTasks)s.operatorListChanged();e.lastChunk&&E(this,mr,Do).call(this)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:s,modifiedIds:i}){const{map:n,transfer:r}=s,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:n,modifiedIds:i},r).getReader(),h=this._intentStates.get(t);h.streamReader=l;const c=()=>{l.read().then(({value:d,done:f})=>{if(f){h.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(d,h),c())},d=>{if(h.streamReader=null,!this._transport.destroyed){if(h.operatorList){h.operatorList.lastChunk=!0;for(const f of h.renderTasks)f.operatorListChanged();E(this,mr,Do).call(this)}if(h.displayReadyCapability)h.displayReadyCapability.reject(d);else if(h.opListReadCapability)h.opListReadCapability.reject(d);else throw d}})};c()}_abortOperatorList({intentState:e,reason:t,force:s=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!s){if(e.renderTasks.size>0)return;if(t instanceof Su){let i=jm;t.extraDelay>0&&t.extraDelay<1e3&&(i+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},i);return}}if(e.streamReader.cancel(new Ln(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[i,n]of this._intentStates)if(n===e){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}xi=new WeakMap,mr=new WeakSet,Do=function(){if(!a(this,xi)||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),y(this,xi,!1),!0};var pn,xs,Ci,br,Dc,yr,_r,Fe,Yh,mp,bp,Fo,Ba,Kh;const zt=class zt{constructor({name:e=null,port:t=null,verbosity:s=Ig()}={}){S(this,Fe);S(this,pn,Promise.withResolvers());S(this,xs,null);S(this,Ci,null);S(this,br,null);if(this.name=e,this.destroyed=!1,this.verbosity=s,t){if(a(zt,_r).has(t))throw new Error("Cannot use more than one PDFWorker per port.");a(zt,_r).set(t,this),E(this,Fe,mp).call(this,t)}else E(this,Fe,bp).call(this)}get promise(){return a(this,pn).promise}get port(){return a(this,Ci)}get messageHandler(){return a(this,xs)}destroy(){var e,t;this.destroyed=!0,(e=a(this,br))==null||e.terminate(),y(this,br,null),a(zt,_r).delete(a(this,Ci)),y(this,Ci,null),(t=a(this,xs))==null||t.destroy(),y(this,xs,null)}static create(e){const t=a(this,_r).get(e==null?void 0:e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new zt(e)}static get workerSrc(){if(Ui.workerSrc)return Ui.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return wt(this,"_setupFakeWorkerGlobal",(async()=>a(this,Ba,Kh)?a(this,Ba,Kh):(await import(this.workerSrc)).WorkerMessageHandler)())}};pn=new WeakMap,xs=new WeakMap,Ci=new WeakMap,br=new WeakMap,Dc=new WeakMap,yr=new WeakMap,_r=new WeakMap,Fe=new WeakSet,Yh=function(){a(this,pn).resolve(),a(this,xs).send("configure",{verbosity:this.verbosity})},mp=function(e){y(this,Ci,e),y(this,xs,new Ro("main","worker",e)),a(this,xs).on("ready",()=>{}),E(this,Fe,Yh).call(this)},bp=function(){if(a(zt,yr)||a(zt,Ba,Kh)){E(this,Fe,Fo).call(this);return}let{workerSrc:e}=zt;try{zt._isSameOrigin(window.location,e)||(e=zt._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),s=new Ro("main","worker",t),i=()=>{n.abort(),s.destroy(),t.terminate(),this.destroyed?a(this,pn).reject(new Error("Worker was destroyed")):E(this,Fe,Fo).call(this)},n=new AbortController;t.addEventListener("error",()=>{a(this,br)||i()},{signal:n.signal}),s.on("test",o=>{if(n.abort(),this.destroyed||!o){i();return}y(this,xs,s),y(this,Ci,t),y(this,br,t),E(this,Fe,Yh).call(this)}),s.on("ready",o=>{if(n.abort(),this.destroyed){i();return}try{r()}catch{E(this,Fe,Fo).call(this)}});const r=()=>{const o=new Uint8Array;s.send("test",o,[o.buffer])};r();return}catch{$c("The worker has been disabled.")}E(this,Fe,Fo).call(this)},Fo=function(){a(zt,yr)||(pt("Setting up fake worker."),y(zt,yr,!0)),zt._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){a(this,pn).reject(new Error("Worker was destroyed"));return}const t=new em;y(this,Ci,t);const s=`fake${ke(zt,Dc)._++}`,i=new Ro(s+"_worker",s,t);e.setup(i,t),y(this,xs,new Ro(s,s+"_worker",t)),E(this,Fe,Yh).call(this)}).catch(e=>{a(this,pn).reject(new Error(`Setting up fake worker failed: "${e.message}".`))})},Ba=new WeakSet,Kh=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch{return null}},S(zt,Ba),S(zt,Dc,0),S(zt,yr,!1),S(zt,_r,new WeakMap),Me&&(y(zt,yr,!0),Ui.workerSrc||(Ui.workerSrc="./pdf.worker.mjs")),zt._isSameOrigin=(e,t)=>{const s=URL.parse(e);if(!(s!=null&&s.origin)||s.origin==="null")return!1;const i=new URL(t,s);return s.origin===i.origin},zt._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},zt.fromPort=e=>{if(jg("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return zt.create(e)};let Wo=zt;var ki,Zs,za,Ha,Ti,wr,No;class Vm{constructor(e,t,s,i,n){S(this,wr);S(this,ki,new Map);S(this,Zs,new Map);S(this,za,new Map);S(this,Ha,new Map);S(this,Ti,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new cp,this.fontLoader=new Yg({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=n.canvasFactory,this.filterFactory=n.filterFactory,this.cMapReaderFactory=n.cMapReaderFactory,this.standardFontDataFactory=n.standardFontDataFactory,this.wasmFactory=n.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return wt(this,"annotationStorage",new ku)}getRenderingIntent(e,t=Xi.ENABLE,s=null,i=!1,n=!1){let r=rs.DISPLAY,o=Ed;switch(e){case"any":r=rs.ANY;break;case"display":break;case"print":r=rs.PRINT;break;default:pt(`getRenderingIntent - invalid intent: ${e}`)}const l=r&rs.PRINT&&s instanceof qf?s:this.annotationStorage;switch(t){case Xi.DISABLE:r+=rs.ANNOTATIONS_DISABLE;break;case Xi.ENABLE:break;case Xi.ENABLE_FORMS:r+=rs.ANNOTATIONS_FORMS;break;case Xi.ENABLE_STORAGE:r+=rs.ANNOTATIONS_STORAGE,o=l.serializable;break;default:pt(`getRenderingIntent - invalid annotationMode: ${t}`)}i&&(r+=rs.IS_EDITING),n&&(r+=rs.OPLIST);const{ids:h,hash:c}=l.modifiedIds,d=[r,o.hash,c];return{renderingIntent:r,cacheKey:d.join("_"),annotationStorageSerializable:o,modifiedIds:h}}destroy(){var s;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(s=a(this,Ti))==null||s.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const i of a(this,Zs).values())e.push(i._destroy());a(this,Zs).clear(),a(this,za).clear(),a(this,Ha).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var i,n;this.commonObjs.clear(),this.fontLoader.clear(),a(this,ki).clear(),this.filterFactory.destroy(),Go.cleanup(),(i=this._networkStream)==null||i.cancelAllRequests(new Ln("Worker was terminated.")),(n=this.messageHandler)==null||n.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(s,i)=>{Qt(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=n=>{this._lastProgress={loaded:n.loaded,total:n.total}},i.onPull=()=>{this._fullReader.read().then(function({value:n,done:r}){if(r){i.close();return}Qt(n instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(n),1,[n])}).catch(n=>{i.error(n)})},i.onCancel=n=>{this._fullReader.cancel(n),i.ready.catch(r=>{if(!this.destroyed)throw r})}}),e.on("ReaderHeadersReady",async s=>{var o;await this._fullReader.headersReady;const{isStreamingSupported:i,isRangeSupported:n,contentLength:r}=this._fullReader;return(!i||!n)&&(this._lastProgress&&((o=t.onProgress)==null||o.call(t,this._lastProgress)),this._fullReader.onProgress=l=>{var h;(h=t.onProgress)==null||h.call(t,{loaded:l.loaded,total:l.total})}),{isStreamingSupported:i,isRangeSupported:n,contentLength:r}}),e.on("GetRangeReader",(s,i)=>{Qt(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const n=this._networkStream.getRangeReader(s.begin,s.end);if(!n){i.close();return}i.onPull=()=>{n.read().then(function({value:r,done:o}){if(o){i.close();return}Qt(r instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{i.error(r)})},i.onCancel=r=>{n.cancel(r),i.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,t._capability.resolve(new $m(s,this))}),e.on("DocException",s=>{t._capability.reject(ze(s))}),e.on("PasswordRequest",s=>{y(this,Ti,Promise.withResolvers());try{if(!t.onPassword)throw ze(s);const i=n=>{n instanceof Error?a(this,Ti).reject(n):a(this,Ti).resolve({password:n})};t.onPassword(i,s.code)}catch(i){a(this,Ti).reject(i)}return a(this,Ti).promise}),e.on("DataLoaded",s=>{var i;(i=t.onProgress)==null||i.call(t,{loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),e.on("StartRenderPage",s=>{if(this.destroyed)return;a(this,Zs).get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),e.on("commonobj",([s,i,n])=>{var r;if(this.destroyed||this.commonObjs.has(s))return null;switch(i){case"Font":if("error"in n){const c=n.error;pt(`Error during font loading: ${c}`),this.commonObjs.resolve(s,c);break}const o=this._params.pdfBug&&((r=globalThis.FontInspector)!=null&&r.enabled)?(c,d)=>globalThis.FontInspector.fontAdded(c,d):null,l=new Kg(n,o);this.fontLoader.bind(l).catch(()=>e.sendWithPromise("FontFallback",{id:s})).finally(()=>{!l.fontExtraProperties&&l.data&&(l.data=null),this.commonObjs.resolve(s,l)});break;case"CopyLocalImage":const{imageRef:h}=n;Qt(h,"The imageRef must be defined.");for(const c of a(this,Zs).values())for(const[,d]of c.objs)if((d==null?void 0:d.ref)===h)return d.dataLen?(this.commonObjs.resolve(s,structuredClone(d)),d.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(s,n);break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),e.on("obj",([s,i,n,r])=>{var l;if(this.destroyed)return;const o=a(this,Zs).get(i);if(!o.objs.has(s)){if(o._intentStates.size===0){(l=r==null?void 0:r.bitmap)==null||l.close();return}switch(n){case"Image":case"Pattern":o.objs.resolve(s,r);break;default:throw new Error(`Got unknown object type ${n}`)}}}),e.on("DocProgress",s=>{var i;this.destroyed||(i=t.onProgress)==null||i.call(t,{loaded:s.loaded,total:s.total})}),e.on("FetchBinaryData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");const i=this[s.type];if(!i)throw new Error(`${s.type} not initialized, see the \`useWorkerFetch\` parameter.`);return i.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var s;this.annotationStorage.size<=0&&pt("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((s=this._fullReader)==null?void 0:s.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,s=a(this,za).get(t);if(s)return s;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(n=>{if(this.destroyed)throw new Error("Transport destroyed");n.refStr&&a(this,Ha).set(n.refStr,e);const r=new Wm(t,n,this,this._params.pdfBug);return a(this,Zs).set(t,r),r});return a(this,za).set(t,i),i}getPageIndex(e){return xd(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return E(this,wr,No).call(this,"GetFieldObjects")}hasJSActions(){return E(this,wr,No).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return E(this,wr,No).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return E(this,wr,No).call(this,"GetOptionalContentConfig").then(t=>new Sm(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=a(this,ki).get(e);if(t)return t;const s=this.messageHandler.sendWithPromise(e,null).then(i=>{var n,r;return{info:i[0],metadata:i[1]?new Am(i[1]):null,contentDispositionFilename:((n=this._fullReader)==null?void 0:n.filename)??null,contentLength:((r=this._fullReader)==null?void 0:r.contentLength)??null}});return a(this,ki).set(e,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of a(this,Zs).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),a(this,ki).clear(),this.filterFactory.destroy(!0),Go.cleanup()}}cachedPageNumber(e){if(!xd(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return a(this,Ha).get(t)??null}}ki=new WeakMap,Zs=new WeakMap,za=new WeakMap,Ha=new WeakMap,Ti=new WeakMap,wr=new WeakSet,No=function(e,t=null){const s=a(this,ki).get(e);if(s)return s;const i=this.messageHandler.sendWithPromise(e,t);return a(this,ki).set(e,i),i};var gn;class Xm{constructor(e){S(this,gn,null);K(this,"onContinue",null);K(this,"onError",null);y(this,gn,e)}get promise(){return a(this,gn).capability.promise}cancel(e=0){a(this,gn).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=a(this,gn).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=a(this,gn);return e.form||e.canvas&&(t==null?void 0:t.size)>0}}gn=new WeakMap;var mn,Ar;const Un=class Un{constructor({callback:e,params:t,objs:s,commonObjs:i,annotationCanvasMap:n,operatorList:r,pageIndex:o,canvasFactory:l,filterFactory:h,useRequestAnimationFrame:c=!1,pdfBug:d=!1,pageColors:f=null}){S(this,mn,null);this.callback=e,this.params=t,this.objs=s,this.commonObjs=i,this.annotationCanvasMap=n,this.operatorListIdx=null,this.operatorList=r,this._pageIndex=o,this.canvasFactory=l,this.filterFactory=h,this._pdfBug=d,this.pageColors=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=c===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Xm(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var o,l;if(this.cancelled)return;if(this._canvas){if(a(Un,Ar).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");a(Un,Ar).add(this._canvas)}this._pdfBug&&((o=globalThis.StepperManager)!=null&&o.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:s,viewport:i,transform:n,background:r}=this.params;this.gfx=new ha(s,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:n,viewport:i,transparency:e,background:r}),this.operatorListIdx=0,this.graphicsReady=!0,(l=this.graphicsReadyCallback)==null||l.call(this)}cancel(e=null,t=0){var s,i,n;this.running=!1,this.cancelled=!0,(s=this.gfx)==null||s.endDrawing(),a(this,mn)&&(window.cancelAnimationFrame(a(this,mn)),y(this,mn,null)),a(Un,Ar).delete(this._canvas),e||(e=new Su(`Rendering cancelled, page ${this._pageIndex+1}`,t)),this.callback(e),(n=(i=this.task).onError)==null||n.call(i,e)}operatorListChanged(){var e;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.stepper)==null||e.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?y(this,mn,window.requestAnimationFrame(()=>{y(this,mn,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),a(Un,Ar).delete(this._canvas),this.callback())))}};mn=new WeakMap,Ar=new WeakMap,S(Un,Ar,new WeakSet);let Bd=Un;const qm="5.3.31",Ym="47ad820d9";function af(g){return Math.floor(Math.max(0,Math.min(1,g))*255).toString(16).padStart(2,"0")}function vo(g){return Math.max(0,Math.min(255,255*g))}class of{static CMYK_G([e,t,s,i]){return["G",1-Math.min(1,.3*e+.59*s+.11*t+i)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=vo(e),[e,e,e]}static G_HTML([e]){const t=af(e);return`#${t}${t}${t}`}static RGB_G([e,t,s]){return["G",.3*e+.59*t+.11*s]}static RGB_rgb(e){return e.map(vo)}static RGB_HTML(e){return`#${e.map(af).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,s,i]){return["RGB",1-Math.min(1,e+i),1-Math.min(1,s+i),1-Math.min(1,t+i)]}static CMYK_rgb([e,t,s,i]){return[vo(1-Math.min(1,e+i)),vo(1-Math.min(1,s+i)),vo(1-Math.min(1,t+i))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,s]){const i=1-e,n=1-t,r=1-s,o=Math.min(i,n,r);return["CMYK",i,n,r,o]}}class Km{create(e,t,s=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),s||(i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${e} ${t}`),i}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){Lt("Abstract method `_createSVG` called.")}}class yc extends Km{_createSVG(e){return document.createElementNS(oi,e)}}class yp{static setupStorage(e,t,s,i,n){const r=i.getValue(t,{value:null});switch(s.name){case"textarea":if(r.value!==null&&(e.textContent=r.value),n==="print")break;e.addEventListener("input",o=>{i.setValue(t,{value:o.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(r.value===s.attributes.xfaOn?e.setAttribute("checked",!0):r.value===s.attributes.xfaOff&&e.removeAttribute("checked"),n==="print")break;e.addEventListener("change",o=>{i.setValue(t,{value:o.target.checked?o.target.getAttribute("xfaOn"):o.target.getAttribute("xfaOff")})})}else{if(r.value!==null&&e.setAttribute("value",r.value),n==="print")break;e.addEventListener("input",o=>{i.setValue(t,{value:o.target.value})})}break;case"select":if(r.value!==null){e.setAttribute("value",r.value);for(const o of s.children)o.attributes.value===r.value?o.attributes.selected=!0:o.attributes.hasOwnProperty("selected")&&delete o.attributes.selected}e.addEventListener("input",o=>{const l=o.target.options,h=l.selectedIndex===-1?"":l[l.selectedIndex].value;i.setValue(t,{value:h})});break}}static setAttributes({html:e,element:t,storage:s=null,intent:i,linkService:n}){const{attributes:r}=t,o=e instanceof HTMLAnchorElement;r.type==="radio"&&(r.name=`${r.name}-${i}`);for(const[l,h]of Object.entries(r))if(h!=null)switch(l){case"class":h.length&&e.setAttribute(l,h.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",h);break;case"style":Object.assign(e.style,h);break;case"textContent":e.textContent=h;break;default:(!o||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,h)}o&&n.addLinkAttributes(e,r.href,r.newWindow),s&&r.dataId&&this.setupStorage(e,r.dataId,t,s)}static render(e){var d,f;const t=e.annotationStorage,s=e.linkService,i=e.xfaHtml,n=e.intent||"display",r=document.createElement(i.name);i.attributes&&this.setAttributes({html:r,element:i,intent:n,linkService:s});const o=n!=="richText",l=e.div;if(l.append(r),e.viewport){const u=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=u}o&&l.setAttribute("class","xfaLayer xfaFont");const h=[];if(i.children.length===0){if(i.value){const u=document.createTextNode(i.value);r.append(u),o&&$o.shouldBuildText(i.name)&&h.push(u)}return{textDivs:h}}const c=[[i,-1,r]];for(;c.length>0;){const[u,m,p]=c.at(-1);if(m+1===u.children.length){c.pop();continue}const _=u.children[++c.at(-1)[1]];if(_===null)continue;const{name:b}=_;if(b==="#text"){const x=document.createTextNode(_.value);h.push(x),p.append(x);continue}const A=(d=_==null?void 0:_.attributes)!=null&&d.xmlns?document.createElementNS(_.attributes.xmlns,b):document.createElement(b);if(p.append(A),_.attributes&&this.setAttributes({html:A,element:_,storage:t,intent:n,linkService:s}),((f=_.children)==null?void 0:f.length)>0)c.push([_,-1,A]);else if(_.value){const x=document.createTextNode(_.value);o&&$o.shouldBuildText(b)&&h.push(x),A.append(x)}}for(const u of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))u.setAttribute("readOnly",!0);return{textDivs:h}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const Eh=1e3,Zm=9,Kr=new WeakSet;class lf{static create(e){switch(e.data.annotationType){case Zt.LINK:return new _p(e);case Zt.TEXT:return new Jm(e);case Zt.WIDGET:switch(e.data.fieldType){case"Tx":return new Qm(e);case"Btn":return e.data.radioButton?new vp(e):e.data.checkBox?new eb(e):new sb(e);case"Ch":return new ib(e);case"Sig":return new tb(e)}return new Jr(e);case Zt.POPUP:return new Hd(e);case Zt.FREETEXT:return new kp(e);case Zt.LINE:return new rb(e);case Zt.SQUARE:return new ab(e);case Zt.CIRCLE:return new ob(e);case Zt.POLYLINE:return new Tp(e);case Zt.CARET:return new hb(e);case Zt.INK:return new Iu(e);case Zt.POLYGON:return new lb(e);case Zt.HIGHLIGHT:return new Rp(e);case Zt.UNDERLINE:return new cb(e);case Zt.SQUIGGLY:return new db(e);case Zt.STRIKEOUT:return new ub(e);case Zt.STAMP:return new Ip(e);case Zt.FILEATTACHMENT:return new fb(e);default:return new qt(e)}}}var vr,Ua,ja,Bl,zd;const Nu=class Nu{constructor(e,{isRenderable:t=!1,ignoreBorder:s=!1,createQuadrilaterals:i=!1}={}){S(this,Bl);S(this,vr,null);S(this,Ua,!1);S(this,ja,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(s)),i&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:s}){return!!(e!=null&&e.str||t!=null&&t.str||s!=null&&s.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Nu._hasPopupData(this.data)}updateEdited(e){var s;if(!this.container)return;a(this,vr)||y(this,vr,{rect:this.data.rect.slice(0)});const{rect:t}=e;t&&E(this,Bl,zd).call(this,t),(s=a(this,ja))==null||s.popup.updateEdited(e)}resetEdited(){var e;a(this,vr)&&(E(this,Bl,zd).call(this,a(this,vr).rect),(e=a(this,ja))==null||e.popup.resetEdited(),y(this,vr,null))}_createContainer(e){const{data:t,parent:{page:s,viewport:i}}=this,n=document.createElement("section");n.setAttribute("data-annotation-id",t.id),this instanceof Jr||(n.tabIndex=Eh);const{style:r}=n;if(r.zIndex=this.parent.zIndex++,t.alternativeText&&(n.title=t.alternativeText),t.noRotate&&n.classList.add("norotate"),!t.rect||this instanceof Hd){const{rotation:p}=t;return!t.hasOwnCanvas&&p!==0&&this.setRotation(p,n),n}const{width:o,height:l}=this;if(!e&&t.borderStyle.width>0){r.borderWidth=`${t.borderStyle.width}px`;const p=t.borderStyle.horizontalCornerRadius,_=t.borderStyle.verticalCornerRadius;if(p>0||_>0){const A=`calc(${p}px * var(--total-scale-factor)) / calc(${_}px * var(--total-scale-factor))`;r.borderRadius=A}else if(this instanceof vp){const A=`calc(${o}px * var(--total-scale-factor)) / calc(${l}px * var(--total-scale-factor))`;r.borderRadius=A}switch(t.borderStyle.style){case Qr.SOLID:r.borderStyle="solid";break;case Qr.DASHED:r.borderStyle="dashed";break;case Qr.BEVELED:pt("Unimplemented border style: beveled");break;case Qr.INSET:pt("Unimplemented border style: inset");break;case Qr.UNDERLINE:r.borderBottomStyle="solid";break}const b=t.borderColor||null;b?(y(this,Ua,!0),r.borderColor=lt.makeHexColor(b[0]|0,b[1]|0,b[2]|0)):r.borderWidth=0}const h=lt.normalizeRect([t.rect[0],s.view[3]-t.rect[1]+s.view[1],t.rect[2],s.view[3]-t.rect[3]+s.view[1]]),{pageWidth:c,pageHeight:d,pageX:f,pageY:u}=i.rawDims;r.left=`${100*(h[0]-f)/c}%`,r.top=`${100*(h[1]-u)/d}%`;const{rotation:m}=t;return t.hasOwnCanvas||m===0?(r.width=`${100*o/c}%`,r.height=`${100*l/d}%`):this.setRotation(m,n),n}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:i}=this.parent.viewport.rawDims;let{width:n,height:r}=this;e%180!==0&&([n,r]=[r,n]),t.style.width=`${100*n/s}%`,t.style.height=`${100*r/i}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,s,i)=>{const n=i.detail[t],r=n[0],o=n.slice(1);i.target.style[s]=of[`${r}_HTML`](o),this.annotationStorage.setValue(this.data.id,{[s]:of[`${r}_rgb`](o)})};return wt(this,"_commonActions",{display:t=>{const{display:s}=t.detail,i=s%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:s===1||s===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:s}=t.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const s=t.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(e,t){const s=this._commonActions;for(const i of Object.keys(t.detail)){const n=e[i]||s[i];n==null||n(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const s=this._commonActions;for(const[i,n]of Object.entries(t)){const r=s[i];if(r){const o={detail:{[i]:n},target:e};r(o),delete t[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,s,i,n]=this.data.rect.map(p=>Math.fround(p));if(e.length===8){const[p,_,b,A]=e.subarray(2,6);if(i===p&&n===_&&t===b&&s===A)return}const{style:r}=this.container;let o;if(a(this,Ua)){const{borderColor:p,borderWidth:_}=r;r.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${p}" stroke-width="${_}">`],this.container.classList.add("hasBorder")}const l=i-t,h=n-s,{svgFactory:c}=this,d=c.createElement("svg");d.classList.add("quadrilateralsContainer"),d.setAttribute("width",0),d.setAttribute("height",0);const f=c.createElement("defs");d.append(f);const u=c.createElement("clipPath"),m=`clippath_${this.data.id}`;u.setAttribute("id",m),u.setAttribute("clipPathUnits","objectBoundingBox"),f.append(u);for(let p=2,_=e.length;p<_;p+=8){const b=e[p],A=e[p+1],x=e[p+2],k=e[p+3],C=c.createElement("rect"),P=(x-t)/l,R=(n-A)/h,D=(b-x)/l,M=(A-k)/h;C.setAttribute("x",P),C.setAttribute("y",R),C.setAttribute("width",D),C.setAttribute("height",M),u.append(C),o==null||o.push(`<rect vector-effect="non-scaling-stroke" x="${P}" y="${R}" width="${D}" height="${M}"/>`)}a(this,Ua)&&(o.push("</g></svg>')"),r.backgroundImage=o.join("")),this.container.append(d),this.container.style.clipPath=`url(#${m})`}_createPopup(){const{data:e}=this,t=y(this,ja,new Hd({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(t.render())}render(){Lt("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const s=[];if(this._fieldObjects){const i=this._fieldObjects[e];if(i)for(const{page:n,id:r,exportValues:o}of i){if(n===-1||r===t)continue;const l=typeof o=="string"?o:null,h=document.querySelector(`[data-element-id="${r}"]`);if(h&&!Kr.has(h)){pt(`_getElementsByName - element not allowed: ${r}`);continue}s.push({id:r,exportValue:l,domElement:h})}return s}for(const i of document.getElementsByName(e)){const{exportValue:n}=i,r=i.getAttribute("data-element-id");r!==t&&Kr.has(i)&&s.push({id:r,exportValue:n,domElement:i})}return s}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var s;(s=this.linkService.eventBus)==null||s.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}};vr=new WeakMap,Ua=new WeakMap,ja=new WeakMap,Bl=new WeakSet,zd=function(e){const{container:{style:t},data:{rect:s,rotation:i},parent:{viewport:{rawDims:{pageWidth:n,pageHeight:r,pageX:o,pageY:l}}}}=this;s==null||s.splice(0,4,...e),t.left=`${100*(e[0]-o)/n}%`,t.top=`${100*(r-e[3]+l)/r}%`,i===0?(t.width=`${100*(e[2]-e[0])/n}%`,t.height=`${100*(e[3]-e[1])/r}%`):this.setRotation(i)};let qt=Nu;var os,On,wp,Ap;class _p extends qt{constructor(t,s=null){super(t,{isRenderable:!0,ignoreBorder:!!(s!=null&&s.ignoreBorder),createQuadrilaterals:!0});S(this,os);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:s}=this,i=document.createElement("a");i.setAttribute("data-element-id",t.id);let n=!1;return t.url?(s.addLinkAttributes(i,t.url,t.newWindow),n=!0):t.action?(this._bindNamedAction(i,t.action),n=!0):t.attachment?(E(this,os,wp).call(this,i,t.attachment,t.attachmentDest),n=!0):t.setOCGState?(E(this,os,Ap).call(this,i,t.setOCGState),n=!0):t.dest?(this._bindLink(i,t.dest),n=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,t),n=!0),t.resetForm?(this._bindResetFormAction(i,t.resetForm),n=!0):this.isTooltipOnly&&!n&&(this._bindLink(i,""),n=!0)),this.container.classList.add("linkAnnotation"),n&&this.container.append(i),this.container}_bindLink(t,s){t.href=this.linkService.getDestinationHash(s),t.onclick=()=>(s&&this.linkService.goToDestination(s),!1),(s||s==="")&&E(this,os,On).call(this)}_bindNamedAction(t,s){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(s),!1),E(this,os,On).call(this)}_bindJSAction(t,s){t.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const n of Object.keys(s.actions)){const r=i.get(n);r&&(t[r]=()=>{var o;return(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:s.id,name:n}}),!1})}t.onclick||(t.onclick=()=>!1),E(this,os,On).call(this)}_bindResetFormAction(t,s){const i=t.onclick;if(i||(t.href=this.linkService.getAnchorUrl("")),E(this,os,On).call(this),!this._fieldObjects){pt('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(t.onclick=()=>!1);return}t.onclick=()=>{var d;i==null||i();const{fields:n,refs:r,include:o}=s,l=[];if(n.length!==0||r.length!==0){const f=new Set(r);for(const u of n){const m=this._fieldObjects[u]||[];for(const{id:p}of m)f.add(p)}for(const u of Object.values(this._fieldObjects))for(const m of u)f.has(m.id)===o&&l.push(m)}else for(const f of Object.values(this._fieldObjects))l.push(...f);const h=this.annotationStorage,c=[];for(const f of l){const{id:u}=f;switch(c.push(u),f.type){case"text":{const p=f.defaultValue||"";h.setValue(u,{value:p});break}case"checkbox":case"radiobutton":{const p=f.defaultValue===f.exportValues;h.setValue(u,{value:p});break}case"combobox":case"listbox":{const p=f.defaultValue||"";h.setValue(u,{value:p});break}default:continue}const m=document.querySelector(`[data-element-id="${u}"]`);if(m){if(!Kr.has(m)){pt(`_bindResetFormAction - element not allowed: ${u}`);continue}}else continue;m.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((d=this.linkService.eventBus)==null||d.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:c,name:"ResetForm"}})),!1}}}os=new WeakSet,On=function(){this.container.setAttribute("data-internal-link","")},wp=function(t,s,i=null){t.href=this.linkService.getAnchorUrl(""),s.description&&(t.title=s.description),t.onclick=()=>{var n;return(n=this.downloadManager)==null||n.openOrDownloadData(s.content,s.filename,i),!1},E(this,os,On).call(this)},Ap=function(t,s){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(s),!1),E(this,os,On).call(this)};class Jm extends qt{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class Jr extends qt{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return we.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,s,i,n){s.includes("mouse")?e.addEventListener(s,r=>{var o;(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(r),shift:r.shiftKey,modifier:this._getKeyModifier(r)}})}):e.addEventListener(s,r=>{var o;if(s==="blur"){if(!t.focused||!r.relatedTarget)return;t.focused=!1}else if(s==="focus"){if(t.focused)return;t.focused=!0}n&&((o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(r)}}))})}_setEventListeners(e,t,s,i){var n,r,o;for(const[l,h]of s)(h==="Action"||(n=this.data.actions)!=null&&n[h])&&((h==="Focus"||h==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,l,h,i),h==="Focus"&&!((r=this.data.actions)!=null&&r.Blur)?this._setEventListener(e,t,"blur","Blur",null):h==="Blur"&&!((o=this.data.actions)!=null&&o.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":lt.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||Zm,n=e.style;let r;const o=2,l=h=>Math.round(10*h)/10;if(this.data.multiLine){const h=Math.abs(this.data.rect[3]-this.data.rect[1]-o),c=Math.round(h/(Kc*i))||1,d=h/c;r=Math.min(i,l(d/Kc))}else{const h=Math.abs(this.data.rect[3]-this.data.rect[1]-o);r=Math.min(i,l(h/Kc))}n.fontSize=`calc(${r}px * var(--total-scale-factor))`,n.color=lt.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(n.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class Qm extends Jr{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,s,i){const n=this.annotationStorage;for(const r of this._getElementsByName(e.name,e.id))r.domElement&&(r.domElement[t]=s),n.setValue(r.id,{[i]:s})}render(){var i,n;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const r=e.getValue(t,{value:this.data.fieldValue});let o=r.value||"";const l=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;l&&o.length>l&&(o=o.slice(0,l));let h=r.formattedValue||((i=this.data.textContent)==null?void 0:i.join(`
`))||null;h&&this.data.comb&&(h=h.replaceAll(/\s+/g,""));const c={userValue:o,formattedValue:h,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=h??o,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type=this.data.password?"password":"text",s.setAttribute("value",h??o),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),Kr.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=Eh,this._setRequired(s,this.data.required),l&&(s.maxLength=l),s.addEventListener("input",f=>{e.setValue(t,{value:f.target.value}),this.setPropertyOnSiblings(s,"value",f.target.value,"value"),c.formattedValue=null}),s.addEventListener("resetform",f=>{const u=this.data.defaultFieldValue??"";s.value=c.userValue=u,c.formattedValue=null});let d=f=>{const{formattedValue:u}=c;u!=null&&(f.target.value=u),f.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",u=>{var p;if(c.focused)return;const{target:m}=u;c.userValue&&(m.value=c.userValue),c.lastCommittedValue=m.value,c.commitKey=1,(p=this.data.actions)!=null&&p.Focus||(c.focused=!0)}),s.addEventListener("updatefromsandbox",u=>{this.showElementAndHideCanvas(u.target);const m={value(p){c.userValue=p.detail.value??"",e.setValue(t,{value:c.userValue.toString()}),p.target.value=c.userValue},formattedValue(p){const{formattedValue:_}=p.detail;c.formattedValue=_,_!=null&&p.target!==document.activeElement&&(p.target.value=_),e.setValue(t,{formattedValue:_})},selRange(p){p.target.setSelectionRange(...p.detail.selRange)},charLimit:p=>{var x;const{charLimit:_}=p.detail,{target:b}=p;if(_===0){b.removeAttribute("maxLength");return}b.setAttribute("maxLength",_);let A=c.userValue;!A||A.length<=_||(A=A.slice(0,_),b.value=c.userValue=A,e.setValue(t,{value:A}),(x=this.linkService.eventBus)==null||x.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:A,willCommit:!0,commitKey:1,selStart:b.selectionStart,selEnd:b.selectionEnd}}))}};this._dispatchEventFromSandbox(m,u)}),s.addEventListener("keydown",u=>{var _;c.commitKey=1;let m=-1;if(u.key==="Escape"?m=0:u.key==="Enter"&&!this.data.multiLine?m=2:u.key==="Tab"&&(c.commitKey=3),m===-1)return;const{value:p}=u.target;c.lastCommittedValue!==p&&(c.lastCommittedValue=p,c.userValue=p,(_=this.linkService.eventBus)==null||_.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:p,willCommit:!0,commitKey:m,selStart:u.target.selectionStart,selEnd:u.target.selectionEnd}}))});const f=d;d=null,s.addEventListener("blur",u=>{var p,_;if(!c.focused||!u.relatedTarget)return;(p=this.data.actions)!=null&&p.Blur||(c.focused=!1);const{value:m}=u.target;c.userValue=m,c.lastCommittedValue!==m&&((_=this.linkService.eventBus)==null||_.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:m,willCommit:!0,commitKey:c.commitKey,selStart:u.target.selectionStart,selEnd:u.target.selectionEnd}})),f(u)}),(n=this.data.actions)!=null&&n.Keystroke&&s.addEventListener("beforeinput",u=>{var C;c.lastCommittedValue=null;const{data:m,target:p}=u,{value:_,selectionStart:b,selectionEnd:A}=p;let x=b,k=A;switch(u.inputType){case"deleteWordBackward":{const P=_.substring(0,b).match(/\w*[^\w]*$/);P&&(x-=P[0].length);break}case"deleteWordForward":{const P=_.substring(b).match(/^[^\w]*\w*/);P&&(k+=P[0].length);break}case"deleteContentBackward":b===A&&(x-=1);break;case"deleteContentForward":b===A&&(k+=1);break}u.preventDefault(),(C=this.linkService.eventBus)==null||C.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:_,change:m||"",willCommit:!1,selStart:x,selEnd:k}})}),this._setEventListeners(s,c,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],u=>u.target.value)}if(d&&s.addEventListener("blur",d),this.data.comb){const u=(this.data.rect[2]-this.data.rect[0])/l;s.classList.add("comb"),s.style.letterSpacing=`calc(${u}px * var(--total-scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class tb extends Jr{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class eb extends Jr{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,s=t.id;let i=e.getValue(s,{value:t.exportValue===t.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",e.setValue(s,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const n=document.createElement("input");return Kr.add(n),n.setAttribute("data-element-id",s),n.disabled=t.readOnly,this._setRequired(n,this.data.required),n.type="checkbox",n.name=t.fieldName,i&&n.setAttribute("checked",!0),n.setAttribute("exportValue",t.exportValue),n.tabIndex=Eh,n.addEventListener("change",r=>{const{name:o,checked:l}=r.target;for(const h of this._getElementsByName(o,s)){const c=l&&h.exportValue===t.exportValue;h.domElement&&(h.domElement.checked=c),e.setValue(h.id,{value:c})}e.setValue(s,{value:l})}),n.addEventListener("resetform",r=>{const o=t.defaultFieldValue||"Off";r.target.checked=o===t.exportValue}),this.enableScripting&&this.hasJSActions&&(n.addEventListener("updatefromsandbox",r=>{const o={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(s,{value:l.target.checked})}};this._dispatchEventFromSandbox(o,r)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],r=>r.target.checked)),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class vp extends Jr{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,s=t.id;let i=e.getValue(s,{value:t.fieldValue===t.buttonValue}).value;if(typeof i=="string"&&(i=i!==t.buttonValue,e.setValue(s,{value:i})),i)for(const r of this._getElementsByName(t.fieldName,s))e.setValue(r.id,{value:!1});const n=document.createElement("input");if(Kr.add(n),n.setAttribute("data-element-id",s),n.disabled=t.readOnly,this._setRequired(n,this.data.required),n.type="radio",n.name=t.fieldName,i&&n.setAttribute("checked",!0),n.tabIndex=Eh,n.addEventListener("change",r=>{const{name:o,checked:l}=r.target;for(const h of this._getElementsByName(o,s))e.setValue(h.id,{value:!1});e.setValue(s,{value:l})}),n.addEventListener("resetform",r=>{const o=t.defaultFieldValue;r.target.checked=o!=null&&o===t.buttonValue}),this.enableScripting&&this.hasJSActions){const r=t.buttonValue;n.addEventListener("updatefromsandbox",o=>{const l={value:h=>{const c=r===h.detail.value;for(const d of this._getElementsByName(h.target.name)){const f=c&&d.id===s;d.domElement&&(d.domElement.checked=f),e.setValue(d.id,{value:f})}}};this._dispatchEventFromSandbox(l,o)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)}return this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class sb extends _p{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),e}}class ib extends Jr{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,s=e.getValue(t,{value:this.data.fieldValue}),i=document.createElement("select");Kr.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=Eh;let n=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",c=>{const d=this.data.defaultFieldValue;for(const f of i.options)f.selected=f.value===d});for(const c of this.data.options){const d=document.createElement("option");d.textContent=c.displayValue,d.value=c.exportValue,s.value.includes(c.exportValue)&&(d.setAttribute("selected",!0),n=!1),i.append(d)}let r=null;if(n){const c=document.createElement("option");c.value=" ",c.setAttribute("hidden",!0),c.setAttribute("selected",!0),i.prepend(c),r=()=>{c.remove(),i.removeEventListener("input",r),r=null},i.addEventListener("input",r)}const o=c=>{const d=c?"value":"textContent",{options:f,multiple:u}=i;return u?Array.prototype.filter.call(f,m=>m.selected).map(m=>m[d]):f.selectedIndex===-1?null:f[f.selectedIndex][d]};let l=o(!1);const h=c=>{const d=c.target.options;return Array.prototype.map.call(d,f=>({displayValue:f.textContent,exportValue:f.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",c=>{const d={value(f){r==null||r();const u=f.detail.value,m=new Set(Array.isArray(u)?u:[u]);for(const p of i.options)p.selected=m.has(p.value);e.setValue(t,{value:o(!0)}),l=o(!1)},multipleSelection(f){i.multiple=!0},remove(f){const u=i.options,m=f.detail.remove;u[m].selected=!1,i.remove(m),u.length>0&&Array.prototype.findIndex.call(u,_=>_.selected)===-1&&(u[0].selected=!0),e.setValue(t,{value:o(!0),items:h(f)}),l=o(!1)},clear(f){for(;i.length!==0;)i.remove(0);e.setValue(t,{value:null,items:[]}),l=o(!1)},insert(f){const{index:u,displayValue:m,exportValue:p}=f.detail.insert,_=i.children[u],b=document.createElement("option");b.textContent=m,b.value=p,_?_.before(b):i.append(b),e.setValue(t,{value:o(!0),items:h(f)}),l=o(!1)},items(f){const{items:u}=f.detail;for(;i.length!==0;)i.remove(0);for(const m of u){const{displayValue:p,exportValue:_}=m,b=document.createElement("option");b.textContent=p,b.value=_,i.append(b)}i.options.length>0&&(i.options[0].selected=!0),e.setValue(t,{value:o(!0),items:h(f)}),l=o(!1)},indices(f){const u=new Set(f.detail.indices);for(const m of f.target.options)m.selected=u.has(m.index);e.setValue(t,{value:o(!0)}),l=o(!1)},editable(f){f.target.disabled=!f.detail.editable}};this._dispatchEventFromSandbox(d,c)}),i.addEventListener("input",c=>{var u;const d=o(!0),f=o(!1);e.setValue(t,{value:d}),c.preventDefault(),(u=this.linkService.eventBus)==null||u.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:f,changeEx:d,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],c=>c.target.value)):i.addEventListener("input",function(c){e.setValue(t,{value:o(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class Hd extends qt{constructor(e){const{data:t,elements:s}=e;super(e,{isRenderable:qt._hasPopupData(t)}),this.elements=s,this.popup=null}render(){this.container.classList.add("popupAnnotation");const e=this.popup=new nb({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(const s of this.elements)s.popup=e,s.container.ariaHasPopup="dialog",t.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(s=>`${vu}${s}`).join(",")),this.container}}var Ga,Fc,Nc,$a,Wa,$t,Ri,Va,zl,Hl,Xa,Ii,Cs,Pi,Ul,Li,jl,Sr,Er,Mt,Zh,Ud,Sp,Ep,xp,Cp,Jh,Qh,jd;class nb{constructor({container:e,color:t,elements:s,titleObj:i,modificationDate:n,contentsObj:r,richText:o,parent:l,rect:h,parentRect:c,open:d}){S(this,Mt);S(this,Ga,E(this,Mt,xp).bind(this));S(this,Fc,E(this,Mt,jd).bind(this));S(this,Nc,E(this,Mt,Qh).bind(this));S(this,$a,E(this,Mt,Jh).bind(this));S(this,Wa,null);S(this,$t,null);S(this,Ri,null);S(this,Va,null);S(this,zl,null);S(this,Hl,null);S(this,Xa,null);S(this,Ii,!1);S(this,Cs,null);S(this,Pi,null);S(this,Ul,null);S(this,Li,null);S(this,jl,null);S(this,Sr,null);S(this,Er,!1);var f;y(this,$t,e),y(this,jl,i),y(this,Ri,r),y(this,Li,o),y(this,Hl,l),y(this,Wa,t),y(this,Ul,h),y(this,Xa,c),y(this,zl,s),y(this,Va,xu.toDateObject(n)),this.trigger=s.flatMap(u=>u.getElementsToTriggerPopup());for(const u of this.trigger)u.addEventListener("click",a(this,$a)),u.addEventListener("mouseenter",a(this,Nc)),u.addEventListener("mouseleave",a(this,Fc)),u.classList.add("popupTriggerArea");for(const u of s)(f=u.container)==null||f.addEventListener("keydown",a(this,Ga));a(this,$t).hidden=!0,d&&E(this,Mt,Jh).call(this)}render(){if(a(this,Cs))return;const e=y(this,Cs,document.createElement("div"));if(e.className="popup",a(this,Wa)){const n=e.style.outlineColor=lt.makeHexColor(...a(this,Wa));e.style.backgroundColor=`color-mix(in srgb, ${n} 30%, white)`}const t=document.createElement("span");t.className="header";const s=document.createElement("h1");if(t.append(s),{dir:s.dir,str:s.textContent}=a(this,jl),e.append(t),a(this,Va)){const n=document.createElement("span");n.classList.add("popupDate"),n.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),n.setAttribute("data-l10n-args",JSON.stringify({dateObj:a(this,Va).valueOf()})),t.append(n)}const i=a(this,Mt,Zh);if(i)yp.render({xfaHtml:i,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{const n=this._formatContents(a(this,Ri));e.append(n)}a(this,$t).append(e)}_formatContents({str:e,dir:t}){const s=document.createElement("p");s.classList.add("popupContent"),s.dir=t;const i=e.split(/(?:\r\n?|\n)/);for(let n=0,r=i.length;n<r;++n){const o=i[n];s.append(document.createTextNode(o)),n<r-1&&s.append(document.createElement("br"))}return s}updateEdited({rect:e,popupContent:t}){var s;a(this,Sr)||y(this,Sr,{contentsObj:a(this,Ri),richText:a(this,Li)}),e&&y(this,Pi,null),t&&(y(this,Li,E(this,Mt,Ep).call(this,t)),y(this,Ri,null)),(s=a(this,Cs))==null||s.remove(),y(this,Cs,null)}resetEdited(){var e;a(this,Sr)&&({contentsObj:ke(this,Ri)._,richText:ke(this,Li)._}=a(this,Sr),y(this,Sr,null),(e=a(this,Cs))==null||e.remove(),y(this,Cs,null),y(this,Pi,null))}forceHide(){y(this,Er,this.isVisible),a(this,Er)&&(a(this,$t).hidden=!0)}maybeShow(){a(this,Er)&&(a(this,Cs)||E(this,Mt,Qh).call(this),y(this,Er,!1),a(this,$t).hidden=!1)}get isVisible(){return a(this,$t).hidden===!1}}Ga=new WeakMap,Fc=new WeakMap,Nc=new WeakMap,$a=new WeakMap,Wa=new WeakMap,$t=new WeakMap,Ri=new WeakMap,Va=new WeakMap,zl=new WeakMap,Hl=new WeakMap,Xa=new WeakMap,Ii=new WeakMap,Cs=new WeakMap,Pi=new WeakMap,Ul=new WeakMap,Li=new WeakMap,jl=new WeakMap,Sr=new WeakMap,Er=new WeakMap,Mt=new WeakSet,Zh=function(){const e=a(this,Li),t=a(this,Ri);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&a(this,Li).html||null},Ud=function(){var e,t,s;return((s=(t=(e=a(this,Mt,Zh))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.fontSize)||0},Sp=function(){var e,t,s;return((s=(t=(e=a(this,Mt,Zh))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.color)||null},Ep=function(e){const t=[],s={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},i={style:{color:a(this,Mt,Sp),fontSize:a(this,Mt,Ud)?`calc(${a(this,Mt,Ud)}px * var(--total-scale-factor))`:""}};for(const n of e.split(`
`))t.push({name:"span",value:n,attributes:i});return s},xp=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&a(this,Ii))&&E(this,Mt,Jh).call(this)},Cp=function(){if(a(this,Pi)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:s,pageX:i,pageY:n}}}=a(this,Hl);let r=!!a(this,Xa),o=r?a(this,Xa):a(this,Ul);for(const m of a(this,zl))if(!o||lt.intersect(m.data.rect,o)!==null){o=m.data.rect,r=!0;break}const l=lt.normalizeRect([o[0],e[3]-o[1]+e[1],o[2],e[3]-o[3]+e[1]]),c=r?o[2]-o[0]+5:0,d=l[0]+c,f=l[1];y(this,Pi,[100*(d-i)/t,100*(f-n)/s]);const{style:u}=a(this,$t);u.left=`${a(this,Pi)[0]}%`,u.top=`${a(this,Pi)[1]}%`},Jh=function(){y(this,Ii,!a(this,Ii)),a(this,Ii)?(E(this,Mt,Qh).call(this),a(this,$t).addEventListener("click",a(this,$a)),a(this,$t).addEventListener("keydown",a(this,Ga))):(E(this,Mt,jd).call(this),a(this,$t).removeEventListener("click",a(this,$a)),a(this,$t).removeEventListener("keydown",a(this,Ga)))},Qh=function(){a(this,Cs)||this.render(),this.isVisible?a(this,Ii)&&a(this,$t).classList.add("focused"):(E(this,Mt,Cp).call(this),a(this,$t).hidden=!1,a(this,$t).style.zIndex=parseInt(a(this,$t).style.zIndex)+1e3)},jd=function(){a(this,$t).classList.remove("focused"),!(a(this,Ii)||!this.isVisible)&&(a(this,$t).hidden=!0,a(this,$t).style.zIndex=parseInt(a(this,$t).style.zIndex)-1e3)};class kp extends qt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=ft.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const s=document.createElement("span");s.textContent=t,e.append(s)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Gl;class rb extends qt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});S(this,Gl,null)}render(){this.container.classList.add("lineAnnotation");const{data:t,width:s,height:i}=this,n=this.svgFactory.create(s,i,!0),r=y(this,Gl,this.svgFactory.createElement("svg:line"));return r.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),r.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),r.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),r.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),r.setAttribute("stroke-width",t.borderStyle.width||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),n.append(r),this.container.append(n),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return a(this,Gl)}addHighlightArea(){this.container.classList.add("highlightArea")}}Gl=new WeakMap;var $l;class ab extends qt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});S(this,$l,null)}render(){this.container.classList.add("squareAnnotation");const{data:t,width:s,height:i}=this,n=this.svgFactory.create(s,i,!0),r=t.borderStyle.width,o=y(this,$l,this.svgFactory.createElement("svg:rect"));return o.setAttribute("x",r/2),o.setAttribute("y",r/2),o.setAttribute("width",s-r),o.setAttribute("height",i-r),o.setAttribute("stroke-width",r||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return a(this,$l)}addHighlightArea(){this.container.classList.add("highlightArea")}}$l=new WeakMap;var Wl;class ob extends qt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});S(this,Wl,null)}render(){this.container.classList.add("circleAnnotation");const{data:t,width:s,height:i}=this,n=this.svgFactory.create(s,i,!0),r=t.borderStyle.width,o=y(this,Wl,this.svgFactory.createElement("svg:ellipse"));return o.setAttribute("cx",s/2),o.setAttribute("cy",i/2),o.setAttribute("rx",s/2-r/2),o.setAttribute("ry",i/2-r/2),o.setAttribute("stroke-width",r||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return a(this,Wl)}addHighlightArea(){this.container.classList.add("highlightArea")}}Wl=new WeakMap;var Vl;class Tp extends qt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});S(this,Vl,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:s,borderStyle:i,popupRef:n},width:r,height:o}=this;if(!s)return this.container;const l=this.svgFactory.create(r,o,!0);let h=[];for(let d=0,f=s.length;d<f;d+=2){const u=s[d]-t[0],m=t[3]-s[d+1];h.push(`${u},${m}`)}h=h.join(" ");const c=y(this,Vl,this.svgFactory.createElement(this.svgElementName));return c.setAttribute("points",h),c.setAttribute("stroke-width",i.width||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),l.append(c),this.container.append(l),!n&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return a(this,Vl)}addHighlightArea(){this.container.classList.add("highlightArea")}}Vl=new WeakMap;class lb extends Tp{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class hb extends qt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var Xl,xr,ql,Gd;class Iu extends qt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});S(this,ql);S(this,Xl,null);S(this,xr,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?ft.HIGHLIGHT:ft.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:s,inkLists:i,borderStyle:n,popupRef:r}}=this,{transform:o,width:l,height:h}=E(this,ql,Gd).call(this,s,t),c=this.svgFactory.create(l,h,!0),d=y(this,Xl,this.svgFactory.createElement("svg:g"));c.append(d),d.setAttribute("stroke-width",n.width||1),d.setAttribute("stroke-linecap","round"),d.setAttribute("stroke-linejoin","round"),d.setAttribute("stroke-miterlimit",10),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),d.setAttribute("transform",o);for(let f=0,u=i.length;f<u;f++){const m=this.svgFactory.createElement(this.svgElementName);a(this,xr).push(m),m.setAttribute("points",i[f].join(",")),d.append(m)}return!r&&this.hasPopupData&&this._createPopup(),this.container.append(c),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:s,points:i,rect:n}=t,r=a(this,Xl);if(s>=0&&r.setAttribute("stroke-width",s||1),i)for(let o=0,l=a(this,xr).length;o<l;o++)a(this,xr)[o].setAttribute("points",i[o].join(","));if(n){const{transform:o,width:l,height:h}=E(this,ql,Gd).call(this,this.data.rotation,n);r.parentElement.setAttribute("viewBox",`0 0 ${l} ${h}`),r.setAttribute("transform",o)}}getElementsToTriggerPopup(){return a(this,xr)}addHighlightArea(){this.container.classList.add("highlightArea")}}Xl=new WeakMap,xr=new WeakMap,ql=new WeakSet,Gd=function(t,s){switch(t){case 90:return{transform:`rotate(90) translate(${-s[0]},${s[1]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};case 180:return{transform:`rotate(180) translate(${-s[2]},${s[1]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]};case 270:return{transform:`rotate(270) translate(${-s[2]},${s[3]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};default:return{transform:`translate(${-s[0]},${s[3]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]}}};class Rp extends qt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=ft.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}class cb extends qt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class db extends qt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class ub extends qt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class Ip extends qt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=ft.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Yl,Kl,$d;class fb extends qt{constructor(t){var i;super(t,{isRenderable:!0});S(this,Kl);S(this,Yl,null);const{file:s}=this.data;this.filename=s.filename,this.content=s.content,(i=this.linkService.eventBus)==null||i.dispatch("fileattachmentannotation",{source:this,...s})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:s}=this;let i;s.hasAppearance||s.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(s.name)?"paperclip":"pushpin"}.svg`,s.fillAlpha&&s.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(s.fillAlpha*100)}%);`)),i.addEventListener("dblclick",E(this,Kl,$d).bind(this)),y(this,Yl,i);const{isMac:n}=we.platform;return t.addEventListener("keydown",r=>{r.key==="Enter"&&(n?r.metaKey:r.ctrlKey)&&E(this,Kl,$d).call(this)}),!s.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),t.append(i),t}getElementsToTriggerPopup(){return a(this,Yl)}addHighlightArea(){this.container.classList.add("highlightArea")}}Yl=new WeakMap,Kl=new WeakSet,$d=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var Zl,Cr,bn,Jl,Nn,Vd,Xd;const Ou=class Ou{constructor({div:e,accessibilityManager:t,annotationCanvasMap:s,annotationEditorUIManager:i,page:n,viewport:r,structTreeLayer:o}){S(this,Nn);S(this,Zl,null);S(this,Cr,null);S(this,bn,new Map);S(this,Jl,null);this.div=e,y(this,Zl,t),y(this,Cr,s),y(this,Jl,o||null),this.page=n,this.viewport=r,this.zIndex=0,this._annotationEditorUIManager=i}hasEditableAnnotations(){return a(this,bn).size>0}async render(e){var r;const{annotations:t}=e,s=this.div;qr(s,this.viewport);const i=new Map,n={data:null,layer:s,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new yc,annotationStorage:e.annotationStorage||new ku,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const o of t){if(o.noHTML)continue;const l=o.annotationType===Zt.POPUP;if(l){const d=i.get(o.id);if(!d)continue;n.elements=d}else if(o.rect[2]===o.rect[0]||o.rect[3]===o.rect[1])continue;n.data=o;const h=lf.create(n);if(!h.isRenderable)continue;if(!l&&o.popupRef){const d=i.get(o.popupRef);d?d.push(h):i.set(o.popupRef,[h])}const c=h.render();o.hidden&&(c.style.visibility="hidden"),await E(this,Nn,Vd).call(this,c,o.id),h._isEditable&&(a(this,bn).set(h.data.id,h),(r=this._annotationEditorUIManager)==null||r.renderAnnotationElement(h))}E(this,Nn,Xd).call(this)}async addLinkAnnotations(e,t){const s={data:null,layer:this.div,linkService:t,svgFactory:new yc,parent:this};for(const i of e){i.borderStyle||(i.borderStyle=Ou._defaultBorderStyle),s.data=i;const n=lf.create(s);if(!n.isRenderable)continue;const r=n.render();await E(this,Nn,Vd).call(this,r,i.id)}}update({viewport:e}){const t=this.div;this.viewport=e,qr(t,{rotation:e.rotation}),E(this,Nn,Xd).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(a(this,bn).values())}getEditableAnnotation(e){return a(this,bn).get(e)}static get _defaultBorderStyle(){return wt(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:Qr.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}};Zl=new WeakMap,Cr=new WeakMap,bn=new WeakMap,Jl=new WeakMap,Nn=new WeakSet,Vd=async function(e,t){var r,o;const s=e.firstChild||e,i=s.id=`${vu}${t}`,n=await((r=a(this,Jl))==null?void 0:r.getAriaAttributes(i));if(n)for(const[l,h]of n)s.setAttribute(l,h);this.div.append(e),(o=a(this,Zl))==null||o.moveElementInDOM(this.div,e,s,!1)},Xd=function(){var t;if(!a(this,Cr))return;const e=this.div;for(const[s,i]of a(this,Cr)){const n=e.querySelector(`[data-annotation-id="${s}"]`);if(!n)continue;i.className="annotationContent";const{firstChild:r}=n;r?r.nodeName==="CANVAS"?r.replaceWith(i):r.classList.contains("annotationContent")?r.after(i):r.before(i):n.append(i);const o=a(this,bn).get(s);o&&(o._hasNoCanvas?((t=this._annotationEditorUIManager)==null||t.setMissingCanvas(s,n.id,i),o._hasNoCanvas=!1):o.canvas=i)}a(this,Cr).clear()};let Wd=Ou;const Fh=/\r\n?|\n/g;var ks,Ke,Ql,kr,Ze,te,Pp,Lp,Mp,tc,$i,ec,sc,Dp,Yd,Fp;const Ft=class Ft extends Nt{constructor(t){super({...t,name:"freeTextEditor"});S(this,te);S(this,ks);S(this,Ke,"");S(this,Ql,`${this.id}-editor`);S(this,kr,null);S(this,Ze);y(this,ks,t.color||Ft._defaultColor||Nt._defaultLineColor),y(this,Ze,t.fontSize||Ft._defaultFontSize)}static get _keyboardManager(){const t=Ft.prototype,s=r=>r.isEmpty(),i=Yr.TRANSLATE_SMALL,n=Yr.TRANSLATE_BIG;return wt(this,"_keyboardManager",new vh([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:s}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-n,0],checker:s}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[i,0],checker:s}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[n,0],checker:s}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:s}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-n],checker:s}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,i],checker:s}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,n],checker:s}]]))}static initialize(t,s){Nt.initialize(t,s);const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,s){switch(t){case At.FREETEXT_SIZE:Ft._defaultFontSize=s;break;case At.FREETEXT_COLOR:Ft._defaultColor=s;break}}updateParams(t,s){switch(t){case At.FREETEXT_SIZE:E(this,te,Pp).call(this,s);break;case At.FREETEXT_COLOR:E(this,te,Lp).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[At.FREETEXT_SIZE,Ft._defaultFontSize],[At.FREETEXT_COLOR,Ft._defaultColor||Nt._defaultLineColor]]}get propertiesToUpdate(){return[[At.FREETEXT_SIZE,a(this,Ze)],[At.FREETEXT_COLOR,a(this,ks)]]}_translateEmpty(t,s){this._uiManager.translateSelectedEditors(t,s,!0)}getInitialTranslation(){const t=this.parentScale;return[-Ft._internalPadding*t,-(Ft._internalPadding+a(this,Ze))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),y(this,kr,new AbortController);const t=this._uiManager.combinedSignal(a(this,kr));return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){var t;return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",a(this,Ql)),this._isDraggable=!0,(t=a(this,kr))==null||t.abort(),y(this,kr,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var s;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(s=this._initialOptions)!=null&&s.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=a(this,Ke),s=y(this,Ke,E(this,te,Mp).call(this).trimEnd());if(t===s)return;const i=n=>{if(y(this,Ke,n),!n){this.remove();return}E(this,te,sc).call(this),this._uiManager.rebuild(this),E(this,te,tc).call(this)};this.addCommands({cmd:()=>{i(s)},undo:()=>{i(t)},mustExec:!1}),E(this,te,tc).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){Ft._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,s;(this._isCopy||this.annotationElementId)&&(t=this.x,s=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",a(this,Ql)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${a(this,Ze)}px * var(--total-scale-factor))`,i.color=a(this,ks),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[n,r]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[l,h]=this.getInitialTranslation();[l,h]=this.pageTranslationToScreen(l,h);const[c,d]=this.pageDimensions,[f,u]=this.pageTranslation;let m,p;switch(this.rotation){case 0:m=t+(o[0]-f)/c,p=s+this.height-(o[1]-u)/d;break;case 90:m=t+(o[0]-f)/c,p=s-(o[1]-u)/d,[l,h]=[h,-l];break;case 180:m=t-this.width+(o[0]-f)/c,p=s-(o[1]-u)/d,[l,h]=[-l,-h];break;case 270:m=t+(o[0]-f-this.height*d)/c,p=s+(o[1]-u-this.width*c)/d,[l,h]=[-h,l];break}this.setAt(m*n,p*r,l,h)}else this._moveAfterPaste(t,s);E(this,te,sc).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var m,p,_;const s=t.clipboardData||window.clipboardData,{types:i}=s;if(i.length===1&&i[0]==="text/plain")return;t.preventDefault();const n=E(m=Ft,$i,Yd).call(m,s.getData("text")||"").replaceAll(Fh,`
`);if(!n)return;const r=window.getSelection();if(!r.rangeCount)return;this.editorDiv.normalize(),r.deleteFromDocument();const o=r.getRangeAt(0);if(!n.includes(`
`)){o.insertNode(document.createTextNode(n)),this.editorDiv.normalize(),r.collapseToStart();return}const{startContainer:l,startOffset:h}=o,c=[],d=[];if(l.nodeType===Node.TEXT_NODE){const b=l.parentElement;if(d.push(l.nodeValue.slice(h).replaceAll(Fh,"")),b!==this.editorDiv){let A=c;for(const x of this.editorDiv.childNodes){if(x===b){A=d;continue}A.push(E(p=Ft,$i,ec).call(p,x))}}c.push(l.nodeValue.slice(0,h).replaceAll(Fh,""))}else if(l===this.editorDiv){let b=c,A=0;for(const x of this.editorDiv.childNodes)A++===h&&(b=d),b.push(E(_=Ft,$i,ec).call(_,x))}y(this,Ke,`${c.join(`
`)}${n}${d.join(`
`)}`),E(this,te,sc).call(this);const f=new Range;let u=Math.sumPrecise(c.map(b=>b.length));for(const{firstChild:b}of this.editorDiv.childNodes)if(b.nodeType===Node.TEXT_NODE){const A=b.nodeValue.length;if(u<=A){f.setStart(b,u),f.setEnd(b,u);break}u-=A}r.removeAllRanges(),r.addRange(f)}get contentDiv(){return this.editorDiv}static async deserialize(t,s,i){var o;let n=null;if(t instanceof kp){const{data:{defaultAppearanceData:{fontSize:l,fontColor:h},rect:c,rotation:d,id:f,popupRef:u},textContent:m,textPosition:p,parent:{page:{pageNumber:_}}}=t;if(!m||m.length===0)return null;n=t={annotationType:ft.FREETEXT,color:Array.from(h),fontSize:l,value:m.join(`
`),position:p,pageIndex:_-1,rect:c.slice(0),rotation:d,id:f,deleted:!1,popupRef:u}}const r=await super.deserialize(t,s,i);return y(r,Ze,t.fontSize),y(r,ks,lt.makeHexColor(...t.color)),y(r,Ke,E(o=Ft,$i,Yd).call(o,t.value)),r.annotationElementId=t.id||null,r._initialData=n,r}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s=Ft._internalPadding*this.parentScale,i=this.getRect(s,s),n=Nt._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:a(this,ks)),r={annotationType:ft.FREETEXT,color:n,fontSize:a(this,Ze),value:E(this,te,Dp).call(this),pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?(r.isCopy=!0,r):this.annotationElementId&&!E(this,te,Fp).call(this,r)?null:(r.id=this.annotationElementId,r)}renderAnnotationElement(t){const s=super.renderAnnotationElement(t);if(this.deleted)return s;const{style:i}=s;i.fontSize=`calc(${a(this,Ze)}px * var(--total-scale-factor))`,i.color=a(this,ks),s.replaceChildren();for(const r of a(this,Ke).split(`
`)){const o=document.createElement("div");o.append(r?document.createTextNode(r):document.createElement("br")),s.append(o)}const n=Ft._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(n,n),popupContent:a(this,Ke)}),s}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};ks=new WeakMap,Ke=new WeakMap,Ql=new WeakMap,kr=new WeakMap,Ze=new WeakMap,te=new WeakSet,Pp=function(t){const s=n=>{this.editorDiv.style.fontSize=`calc(${n}px * var(--total-scale-factor))`,this.translate(0,-(n-a(this,Ze))*this.parentScale),y(this,Ze,n),E(this,te,tc).call(this)},i=a(this,Ze);this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:At.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},Lp=function(t){const s=n=>{y(this,ks,this.editorDiv.style.color=n)},i=a(this,ks);this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:At.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},Mp=function(){var i;const t=[];this.editorDiv.normalize();let s=null;for(const n of this.editorDiv.childNodes)(s==null?void 0:s.nodeType)===Node.TEXT_NODE&&n.nodeName==="BR"||(t.push(E(i=Ft,$i,ec).call(i,n)),s=n);return t.join(`
`)},tc=function(){const[t,s]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:n,div:r}=this,o=r.style.display,l=r.classList.contains("hidden");r.classList.remove("hidden"),r.style.display="hidden",n.div.append(this.div),i=r.getBoundingClientRect(),r.remove(),r.style.display=o,r.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=i.width/t,this.height=i.height/s):(this.width=i.height/t,this.height=i.width/s),this.fixAndSetPosition()},$i=new WeakSet,ec=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Fh,"")},sc=function(){if(this.editorDiv.replaceChildren(),!!a(this,Ke))for(const t of a(this,Ke).split(`
`)){const s=document.createElement("div");s.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(s)}},Dp=function(){return a(this,Ke).replaceAll(" "," ")},Yd=function(t){return t.replaceAll(" "," ")},Fp=function(t){const{value:s,fontSize:i,color:n,pageIndex:r}=this._initialData;return this._hasBeenMoved||t.value!==s||t.fontSize!==i||t.color.some((o,l)=>o!==n[l])||t.pageIndex!==r},S(Ft,$i),K(Ft,"_freeTextDefaultContent",""),K(Ft,"_internalPadding",0),K(Ft,"_defaultColor",null),K(Ft,"_defaultFontSize",10),K(Ft,"_type","freetext"),K(Ft,"_editorType",ft.FREETEXT);let qd=Ft;class nt{toSVGPath(){Lt("Abstract method `toSVGPath` must be implemented.")}get box(){Lt("Abstract getter `box` must be implemented.")}serialize(e,t){Lt("Abstract method `serialize` must be implemented.")}static _rescale(e,t,s,i,n,r){r||(r=new Float32Array(e.length));for(let o=0,l=e.length;o<l;o+=2)r[o]=t+e[o]*i,r[o+1]=s+e[o+1]*n;return r}static _rescaleAndSwap(e,t,s,i,n,r){r||(r=new Float32Array(e.length));for(let o=0,l=e.length;o<l;o+=2)r[o]=t+e[o+1]*i,r[o+1]=s+e[o]*n;return r}static _translate(e,t,s,i){i||(i=new Float32Array(e.length));for(let n=0,r=e.length;n<r;n+=2)i[n]=t+e[n],i[n+1]=s+e[n+1];return i}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,s,i,n){switch(n){case 90:return[1-t/s,e/i];case 180:return[1-e/s,1-t/i];case 270:return[t/s,1-e/i];default:return[e/s,t/i]}}static _normalizePagePoint(e,t,s){switch(s){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,s,i,n,r){return[(e+5*s)/6,(t+5*i)/6,(5*s+n)/6,(5*i+r)/6,(s+n)/2,(i+r)/2]}}K(nt,"PRECISION",1e-4);var Je,Ts,qa,Ya,Js,_t,Tr,Rr,th,eh,Ka,Za,yn,sh,Oc,Bc,re,Oo,Np,Op,Bp,zp,Hp,Up;const di=class di{constructor({x:e,y:t},s,i,n,r,o=0){S(this,re);S(this,Je);S(this,Ts,[]);S(this,qa);S(this,Ya);S(this,Js,[]);S(this,_t,new Float32Array(18));S(this,Tr);S(this,Rr);S(this,th);S(this,eh);S(this,Ka);S(this,Za);S(this,yn,[]);y(this,Je,s),y(this,Za,n*i),y(this,Ya,r),a(this,_t).set([NaN,NaN,NaN,NaN,e,t],6),y(this,qa,o),y(this,eh,a(di,sh)*i),y(this,th,a(di,Bc)*i),y(this,Ka,i),a(this,yn).push(e,t)}isEmpty(){return isNaN(a(this,_t)[8])}add({x:e,y:t}){var M;y(this,Tr,e),y(this,Rr,t);const[s,i,n,r]=a(this,Je);let[o,l,h,c]=a(this,_t).subarray(8,12);const d=e-h,f=t-c,u=Math.hypot(d,f);if(u<a(this,th))return!1;const m=u-a(this,eh),p=m/u,_=p*d,b=p*f;let A=o,x=l;o=h,l=c,h+=_,c+=b,(M=a(this,yn))==null||M.push(e,t);const k=-b/m,C=_/m,P=k*a(this,Za),R=C*a(this,Za);return a(this,_t).set(a(this,_t).subarray(2,8),0),a(this,_t).set([h+P,c+R],4),a(this,_t).set(a(this,_t).subarray(14,18),12),a(this,_t).set([h-P,c-R],16),isNaN(a(this,_t)[6])?(a(this,Js).length===0&&(a(this,_t).set([o+P,l+R],2),a(this,Js).push(NaN,NaN,NaN,NaN,(o+P-s)/n,(l+R-i)/r),a(this,_t).set([o-P,l-R],14),a(this,Ts).push(NaN,NaN,NaN,NaN,(o-P-s)/n,(l-R-i)/r)),a(this,_t).set([A,x,o,l,h,c],6),!this.isEmpty()):(a(this,_t).set([A,x,o,l,h,c],6),Math.abs(Math.atan2(x-l,A-o)-Math.atan2(b,_))<Math.PI/2?([o,l,h,c]=a(this,_t).subarray(2,6),a(this,Js).push(NaN,NaN,NaN,NaN,((o+h)/2-s)/n,((l+c)/2-i)/r),[o,l,A,x]=a(this,_t).subarray(14,18),a(this,Ts).push(NaN,NaN,NaN,NaN,((A+o)/2-s)/n,((x+l)/2-i)/r),!0):([A,x,o,l,h,c]=a(this,_t).subarray(0,6),a(this,Js).push(((A+5*o)/6-s)/n,((x+5*l)/6-i)/r,((5*o+h)/6-s)/n,((5*l+c)/6-i)/r,((o+h)/2-s)/n,((l+c)/2-i)/r),[h,c,o,l,A,x]=a(this,_t).subarray(12,18),a(this,Ts).push(((A+5*o)/6-s)/n,((x+5*l)/6-i)/r,((5*o+h)/6-s)/n,((5*l+c)/6-i)/r,((o+h)/2-s)/n,((l+c)/2-i)/r),!0))}toSVGPath(){if(this.isEmpty())return"";const e=a(this,Js),t=a(this,Ts);if(isNaN(a(this,_t)[6])&&!this.isEmpty())return E(this,re,Np).call(this);const s=[];s.push(`M${e[4]} ${e[5]}`);for(let i=6;i<e.length;i+=6)isNaN(e[i])?s.push(`L${e[i+4]} ${e[i+5]}`):s.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);E(this,re,Bp).call(this,s);for(let i=t.length-6;i>=6;i-=6)isNaN(t[i])?s.push(`L${t[i+4]} ${t[i+5]}`):s.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);return E(this,re,Op).call(this,s),s.join(" ")}newFreeDrawOutline(e,t,s,i,n,r){return new jp(e,t,s,i,n,r)}getOutlines(){var d;const e=a(this,Js),t=a(this,Ts),s=a(this,_t),[i,n,r,o]=a(this,Je),l=new Float32Array((((d=a(this,yn))==null?void 0:d.length)??0)+2);for(let f=0,u=l.length-2;f<u;f+=2)l[f]=(a(this,yn)[f]-i)/r,l[f+1]=(a(this,yn)[f+1]-n)/o;if(l[l.length-2]=(a(this,Tr)-i)/r,l[l.length-1]=(a(this,Rr)-n)/o,isNaN(s[6])&&!this.isEmpty())return E(this,re,zp).call(this,l);const h=new Float32Array(a(this,Js).length+24+a(this,Ts).length);let c=e.length;for(let f=0;f<c;f+=2){if(isNaN(e[f])){h[f]=h[f+1]=NaN;continue}h[f]=e[f],h[f+1]=e[f+1]}c=E(this,re,Up).call(this,h,c);for(let f=t.length-6;f>=6;f-=6)for(let u=0;u<6;u+=2){if(isNaN(t[f+u])){h[c]=h[c+1]=NaN,c+=2;continue}h[c]=t[f+u],h[c+1]=t[f+u+1],c+=2}return E(this,re,Hp).call(this,h,c),this.newFreeDrawOutline(h,l,a(this,Je),a(this,Ka),a(this,qa),a(this,Ya))}};Je=new WeakMap,Ts=new WeakMap,qa=new WeakMap,Ya=new WeakMap,Js=new WeakMap,_t=new WeakMap,Tr=new WeakMap,Rr=new WeakMap,th=new WeakMap,eh=new WeakMap,Ka=new WeakMap,Za=new WeakMap,yn=new WeakMap,sh=new WeakMap,Oc=new WeakMap,Bc=new WeakMap,re=new WeakSet,Oo=function(){const e=a(this,_t).subarray(4,6),t=a(this,_t).subarray(16,18),[s,i,n,r]=a(this,Je);return[(a(this,Tr)+(e[0]-t[0])/2-s)/n,(a(this,Rr)+(e[1]-t[1])/2-i)/r,(a(this,Tr)+(t[0]-e[0])/2-s)/n,(a(this,Rr)+(t[1]-e[1])/2-i)/r]},Np=function(){const[e,t,s,i]=a(this,Je),[n,r,o,l]=E(this,re,Oo).call(this);return`M${(a(this,_t)[2]-e)/s} ${(a(this,_t)[3]-t)/i} L${(a(this,_t)[4]-e)/s} ${(a(this,_t)[5]-t)/i} L${n} ${r} L${o} ${l} L${(a(this,_t)[16]-e)/s} ${(a(this,_t)[17]-t)/i} L${(a(this,_t)[14]-e)/s} ${(a(this,_t)[15]-t)/i} Z`},Op=function(e){const t=a(this,Ts);e.push(`L${t[4]} ${t[5]} Z`)},Bp=function(e){const[t,s,i,n]=a(this,Je),r=a(this,_t).subarray(4,6),o=a(this,_t).subarray(16,18),[l,h,c,d]=E(this,re,Oo).call(this);e.push(`L${(r[0]-t)/i} ${(r[1]-s)/n} L${l} ${h} L${c} ${d} L${(o[0]-t)/i} ${(o[1]-s)/n}`)},zp=function(e){const t=a(this,_t),[s,i,n,r]=a(this,Je),[o,l,h,c]=E(this,re,Oo).call(this),d=new Float32Array(36);return d.set([NaN,NaN,NaN,NaN,(t[2]-s)/n,(t[3]-i)/r,NaN,NaN,NaN,NaN,(t[4]-s)/n,(t[5]-i)/r,NaN,NaN,NaN,NaN,o,l,NaN,NaN,NaN,NaN,h,c,NaN,NaN,NaN,NaN,(t[16]-s)/n,(t[17]-i)/r,NaN,NaN,NaN,NaN,(t[14]-s)/n,(t[15]-i)/r],0),this.newFreeDrawOutline(d,e,a(this,Je),a(this,Ka),a(this,qa),a(this,Ya))},Hp=function(e,t){const s=a(this,Ts);return e.set([NaN,NaN,NaN,NaN,s[4],s[5]],t),t+=6},Up=function(e,t){const s=a(this,_t).subarray(4,6),i=a(this,_t).subarray(16,18),[n,r,o,l]=a(this,Je),[h,c,d,f]=E(this,re,Oo).call(this);return e.set([NaN,NaN,NaN,NaN,(s[0]-n)/o,(s[1]-r)/l,NaN,NaN,NaN,NaN,h,c,NaN,NaN,NaN,NaN,d,f,NaN,NaN,NaN,NaN,(i[0]-n)/o,(i[1]-r)/l],t),t+=24},S(di,sh,8),S(di,Oc,2),S(di,Bc,a(di,sh)+a(di,Oc));let _c=di;var Ja,Ir,Mi,ih,Qe,nh,Xt,zc,Gp;class jp extends nt{constructor(t,s,i,n,r,o){super();S(this,zc);S(this,Ja);S(this,Ir,new Float32Array(4));S(this,Mi);S(this,ih);S(this,Qe);S(this,nh);S(this,Xt);y(this,Xt,t),y(this,Qe,s),y(this,Ja,i),y(this,nh,n),y(this,Mi,r),y(this,ih,o),this.lastPoint=[NaN,NaN],E(this,zc,Gp).call(this,o);const[l,h,c,d]=a(this,Ir);for(let f=0,u=t.length;f<u;f+=2)t[f]=(t[f]-l)/c,t[f+1]=(t[f+1]-h)/d;for(let f=0,u=s.length;f<u;f+=2)s[f]=(s[f]-l)/c,s[f+1]=(s[f+1]-h)/d}toSVGPath(){const t=[`M${a(this,Xt)[4]} ${a(this,Xt)[5]}`];for(let s=6,i=a(this,Xt).length;s<i;s+=6){if(isNaN(a(this,Xt)[s])){t.push(`L${a(this,Xt)[s+4]} ${a(this,Xt)[s+5]}`);continue}t.push(`C${a(this,Xt)[s]} ${a(this,Xt)[s+1]} ${a(this,Xt)[s+2]} ${a(this,Xt)[s+3]} ${a(this,Xt)[s+4]} ${a(this,Xt)[s+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,s,i,n],r){const o=i-t,l=n-s;let h,c;switch(r){case 0:h=nt._rescale(a(this,Xt),t,n,o,-l),c=nt._rescale(a(this,Qe),t,n,o,-l);break;case 90:h=nt._rescaleAndSwap(a(this,Xt),t,s,o,l),c=nt._rescaleAndSwap(a(this,Qe),t,s,o,l);break;case 180:h=nt._rescale(a(this,Xt),i,s,-o,l),c=nt._rescale(a(this,Qe),i,s,-o,l);break;case 270:h=nt._rescaleAndSwap(a(this,Xt),i,n,-o,-l),c=nt._rescaleAndSwap(a(this,Qe),i,n,-o,-l);break}return{outline:Array.from(h),points:[Array.from(c)]}}get box(){return a(this,Ir)}newOutliner(t,s,i,n,r,o=0){return new _c(t,s,i,n,r,o)}getNewOutline(t,s){const[i,n,r,o]=a(this,Ir),[l,h,c,d]=a(this,Ja),f=r*c,u=o*d,m=i*c+l,p=n*d+h,_=this.newOutliner({x:a(this,Qe)[0]*f+m,y:a(this,Qe)[1]*u+p},a(this,Ja),a(this,nh),t,a(this,ih),s??a(this,Mi));for(let b=2;b<a(this,Qe).length;b+=2)_.add({x:a(this,Qe)[b]*f+m,y:a(this,Qe)[b+1]*u+p});return _.getOutlines()}}Ja=new WeakMap,Ir=new WeakMap,Mi=new WeakMap,ih=new WeakMap,Qe=new WeakMap,nh=new WeakMap,Xt=new WeakMap,zc=new WeakSet,Gp=function(t){const s=a(this,Xt);let i=s[4],n=s[5];const r=[i,n,i,n];let o=i,l=n;const h=t?Math.max:Math.min;for(let d=6,f=s.length;d<f;d+=6){const u=s[d+4],m=s[d+5];if(isNaN(s[d]))lt.pointBoundingBox(u,m,r),l<m?(o=u,l=m):l===m&&(o=h(o,u));else{const p=[1/0,1/0,-1/0,-1/0];lt.bezierBoundingBox(i,n,...s.slice(d,d+6),p),lt.rectBoundingBox(...p,r),l<p[3]?(o=p[2],l=p[3]):l===p[3]&&(o=h(o,p[2]))}i=u,n=m}const c=a(this,Ir);c[0]=r[0]-a(this,Mi),c[1]=r[1]-a(this,Mi),c[2]=r[2]-r[0]+2*a(this,Mi),c[3]=r[3]-r[1]+2*a(this,Mi),this.lastPoint=[o,l]};var rh,ah,_n,Rs,Ne,$p,ic,Wp,Vp,Zd;class Kd{constructor(e,t=0,s=0,i=!0){S(this,Ne);S(this,rh);S(this,ah);S(this,_n,[]);S(this,Rs,[]);const n=[1/0,1/0,-1/0,-1/0],o=10**-4;for(const{x:m,y:p,width:_,height:b}of e){const A=Math.floor((m-t)/o)*o,x=Math.ceil((m+_+t)/o)*o,k=Math.floor((p-t)/o)*o,C=Math.ceil((p+b+t)/o)*o,P=[A,k,C,!0],R=[x,k,C,!1];a(this,_n).push(P,R),lt.rectBoundingBox(A,k,x,C,n)}const l=n[2]-n[0]+2*s,h=n[3]-n[1]+2*s,c=n[0]-s,d=n[1]-s,f=a(this,_n).at(i?-1:-2),u=[f[0],f[2]];for(const m of a(this,_n)){const[p,_,b]=m;m[0]=(p-c)/l,m[1]=(_-d)/h,m[2]=(b-d)/h}y(this,rh,new Float32Array([c,d,l,h])),y(this,ah,u)}getOutlines(){a(this,_n).sort((t,s)=>t[0]-s[0]||t[1]-s[1]||t[2]-s[2]);const e=[];for(const t of a(this,_n))t[3]?(e.push(...E(this,Ne,Zd).call(this,t)),E(this,Ne,Wp).call(this,t)):(E(this,Ne,Vp).call(this,t),e.push(...E(this,Ne,Zd).call(this,t)));return E(this,Ne,$p).call(this,e)}}rh=new WeakMap,ah=new WeakMap,_n=new WeakMap,Rs=new WeakMap,Ne=new WeakSet,$p=function(e){const t=[],s=new Set;for(const r of e){const[o,l,h]=r;t.push([o,l,r],[o,h,r])}t.sort((r,o)=>r[1]-o[1]||r[0]-o[0]);for(let r=0,o=t.length;r<o;r+=2){const l=t[r][2],h=t[r+1][2];l.push(h),h.push(l),s.add(l),s.add(h)}const i=[];let n;for(;s.size>0;){const r=s.values().next().value;let[o,l,h,c,d]=r;s.delete(r);let f=o,u=l;for(n=[o,h],i.push(n);;){let m;if(s.has(c))m=c;else if(s.has(d))m=d;else break;s.delete(m),[o,l,h,c,d]=m,f!==o&&(n.push(f,u,o,u===l?l:h),f=o),u=u===l?h:l}n.push(f,u)}return new pb(i,a(this,rh),a(this,ah))},ic=function(e){const t=a(this,Rs);let s=0,i=t.length-1;for(;s<=i;){const n=s+i>>1,r=t[n][0];if(r===e)return n;r<e?s=n+1:i=n-1}return i+1},Wp=function([,e,t]){const s=E(this,Ne,ic).call(this,e);a(this,Rs).splice(s,0,[e,t])},Vp=function([,e,t]){const s=E(this,Ne,ic).call(this,e);for(let i=s;i<a(this,Rs).length;i++){const[n,r]=a(this,Rs)[i];if(n!==e)break;if(n===e&&r===t){a(this,Rs).splice(i,1);return}}for(let i=s-1;i>=0;i--){const[n,r]=a(this,Rs)[i];if(n!==e)break;if(n===e&&r===t){a(this,Rs).splice(i,1);return}}},Zd=function(e){const[t,s,i]=e,n=[[t,s,i]],r=E(this,Ne,ic).call(this,i);for(let o=0;o<r;o++){const[l,h]=a(this,Rs)[o];for(let c=0,d=n.length;c<d;c++){const[,f,u]=n[c];if(!(h<=f||u<=l)){if(f>=l){if(u>h)n[c][1]=h;else{if(d===1)return[];n.splice(c,1),c--,d--}continue}n[c][2]=l,u>h&&n.push([t,h,u])}}}return n};var oh,Qa;class pb extends nt{constructor(t,s,i){super();S(this,oh);S(this,Qa);y(this,Qa,t),y(this,oh,s),this.lastPoint=i}toSVGPath(){const t=[];for(const s of a(this,Qa)){let[i,n]=s;t.push(`M${i} ${n}`);for(let r=2;r<s.length;r+=2){const o=s[r],l=s[r+1];o===i?(t.push(`V${l}`),n=l):l===n&&(t.push(`H${o}`),i=o)}t.push("Z")}return t.join(" ")}serialize([t,s,i,n],r){const o=[],l=i-t,h=n-s;for(const c of a(this,Qa)){const d=new Array(c.length);for(let f=0;f<c.length;f+=2)d[f]=t+c[f]*l,d[f+1]=n-c[f+1]*h;o.push(d)}return o}get box(){return a(this,oh)}get classNamesForOutlining(){return["highlightOutline"]}}oh=new WeakMap,Qa=new WeakMap;class Jd extends _c{newFreeDrawOutline(e,t,s,i,n,r){return new gb(e,t,s,i,n,r)}}class gb extends jp{newOutliner(e,t,s,i,n,r=0){return new Jd(e,t,s,i,n,r)}}var Is,Pr,to,ne,lh,eo,hh,ch,wn,Ps,so,dh,Pt,Qd,tu,eu,Bn,Xp,Vi;const He=class He{constructor({editor:e=null,uiManager:t=null}){S(this,Pt);S(this,Is,null);S(this,Pr,null);S(this,to);S(this,ne,null);S(this,lh,!1);S(this,eo,!1);S(this,hh,null);S(this,ch);S(this,wn,null);S(this,Ps,null);S(this,so);var s;e?(y(this,eo,!1),y(this,so,At.HIGHLIGHT_COLOR),y(this,hh,e)):(y(this,eo,!0),y(this,so,At.HIGHLIGHT_DEFAULT_COLOR)),y(this,Ps,(e==null?void 0:e._uiManager)||t),y(this,ch,a(this,Ps)._eventBus),y(this,to,(e==null?void 0:e.color)||((s=a(this,Ps))==null?void 0:s.highlightColors.values().next().value)||"#FFFF98"),a(He,dh)||y(He,dh,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return wt(this,"_keyboardManager",new vh([[["Escape","mac+Escape"],He.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],He.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],He.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],He.prototype._moveToPrevious],[["Home","mac+Home"],He.prototype._moveToBeginning],[["End","mac+End"],He.prototype._moveToEnd]]))}renderButton(){const e=y(this,Is,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);const t=a(this,Ps)._signal;e.addEventListener("click",E(this,Pt,Bn).bind(this),{signal:t}),e.addEventListener("keydown",E(this,Pt,eu).bind(this),{signal:t});const s=y(this,Pr,document.createElement("span"));return s.className="swatch",s.setAttribute("aria-hidden",!0),s.style.backgroundColor=a(this,to),e.append(s),e}renderMainDropdown(){const e=y(this,ne,E(this,Pt,Qd).call(this));return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}_colorSelectFromKeyboard(e){if(e.target===a(this,Is)){E(this,Pt,Bn).call(this,e);return}const t=e.target.getAttribute("data-color");t&&E(this,Pt,tu).call(this,t,e)}_moveToNext(e){var t,s;if(!a(this,Pt,Vi)){E(this,Pt,Bn).call(this,e);return}if(e.target===a(this,Is)){(t=a(this,ne).firstChild)==null||t.focus();return}(s=e.target.nextSibling)==null||s.focus()}_moveToPrevious(e){var t,s;if(e.target===((t=a(this,ne))==null?void 0:t.firstChild)||e.target===a(this,Is)){a(this,Pt,Vi)&&this._hideDropdownFromKeyboard();return}a(this,Pt,Vi)||E(this,Pt,Bn).call(this,e),(s=e.target.previousSibling)==null||s.focus()}_moveToBeginning(e){var t;if(!a(this,Pt,Vi)){E(this,Pt,Bn).call(this,e);return}(t=a(this,ne).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!a(this,Pt,Vi)){E(this,Pt,Bn).call(this,e);return}(t=a(this,ne).lastChild)==null||t.focus()}hideDropdown(){var e,t;(e=a(this,ne))==null||e.classList.add("hidden"),(t=a(this,wn))==null||t.abort(),y(this,wn,null)}_hideDropdownFromKeyboard(){var e;if(!a(this,eo)){if(!a(this,Pt,Vi)){(e=a(this,hh))==null||e.unselect();return}this.hideDropdown(),a(this,Is).focus({preventScroll:!0,focusVisible:a(this,lh)})}}updateColor(e){if(a(this,Pr)&&(a(this,Pr).style.backgroundColor=e),!a(this,ne))return;const t=a(this,Ps).highlightColors.values();for(const s of a(this,ne).children)s.setAttribute("aria-selected",t.next().value===e)}destroy(){var e,t;(e=a(this,Is))==null||e.remove(),y(this,Is,null),y(this,Pr,null),(t=a(this,ne))==null||t.remove(),y(this,ne,null)}};Is=new WeakMap,Pr=new WeakMap,to=new WeakMap,ne=new WeakMap,lh=new WeakMap,eo=new WeakMap,hh=new WeakMap,ch=new WeakMap,wn=new WeakMap,Ps=new WeakMap,so=new WeakMap,dh=new WeakMap,Pt=new WeakSet,Qd=function(){const e=document.createElement("div"),t=a(this,Ps)._signal;e.addEventListener("contextmenu",Ns,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[s,i]of a(this,Ps).highlightColors){const n=document.createElement("button");n.tabIndex="0",n.role="option",n.setAttribute("data-color",i),n.title=s,n.setAttribute("data-l10n-id",a(He,dh)[s]);const r=document.createElement("span");n.append(r),r.className="swatch",r.style.backgroundColor=i,n.setAttribute("aria-selected",i===a(this,to)),n.addEventListener("click",E(this,Pt,tu).bind(this,i),{signal:t}),e.append(n)}return e.addEventListener("keydown",E(this,Pt,eu).bind(this),{signal:t}),e},tu=function(e,t){t.stopPropagation(),a(this,ch).dispatch("switchannotationeditorparams",{source:this,type:a(this,so),value:e})},eu=function(e){He._keyboardManager.exec(this,e)},Bn=function(e){if(a(this,Pt,Vi)){this.hideDropdown();return}if(y(this,lh,e.detail===0),a(this,wn)||(y(this,wn,new AbortController),window.addEventListener("pointerdown",E(this,Pt,Xp).bind(this),{signal:a(this,Ps).combinedSignal(a(this,wn))})),a(this,ne)){a(this,ne).classList.remove("hidden");return}const t=y(this,ne,E(this,Pt,Qd).call(this));a(this,Is).append(t)},Xp=function(e){var t;(t=a(this,ne))!=null&&t.contains(e.target)||this.hideDropdown()},Vi=function(){return a(this,ne)&&!a(this,ne).classList.contains("hidden")},S(He,dh,null);let wc=He;var io,uh,Di,Lr,no,Ge,fh,ph,Mr,gs,ts,ge,ro,Fi,xe,ao,ms,gh,gt,su,nc,qp,Yp,Kp,iu,zn,_s,na,Zp,rc,Bo,Jp,Qp,tg,eg,sg;const Ct=class Ct extends Nt{constructor(t){super({...t,name:"highlightEditor"});S(this,gt);S(this,io,null);S(this,uh,0);S(this,Di);S(this,Lr,null);S(this,no,null);S(this,Ge,null);S(this,fh,null);S(this,ph,0);S(this,Mr,null);S(this,gs,null);S(this,ts,null);S(this,ge,!1);S(this,ro,null);S(this,Fi);S(this,xe,null);S(this,ao,"");S(this,ms);S(this,gh,"");this.color=t.color||Ct._defaultColor,y(this,ms,t.thickness||Ct._defaultThickness),y(this,Fi,t.opacity||Ct._defaultOpacity),y(this,Di,t.boxes||null),y(this,gh,t.methodOfCreation||""),y(this,ao,t.text||""),this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(y(this,ge,!0),E(this,gt,nc).call(this,t),E(this,gt,zn).call(this)):a(this,Di)&&(y(this,io,t.anchorNode),y(this,uh,t.anchorOffset),y(this,fh,t.focusNode),y(this,ph,t.focusOffset),E(this,gt,su).call(this),E(this,gt,zn).call(this),this.rotate(this.rotation))}static get _keyboardManager(){const t=Ct.prototype;return wt(this,"_keyboardManager",new vh([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:a(this,ge)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:a(this,ms),methodOfCreation:a(this,gh)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,s){var i;Nt.initialize(t,s),Ct._defaultColor||(Ct._defaultColor=((i=s.highlightColors)==null?void 0:i.values().next().value)||"#fff066")}static updateDefaultParams(t,s){switch(t){case At.HIGHLIGHT_DEFAULT_COLOR:Ct._defaultColor=s;break;case At.HIGHLIGHT_THICKNESS:Ct._defaultThickness=s;break}}translateInPage(t,s){}get toolbarPosition(){return a(this,ro)}updateParams(t,s){switch(t){case At.HIGHLIGHT_COLOR:E(this,gt,qp).call(this,s);break;case At.HIGHLIGHT_THICKNESS:E(this,gt,Yp).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[At.HIGHLIGHT_DEFAULT_COLOR,Ct._defaultColor],[At.HIGHLIGHT_THICKNESS,Ct._defaultThickness]]}get propertiesToUpdate(){return[[At.HIGHLIGHT_COLOR,this.color||Ct._defaultColor],[At.HIGHLIGHT_THICKNESS,a(this,ms)||Ct._defaultThickness],[At.HIGHLIGHT_FREE,a(this,ge)]]}async addEditToolbar(){const t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(y(this,no,new wc({editor:this})),t.addColorPicker(a(this,no))),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(E(this,gt,Bo).call(this))}getBaseTranslation(){return[0,0]}getRect(t,s){return super.getRect(t,s,E(this,gt,Bo).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){E(this,gt,iu).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(E(this,gt,zn).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let s=!1;this.parent&&!t?E(this,gt,iu).call(this):t&&(E(this,gt,zn).call(this,t),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),s&&this.select()}rotate(t){var n,r,o;const{drawLayer:s}=this.parent;let i;a(this,ge)?(t=(t-this.rotation+360)%360,i=E(n=Ct,_s,na).call(n,a(this,gs).box,t)):i=E(r=Ct,_s,na).call(r,[this.x,this.y,this.width,this.height],t),s.updateProperties(a(this,ts),{bbox:i,root:{"data-main-rotation":t}}),s.updateProperties(a(this,xe),{bbox:E(o=Ct,_s,na).call(o,a(this,Ge).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();a(this,ao)&&(t.setAttribute("aria-label",a(this,ao)),t.setAttribute("role","mark")),a(this,ge)?t.classList.add("free"):this.div.addEventListener("keydown",E(this,gt,Zp).bind(this),{signal:this._uiManager._signal});const s=y(this,Mr,document.createElement("div"));t.append(s),s.setAttribute("aria-hidden","true"),s.className="internal",s.style.clipPath=a(this,Lr);const[i,n]=this.parentDimensions;return this.setDims(this.width*i,this.height*n),vf(this,a(this,Mr),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(a(this,xe),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(a(this,xe),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:E(this,gt,rc).call(this,!0);break;case 1:case 3:E(this,gt,rc).call(this,!1);break}}select(){var t;super.select(),a(this,xe)&&((t=this.parent)==null||t.drawLayer.updateProperties(a(this,xe),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),a(this,xe)&&((t=this.parent)==null||t.drawLayer.updateProperties(a(this,xe),{rootClass:{selected:!1}}),a(this,ge)||E(this,gt,rc).call(this,!1))}get _mustFixPosition(){return!a(this,ge)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(a(this,ts),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(a(this,xe),{rootClass:{hidden:!t}}))}static startHighlighting(t,s,{target:i,x:n,y:r}){const{x:o,y:l,width:h,height:c}=i.getBoundingClientRect(),d=new AbortController,f=t.combinedSignal(d),u=m=>{d.abort(),E(this,_s,eg).call(this,t,m)};window.addEventListener("blur",u,{signal:f}),window.addEventListener("pointerup",u,{signal:f}),window.addEventListener("pointerdown",Jt,{capture:!0,passive:!1,signal:f}),window.addEventListener("contextmenu",Ns,{signal:f}),i.addEventListener("pointermove",E(this,_s,tg).bind(this,t),{signal:f}),this._freeHighlight=new Jd({x:n,y:r},[o,l,h,c],t.scale,this._defaultThickness/2,s,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,s,i){var p,_,b,A;let n=null;if(t instanceof Rp){const{data:{quadPoints:x,rect:k,rotation:C,id:P,color:R,opacity:D,popupRef:M},parent:{page:{pageNumber:U}}}=t;n=t={annotationType:ft.HIGHLIGHT,color:Array.from(R),opacity:D,quadPoints:x,boxes:null,pageIndex:U-1,rect:k.slice(0),rotation:C,id:P,deleted:!1,popupRef:M}}else if(t instanceof Iu){const{data:{inkLists:x,rect:k,rotation:C,id:P,color:R,borderStyle:{rawWidth:D},popupRef:M},parent:{page:{pageNumber:U}}}=t;n=t={annotationType:ft.HIGHLIGHT,color:Array.from(R),thickness:D,inkLists:x,boxes:null,pageIndex:U-1,rect:k.slice(0),rotation:C,id:P,deleted:!1,popupRef:M}}const{color:r,quadPoints:o,inkLists:l,opacity:h}=t,c=await super.deserialize(t,s,i);c.color=lt.makeHexColor(...r),y(c,Fi,h||1),l&&y(c,ms,t.thickness),c.annotationElementId=t.id||null,c._initialData=n;const[d,f]=c.pageDimensions,[u,m]=c.pageTranslation;if(o){const x=y(c,Di,[]);for(let k=0;k<o.length;k+=8)x.push({x:(o[k]-u)/d,y:1-(o[k+1]-m)/f,width:(o[k+2]-o[k])/d,height:(o[k+1]-o[k+5])/f});E(p=c,gt,su).call(p),E(_=c,gt,zn).call(_),c.rotate(c.rotation)}else if(l){y(c,ge,!0);const x=l[0],k={x:x[0]-u,y:f-(x[1]-m)},C=new Jd(k,[0,0,d,f],1,a(c,ms)/2,!0,.001);for(let D=0,M=x.length;D<M;D+=2)k.x=x[D]-u,k.y=f-(x[D+1]-m),C.add(k);const{id:P,clipPathId:R}=s.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:c.color,"fill-opacity":c._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:C.toSVGPath()}},!0,!0);E(b=c,gt,nc).call(b,{highlightOutlines:C.getOutlines(),highlightId:P,clipPathId:R}),E(A=c,gt,zn).call(A),c.rotate(c.parentRotation)}return c}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const s=this.getRect(0,0),i=Nt._colorManager.convert(this.color),n={annotationType:ft.HIGHLIGHT,color:i,opacity:a(this,Fi),thickness:a(this,ms),quadPoints:E(this,gt,Jp).call(this),outlines:E(this,gt,Qp).call(this,s),pageIndex:this.pageIndex,rect:s,rotation:E(this,gt,Bo).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!E(this,gt,sg).call(this,n)?null:(n.id=this.annotationElementId,n)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};io=new WeakMap,uh=new WeakMap,Di=new WeakMap,Lr=new WeakMap,no=new WeakMap,Ge=new WeakMap,fh=new WeakMap,ph=new WeakMap,Mr=new WeakMap,gs=new WeakMap,ts=new WeakMap,ge=new WeakMap,ro=new WeakMap,Fi=new WeakMap,xe=new WeakMap,ao=new WeakMap,ms=new WeakMap,gh=new WeakMap,gt=new WeakSet,su=function(){const t=new Kd(a(this,Di),.001);y(this,gs,t.getOutlines()),[this.x,this.y,this.width,this.height]=a(this,gs).box;const s=new Kd(a(this,Di),.0025,.001,this._uiManager.direction==="ltr");y(this,Ge,s.getOutlines());const{lastPoint:i}=a(this,Ge);y(this,ro,[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height])},nc=function({highlightOutlines:t,highlightId:s,clipPathId:i}){var d,f;if(y(this,gs,t),y(this,Ge,t.getNewOutline(a(this,ms)/2+1.5,.0025)),s>=0)y(this,ts,s),y(this,Lr,i),this.parent.drawLayer.finalizeDraw(s,{bbox:t.box,path:{d:t.toSVGPath()}}),y(this,xe,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:a(this,Ge).box,path:{d:a(this,Ge).toSVGPath()}},!0));else if(this.parent){const u=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(a(this,ts),{bbox:E(d=Ct,_s,na).call(d,a(this,gs).box,(u-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(a(this,xe),{bbox:E(f=Ct,_s,na).call(f,a(this,Ge).box,u),path:{d:a(this,Ge).toSVGPath()}})}const[r,o,l,h]=t.box;switch(this.rotation){case 0:this.x=r,this.y=o,this.width=l,this.height=h;break;case 90:{const[u,m]=this.parentDimensions;this.x=o,this.y=1-r,this.width=l*m/u,this.height=h*u/m;break}case 180:this.x=1-r,this.y=1-o,this.width=l,this.height=h;break;case 270:{const[u,m]=this.parentDimensions;this.x=1-o,this.y=r,this.width=l*m/u,this.height=h*u/m;break}}const{lastPoint:c}=a(this,Ge);y(this,ro,[(c[0]-r)/l,(c[1]-o)/h])},qp=function(t){const s=(r,o)=>{var l,h;this.color=r,y(this,Fi,o),(l=this.parent)==null||l.drawLayer.updateProperties(a(this,ts),{root:{fill:r,"fill-opacity":o}}),(h=a(this,no))==null||h.updateColor(r)},i=this.color,n=a(this,Fi);this.addCommands({cmd:s.bind(this,t,Ct._defaultOpacity),undo:s.bind(this,i,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:At.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)},Yp=function(t){const s=a(this,ms),i=n=>{y(this,ms,n),E(this,gt,Kp).call(this,n)};this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:At.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},Kp=function(t){if(!a(this,ge))return;E(this,gt,nc).call(this,{highlightOutlines:a(this,gs).getNewOutline(t/2)}),this.fixAndSetPosition();const[s,i]=this.parentDimensions;this.setDims(this.width*s,this.height*i)},iu=function(){a(this,ts)===null||!this.parent||(this.parent.drawLayer.remove(a(this,ts)),y(this,ts,null),this.parent.drawLayer.remove(a(this,xe)),y(this,xe,null))},zn=function(t=this.parent){a(this,ts)===null&&({id:ke(this,ts)._,clipPathId:ke(this,Lr)._}=t.drawLayer.draw({bbox:a(this,gs).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":a(this,Fi)},rootClass:{highlight:!0,free:a(this,ge)},path:{d:a(this,gs).toSVGPath()}},!1,!0),y(this,xe,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:a(this,ge)},bbox:a(this,Ge).box,path:{d:a(this,Ge).toSVGPath()}},a(this,ge))),a(this,Mr)&&(a(this,Mr).style.clipPath=a(this,Lr)))},_s=new WeakSet,na=function([t,s,i,n],r){switch(r){case 90:return[1-s-n,t,n,i];case 180:return[1-t-i,1-s-n,i,n];case 270:return[s,1-t-i,n,i]}return[t,s,i,n]},Zp=function(t){Ct._keyboardManager.exec(this,t)},rc=function(t){if(!a(this,io))return;const s=window.getSelection();t?s.setPosition(a(this,io),a(this,uh)):s.setPosition(a(this,fh),a(this,ph))},Bo=function(){return a(this,ge)?this.rotation:0},Jp=function(){if(a(this,ge))return null;const[t,s]=this.pageDimensions,[i,n]=this.pageTranslation,r=a(this,Di),o=new Float32Array(r.length*8);let l=0;for(const{x:h,y:c,width:d,height:f}of r){const u=h*t+i,m=(1-c)*s+n;o[l]=o[l+4]=u,o[l+1]=o[l+3]=m,o[l+2]=o[l+6]=u+d*t,o[l+5]=o[l+7]=m-f*s,l+=8}return o},Qp=function(t){return a(this,gs).serialize(t,E(this,gt,Bo).call(this))},tg=function(t,s){this._freeHighlight.add(s)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},eg=function(t,s){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(s,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},sg=function(t){const{color:s}=this._initialData;return t.color.some((i,n)=>i!==s[n])},S(Ct,_s),K(Ct,"_defaultColor",null),K(Ct,"_defaultOpacity",1),K(Ct,"_defaultThickness",12),K(Ct,"_type","highlight"),K(Ct,"_editorType",ft.HIGHLIGHT),K(Ct,"_freeHighlightId",-1),K(Ct,"_freeHighlight",null),K(Ct,"_freeHighlightClipId","");let Ac=Ct;var Dr;class ig{constructor(){S(this,Dr,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,s]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,s)}updateSVGProperty(e,t){a(this,Dr)[e]=t}toSVGProperties(){const e=a(this,Dr);return y(this,Dr,Object.create(null)),{root:e}}reset(){y(this,Dr,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){Lt("Not implemented")}}Dr=new WeakMap;var es,oo,le,Fr,Nr,An,vn,Sn,Or,St,nu,ru,au,zo,ng,ac,Ho,ra;const at=class at extends Nt{constructor(t){super(t);S(this,St);S(this,es,null);S(this,oo);K(this,"_drawId",null);y(this,oo,t.mustBeCommitted||!1),this._addOutlines(t)}_addOutlines(t){t.drawOutlines&&(E(this,St,nu).call(this,t),E(this,St,zo).call(this))}static _mergeSVGProperties(t,s){const i=new Set(Object.keys(t));for(const[n,r]of Object.entries(s))i.has(n)?Object.assign(t[n],r):t[n]=r;return t}static getDefaultDrawingOptions(t){Lt("Not implemented")}static get typesMap(){Lt("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,s){const i=this.typesMap.get(t);i&&this._defaultDrawingOptions.updateProperty(i,s),this._currentParent&&(a(at,le).updateProperty(i,s),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,s){const i=this.constructor.typesMap.get(t);i&&this._updateProperty(t,i,s)}static get defaultPropertiesToUpdate(){const t=[],s=this._defaultDrawingOptions;for(const[i,n]of this.typesMap)t.push([i,s[n]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:s}=this;for(const[i,n]of this.constructor.typesMap)t.push([i,s[n]]);return t}_updateProperty(t,s,i){const n=this._drawingOptions,r=n[s],o=l=>{var c;n.updateProperty(s,l);const h=a(this,es).updateProperty(s,l);h&&E(this,St,Ho).call(this,h),(c=this.parent)==null||c.drawLayer.updateProperties(this._drawId,n.toSVGProperties())};this.addCommands({cmd:o.bind(this,i),undo:o.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,at._mergeSVGProperties(a(this,es).getPathResizingSVGProperties(E(this,St,ac).call(this)),{bbox:E(this,St,ra).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,at._mergeSVGProperties(a(this,es).getPathResizedSVGProperties(E(this,St,ac).call(this)),{bbox:E(this,St,ra).call(this)}))}_onTranslating(t,s){var i;(i=this.parent)==null||i.drawLayer.updateProperties(this._drawId,{bbox:E(this,St,ra).call(this)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,at._mergeSVGProperties(a(this,es).getPathTranslatedSVGProperties(E(this,St,ac).call(this),this.parentDimensions),{bbox:E(this,St,ra).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,a(this,oo)&&(y(this,oo,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){E(this,St,au).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(E(this,St,zo).call(this),E(this,St,Ho).call(this,a(this,es).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let s=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),E(this,St,au).call(this)):t&&(this._uiManager.addShouldRescale(this),E(this,St,zo).call(this,t),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),s&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,at._mergeSVGProperties({bbox:E(this,St,ra).call(this)},a(this,es).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&E(this,St,Ho).call(this,a(this,es).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,s;this._isCopy&&(t=this.x,s=this.y);const i=super.render();i.classList.add("draw");const n=document.createElement("div");i.append(n),n.setAttribute("aria-hidden","true"),n.className="internal";const[r,o]=this.parentDimensions;return this.setDims(this.width*r,this.height*o),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,s),i}static createDrawerInstance(t,s,i,n,r){Lt("Not implemented")}static startDrawing(t,s,i,n){var _;const{target:r,offsetX:o,offsetY:l,pointerId:h,pointerType:c}=n;if(a(at,vn)&&a(at,vn)!==c)return;const{viewport:{rotation:d}}=t,{width:f,height:u}=r.getBoundingClientRect(),m=y(at,Fr,new AbortController),p=t.combinedSignal(m);if(a(at,An)||y(at,An,h),a(at,vn)??y(at,vn,c),window.addEventListener("pointerup",b=>{var A;a(at,An)===b.pointerId?this._endDraw(b):(A=a(at,Sn))==null||A.delete(b.pointerId)},{signal:p}),window.addEventListener("pointercancel",b=>{var A;a(at,An)===b.pointerId?this._currentParent.endDrawingSession():(A=a(at,Sn))==null||A.delete(b.pointerId)},{signal:p}),window.addEventListener("pointerdown",b=>{a(at,vn)===b.pointerType&&((a(at,Sn)||y(at,Sn,new Set)).add(b.pointerId),a(at,le).isCancellable()&&(a(at,le).removeLastElement(),a(at,le).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:p}),window.addEventListener("contextmenu",Ns,{signal:p}),r.addEventListener("pointermove",this._drawMove.bind(this),{signal:p}),r.addEventListener("touchmove",b=>{b.timeStamp===a(at,Or)&&Jt(b)},{signal:p}),t.toggleDrawing(),(_=s._editorUndoBar)==null||_.hide(),a(at,le)){t.drawLayer.updateProperties(this._currentDrawId,a(at,le).startNew(o,l,f,u,d));return}s.updateUIForDefaultProperties(this),y(at,le,this.createDrawerInstance(o,l,f,u,d)),y(at,Nr,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(a(at,Nr).toSVGProperties(),a(at,le).defaultSVGProperties),!0,!1)}static _drawMove(t){var r;if(y(at,Or,-1),!a(at,le))return;const{offsetX:s,offsetY:i,pointerId:n}=t;if(a(at,An)===n){if(((r=a(at,Sn))==null?void 0:r.size)>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,a(at,le).add(s,i)),y(at,Or,t.timeStamp),Jt(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,y(at,le,null),y(at,Nr,null),y(at,vn,null),y(at,Or,NaN)),a(at,Fr)&&(a(at,Fr).abort(),y(at,Fr,null),y(at,An,NaN),y(at,Sn,null))}static _endDraw(t){const s=this._currentParent;if(s){if(s.toggleDrawing(!0),this._cleanup(!1),(t==null?void 0:t.target)===s.div&&s.drawLayer.updateProperties(this._currentDrawId,a(at,le).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const i=a(at,le),n=this._currentDrawId,r=i.getLastElement();s.addCommands({cmd:()=>{s.drawLayer.updateProperties(n,i.setLastElement(r))},undo:()=>{s.drawLayer.updateProperties(n,i.removeLastElement())},mustExec:!1,type:At.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const s=this._currentParent;if(!s)return null;if(s.toggleDrawing(!0),s.cleanUndoStack(At.DRAW_STEP),!a(at,le).isEmpty()){const{pageDimensions:[i,n],scale:r}=s,o=s.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:a(at,le).getOutlines(i*r,n*r,r,this._INNER_MARGIN),drawingOptions:a(at,Nr),mustBeCommitted:!t});return this._cleanup(!0),o}return s.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,s,i,n,r,o){Lt("Not implemented")}static async deserialize(t,s,i){var d,f;const{rawDims:{pageWidth:n,pageHeight:r,pageX:o,pageY:l}}=s.viewport,h=this.deserializeDraw(o,l,n,r,this._INNER_MARGIN,t),c=await super.deserialize(t,s,i);return c.createDrawingOptions(t),E(d=c,St,nu).call(d,{drawOutlines:h}),E(f=c,St,zo).call(f),c.onScaleChanging(),c.rotate(),c}serializeDraw(t){const[s,i]=this.pageTranslation,[n,r]=this.pageDimensions;return a(this,es).serialize([s,i,n,r],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};es=new WeakMap,oo=new WeakMap,le=new WeakMap,Fr=new WeakMap,Nr=new WeakMap,An=new WeakMap,vn=new WeakMap,Sn=new WeakMap,Or=new WeakMap,St=new WeakSet,nu=function({drawOutlines:t,drawId:s,drawingOptions:i}){y(this,es,t),this._drawingOptions||(this._drawingOptions=i),s>=0?(this._drawId=s,this.parent.drawLayer.finalizeDraw(s,t.defaultProperties)):this._drawId=E(this,St,ru).call(this,t,this.parent),E(this,St,Ho).call(this,t.box)},ru=function(t,s){const{id:i}=s.drawLayer.draw(at._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return i},au=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},zo=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=E(this,St,ru).call(this,a(this,es),t)}},ng=function([t,s,i,n]){const{parentDimensions:[r,o],rotation:l}=this;switch(l){case 90:return[s,1-t,i*(o/r),n*(r/o)];case 180:return[1-t,1-s,i,n];case 270:return[1-s,t,i*(o/r),n*(r/o)];default:return[t,s,i,n]}},ac=function(){const{x:t,y:s,width:i,height:n,parentDimensions:[r,o],rotation:l}=this;switch(l){case 90:return[1-s,t,i*(r/o),n*(o/r)];case 180:return[1-t,1-s,i,n];case 270:return[s,1-t,i*(r/o),n*(o/r)];default:return[t,s,i,n]}},Ho=function(t){if([this.x,this.y,this.width,this.height]=E(this,St,ng).call(this,t),this.div){this.fixAndSetPosition();const[s,i]=this.parentDimensions;this.setDims(this.width*s,this.height*i)}this._onResized()},ra=function(){const{x:t,y:s,width:i,height:n,rotation:r,parentRotation:o,parentDimensions:[l,h]}=this;switch((r*4+o)/90){case 1:return[1-s-n,t,n,i];case 2:return[1-t-i,1-s-n,i,n];case 3:return[s,1-t-i,n,i];case 4:return[t,s-i*(l/h),n*(h/l),i*(l/h)];case 5:return[1-s,t,i*(l/h),n*(h/l)];case 6:return[1-t-n*(h/l),1-s,n*(h/l),i*(l/h)];case 7:return[s-i*(l/h),1-t-n*(h/l),i*(l/h),n*(h/l)];case 8:return[t-i,s-n,i,n];case 9:return[1-s,t-i,n,i];case 10:return[1-t,1-s,i,n];case 11:return[s-n,1-t,n,i];case 12:return[t-n*(h/l),s,n*(h/l),i*(l/h)];case 13:return[1-s-i*(l/h),t-n*(h/l),i*(l/h),n*(h/l)];case 14:return[1-t,1-s-i*(l/h),n*(h/l),i*(l/h)];case 15:return[s,1-t,i*(l/h),n*(h/l)];default:return[t,s,i,n]}},K(at,"_currentDrawId",-1),K(at,"_currentParent",null),S(at,le,null),S(at,Fr,null),S(at,Nr,null),S(at,An,NaN),S(at,vn,null),S(at,Sn,null),S(at,Or,NaN),K(at,"_INNER_MARGIN",3);let vc=at;var Qs,he,ce,Br,lo,Ie,me,bs,zr,Hr,Ur,ho,oc;class mb{constructor(e,t,s,i,n,r){S(this,ho);S(this,Qs,new Float64Array(6));S(this,he);S(this,ce);S(this,Br);S(this,lo);S(this,Ie);S(this,me,"");S(this,bs,0);S(this,zr,new xh);S(this,Hr);S(this,Ur);y(this,Hr,s),y(this,Ur,i),y(this,Br,n),y(this,lo,r),[e,t]=E(this,ho,oc).call(this,e,t);const o=y(this,he,[NaN,NaN,NaN,NaN,e,t]);y(this,Ie,[e,t]),y(this,ce,[{line:o,points:a(this,Ie)}]),a(this,Qs).set(o,0)}updateProperty(e,t){e==="stroke-width"&&y(this,lo,t)}isEmpty(){return!a(this,ce)||a(this,ce).length===0}isCancellable(){return a(this,Ie).length<=10}add(e,t){[e,t]=E(this,ho,oc).call(this,e,t);const[s,i,n,r]=a(this,Qs).subarray(2,6),o=e-n,l=t-r;return Math.hypot(a(this,Hr)*o,a(this,Ur)*l)<=2?null:(a(this,Ie).push(e,t),isNaN(s)?(a(this,Qs).set([n,r,e,t],2),a(this,he).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(a(this,Qs)[0])&&a(this,he).splice(6,6),a(this,Qs).set([s,i,n,r,e,t],0),a(this,he).push(...nt.createBezierPoints(s,i,n,r,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const s=this.add(e,t);return s||(a(this,Ie).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,s,i,n){y(this,Hr,s),y(this,Ur,i),y(this,Br,n),[e,t]=E(this,ho,oc).call(this,e,t);const r=y(this,he,[NaN,NaN,NaN,NaN,e,t]);y(this,Ie,[e,t]);const o=a(this,ce).at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),a(this,ce).push({line:r,points:a(this,Ie)}),a(this,Qs).set(r,0),y(this,bs,0),this.toSVGPath(),null}getLastElement(){return a(this,ce).at(-1)}setLastElement(e){return a(this,ce)?(a(this,ce).push(e),y(this,he,e.line),y(this,Ie,e.points),y(this,bs,0),{path:{d:this.toSVGPath()}}):a(this,zr).setLastElement(e)}removeLastElement(){if(!a(this,ce))return a(this,zr).removeLastElement();a(this,ce).pop(),y(this,me,"");for(let e=0,t=a(this,ce).length;e<t;e++){const{line:s,points:i}=a(this,ce)[e];y(this,he,s),y(this,Ie,i),y(this,bs,0),this.toSVGPath()}return{path:{d:a(this,me)}}}toSVGPath(){const e=nt.svgRound(a(this,he)[4]),t=nt.svgRound(a(this,he)[5]);if(a(this,Ie).length===2)return y(this,me,`${a(this,me)} M ${e} ${t} Z`),a(this,me);if(a(this,Ie).length<=6){const i=a(this,me).lastIndexOf("M");y(this,me,`${a(this,me).slice(0,i)} M ${e} ${t}`),y(this,bs,6)}if(a(this,Ie).length===4){const i=nt.svgRound(a(this,he)[10]),n=nt.svgRound(a(this,he)[11]);return y(this,me,`${a(this,me)} L ${i} ${n}`),y(this,bs,12),a(this,me)}const s=[];a(this,bs)===0&&(s.push(`M ${e} ${t}`),y(this,bs,6));for(let i=a(this,bs),n=a(this,he).length;i<n;i+=6){const[r,o,l,h,c,d]=a(this,he).slice(i,i+6).map(nt.svgRound);s.push(`C${r} ${o} ${l} ${h} ${c} ${d}`)}return y(this,me,a(this,me)+s.join(" ")),y(this,bs,a(this,he).length),a(this,me)}getOutlines(e,t,s,i){const n=a(this,ce).at(-1);return n.line=new Float32Array(n.line),n.points=new Float32Array(n.points),a(this,zr).build(a(this,ce),e,t,s,a(this,Br),a(this,lo),i),y(this,Qs,null),y(this,he,null),y(this,ce,null),y(this,me,null),a(this,zr)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}Qs=new WeakMap,he=new WeakMap,ce=new WeakMap,Br=new WeakMap,lo=new WeakMap,Ie=new WeakMap,me=new WeakMap,bs=new WeakMap,zr=new WeakMap,Hr=new WeakMap,Ur=new WeakMap,ho=new WeakSet,oc=function(e,t){return nt._normalizePoint(e,t,a(this,Hr),a(this,Ur),a(this,Br))};var Pe,mh,bh,ss,ti,ei,co,uo,jr,ye,hi,rg,ag,og;class xh extends nt{constructor(){super(...arguments);S(this,ye);S(this,Pe);S(this,mh,0);S(this,bh);S(this,ss);S(this,ti);S(this,ei);S(this,co);S(this,uo);S(this,jr)}build(t,s,i,n,r,o,l){y(this,ti,s),y(this,ei,i),y(this,co,n),y(this,uo,r),y(this,jr,o),y(this,bh,l??0),y(this,ss,t),E(this,ye,ag).call(this)}get thickness(){return a(this,jr)}setLastElement(t){return a(this,ss).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return a(this,ss).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:s}of a(this,ss)){if(t.push(`M${nt.svgRound(s[4])} ${nt.svgRound(s[5])}`),s.length===6){t.push("Z");continue}if(s.length===12&&isNaN(s[6])){t.push(`L${nt.svgRound(s[10])} ${nt.svgRound(s[11])}`);continue}for(let i=6,n=s.length;i<n;i+=6){const[r,o,l,h,c,d]=s.subarray(i,i+6).map(nt.svgRound);t.push(`C${r} ${o} ${l} ${h} ${c} ${d}`)}}return t.join("")}serialize([t,s,i,n],r){const o=[],l=[],[h,c,d,f]=E(this,ye,rg).call(this);let u,m,p,_,b,A,x,k,C;switch(a(this,uo)){case 0:C=nt._rescale,u=t,m=s+n,p=i,_=-n,b=t+h*i,A=s+(1-c-f)*n,x=t+(h+d)*i,k=s+(1-c)*n;break;case 90:C=nt._rescaleAndSwap,u=t,m=s,p=i,_=n,b=t+c*i,A=s+h*n,x=t+(c+f)*i,k=s+(h+d)*n;break;case 180:C=nt._rescale,u=t+i,m=s,p=-i,_=n,b=t+(1-h-d)*i,A=s+c*n,x=t+(1-h)*i,k=s+(c+f)*n;break;case 270:C=nt._rescaleAndSwap,u=t+i,m=s+n,p=-i,_=-n,b=t+(1-c-f)*i,A=s+(1-h-d)*n,x=t+(1-c)*i,k=s+(1-h)*n;break}for(const{line:P,points:R}of a(this,ss))o.push(C(P,u,m,p,_,r?new Array(P.length):null)),l.push(C(R,u,m,p,_,r?new Array(R.length):null));return{lines:o,points:l,rect:[b,A,x,k]}}static deserialize(t,s,i,n,r,{paths:{lines:o,points:l},rotation:h,thickness:c}){const d=[];let f,u,m,p,_;switch(h){case 0:_=nt._rescale,f=-t/i,u=s/n+1,m=1/i,p=-1/n;break;case 90:_=nt._rescaleAndSwap,f=-s/n,u=-t/i,m=1/n,p=1/i;break;case 180:_=nt._rescale,f=t/i+1,u=-s/n,m=-1/i,p=1/n;break;case 270:_=nt._rescaleAndSwap,f=s/n+1,u=t/i+1,m=-1/n,p=-1/i;break}if(!o){o=[];for(const A of l){const x=A.length;if(x===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,A[0],A[1]]));continue}if(x===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,A[0],A[1],NaN,NaN,NaN,NaN,A[2],A[3]]));continue}const k=new Float32Array(3*(x-2));o.push(k);let[C,P,R,D]=A.subarray(0,4);k.set([NaN,NaN,NaN,NaN,C,P],0);for(let M=4;M<x;M+=2){const U=A[M],$=A[M+1];k.set(nt.createBezierPoints(C,P,R,D,U,$),(M-2)*3),[C,P,R,D]=[R,D,U,$]}}}for(let A=0,x=o.length;A<x;A++)d.push({line:_(o[A].map(k=>k??NaN),f,u,m,p),points:_(l[A].map(k=>k??NaN),f,u,m,p)});const b=new this.prototype.constructor;return b.build(d,i,n,1,h,c,r),b}get box(){return a(this,Pe)}updateProperty(t,s){return t==="stroke-width"?E(this,ye,og).call(this,s):null}updateParentDimensions([t,s],i){const[n,r]=E(this,ye,hi).call(this);y(this,ti,t),y(this,ei,s),y(this,co,i);const[o,l]=E(this,ye,hi).call(this),h=o-n,c=l-r,d=a(this,Pe);return d[0]-=h,d[1]-=c,d[2]+=2*h,d[3]+=2*c,d}updateRotation(t){return y(this,mh,t),{path:{transform:this.rotationTransform}}}get viewBox(){return a(this,Pe).map(nt.svgRound).join(" ")}get defaultProperties(){const[t,s]=a(this,Pe);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${nt.svgRound(t)} ${nt.svgRound(s)}`}}}get rotationTransform(){const[,,t,s]=a(this,Pe);let i=0,n=0,r=0,o=0,l=0,h=0;switch(a(this,mh)){case 90:n=s/t,r=-t/s,l=t;break;case 180:i=-1,o=-1,l=t,h=s;break;case 270:n=-s/t,r=t/s,h=s;break;default:return""}return`matrix(${i} ${n} ${r} ${o} ${nt.svgRound(l)} ${nt.svgRound(h)})`}getPathResizingSVGProperties([t,s,i,n]){const[r,o]=E(this,ye,hi).call(this),[l,h,c,d]=a(this,Pe);if(Math.abs(c-r)<=nt.PRECISION||Math.abs(d-o)<=nt.PRECISION){const _=t+i/2-(l+c/2),b=s+n/2-(h+d/2);return{path:{"transform-origin":`${nt.svgRound(t)} ${nt.svgRound(s)}`,transform:`${this.rotationTransform} translate(${_} ${b})`}}}const f=(i-2*r)/(c-2*r),u=(n-2*o)/(d-2*o),m=c/i,p=d/n;return{path:{"transform-origin":`${nt.svgRound(l)} ${nt.svgRound(h)}`,transform:`${this.rotationTransform} scale(${m} ${p}) translate(${nt.svgRound(r)} ${nt.svgRound(o)}) scale(${f} ${u}) translate(${nt.svgRound(-r)} ${nt.svgRound(-o)})`}}}getPathResizedSVGProperties([t,s,i,n]){const[r,o]=E(this,ye,hi).call(this),l=a(this,Pe),[h,c,d,f]=l;if(l[0]=t,l[1]=s,l[2]=i,l[3]=n,Math.abs(d-r)<=nt.PRECISION||Math.abs(f-o)<=nt.PRECISION){const b=t+i/2-(h+d/2),A=s+n/2-(c+f/2);for(const{line:x,points:k}of a(this,ss))nt._translate(x,b,A,x),nt._translate(k,b,A,k);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${nt.svgRound(t)} ${nt.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const u=(i-2*r)/(d-2*r),m=(n-2*o)/(f-2*o),p=-u*(h+r)+t+r,_=-m*(c+o)+s+o;if(u!==1||m!==1||p!==0||_!==0)for(const{line:b,points:A}of a(this,ss))nt._rescale(b,p,_,u,m,b),nt._rescale(A,p,_,u,m,A);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${nt.svgRound(t)} ${nt.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,s],i){const[n,r]=i,o=a(this,Pe),l=t-o[0],h=s-o[1];if(a(this,ti)===n&&a(this,ei)===r)for(const{line:c,points:d}of a(this,ss))nt._translate(c,l,h,c),nt._translate(d,l,h,d);else{const c=a(this,ti)/n,d=a(this,ei)/r;y(this,ti,n),y(this,ei,r);for(const{line:f,points:u}of a(this,ss))nt._rescale(f,l,h,c,d,f),nt._rescale(u,l,h,c,d,u);o[2]*=c,o[3]*=d}return o[0]=t,o[1]=s,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${nt.svgRound(t)} ${nt.svgRound(s)}`}}}get defaultSVGProperties(){const t=a(this,Pe);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${nt.svgRound(t[0])} ${nt.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}Pe=new WeakMap,mh=new WeakMap,bh=new WeakMap,ss=new WeakMap,ti=new WeakMap,ei=new WeakMap,co=new WeakMap,uo=new WeakMap,jr=new WeakMap,ye=new WeakSet,hi=function(t=a(this,jr)){const s=a(this,bh)+t/2*a(this,co);return a(this,uo)%180===0?[s/a(this,ti),s/a(this,ei)]:[s/a(this,ei),s/a(this,ti)]},rg=function(){const[t,s,i,n]=a(this,Pe),[r,o]=E(this,ye,hi).call(this,0);return[t+r,s+o,i-2*r,n-2*o]},ag=function(){const t=y(this,Pe,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:n}of a(this,ss)){if(n.length<=12){for(let l=4,h=n.length;l<h;l+=6)lt.pointBoundingBox(n[l],n[l+1],t);continue}let r=n[4],o=n[5];for(let l=6,h=n.length;l<h;l+=6){const[c,d,f,u,m,p]=n.subarray(l,l+6);lt.bezierBoundingBox(r,o,c,d,f,u,m,p,t),r=m,o=p}}const[s,i]=E(this,ye,hi).call(this);t[0]=De(t[0]-s,0,1),t[1]=De(t[1]-i,0,1),t[2]=De(t[2]+s,0,1),t[3]=De(t[3]+i,0,1),t[2]-=t[0],t[3]-=t[1]},og=function(t){const[s,i]=E(this,ye,hi).call(this);y(this,jr,t);const[n,r]=E(this,ye,hi).call(this),[o,l]=[n-s,r-i],h=a(this,Pe);return h[0]-=o,h[1]-=l,h[2]+=2*o,h[3]+=2*l,h};class Xc extends ig{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:Nt._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??(t=this["stroke-width"]),t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new Xc(this._viewParameters);return e.updateAll(this),e}}var Hc,lg;const la=class la extends vc{constructor(t){super({...t,name:"inkEditor"});S(this,Hc);this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,s){Nt.initialize(t,s),this._defaultDrawingOptions=new Xc(s.viewParameters)}static getDefaultDrawingOptions(t){const s=this._defaultDrawingOptions.clone();return s.updateProperties(t),s}static get supportMultipleDrawings(){return!0}static get typesMap(){return wt(this,"typesMap",new Map([[At.INK_THICKNESS,"stroke-width"],[At.INK_COLOR,"stroke"],[At.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,s,i,n,r){return new mb(t,s,i,n,r,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,s,i,n,r,o){return xh.deserialize(t,s,i,n,r,o)}static async deserialize(t,s,i){let n=null;if(t instanceof Iu){const{data:{inkLists:o,rect:l,rotation:h,id:c,color:d,opacity:f,borderStyle:{rawWidth:u},popupRef:m},parent:{page:{pageNumber:p}}}=t;n=t={annotationType:ft.INK,color:Array.from(d),thickness:u,opacity:f,paths:{points:o},boxes:null,pageIndex:p-1,rect:l.slice(0),rotation:h,id:c,deleted:!1,popupRef:m}}const r=await super.deserialize(t,s,i);return r.annotationElementId=t.id||null,r._initialData=n,r}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:s,parent:i}=this;s.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(t,s.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:s,opacity:i}){this._drawingOptions=la.getDefaultDrawingOptions({stroke:lt.makeHexColor(...t),"stroke-width":s,"stroke-opacity":i})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:s,points:i,rect:n}=this.serializeDraw(t),{_drawingOptions:{stroke:r,"stroke-opacity":o,"stroke-width":l}}=this,h={annotationType:ft.INK,color:Nt._colorManager.convert(r),opacity:o,thickness:l,paths:{lines:s,points:i},pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?(h.isCopy=!0,h):this.annotationElementId&&!E(this,Hc,lg).call(this,h)?null:(h.id=this.annotationElementId,h)}renderAnnotationElement(t){const{points:s,rect:i}=this.serializeDraw(!1);return t.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:s}),null}};Hc=new WeakSet,lg=function(t){const{color:s,thickness:i,opacity:n,pageIndex:r}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||t.color.some((o,l)=>o!==s[l])||t.thickness!==i||t.opacity!==n||t.pageIndex!==r},K(la,"_type","ink"),K(la,"_editorType",ft.INK),K(la,"_defaultDrawingOptions",null);let ou=la;class lu extends xh{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}const Nh=8,So=3;var Gr,Tt,hu,Ls,hg,cg,cu,lc,dg,ug,fg,du,uu,pg;class ji{static extractContoursFromText(e,{fontFamily:t,fontStyle:s,fontWeight:i},n,r,o,l){let h=new OffscreenCanvas(1,1),c=h.getContext("2d",{alpha:!1});const d=200,f=c.font=`${s} ${i} ${d}px ${t}`,{actualBoundingBoxLeft:u,actualBoundingBoxRight:m,actualBoundingBoxAscent:p,actualBoundingBoxDescent:_,fontBoundingBoxAscent:b,fontBoundingBoxDescent:A,width:x}=c.measureText(e),k=1.5,C=Math.ceil(Math.max(Math.abs(u)+Math.abs(m)||0,x)*k),P=Math.ceil(Math.max(Math.abs(p)+Math.abs(_)||d,Math.abs(b)+Math.abs(A)||d)*k);h=new OffscreenCanvas(C,P),c=h.getContext("2d",{alpha:!0,willReadFrequently:!0}),c.font=f,c.filter="grayscale(1)",c.fillStyle="white",c.fillRect(0,0,C,P),c.fillStyle="black",c.fillText(e,C*(k-1)/2,P*(3-k)/2);const R=E(this,Tt,du).call(this,c.getImageData(0,0,C,P).data),D=E(this,Tt,fg).call(this,R),M=E(this,Tt,uu).call(this,D),U=E(this,Tt,cu).call(this,R,C,P,M);return this.processDrawnLines({lines:{curves:U,width:C,height:P},pageWidth:n,pageHeight:r,rotation:o,innerMargin:l,mustSmooth:!0,areContours:!0})}static process(e,t,s,i,n){const[r,o,l]=E(this,Tt,pg).call(this,e),[h,c]=E(this,Tt,ug).call(this,r,o,l,Math.hypot(o,l)*a(this,Gr).sigmaSFactor,a(this,Gr).sigmaR,a(this,Gr).kernelSize),d=E(this,Tt,uu).call(this,c),f=E(this,Tt,cu).call(this,h,o,l,d);return this.processDrawnLines({lines:{curves:f,width:o,height:l},pageWidth:t,pageHeight:s,rotation:i,innerMargin:n,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:s,rotation:i,innerMargin:n,mustSmooth:r,areContours:o}){i%180!==0&&([t,s]=[s,t]);const{curves:l,width:h,height:c}=e,d=e.thickness??0,f=[],u=Math.min(t/h,s/c),m=u/t,p=u/s,_=[];for(const{points:A}of l){const x=r?E(this,Tt,dg).call(this,A):A;if(!x)continue;_.push(x);const k=x.length,C=new Float32Array(k),P=new Float32Array(3*(k===2?2:k-2));if(f.push({line:P,points:C}),k===2){C[0]=x[0]*m,C[1]=x[1]*p,P.set([NaN,NaN,NaN,NaN,C[0],C[1]],0);continue}let[R,D,M,U]=x;R*=m,D*=p,M*=m,U*=p,C.set([R,D,M,U],0),P.set([NaN,NaN,NaN,NaN,R,D],0);for(let $=4;$<k;$+=2){const L=C[$]=x[$]*m,z=C[$+1]=x[$+1]*p;P.set(nt.createBezierPoints(R,D,M,U,L,z),($-2)*3),[R,D,M,U]=[M,U,L,z]}}if(f.length===0)return null;const b=o?new lu:new xh;return b.build(f,t,s,1,i,o?0:d,n),{outline:b,newCurves:_,areContours:o,thickness:d,width:h,height:c}}static async compressSignature({outlines:e,areContours:t,thickness:s,width:i,height:n}){let r=1/0,o=-1/0,l=0;for(const x of e){l+=x.length;for(let k=2,C=x.length;k<C;k++){const P=x[k]-x[k-2];r=Math.min(r,P),o=Math.max(o,P)}}let h;r>=-128&&o<=127?h=Int8Array:r>=-32768&&o<=32767?h=Int16Array:h=Int32Array;const c=e.length,d=Nh+So*c,f=new Uint32Array(d);let u=0;f[u++]=d*Uint32Array.BYTES_PER_ELEMENT+(l-2*c)*h.BYTES_PER_ELEMENT,f[u++]=0,f[u++]=i,f[u++]=n,f[u++]=t?0:1,f[u++]=Math.max(0,Math.floor(s??0)),f[u++]=c,f[u++]=h.BYTES_PER_ELEMENT;for(const x of e)f[u++]=x.length-2,f[u++]=x[0],f[u++]=x[1];const m=new CompressionStream("deflate-raw"),p=m.writable.getWriter();await p.ready,p.write(f);const _=h.prototype.constructor;for(const x of e){const k=new _(x.length-2);for(let C=2,P=x.length;C<P;C++)k[C-2]=x[C]-x[C-2];p.write(k)}p.close();const b=await new Response(m.readable).arrayBuffer(),A=new Uint8Array(b);return pf(A)}static async decompressSignature(e){try{const t=zg(e),{readable:s,writable:i}=new DecompressionStream("deflate-raw"),n=i.getWriter();await n.ready,n.write(t).then(async()=>{await n.ready,await n.close()}).catch(()=>{});let r=null,o=0;for await(const x of s)r||(r=new Uint8Array(new Uint32Array(x.buffer,0,4)[0])),r.set(x,o),o+=x.length;const l=new Uint32Array(r.buffer,0,r.length>>2),h=l[1];if(h!==0)throw new Error(`Invalid version: ${h}`);const c=l[2],d=l[3],f=l[4]===0,u=l[5],m=l[6],p=l[7],_=[],b=(Nh+So*m)*Uint32Array.BYTES_PER_ELEMENT;let A;switch(p){case Int8Array.BYTES_PER_ELEMENT:A=new Int8Array(r.buffer,b);break;case Int16Array.BYTES_PER_ELEMENT:A=new Int16Array(r.buffer,b);break;case Int32Array.BYTES_PER_ELEMENT:A=new Int32Array(r.buffer,b);break}o=0;for(let x=0;x<m;x++){const k=l[So*x+Nh],C=new Float32Array(k+2);_.push(C);for(let P=0;P<So-1;P++)C[P]=l[So*x+Nh+P+1];for(let P=0;P<k;P++)C[P+2]=C[P]+A[o++]}return{areContours:f,thickness:u,outlines:_,width:c,height:d}}catch(t){return pt(`decompressSignature: ${t}`),null}}}Gr=new WeakMap,Tt=new WeakSet,hu=function(e,t,s,i){return s-=e,i-=t,s===0?i>0?0:4:s===1?i+6:2-i},Ls=new WeakMap,hg=function(e,t,s,i,n,r,o){const l=E(this,Tt,hu).call(this,s,i,n,r);for(let h=0;h<8;h++){const c=(-h+l-o+16)%8,d=a(this,Ls)[2*c],f=a(this,Ls)[2*c+1];if(e[(s+d)*t+(i+f)]!==0)return c}return-1},cg=function(e,t,s,i,n,r,o){const l=E(this,Tt,hu).call(this,s,i,n,r);for(let h=0;h<8;h++){const c=(h+l+o+16)%8,d=a(this,Ls)[2*c],f=a(this,Ls)[2*c+1];if(e[(s+d)*t+(i+f)]!==0)return c}return-1},cu=function(e,t,s,i){const n=e.length,r=new Int32Array(n);for(let c=0;c<n;c++)r[c]=e[c]<=i?1:0;for(let c=1;c<s-1;c++)r[c*t]=r[c*t+t-1]=0;for(let c=0;c<t;c++)r[c]=r[t*s-1-c]=0;let o=1,l;const h=[];for(let c=1;c<s-1;c++){l=1;for(let d=1;d<t-1;d++){const f=c*t+d,u=r[f];if(u===0)continue;let m=c,p=d;if(u===1&&r[f-1]===0)o+=1,p-=1;else if(u>=1&&r[f+1]===0)o+=1,p+=1,u>1&&(l=u);else{u!==1&&(l=Math.abs(u));continue}const _=[d,c],b=p===d+1,A={isHole:b,points:_,id:o,parent:0};h.push(A);let x;for(const $ of h)if($.id===l){x=$;break}x?x.isHole?A.parent=b?x.parent:l:A.parent=b?l:x.parent:A.parent=b?l:0;const k=E(this,Tt,hg).call(this,r,t,c,d,m,p,0);if(k===-1){r[f]=-o,r[f]!==1&&(l=Math.abs(r[f]));continue}let C=a(this,Ls)[2*k],P=a(this,Ls)[2*k+1];const R=c+C,D=d+P;m=R,p=D;let M=c,U=d;for(;;){const $=E(this,Tt,cg).call(this,r,t,M,U,m,p,1);C=a(this,Ls)[2*$],P=a(this,Ls)[2*$+1];const L=M+C,z=U+P;_.push(z,L);const v=M*t+U;if(r[v+1]===0?r[v]=-o:r[v]===1&&(r[v]=o),L===c&&z===d&&M===R&&U===D){r[f]!==1&&(l=Math.abs(r[f]));break}else m=M,p=U,M=L,U=z}}}return h},lc=function(e,t,s,i){if(s-t<=4){for(let R=t;R<s-2;R+=2)i.push(e[R],e[R+1]);return}const n=e[t],r=e[t+1],o=e[s-4]-n,l=e[s-3]-r,h=Math.hypot(o,l),c=o/h,d=l/h,f=c*r-d*n,u=l/o,m=1/h,p=Math.atan(u),_=Math.cos(p),b=Math.sin(p),A=m*(Math.abs(_)+Math.abs(b)),x=m*(1-A+A**2),k=Math.max(Math.atan(Math.abs(b+_)*x),Math.atan(Math.abs(b-_)*x));let C=0,P=t;for(let R=t+2;R<s-2;R+=2){const D=Math.abs(f-c*e[R+1]+d*e[R]);D>C&&(P=R,C=D)}C>(h*k)**2?(E(this,Tt,lc).call(this,e,t,P+2,i),E(this,Tt,lc).call(this,e,P,s,i)):i.push(n,r)},dg=function(e){const t=[],s=e.length;return E(this,Tt,lc).call(this,e,0,s,t),t.push(e[s-2],e[s-1]),t.length<=4?null:t},ug=function(e,t,s,i,n,r){const o=new Float32Array(r**2),l=-2*i**2,h=r>>1;for(let p=0;p<r;p++){const _=(p-h)**2;for(let b=0;b<r;b++)o[p*r+b]=Math.exp((_+(b-h)**2)/l)}const c=new Float32Array(256),d=-2*n**2;for(let p=0;p<256;p++)c[p]=Math.exp(p**2/d);const f=e.length,u=new Uint8Array(f),m=new Uint32Array(256);for(let p=0;p<s;p++)for(let _=0;_<t;_++){const b=p*t+_,A=e[b];let x=0,k=0;for(let P=0;P<r;P++){const R=p+P-h;if(!(R<0||R>=s))for(let D=0;D<r;D++){const M=_+D-h;if(M<0||M>=t)continue;const U=e[R*t+M],$=o[P*r+D]*c[Math.abs(U-A)];x+=U*$,k+=$}}const C=u[b]=Math.round(x/k);m[C]++}return[u,m]},fg=function(e){const t=new Uint32Array(256);for(const s of e)t[s]++;return t},du=function(e){const t=e.length,s=new Uint8ClampedArray(t>>2);let i=-1/0,n=1/0;for(let o=0,l=s.length;o<l;o++){if(e[(o<<2)+3]===0){i=s[o]=255;continue}const c=s[o]=e[o<<2];c>i&&(i=c),c<n&&(n=c)}const r=255/(i-n);for(let o=0;o<t;o++)s[o]=(s[o]-n)*r;return s},uu=function(e){let t,s=-1/0,i=-1/0;const n=e.findIndex(l=>l!==0);let r=n,o=n;for(t=n;t<256;t++){const l=e[t];l>s&&(t-r>i&&(i=t-r,o=t-1),s=l,r=t)}for(t=o-1;t>=0&&!(e[t]>e[t+1]);t--);return t},pg=function(e){const t=e,{width:s,height:i}=e,{maxDim:n}=a(this,Gr);let r=s,o=i;if(s>n||i>n){let f=s,u=i,m=Math.log2(Math.max(s,i)/n);const p=Math.floor(m);m=m===p?p-1:p;for(let b=0;b<m;b++){r=Math.ceil(f/2),o=Math.ceil(u/2);const A=new OffscreenCanvas(r,o);A.getContext("2d").drawImage(e,0,0,f,u,0,0,r,o),f=r,u=o,e!==t&&e.close(),e=A.transferToImageBitmap()}const _=Math.min(n/r,n/o);r=Math.round(r*_),o=Math.round(o*_)}const h=new OffscreenCanvas(r,o).getContext("2d",{willReadFrequently:!0});h.filter="grayscale(1)",h.drawImage(e,0,0,e.width,e.height,0,0,r,o);const c=h.getImageData(0,0,r,o).data;return[E(this,Tt,du).call(this,c),r,o]},S(ji,Tt),S(ji,Gr,{maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16}),S(ji,Ls,new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]));class Pu extends ig{constructor(){super(),super.updateProperties({fill:Nt._defaultLineColor,"stroke-width":0})}clone(){const e=new Pu;return e.updateAll(this),e}}class Lu extends Xc{constructor(e){super(e),super.updateProperties({stroke:Nt._defaultLineColor,"stroke-width":1})}clone(){const e=new Lu(this._viewParameters);return e.updateAll(this),e}}var En,is,xn,Cn;const We=class We extends vc{constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"});S(this,En,!1);S(this,is,null);S(this,xn,null);S(this,Cn,null);this._willKeepAspectRatio=!0,y(this,xn,t.signatureData||null),y(this,is,null),this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,s){Nt.initialize(t,s),this._defaultDrawingOptions=new Pu,this._defaultDrawnSignatureOptions=new Lu(s.viewParameters)}static getDefaultDrawingOptions(t){const s=this._defaultDrawingOptions.clone();return s.updateProperties(t),s}static get supportMultipleDrawings(){return!1}static get typesMap(){return wt(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!a(this,is)}}static computeTelemetryFinalData(t){const s=t.get("hasDescription");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,s;const{_isCopy:i}=this;if(i&&(this._isCopy=!1,t=this.x,s=this.y),super.render(),this._drawId===null)if(a(this,xn)){const{lines:n,mustSmooth:r,areContours:o,description:l,uuid:h,heightInPage:c}=a(this,xn),{rawDims:{pageWidth:d,pageHeight:f},rotation:u}=this.parent.viewport,m=ji.processDrawnLines({lines:n,pageWidth:d,pageHeight:f,rotation:u,innerMargin:We._INNER_MARGIN,mustSmooth:r,areContours:o});this.addSignature(m,c,l,h)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);return i&&(this._isCopy=!0,this._moveAfterPaste(t,s)),this.div}setUuid(t){y(this,Cn,t),this.addEditToolbar()}getUuid(){return a(this,Cn)}get description(){return a(this,is)}set description(t){y(this,is,t),super.addEditToolbar().then(s=>{s==null||s.updateEditSignatureButton(t)})}getSignaturePreview(){const{newCurves:t,areContours:s,thickness:i,width:n,height:r}=a(this,xn),o=Math.max(n,r),l=ji.processDrawnLines({lines:{curves:t.map(h=>({points:h})),thickness:i,width:n,height:r},pageWidth:o,pageHeight:o,rotation:0,innerMargin:0,mustSmooth:!1,areContours:s});return{areContours:s,outline:l.outline}}async addEditToolbar(){const t=await super.addEditToolbar();return t?(this._uiManager.signatureManager&&a(this,is)!==null&&(await t.addEditSignatureButton(this._uiManager.signatureManager,a(this,Cn),a(this,is)),t.show()),t):null}addSignature(t,s,i,n){const{x:r,y:o}=this,{outline:l}=y(this,xn,t);y(this,En,l instanceof lu),y(this,is,i),this.div.setAttribute("data-l10n-args",JSON.stringify({description:i}));let h;a(this,En)?h=We.getDefaultDrawingOptions():(h=We._defaultDrawnSignatureOptions.clone(),h.updateProperties({"stroke-width":l.thickness})),this._addOutlines({drawOutlines:l,drawingOptions:h});const[c,d]=this.parentDimensions,[,f]=this.pageDimensions;let u=s/f;u=u>=1?.5:u,this.width*=u/this.height,this.width>=1&&(u*=.9/this.width,this.width=.9),this.height=u,this.setDims(c*this.width,d*this.height),this.x=r,this.y=o,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(n),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!n,hasDescription:!!i}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:s,pageHeight:i},rotation:n}=this.parent.viewport;return ji.process(t,s,i,n,We._INNER_MARGIN)}getFromText(t,s){const{rawDims:{pageWidth:i,pageHeight:n},rotation:r}=this.parent.viewport;return ji.extractContoursFromText(t,s,i,n,r,We._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:s,pageHeight:i},rotation:n}=this.parent.viewport;return ji.processDrawnLines({lines:t,pageWidth:s,pageHeight:i,rotation:n,innerMargin:We._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:s}){t?this._drawingOptions=We.getDefaultDrawingOptions():(this._drawingOptions=We._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":s}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:s,points:i,rect:n}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":r}}=this,o={annotationType:ft.SIGNATURE,isSignature:!0,areContours:a(this,En),color:[0,0,0],thickness:a(this,En)?0:r,pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?(o.paths={lines:s,points:i},o.uuid=a(this,Cn),o.isCopy=!0):o.lines=s,a(this,is)&&(o.accessibilityData={type:"Figure",alt:a(this,is)}),o}static deserializeDraw(t,s,i,n,r,o){return o.areContours?lu.deserialize(t,s,i,n,r,o):xh.deserialize(t,s,i,n,r,o)}static async deserialize(t,s,i){var r;const n=await super.deserialize(t,s,i);return y(n,En,t.areContours),y(n,is,((r=t.accessibilityData)==null?void 0:r.alt)||""),y(n,Cn,t.uuid),n}};En=new WeakMap,is=new WeakMap,xn=new WeakMap,Cn=new WeakMap,K(We,"_type","signature"),K(We,"_editorType",ft.SIGNATURE),K(We,"_defaultDrawingOptions",null);let fu=We;var Ht,de,kn,Ni,Tn,fo,Oi,$r,si,ns,po,Et,Uo,jo,hc,cc,dc,gu,uc,gg;class pu extends Nt{constructor(t){super({...t,name:"stampEditor"});S(this,Et);S(this,Ht,null);S(this,de,null);S(this,kn,null);S(this,Ni,null);S(this,Tn,null);S(this,fo,"");S(this,Oi,null);S(this,$r,!1);S(this,si,null);S(this,ns,!1);S(this,po,!1);y(this,Ni,t.bitmapUrl),y(this,Tn,t.bitmapFile),this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,s){Nt.initialize(t,s)}static isHandlingMimeForPasting(t){return od.includes(t)}static paste(t,s){s.pasteEditor({mode:ft.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const s=t.get("hasAltText");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}async mlGuessAltText(t=null,s=!0){if(this.hasAltTextData())return null;const{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:n,width:r,height:o}=t||this.copyCanvas(null,null,!0).imageData,l=await i.guess({name:"altText",request:{data:n,width:r,height:o,channels:n.length/(r*o)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");const h=l.output;return await this.setGuessedAltText(h),s&&!this.hasAltTextData()&&(this.altTextData={alt:h,decorative:!1}),h}remove(){var t;a(this,de)&&(y(this,Ht,null),this._uiManager.imageManager.deleteId(a(this,de)),(t=a(this,Oi))==null||t.remove(),y(this,Oi,null),a(this,si)&&(clearTimeout(a(this,si)),y(this,si,null))),super.remove()}rebuild(){if(!this.parent){a(this,de)&&E(this,Et,hc).call(this);return}super.rebuild(),this.div!==null&&(a(this,de)&&a(this,Oi)===null&&E(this,Et,hc).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(a(this,kn)||a(this,Ht)||a(this,Ni)||a(this,Tn)||a(this,de)||a(this,$r))}get isResizable(){return!0}render(){if(this.div)return this.div;let t,s;return this._isCopy&&(t=this.x,s=this.y),super.render(),this.div.hidden=!0,this.addAltTextButton(),a(this,$r)||(a(this,Ht)?E(this,Et,cc).call(this):E(this,Et,hc).call(this)),this._isCopy&&this._moveAfterPaste(t,s),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,s){const{id:i,bitmap:n}=this._uiManager.imageManager.getFromCanvas(t,s);s.remove(),i&&this._uiManager.imageManager.isValidId(i)&&(y(this,de,i),n&&y(this,Ht,n),y(this,$r,!1),E(this,Et,cc).call(this))}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;a(this,si)!==null&&clearTimeout(a(this,si)),y(this,si,setTimeout(()=>{y(this,si,null),E(this,Et,gu).call(this)},200))}copyCanvas(t,s,i=!1){var u;t||(t=224);const{width:n,height:r}=a(this,Ht),o=new ni;let l=a(this,Ht),h=n,c=r,d=null;if(s){if(n>s||r>s){const D=Math.min(s/n,s/r);h=Math.floor(n*D),c=Math.floor(r*D)}d=document.createElement("canvas");const m=d.width=Math.ceil(h*o.sx),p=d.height=Math.ceil(c*o.sy);a(this,ns)||(l=E(this,Et,dc).call(this,m,p));const _=d.getContext("2d");_.filter=this._uiManager.hcmFilter;let b="white",A="#cfcfd8";this._uiManager.hcmFilter!=="none"?A="black":(u=window.matchMedia)!=null&&u.call(window,"(prefers-color-scheme: dark)").matches&&(b="#8f8f9d",A="#42414d");const x=15,k=x*o.sx,C=x*o.sy,P=new OffscreenCanvas(k*2,C*2),R=P.getContext("2d");R.fillStyle=b,R.fillRect(0,0,k*2,C*2),R.fillStyle=A,R.fillRect(0,0,k,C),R.fillRect(k,C,k,C),_.fillStyle=_.createPattern(P,"repeat"),_.fillRect(0,0,m,p),_.drawImage(l,0,0,l.width,l.height,0,0,m,p)}let f=null;if(i){let m,p;if(o.symmetric&&l.width<t&&l.height<t)m=l.width,p=l.height;else if(l=a(this,Ht),n>t||r>t){const A=Math.min(t/n,t/r);m=Math.floor(n*A),p=Math.floor(r*A),a(this,ns)||(l=E(this,Et,dc).call(this,m,p))}const b=new OffscreenCanvas(m,p).getContext("2d",{willReadFrequently:!0});b.drawImage(l,0,0,l.width,l.height,0,0,m,p),f={width:m,height:p,data:b.getImageData(0,0,m,p).data}}return{canvas:d,width:h,height:c,imageData:f}}static async deserialize(t,s,i){var _;let n=null,r=!1;if(t instanceof Ip){const{data:{rect:b,rotation:A,id:x,structParent:k,popupRef:C},container:P,parent:{page:{pageNumber:R}},canvas:D}=t;let M,U;D?(delete t.canvas,{id:M,bitmap:U}=i.imageManager.getFromCanvas(P.id,D),D.remove()):(r=!0,t._hasNoCanvas=!0);const $=((_=await s._structTree.getAriaAttributes(`${vu}${x}`))==null?void 0:_.get("aria-label"))||"";n=t={annotationType:ft.STAMP,bitmapId:M,bitmap:U,pageIndex:R-1,rect:b.slice(0),rotation:A,id:x,deleted:!1,accessibilityData:{decorative:!1,altText:$},isSvg:!1,structParent:k,popupRef:C}}const o=await super.deserialize(t,s,i),{rect:l,bitmap:h,bitmapUrl:c,bitmapId:d,isSvg:f,accessibilityData:u}=t;r?(i.addMissingCanvas(t.id,o),y(o,$r,!0)):d&&i.imageManager.isValidId(d)?(y(o,de,d),h&&y(o,Ht,h)):y(o,Ni,c),y(o,ns,f);const[m,p]=o.pageDimensions;return o.width=(l[2]-l[0])/m,o.height=(l[3]-l[1])/p,o.annotationElementId=t.id||null,u&&(o.altTextData=u),o._initialData=n,y(o,po,!!n),o}serialize(t=!1,s=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i={annotationType:ft.STAMP,bitmapId:a(this,de),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:a(this,ns),structTreeParentId:this._structTreeParentId};if(t)return i.bitmapUrl=E(this,Et,uc).call(this,!0),i.accessibilityData=this.serializeAltText(!0),i.isCopy=!0,i;const{decorative:n,altText:r}=this.serializeAltText(!1);if(!n&&r&&(i.accessibilityData={type:"Figure",alt:r}),this.annotationElementId){const l=E(this,Et,gg).call(this,i);if(l.isSame)return null;l.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1}if(i.id=this.annotationElementId,s===null)return i;s.stamps||(s.stamps=new Map);const o=a(this,ns)?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!s.stamps.has(a(this,de)))s.stamps.set(a(this,de),{area:o,serialized:i}),i.bitmap=E(this,Et,uc).call(this,!1);else if(a(this,ns)){const l=s.stamps.get(a(this,de));o>l.area&&(l.area=o,l.serialized.bitmap.close(),l.serialized.bitmap=E(this,Et,uc).call(this,!1))}return i}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}}Ht=new WeakMap,de=new WeakMap,kn=new WeakMap,Ni=new WeakMap,Tn=new WeakMap,fo=new WeakMap,Oi=new WeakMap,$r=new WeakMap,si=new WeakMap,ns=new WeakMap,po=new WeakMap,Et=new WeakSet,Uo=function(t,s=!1){if(!t){this.remove();return}y(this,Ht,t.bitmap),s||(y(this,de,t.id),y(this,ns,t.isSvg)),t.file&&y(this,fo,t.file.name),E(this,Et,cc).call(this)},jo=function(){if(y(this,kn,null),this._uiManager.enableWaiting(!1),!!a(this,Oi)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&a(this,Ht)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&a(this,Ht)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},hc=function(){if(a(this,de)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(a(this,de)).then(i=>E(this,Et,Uo).call(this,i,!0)).finally(()=>E(this,Et,jo).call(this));return}if(a(this,Ni)){const i=a(this,Ni);y(this,Ni,null),this._uiManager.enableWaiting(!0),y(this,kn,this._uiManager.imageManager.getFromUrl(i).then(n=>E(this,Et,Uo).call(this,n)).finally(()=>E(this,Et,jo).call(this)));return}if(a(this,Tn)){const i=a(this,Tn);y(this,Tn,null),this._uiManager.enableWaiting(!0),y(this,kn,this._uiManager.imageManager.getFromFile(i).then(n=>E(this,Et,Uo).call(this,n)).finally(()=>E(this,Et,jo).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=od.join(",");const s=this._uiManager._signal;y(this,kn,new Promise(i=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const n=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),E(this,Et,Uo).call(this,n)}i()},{signal:s}),t.addEventListener("cancel",()=>{this.remove(),i()},{signal:s})}).finally(()=>E(this,Et,jo).call(this))),t.click()},cc=function(){var d;const{div:t}=this;let{width:s,height:i}=a(this,Ht);const[n,r]=this.pageDimensions,o=.75;if(this.width)s=this.width*n,i=this.height*r;else if(s>o*n||i>o*r){const f=Math.min(o*n/s,o*r/i);s*=f,i*=f}const[l,h]=this.parentDimensions;this.setDims(s*l/n,i*h/r),this._uiManager.enableWaiting(!1);const c=y(this,Oi,document.createElement("canvas"));c.setAttribute("role","img"),this.addContainer(c),this.width=s/n,this.height=i/r,(d=this._initialOptions)!=null&&d.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),E(this,Et,gu).call(this),a(this,po)||(this.parent.addUndoableEditor(this),y(this,po,!0)),this._reportTelemetry({action:"inserted_image"}),a(this,fo)&&this.div.setAttribute("aria-description",a(this,fo))},dc=function(t,s){const{width:i,height:n}=a(this,Ht);let r=i,o=n,l=a(this,Ht);for(;r>2*t||o>2*s;){const h=r,c=o;r>2*t&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2)),o>2*s&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const d=new OffscreenCanvas(r,o);d.getContext("2d").drawImage(l,0,0,h,c,0,0,r,o),l=d.transferToImageBitmap()}return l},gu=function(){const[t,s]=this.parentDimensions,{width:i,height:n}=this,r=new ni,o=Math.ceil(i*t*r.sx),l=Math.ceil(n*s*r.sy),h=a(this,Oi);if(!h||h.width===o&&h.height===l)return;h.width=o,h.height=l;const c=a(this,ns)?a(this,Ht):E(this,Et,dc).call(this,o,l),d=h.getContext("2d");d.filter=this._uiManager.hcmFilter,d.drawImage(c,0,0,c.width,c.height,0,0,o,l)},uc=function(t){if(t){if(a(this,ns)){const n=this._uiManager.imageManager.getSvgUrl(a(this,de));if(n)return n}const s=document.createElement("canvas");return{width:s.width,height:s.height}=a(this,Ht),s.getContext("2d").drawImage(a(this,Ht),0,0),s.toDataURL()}if(a(this,ns)){const[s,i]=this.pageDimensions,n=Math.round(this.width*s*Mn.PDF_TO_CSS_UNITS),r=Math.round(this.height*i*Mn.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(n,r);return o.getContext("2d").drawImage(a(this,Ht),0,0,a(this,Ht).width,a(this,Ht).height,0,0,n,r),o.transferToImageBitmap()}return structuredClone(a(this,Ht))},gg=function(t){var o;const{pageIndex:s,accessibilityData:{altText:i}}=this._initialData,n=t.pageIndex===s,r=(((o=t.accessibilityData)==null?void 0:o.alt)||"")===i;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&n&&r,isSameAltText:r}},K(pu,"_type","stamp"),K(pu,"_editorType",ft.STAMP);var Wr,go,ii,Rn,Bi,ys,In,mo,Vr,Ms,zi,Ce,Hi,ot,Pn,Ut,mg,Us,bu,yu,fc;const As=class As{constructor({uiManager:e,pageIndex:t,div:s,structTreeLayer:i,accessibilityManager:n,annotationLayer:r,drawLayer:o,textLayer:l,viewport:h,l10n:c}){S(this,Ut);S(this,Wr);S(this,go,!1);S(this,ii,null);S(this,Rn,null);S(this,Bi,null);S(this,ys,new Map);S(this,In,!1);S(this,mo,!1);S(this,Vr,!1);S(this,Ms,null);S(this,zi,null);S(this,Ce,null);S(this,Hi,null);S(this,ot);const d=[...a(As,Pn).values()];if(!As._initialized){As._initialized=!0;for(const f of d)f.initialize(c,e)}e.registerEditorTypes(d),y(this,ot,e),this.pageIndex=t,this.div=s,y(this,Wr,n),y(this,ii,r),this.viewport=h,y(this,Ce,l),this.drawLayer=o,this._structTree=i,a(this,ot).addLayer(this)}get isEmpty(){return a(this,ys).size===0}get isInvisible(){return this.isEmpty&&a(this,ot).getMode()===ft.NONE}updateToolbar(e){a(this,ot).updateToolbar(e)}updateMode(e=a(this,ot).getMode()){switch(E(this,Ut,fc).call(this),e){case ft.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case ft.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case ft.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;for(const s of a(As,Pn).values())t.toggle(`${s._type}Editing`,e===s._editorType);this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=a(this,Ce))==null?void 0:t.div)}setEditingState(e){a(this,ot).setEditingState(e)}addCommands(e){a(this,ot).addCommands(e)}cleanUndoStack(e){a(this,ot).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=a(this,ii))==null||t.div.classList.toggle("disabled",!e)}async enable(){y(this,Vr,!0),this.div.tabIndex=0,this.togglePointerEvents(!0);const e=new Set;for(const s of a(this,ys).values())s.enableEditing(),s.show(!0),s.annotationElementId&&(a(this,ot).removeChangedExistingAnnotation(s),e.add(s.annotationElementId));if(!a(this,ii)){y(this,Vr,!1);return}const t=a(this,ii).getEditableAnnotations();for(const s of t){if(s.hide(),a(this,ot).isDeletedAnnotationElement(s.data.id)||e.has(s.data.id))continue;const i=await this.deserialize(s);i&&(this.addOrRebuild(i),i.enableEditing())}y(this,Vr,!1)}disable(){var i;y(this,mo,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);const e=new Map,t=new Map;for(const n of a(this,ys).values())if(n.disableEditing(),!!n.annotationElementId){if(n.serialize()!==null){e.set(n.annotationElementId,n);continue}else t.set(n.annotationElementId,n);(i=this.getEditableAnnotation(n.annotationElementId))==null||i.show(),n.remove()}if(a(this,ii)){const n=a(this,ii).getEditableAnnotations();for(const r of n){const{id:o}=r.data;if(a(this,ot).isDeletedAnnotationElement(o))continue;let l=t.get(o);if(l){l.resetAnnotationElement(r),l.show(!1),r.show();continue}l=e.get(o),l&&(a(this,ot).addChangedExistingAnnotation(l),l.renderAnnotationElement(r)&&l.show(!1)),r.show()}}E(this,Ut,fc).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:s}=this.div;for(const n of a(As,Pn).values())s.remove(`${n._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),y(this,mo,!1)}getEditableAnnotation(e){var t;return((t=a(this,ii))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){a(this,ot).getActive()!==e&&a(this,ot).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=a(this,Ce))!=null&&e.div&&!a(this,Hi)){y(this,Hi,new AbortController);const t=a(this,ot).combinedSignal(a(this,Hi));a(this,Ce).div.addEventListener("pointerdown",E(this,Ut,mg).bind(this),{signal:t}),a(this,Ce).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=a(this,Ce))!=null&&e.div&&a(this,Hi)&&(a(this,Hi).abort(),y(this,Hi,null),a(this,Ce).div.classList.remove("highlighting"))}enableClick(){if(a(this,Rn))return;y(this,Rn,new AbortController);const e=a(this,ot).combinedSignal(a(this,Rn));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=a(this,Rn))==null||e.abort(),y(this,Rn,null)}attach(e){a(this,ys).set(e.id,e);const{annotationElementId:t}=e;t&&a(this,ot).isDeletedAnnotationElement(t)&&a(this,ot).removeDeletedAnnotationElement(e)}detach(e){var t;a(this,ys).delete(e.id),(t=a(this,Wr))==null||t.removePointerInTextLayer(e.contentDiv),!a(this,mo)&&e.annotationElementId&&a(this,ot).addDeletedAnnotationElement(e)}remove(e){this.detach(e),a(this,ot).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(a(this,ot).addDeletedAnnotationElement(e.annotationElementId),Nt.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),a(this,ot).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!a(this,Vr)),a(this,ot).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var s;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!a(this,Bi)&&(e._focusEventsAllowed=!1,y(this,Bi,setTimeout(()=>{y(this,Bi,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:a(this,ot)._signal}),t.focus())},0))),e._structTreeParentId=(s=a(this,Wr))==null?void 0:s.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),s=()=>{e.remove()};this.addCommands({cmd:t,undo:s,mustExec:!1})}getNextId(){return a(this,ot).getId()}combinedSignal(e){return a(this,ot).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=a(this,Ut,Us))==null?void 0:e.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await a(this,ot).updateMode(e.mode);const{offsetX:s,offsetY:i}=E(this,Ut,yu).call(this),n=this.getNextId(),r=E(this,Ut,bu).call(this,{parent:this,id:n,x:s,y:i,uiManager:a(this,ot),isCentered:!0,...t});r&&this.add(r)}async deserialize(e){var t;return await((t=a(As,Pn).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,a(this,ot)))||null}createAndAddNewEditor(e,t,s={}){const i=this.getNextId(),n=E(this,Ut,bu).call(this,{parent:this,id:i,x:e.offsetX,y:e.offsetY,uiManager:a(this,ot),isCentered:t,...s});return n&&this.add(n),n}addNewEditor(e={}){this.createAndAddNewEditor(E(this,Ut,yu).call(this),!0,e)}setSelected(e){a(this,ot).setSelected(e)}toggleSelected(e){a(this,ot).toggleSelected(e)}unselect(e){a(this,ot).unselect(e)}pointerup(e){var i;const{isMac:t}=we.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div||!a(this,In)||(y(this,In,!1),(i=a(this,Ut,Us))!=null&&i.isDrawer&&a(this,Ut,Us).supportMultipleDrawings))return;if(!a(this,go)){y(this,go,!0);return}const s=a(this,ot).getMode();if(s===ft.STAMP||s===ft.SIGNATURE){a(this,ot).unselectAll();return}this.createAndAddNewEditor(e,!1)}pointerdown(e){var i;if(a(this,ot).getMode()===ft.HIGHLIGHT&&this.enableTextSelection(),a(this,In)){y(this,In,!1);return}const{isMac:t}=we.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(y(this,In,!0),(i=a(this,Ut,Us))!=null&&i.isDrawer){this.startDrawingSession(e);return}const s=a(this,ot).getActive();y(this,go,!s||s.isEmpty())}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),a(this,Ms)){a(this,Ut,Us).startDrawing(this,a(this,ot),!1,e);return}a(this,ot).setCurrentDrawingSession(this),y(this,Ms,new AbortController);const t=a(this,ot).combinedSignal(a(this,Ms));this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(y(this,zi,null),this.commitOrRemove())},{signal:t}),a(this,Ut,Us).startDrawing(this,a(this,ot),!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&y(this,zi,t);return}a(this,zi)&&setTimeout(()=>{var t;(t=a(this,zi))==null||t.focus(),y(this,zi,null)},0)}endDrawingSession(e=!1){return a(this,Ms)?(a(this,ot).setCurrentDrawingSession(null),a(this,Ms).abort(),y(this,Ms,null),y(this,zi,null),a(this,Ut,Us).endDrawing(e)):null}findNewParent(e,t,s){const i=a(this,ot).findParent(t,s);return i===null||i===this?!1:(i.changeParent(e),!0)}commitOrRemove(){return a(this,Ms)?(this.endDrawingSession(),!0):!1}onScaleChanging(){a(this,Ms)&&a(this,Ut,Us).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=a(this,ot).getActive())==null?void 0:e.parent)===this&&(a(this,ot).commitOrRemove(),a(this,ot).setActiveEditor(null)),a(this,Bi)&&(clearTimeout(a(this,Bi)),y(this,Bi,null));for(const s of a(this,ys).values())(t=a(this,Wr))==null||t.removePointerInTextLayer(s.contentDiv),s.setParent(null),s.isAttachedToDOM=!1,s.div.remove();this.div=null,a(this,ys).clear(),a(this,ot).removeLayer(this)}render({viewport:e}){this.viewport=e,qr(this.div,e);for(const t of a(this,ot).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){a(this,ot).commitOrRemove(),E(this,Ut,fc).call(this);const t=this.viewport.rotation,s=e.rotation;if(this.viewport=e,qr(this.div,{rotation:s}),t!==s)for(const i of a(this,ys).values())i.rotate(s)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return a(this,ot).viewParameters.realScale}};Wr=new WeakMap,go=new WeakMap,ii=new WeakMap,Rn=new WeakMap,Bi=new WeakMap,ys=new WeakMap,In=new WeakMap,mo=new WeakMap,Vr=new WeakMap,Ms=new WeakMap,zi=new WeakMap,Ce=new WeakMap,Hi=new WeakMap,ot=new WeakMap,Pn=new WeakMap,Ut=new WeakSet,mg=function(e){a(this,ot).unselectAll();const{target:t}=e;if(t===a(this,Ce).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&a(this,Ce).div.contains(t)){const{isMac:s}=we.platform;if(e.button!==0||e.ctrlKey&&s)return;a(this,ot).showAllEditors("highlight",!0,!0),a(this,Ce).div.classList.add("free"),this.toggleDrawing(),Ac.startHighlighting(this,a(this,ot).direction==="ltr",{target:a(this,Ce).div,x:e.x,y:e.y}),a(this,Ce).div.addEventListener("pointerup",()=>{a(this,Ce).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:a(this,ot)._signal}),e.preventDefault()}},Us=function(){return a(As,Pn).get(a(this,ot).getMode())},bu=function(e){const t=a(this,Ut,Us);return t?new t.prototype.constructor(e):null},yu=function(){const{x:e,y:t,width:s,height:i}=this.div.getBoundingClientRect(),n=Math.max(0,e),r=Math.max(0,t),o=Math.min(window.innerWidth,e+s),l=Math.min(window.innerHeight,t+i),h=(n+o)/2-e,c=(r+l)/2-t,[d,f]=this.viewport.rotation%180===0?[h,c]:[c,h];return{offsetX:d,offsetY:f}},fc=function(){for(const e of a(this,ys).values())e.isEmpty()&&e.remove()},K(As,"_initialized",!1),S(As,Pn,new Map([qd,ou,pu,Ac,fu].map(e=>[e._editorType,e])));let mu=As;var Ds,Le,Xr,yh,Uc,bg,ri,wu,yg,Au;const se=class se{constructor({pageIndex:e}){S(this,ri);S(this,Ds,null);S(this,Le,new Map);S(this,Xr,new Map);this.pageIndex=e}setParent(e){if(!a(this,Ds)){y(this,Ds,e);return}if(a(this,Ds)!==e){if(a(this,Le).size>0)for(const t of a(this,Le).values())t.remove(),e.append(t);y(this,Ds,e)}}static get _svgFactory(){return wt(this,"_svgFactory",new yc)}draw(e,t=!1,s=!1){const i=ke(se,yh)._++,n=E(this,ri,wu).call(this),r=se._svgFactory.createElement("defs");n.append(r);const o=se._svgFactory.createElement("path");r.append(o);const l=`path_p${this.pageIndex}_${i}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke"),t&&a(this,Xr).set(i,o);const h=s?E(this,ri,yg).call(this,r,l):null,c=se._svgFactory.createElement("use");return n.append(c),c.setAttribute("href",`#${l}`),this.updateProperties(n,e),a(this,Le).set(i,n),{id:i,clipPathId:`url(#${h})`}}drawOutline(e,t){const s=ke(se,yh)._++,i=E(this,ri,wu).call(this),n=se._svgFactory.createElement("defs");i.append(n);const r=se._svgFactory.createElement("path");n.append(r);const o=`path_p${this.pageIndex}_${s}`;r.setAttribute("id",o),r.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){const d=se._svgFactory.createElement("mask");n.append(d),l=`mask_p${this.pageIndex}_${s}`,d.setAttribute("id",l),d.setAttribute("maskUnits","objectBoundingBox");const f=se._svgFactory.createElement("rect");d.append(f),f.setAttribute("width","1"),f.setAttribute("height","1"),f.setAttribute("fill","white");const u=se._svgFactory.createElement("use");d.append(u),u.setAttribute("href",`#${o}`),u.setAttribute("stroke","none"),u.setAttribute("fill","black"),u.setAttribute("fill-rule","nonzero"),u.classList.add("mask")}const h=se._svgFactory.createElement("use");i.append(h),h.setAttribute("href",`#${o}`),l&&h.setAttribute("mask",`url(#${l})`);const c=h.cloneNode();return i.append(c),h.classList.add("mainOutline"),c.classList.add("secondaryOutline"),this.updateProperties(i,e),a(this,Le).set(s,i),s}finalizeDraw(e,t){a(this,Xr).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var l;if(!t)return;const{root:s,bbox:i,rootClass:n,path:r}=t,o=typeof e=="number"?a(this,Le).get(e):e;if(o){if(s&&E(this,ri,Au).call(this,o,s),i&&E(l=se,Uc,bg).call(l,o,i),n){const{classList:h}=o;for(const[c,d]of Object.entries(n))h.toggle(c,d)}if(r){const c=o.firstChild.firstChild;E(this,ri,Au).call(this,c,r)}}}updateParent(e,t){if(t===this)return;const s=a(this,Le).get(e);s&&(a(t,Ds).append(s),a(this,Le).delete(e),a(t,Le).set(e,s))}remove(e){a(this,Xr).delete(e),a(this,Ds)!==null&&(a(this,Le).get(e).remove(),a(this,Le).delete(e))}destroy(){y(this,Ds,null);for(const e of a(this,Le).values())e.remove();a(this,Le).clear(),a(this,Xr).clear()}};Ds=new WeakMap,Le=new WeakMap,Xr=new WeakMap,yh=new WeakMap,Uc=new WeakSet,bg=function(e,[t,s,i,n]){const{style:r}=e;r.top=`${100*s}%`,r.left=`${100*t}%`,r.width=`${100*i}%`,r.height=`${100*n}%`},ri=new WeakSet,wu=function(){const e=se._svgFactory.create(1,1,!0);return a(this,Ds).append(e),e.setAttribute("aria-hidden",!0),e},yg=function(e,t){const s=se._svgFactory.createElement("clipPath");e.append(s);const i=`clip_${t}`;s.setAttribute("id",i),s.setAttribute("clipPathUnits","objectBoundingBox");const n=se._svgFactory.createElement("use");return s.append(n),n.setAttribute("href",`#${t}`),n.classList.add("clip"),i},Au=function(e,t){for(const[s,i]of Object.entries(t))i===null?e.removeAttribute(s):e.setAttribute(s,i)},S(se,Uc),S(se,yh,0);let _u=se;globalThis._pdfjsTestingUtils={HighlightOutliner:Kd};globalThis.pdfjsLib={AbortException:Ln,AnnotationEditorLayer:mu,AnnotationEditorParamsType:At,AnnotationEditorType:ft,AnnotationEditorUIManager:Yr,AnnotationLayer:Wd,AnnotationMode:Xi,AnnotationType:Zt,build:Ym,ColorPicker:wc,createValidAbsoluteUrl:cf,DOMSVGFactory:yc,DrawLayer:_u,FeatureTest:we,fetchData:wh,getDocument:Gm,getFilenameFromUrl:Hg,getPdfFilenameFromUrl:Ug,getUuid:ff,getXfaPageViewport:Gg,GlobalWorkerOptions:Ui,ImageKind:Oh,InvalidPDFException:rd,isDataScheme:Wc,isPdfFile:Eu,isValidExplicitDest:tm,MathClamp:De,noContextMenu:Ns,normalizeUnicode:Og,OPS:pc,OutputScale:ni,PasswordResponses:Tg,PDFDataRangeTransport:gp,PDFDateString:xu,PDFWorker:Wo,PermissionFlag:kg,PixelsPerInch:Mn,RenderingCancelledException:Su,ResponseException:gc,setLayerDimensions:qr,shadow:wt,SignatureExtractor:ji,stopEvent:Jt,SupportedImageMimeTypes:od,TextLayer:Go,TouchManager:bc,updateUrlHash:df,Util:lt,VerbosityLevel:jc,version:qm,XfaLayer:yp};const Ab="/assets/pdf.worker.min-BFAMBS4k.mjs";var _g={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(g,e){(function(t){g.exports=t()})(function(){return function t(s,i,n){function r(h,c){if(!i[h]){if(!s[h]){var d=typeof Rh=="function"&&Rh;if(!c&&d)return d(h,!0);if(o)return o(h,!0);var f=new Error("Cannot find module '"+h+"'");throw f.code="MODULE_NOT_FOUND",f}var u=i[h]={exports:{}};s[h][0].call(u.exports,function(m){var p=s[h][1][m];return r(p||m)},u,u.exports,t,s,i,n)}return i[h].exports}for(var o=typeof Rh=="function"&&Rh,l=0;l<n.length;l++)r(n[l]);return r}({1:[function(t,s,i){var n=t("./utils"),r=t("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(l){for(var h,c,d,f,u,m,p,_=[],b=0,A=l.length,x=A,k=n.getTypeOf(l)!=="string";b<l.length;)x=A-b,d=k?(h=l[b++],c=b<A?l[b++]:0,b<A?l[b++]:0):(h=l.charCodeAt(b++),c=b<A?l.charCodeAt(b++):0,b<A?l.charCodeAt(b++):0),f=h>>2,u=(3&h)<<4|c>>4,m=1<x?(15&c)<<2|d>>6:64,p=2<x?63&d:64,_.push(o.charAt(f)+o.charAt(u)+o.charAt(m)+o.charAt(p));return _.join("")},i.decode=function(l){var h,c,d,f,u,m,p=0,_=0,b="data:";if(l.substr(0,b.length)===b)throw new Error("Invalid base64 input, it looks like a data url.");var A,x=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===o.charAt(64)&&x--,l.charAt(l.length-2)===o.charAt(64)&&x--,x%1!=0)throw new Error("Invalid base64 input, bad content length.");for(A=r.uint8array?new Uint8Array(0|x):new Array(0|x);p<l.length;)h=o.indexOf(l.charAt(p++))<<2|(f=o.indexOf(l.charAt(p++)))>>4,c=(15&f)<<4|(u=o.indexOf(l.charAt(p++)))>>2,d=(3&u)<<6|(m=o.indexOf(l.charAt(p++))),A[_++]=h,u!==64&&(A[_++]=c),m!==64&&(A[_++]=d);return A}},{"./support":30,"./utils":32}],2:[function(t,s,i){var n=t("./external"),r=t("./stream/DataWorker"),o=t("./stream/Crc32Probe"),l=t("./stream/DataLengthProbe");function h(c,d,f,u,m){this.compressedSize=c,this.uncompressedSize=d,this.crc32=f,this.compression=u,this.compressedContent=m}h.prototype={getContentWorker:function(){var c=new r(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),d=this;return c.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),c},getCompressedWorker:function(){return new r(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},h.createWorkerFrom=function(c,d,f){return c.pipe(new o).pipe(new l("uncompressedSize")).pipe(d.compressWorker(f)).pipe(new l("compressedSize")).withStreamInfo("compression",d)},s.exports=h},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,s,i){var n=t("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},i.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,s,i){var n=t("./utils"),r=function(){for(var o,l=[],h=0;h<256;h++){o=h;for(var c=0;c<8;c++)o=1&o?3988292384^o>>>1:o>>>1;l[h]=o}return l}();s.exports=function(o,l){return o!==void 0&&o.length?n.getTypeOf(o)!=="string"?function(h,c,d,f){var u=r,m=f+d;h^=-1;for(var p=f;p<m;p++)h=h>>>8^u[255&(h^c[p])];return-1^h}(0|l,o,o.length,0):function(h,c,d,f){var u=r,m=f+d;h^=-1;for(var p=f;p<m;p++)h=h>>>8^u[255&(h^c.charCodeAt(p))];return-1^h}(0|l,o,o.length,0):0}},{"./utils":32}],5:[function(t,s,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(t,s,i){var n=null;n=typeof Promise<"u"?Promise:t("lie"),s.exports={Promise:n}},{lie:37}],7:[function(t,s,i){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",r=t("pako"),o=t("./utils"),l=t("./stream/GenericWorker"),h=n?"uint8array":"array";function c(d,f){l.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=f,this.meta={}}i.magic="\b\0",o.inherits(c,l),c.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(h,d.data),!1)},c.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},c.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},c.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(f){d.push({data:f,meta:d.meta})}},i.compressWorker=function(d){return new c("Deflate",d)},i.uncompressWorker=function(){return new c("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,s,i){function n(u,m){var p,_="";for(p=0;p<m;p++)_+=String.fromCharCode(255&u),u>>>=8;return _}function r(u,m,p,_,b,A){var x,k,C=u.file,P=u.compression,R=A!==h.utf8encode,D=o.transformTo("string",A(C.name)),M=o.transformTo("string",h.utf8encode(C.name)),U=C.comment,$=o.transformTo("string",A(U)),L=o.transformTo("string",h.utf8encode(U)),z=M.length!==C.name.length,v=L.length!==U.length,G="",V="",O="",dt=C.dir,Y=C.date,ht={crc32:0,compressedSize:0,uncompressedSize:0};m&&!p||(ht.crc32=u.crc32,ht.compressedSize=u.compressedSize,ht.uncompressedSize=u.uncompressedSize);var H=0;m&&(H|=8),R||!z&&!v||(H|=2048);var N=0,st=0;dt&&(N|=16),b==="UNIX"?(st=798,N|=function(Z,kt){var yt=Z;return Z||(yt=kt?16893:33204),(65535&yt)<<16}(C.unixPermissions,dt)):(st=20,N|=function(Z){return 63&(Z||0)}(C.dosPermissions)),x=Y.getUTCHours(),x<<=6,x|=Y.getUTCMinutes(),x<<=5,x|=Y.getUTCSeconds()/2,k=Y.getUTCFullYear()-1980,k<<=4,k|=Y.getUTCMonth()+1,k<<=5,k|=Y.getUTCDate(),z&&(V=n(1,1)+n(c(D),4)+M,G+="up"+n(V.length,2)+V),v&&(O=n(1,1)+n(c($),4)+L,G+="uc"+n(O.length,2)+O);var et="";return et+=`
\0`,et+=n(H,2),et+=P.magic,et+=n(x,2),et+=n(k,2),et+=n(ht.crc32,4),et+=n(ht.compressedSize,4),et+=n(ht.uncompressedSize,4),et+=n(D.length,2),et+=n(G.length,2),{fileRecord:d.LOCAL_FILE_HEADER+et+D+G,dirRecord:d.CENTRAL_FILE_HEADER+n(st,2)+et+n($.length,2)+"\0\0\0\0"+n(N,4)+n(_,4)+D+G+$}}var o=t("../utils"),l=t("../stream/GenericWorker"),h=t("../utf8"),c=t("../crc32"),d=t("../signature");function f(u,m,p,_){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=p,this.encodeFileName=_,this.streamFiles=u,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(f,l),f.prototype.push=function(u){var m=u.meta.percent||0,p=this.entriesCount,_=this._sources.length;this.accumulate?this.contentBuffer.push(u):(this.bytesWritten+=u.data.length,l.prototype.push.call(this,{data:u.data,meta:{currentFile:this.currentFile,percent:p?(m+100*(p-_-1))/p:100}}))},f.prototype.openedSource=function(u){this.currentSourceOffset=this.bytesWritten,this.currentFile=u.file.name;var m=this.streamFiles&&!u.file.dir;if(m){var p=r(u,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(u){this.accumulate=!1;var m=this.streamFiles&&!u.file.dir,p=r(u,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),m)this.push({data:function(_){return d.DATA_DESCRIPTOR+n(_.crc32,4)+n(_.compressedSize,4)+n(_.uncompressedSize,4)}(u),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var u=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var p=this.bytesWritten-u,_=function(b,A,x,k,C){var P=o.transformTo("string",C(k));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(b,2)+n(b,2)+n(A,4)+n(x,4)+n(P.length,2)+P}(this.dirRecords.length,p,u,this.zipComment,this.encodeFileName);this.push({data:_,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(u){this._sources.push(u);var m=this;return u.on("data",function(p){m.processChunk(p)}),u.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),u.on("error",function(p){m.error(p)}),this},f.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(u){var m=this._sources;if(!l.prototype.error.call(this,u))return!1;for(var p=0;p<m.length;p++)try{m[p].error(u)}catch{}return!0},f.prototype.lock=function(){l.prototype.lock.call(this);for(var u=this._sources,m=0;m<u.length;m++)u[m].lock()},s.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,s,i){var n=t("../compressions"),r=t("./ZipFileWorker");i.generateWorker=function(o,l,h){var c=new r(l.streamFiles,h,l.platform,l.encodeFileName),d=0;try{o.forEach(function(f,u){d++;var m=function(A,x){var k=A||x,C=n[k];if(!C)throw new Error(k+" is not a valid compression method !");return C}(u.options.compression,l.compression),p=u.options.compressionOptions||l.compressionOptions||{},_=u.dir,b=u.date;u._compressWorker(m,p).withStreamInfo("file",{name:f,dir:_,date:b,comment:u.comment||"",unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions}).pipe(c)}),c.entriesCount=d}catch(f){c.error(f)}return c}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,s,i){function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var r=new n;for(var o in this)typeof this[o]!="function"&&(r[o]=this[o]);return r}}(n.prototype=t("./object")).loadAsync=t("./load"),n.support=t("./support"),n.defaults=t("./defaults"),n.version="3.10.1",n.loadAsync=function(r,o){return new n().loadAsync(r,o)},n.external=t("./external"),s.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,s,i){var n=t("./utils"),r=t("./external"),o=t("./utf8"),l=t("./zipEntries"),h=t("./stream/Crc32Probe"),c=t("./nodejsUtils");function d(f){return new r.Promise(function(u,m){var p=f.decompressed.getContentWorker().pipe(new h);p.on("error",function(_){m(_)}).on("end",function(){p.streamInfo.crc32!==f.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):u()}).resume()})}s.exports=function(f,u){var m=this;return u=n.extend(u||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),c.isNode&&c.isStream(f)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",f,!0,u.optimizedBinaryString,u.base64).then(function(p){var _=new l(u);return _.load(p),_}).then(function(p){var _=[r.Promise.resolve(p)],b=p.files;if(u.checkCRC32)for(var A=0;A<b.length;A++)_.push(d(b[A]));return r.Promise.all(_)}).then(function(p){for(var _=p.shift(),b=_.files,A=0;A<b.length;A++){var x=b[A],k=x.fileNameStr,C=n.resolve(x.fileNameStr);m.file(C,x.decompressed,{binary:!0,optimizedBinaryString:!0,date:x.date,dir:x.dir,comment:x.fileCommentStr.length?x.fileCommentStr:null,unixPermissions:x.unixPermissions,dosPermissions:x.dosPermissions,createFolders:u.createFolders}),x.dir||(m.file(C).unsafeOriginalName=k)}return _.zipComment.length&&(m.comment=_.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,s,i){var n=t("../utils"),r=t("../stream/GenericWorker");function o(l,h){r.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(h)}n.inherits(o,r),o.prototype._bindStream=function(l){var h=this;(this._stream=l).pause(),l.on("data",function(c){h.push({data:c,meta:{percent:0}})}).on("error",function(c){h.isPaused?this.generatedError=c:h.error(c)}).on("end",function(){h.isPaused?h._upstreamEnded=!0:h.end()})},o.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,s,i){var n=t("readable-stream").Readable;function r(o,l,h){n.call(this,l),this._helper=o;var c=this;o.on("data",function(d,f){c.push(d)||c._helper.pause(),h&&h(f)}).on("error",function(d){c.emit("error",d)}).on("end",function(){c.push(null)})}t("../utils").inherits(r,n),r.prototype._read=function(){this._helper.resume()},s.exports=r},{"../utils":32,"readable-stream":16}],14:[function(t,s,i){s.exports={isNode:typeof Buffer<"u",newBufferFrom:function(n,r){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(n,r);if(typeof n=="number")throw new Error('The "data" argument must not be a number');return new Buffer(n,r)},allocBuffer:function(n){if(Buffer.alloc)return Buffer.alloc(n);var r=new Buffer(n);return r.fill(0),r},isBuffer:function(n){return Buffer.isBuffer(n)},isStream:function(n){return n&&typeof n.on=="function"&&typeof n.pause=="function"&&typeof n.resume=="function"}}},{}],15:[function(t,s,i){function n(C,P,R){var D,M=o.getTypeOf(P),U=o.extend(R||{},c);U.date=U.date||new Date,U.compression!==null&&(U.compression=U.compression.toUpperCase()),typeof U.unixPermissions=="string"&&(U.unixPermissions=parseInt(U.unixPermissions,8)),U.unixPermissions&&16384&U.unixPermissions&&(U.dir=!0),U.dosPermissions&&16&U.dosPermissions&&(U.dir=!0),U.dir&&(C=b(C)),U.createFolders&&(D=_(C))&&A.call(this,D,!0);var $=M==="string"&&U.binary===!1&&U.base64===!1;R&&R.binary!==void 0||(U.binary=!$),(P instanceof d&&P.uncompressedSize===0||U.dir||!P||P.length===0)&&(U.base64=!1,U.binary=!0,P="",U.compression="STORE",M="string");var L=null;L=P instanceof d||P instanceof l?P:m.isNode&&m.isStream(P)?new p(C,P):o.prepareContent(C,P,U.binary,U.optimizedBinaryString,U.base64);var z=new f(C,L,U);this.files[C]=z}var r=t("./utf8"),o=t("./utils"),l=t("./stream/GenericWorker"),h=t("./stream/StreamHelper"),c=t("./defaults"),d=t("./compressedObject"),f=t("./zipObject"),u=t("./generate"),m=t("./nodejsUtils"),p=t("./nodejs/NodejsStreamInputAdapter"),_=function(C){C.slice(-1)==="/"&&(C=C.substring(0,C.length-1));var P=C.lastIndexOf("/");return 0<P?C.substring(0,P):""},b=function(C){return C.slice(-1)!=="/"&&(C+="/"),C},A=function(C,P){return P=P!==void 0?P:c.createFolders,C=b(C),this.files[C]||n.call(this,C,null,{dir:!0,createFolders:P}),this.files[C]};function x(C){return Object.prototype.toString.call(C)==="[object RegExp]"}var k={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(C){var P,R,D;for(P in this.files)D=this.files[P],(R=P.slice(this.root.length,P.length))&&P.slice(0,this.root.length)===this.root&&C(R,D)},filter:function(C){var P=[];return this.forEach(function(R,D){C(R,D)&&P.push(D)}),P},file:function(C,P,R){if(arguments.length!==1)return C=this.root+C,n.call(this,C,P,R),this;if(x(C)){var D=C;return this.filter(function(U,$){return!$.dir&&D.test(U)})}var M=this.files[this.root+C];return M&&!M.dir?M:null},folder:function(C){if(!C)return this;if(x(C))return this.filter(function(M,U){return U.dir&&C.test(M)});var P=this.root+C,R=A.call(this,P),D=this.clone();return D.root=R.name,D},remove:function(C){C=this.root+C;var P=this.files[C];if(P||(C.slice(-1)!=="/"&&(C+="/"),P=this.files[C]),P&&!P.dir)delete this.files[C];else for(var R=this.filter(function(M,U){return U.name.slice(0,C.length)===C}),D=0;D<R.length;D++)delete this.files[R[D].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(C){var P,R={};try{if((R=o.extend(C||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=R.type.toLowerCase(),R.compression=R.compression.toUpperCase(),R.type==="binarystring"&&(R.type="string"),!R.type)throw new Error("No output type specified.");o.checkSupport(R.type),R.platform!=="darwin"&&R.platform!=="freebsd"&&R.platform!=="linux"&&R.platform!=="sunos"||(R.platform="UNIX"),R.platform==="win32"&&(R.platform="DOS");var D=R.comment||this.comment||"";P=u.generateWorker(this,R,D)}catch(M){(P=new l("error")).error(M)}return new h(P,R.type||"string",R.mimeType)},generateAsync:function(C,P){return this.generateInternalStream(C).accumulate(P)},generateNodeStream:function(C,P){return(C=C||{}).type||(C.type="nodebuffer"),this.generateInternalStream(C).toNodejsStream(P)}};s.exports=k},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,s,i){s.exports=t("stream")},{stream:void 0}],17:[function(t,s,i){var n=t("./DataReader");function r(o){n.call(this,o);for(var l=0;l<this.data.length;l++)o[l]=255&o[l]}t("../utils").inherits(r,n),r.prototype.byteAt=function(o){return this.data[this.zero+o]},r.prototype.lastIndexOfSignature=function(o){for(var l=o.charCodeAt(0),h=o.charCodeAt(1),c=o.charCodeAt(2),d=o.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===l&&this.data[f+1]===h&&this.data[f+2]===c&&this.data[f+3]===d)return f-this.zero;return-1},r.prototype.readAndCheckSignature=function(o){var l=o.charCodeAt(0),h=o.charCodeAt(1),c=o.charCodeAt(2),d=o.charCodeAt(3),f=this.readData(4);return l===f[0]&&h===f[1]&&c===f[2]&&d===f[3]},r.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},s.exports=r},{"../utils":32,"./DataReader":18}],18:[function(t,s,i){var n=t("../utils");function r(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var l,h=0;for(this.checkOffset(o),l=this.index+o-1;l>=this.index;l--)h=(h<<8)+this.byteAt(l);return this.index+=o,h},readString:function(o){return n.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},s.exports=r},{"../utils":32}],19:[function(t,s,i){var n=t("./Uint8ArrayReader");function r(o){n.call(this,o)}t("../utils").inherits(r,n),r.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},s.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,s,i){var n=t("./DataReader");function r(o){n.call(this,o)}t("../utils").inherits(r,n),r.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},r.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},r.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},r.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},s.exports=r},{"../utils":32,"./DataReader":18}],21:[function(t,s,i){var n=t("./ArrayReader");function r(o){n.call(this,o)}t("../utils").inherits(r,n),r.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},s.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(t,s,i){var n=t("../utils"),r=t("../support"),o=t("./ArrayReader"),l=t("./StringReader"),h=t("./NodeBufferReader"),c=t("./Uint8ArrayReader");s.exports=function(d){var f=n.getTypeOf(d);return n.checkSupport(f),f!=="string"||r.uint8array?f==="nodebuffer"?new h(d):r.uint8array?new c(n.transformTo("uint8array",d)):new o(n.transformTo("array",d)):new l(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,s,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,s,i){var n=t("./GenericWorker"),r=t("../utils");function o(l){n.call(this,"ConvertWorker to "+l),this.destType=l}r.inherits(o,n),o.prototype.processChunk=function(l){this.push({data:r.transformTo(this.destType,l.data),meta:l.meta})},s.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(t,s,i){var n=t("./GenericWorker"),r=t("../crc32");function o(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(o,n),o.prototype.processChunk=function(l){this.streamInfo.crc32=r(l.data,this.streamInfo.crc32||0),this.push(l)},s.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,s,i){var n=t("../utils"),r=t("./GenericWorker");function o(l){r.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}n.inherits(o,r),o.prototype.processChunk=function(l){if(l){var h=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=h+l.data.length}r.prototype.processChunk.call(this,l)},s.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(t,s,i){var n=t("../utils"),r=t("./GenericWorker");function o(l){r.call(this,"DataWorker");var h=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(c){h.dataIsReady=!0,h.data=c,h.max=c&&c.length||0,h.type=n.getTypeOf(c),h.isPaused||h._tickAndRepeat()},function(c){h.error(c)})}n.inherits(o,r),o.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,h=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,h);break;case"uint8array":l=this.data.subarray(this.index,h);break;case"array":case"nodebuffer":l=this.data.slice(this.index,h)}return this.index=h,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(t,s,i){function n(r){this.name=r||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(r){this.emit("data",r)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(r){this.emit("error",r)}return!0},error:function(r){return!this.isFinished&&(this.isPaused?this.generatedError=r:(this.isFinished=!0,this.emit("error",r),this.previous&&this.previous.error(r),this.cleanUp()),!0)},on:function(r,o){return this._listeners[r].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(r,o){if(this._listeners[r])for(var l=0;l<this._listeners[r].length;l++)this._listeners[r][l].call(this,o)},pipe:function(r){return r.registerPrevious(this)},registerPrevious:function(r){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=r.streamInfo,this.mergeStreamInfo(),this.previous=r;var o=this;return r.on("data",function(l){o.processChunk(l)}),r.on("end",function(){o.end()}),r.on("error",function(l){o.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var r=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),r=!0),this.previous&&this.previous.resume(),!r},flush:function(){},processChunk:function(r){this.push(r)},withStreamInfo:function(r,o){return this.extraStreamInfo[r]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var r in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,r)&&(this.streamInfo[r]=this.extraStreamInfo[r])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var r="Worker "+this.name;return this.previous?this.previous+" -> "+r:r}},s.exports=n},{}],29:[function(t,s,i){var n=t("../utils"),r=t("./ConvertWorker"),o=t("./GenericWorker"),l=t("../base64"),h=t("../support"),c=t("../external"),d=null;if(h.nodestream)try{d=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(m,p){return new c.Promise(function(_,b){var A=[],x=m._internalType,k=m._outputType,C=m._mimeType;m.on("data",function(P,R){A.push(P),p&&p(R)}).on("error",function(P){A=[],b(P)}).on("end",function(){try{var P=function(R,D,M){switch(R){case"blob":return n.newBlob(n.transformTo("arraybuffer",D),M);case"base64":return l.encode(D);default:return n.transformTo(R,D)}}(k,function(R,D){var M,U=0,$=null,L=0;for(M=0;M<D.length;M++)L+=D[M].length;switch(R){case"string":return D.join("");case"array":return Array.prototype.concat.apply([],D);case"uint8array":for($=new Uint8Array(L),M=0;M<D.length;M++)$.set(D[M],U),U+=D[M].length;return $;case"nodebuffer":return Buffer.concat(D);default:throw new Error("concat : unsupported type '"+R+"'")}}(x,A),C);_(P)}catch(R){b(R)}A=[]}).resume()})}function u(m,p,_){var b=p;switch(p){case"blob":case"arraybuffer":b="uint8array";break;case"base64":b="string"}try{this._internalType=b,this._outputType=p,this._mimeType=_,n.checkSupport(b),this._worker=m.pipe(new r(b)),m.lock()}catch(A){this._worker=new o("error"),this._worker.error(A)}}u.prototype={accumulate:function(m){return f(this,m)},on:function(m,p){var _=this;return m==="data"?this._worker.on(m,function(b){p.call(_,b.data,b.meta)}):this._worker.on(m,function(){n.delay(p,arguments,_)}),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(n.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},m)}},s.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,s,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var n=new ArrayBuffer(0);try{i.blob=new Blob([n],{type:"application/zip"}).size===0}catch{try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(n),i.blob=r.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!t("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(t,s,i){for(var n=t("./utils"),r=t("./support"),o=t("./nodejsUtils"),l=t("./stream/GenericWorker"),h=new Array(256),c=0;c<256;c++)h[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;h[254]=h[254]=1;function d(){l.call(this,"utf-8 decode"),this.leftOver=null}function f(){l.call(this,"utf-8 encode")}i.utf8encode=function(u){return r.nodebuffer?o.newBufferFrom(u,"utf-8"):function(m){var p,_,b,A,x,k=m.length,C=0;for(A=0;A<k;A++)(64512&(_=m.charCodeAt(A)))==55296&&A+1<k&&(64512&(b=m.charCodeAt(A+1)))==56320&&(_=65536+(_-55296<<10)+(b-56320),A++),C+=_<128?1:_<2048?2:_<65536?3:4;for(p=r.uint8array?new Uint8Array(C):new Array(C),A=x=0;x<C;A++)(64512&(_=m.charCodeAt(A)))==55296&&A+1<k&&(64512&(b=m.charCodeAt(A+1)))==56320&&(_=65536+(_-55296<<10)+(b-56320),A++),_<128?p[x++]=_:(_<2048?p[x++]=192|_>>>6:(_<65536?p[x++]=224|_>>>12:(p[x++]=240|_>>>18,p[x++]=128|_>>>12&63),p[x++]=128|_>>>6&63),p[x++]=128|63&_);return p}(u)},i.utf8decode=function(u){return r.nodebuffer?n.transformTo("nodebuffer",u).toString("utf-8"):function(m){var p,_,b,A,x=m.length,k=new Array(2*x);for(p=_=0;p<x;)if((b=m[p++])<128)k[_++]=b;else if(4<(A=h[b]))k[_++]=65533,p+=A-1;else{for(b&=A===2?31:A===3?15:7;1<A&&p<x;)b=b<<6|63&m[p++],A--;1<A?k[_++]=65533:b<65536?k[_++]=b:(b-=65536,k[_++]=55296|b>>10&1023,k[_++]=56320|1023&b)}return k.length!==_&&(k.subarray?k=k.subarray(0,_):k.length=_),n.applyFromCharCode(k)}(u=n.transformTo(r.uint8array?"uint8array":"array",u))},n.inherits(d,l),d.prototype.processChunk=function(u){var m=n.transformTo(r.uint8array?"uint8array":"array",u.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var p=m;(m=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),m.set(p,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var _=function(A,x){var k;for((x=x||A.length)>A.length&&(x=A.length),k=x-1;0<=k&&(192&A[k])==128;)k--;return k<0||k===0?x:k+h[A[k]]>x?k:x}(m),b=m;_!==m.length&&(r.uint8array?(b=m.subarray(0,_),this.leftOver=m.subarray(_,m.length)):(b=m.slice(0,_),this.leftOver=m.slice(_,m.length))),this.push({data:i.utf8decode(b),meta:u.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=d,n.inherits(f,l),f.prototype.processChunk=function(u){this.push({data:i.utf8encode(u.data),meta:u.meta})},i.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,s,i){var n=t("./support"),r=t("./base64"),o=t("./nodejsUtils"),l=t("./external");function h(p){return p}function c(p,_){for(var b=0;b<p.length;++b)_[b]=255&p.charCodeAt(b);return _}t("setimmediate"),i.newBlob=function(p,_){i.checkSupport("blob");try{return new Blob([p],{type:_})}catch{try{var b=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return b.append(p),b.getBlob(_)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(p,_,b){var A=[],x=0,k=p.length;if(k<=b)return String.fromCharCode.apply(null,p);for(;x<k;)_==="array"||_==="nodebuffer"?A.push(String.fromCharCode.apply(null,p.slice(x,Math.min(x+b,k)))):A.push(String.fromCharCode.apply(null,p.subarray(x,Math.min(x+b,k)))),x+=b;return A.join("")},stringifyByChar:function(p){for(var _="",b=0;b<p.length;b++)_+=String.fromCharCode(p[b]);return _},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function f(p){var _=65536,b=i.getTypeOf(p),A=!0;if(b==="uint8array"?A=d.applyCanBeUsed.uint8array:b==="nodebuffer"&&(A=d.applyCanBeUsed.nodebuffer),A)for(;1<_;)try{return d.stringifyByChunk(p,b,_)}catch{_=Math.floor(_/2)}return d.stringifyByChar(p)}function u(p,_){for(var b=0;b<p.length;b++)_[b]=p[b];return _}i.applyFromCharCode=f;var m={};m.string={string:h,array:function(p){return c(p,new Array(p.length))},arraybuffer:function(p){return m.string.uint8array(p).buffer},uint8array:function(p){return c(p,new Uint8Array(p.length))},nodebuffer:function(p){return c(p,o.allocBuffer(p.length))}},m.array={string:f,array:h,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return o.newBufferFrom(p)}},m.arraybuffer={string:function(p){return f(new Uint8Array(p))},array:function(p){return u(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:h,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return o.newBufferFrom(new Uint8Array(p))}},m.uint8array={string:f,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:h,nodebuffer:function(p){return o.newBufferFrom(p)}},m.nodebuffer={string:f,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return m.nodebuffer.uint8array(p).buffer},uint8array:function(p){return u(p,new Uint8Array(p.length))},nodebuffer:h},i.transformTo=function(p,_){if(_=_||"",!p)return _;i.checkSupport(p);var b=i.getTypeOf(_);return m[b][p](_)},i.resolve=function(p){for(var _=p.split("/"),b=[],A=0;A<_.length;A++){var x=_[A];x==="."||x===""&&A!==0&&A!==_.length-1||(x===".."?b.pop():b.push(x))}return b.join("/")},i.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":n.nodebuffer&&o.isBuffer(p)?"nodebuffer":n.uint8array&&p instanceof Uint8Array?"uint8array":n.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(p){if(!n[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(p){var _,b,A="";for(b=0;b<(p||"").length;b++)A+="\\x"+((_=p.charCodeAt(b))<16?"0":"")+_.toString(16).toUpperCase();return A},i.delay=function(p,_,b){setImmediate(function(){p.apply(b||null,_||[])})},i.inherits=function(p,_){function b(){}b.prototype=_.prototype,p.prototype=new b},i.extend=function(){var p,_,b={};for(p=0;p<arguments.length;p++)for(_ in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],_)&&b[_]===void 0&&(b[_]=arguments[p][_]);return b},i.prepareContent=function(p,_,b,A,x){return l.Promise.resolve(_).then(function(k){return n.blob&&(k instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(k))!==-1)&&typeof FileReader<"u"?new l.Promise(function(C,P){var R=new FileReader;R.onload=function(D){C(D.target.result)},R.onerror=function(D){P(D.target.error)},R.readAsArrayBuffer(k)}):k}).then(function(k){var C=i.getTypeOf(k);return C?(C==="arraybuffer"?k=i.transformTo("uint8array",k):C==="string"&&(x?k=r.decode(k):b&&A!==!0&&(k=function(P){return c(P,n.uint8array?new Uint8Array(P.length):new Array(P.length))}(k))),k):l.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,s,i){var n=t("./reader/readerFor"),r=t("./utils"),o=t("./signature"),l=t("./zipEntry"),h=t("./support");function c(d){this.files=[],this.loadOptions=d}c.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(f)+", expected "+r.pretty(d)+")")}},isSignature:function(d,f){var u=this.reader.index;this.reader.setIndex(d);var m=this.reader.readString(4)===f;return this.reader.setIndex(u),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),f=h.uint8array?"uint8array":"array",u=r.transformTo(f,d);this.zipComment=this.loadOptions.decodeFileName(u)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,f,u,m=this.zip64EndOfCentralSize-44;0<m;)d=this.reader.readInt(2),f=this.reader.readInt(4),u=this.reader.readData(f),this.zip64ExtensibleData[d]={id:d,length:f,value:u}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,f;for(d=0;d<this.files.length;d++)f=this.files[d],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(d=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var f=d;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var u=this.centralDirOffset+this.centralDirSize;this.zip64&&(u+=20,u+=12+this.zip64EndOfCentralSize);var m=f-u;if(0<m)this.isSignature(f,o.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(d){this.reader=n(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s.exports=c},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,s,i){var n=t("./reader/readerFor"),r=t("./utils"),o=t("./compressedObject"),l=t("./crc32"),h=t("./utf8"),c=t("./compressions"),d=t("./support");function f(u,m){this.options=u,this.loadOptions=m}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(u){var m,p;if(u.skip(22),this.fileNameLength=u.readInt(2),p=u.readInt(2),this.fileName=u.readData(this.fileNameLength),u.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(_){for(var b in c)if(Object.prototype.hasOwnProperty.call(c,b)&&c[b].magic===_)return c[b];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,m,u.readData(this.compressedSize))},readCentralPart:function(u){this.versionMadeBy=u.readInt(2),u.skip(2),this.bitFlag=u.readInt(2),this.compressionMethod=u.readString(2),this.date=u.readDate(),this.crc32=u.readInt(4),this.compressedSize=u.readInt(4),this.uncompressedSize=u.readInt(4);var m=u.readInt(2);if(this.extraFieldsLength=u.readInt(2),this.fileCommentLength=u.readInt(2),this.diskNumberStart=u.readInt(2),this.internalFileAttributes=u.readInt(2),this.externalFileAttributes=u.readInt(4),this.localHeaderOffset=u.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");u.skip(m),this.readExtraFields(u),this.parseZIP64ExtraField(u),this.fileComment=u.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var u=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),u==0&&(this.dosPermissions=63&this.externalFileAttributes),u==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var u=n(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=u.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=u.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=u.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=u.readInt(4))}},readExtraFields:function(u){var m,p,_,b=u.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});u.index+4<b;)m=u.readInt(2),p=u.readInt(2),_=u.readData(p),this.extraFields[m]={id:m,length:p,value:_};u.setIndex(b)},handleUTF8:function(){var u=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var p=r.transformTo(u,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var _=this.findExtraFieldUnicodeComment();if(_!==null)this.fileCommentStr=_;else{var b=r.transformTo(u,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(b)}}},findExtraFieldUnicodePath:function(){var u=this.extraFields[28789];if(u){var m=n(u.value);return m.readInt(1)!==1||l(this.fileName)!==m.readInt(4)?null:h.utf8decode(m.readData(u.length-5))}return null},findExtraFieldUnicodeComment:function(){var u=this.extraFields[25461];if(u){var m=n(u.value);return m.readInt(1)!==1||l(this.fileComment)!==m.readInt(4)?null:h.utf8decode(m.readData(u.length-5))}return null}},s.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,s,i){function n(m,p,_){this.name=m,this.dir=_.dir,this.date=_.date,this.comment=_.comment,this.unixPermissions=_.unixPermissions,this.dosPermissions=_.dosPermissions,this._data=p,this._dataBinary=_.binary,this.options={compression:_.compression,compressionOptions:_.compressionOptions}}var r=t("./stream/StreamHelper"),o=t("./stream/DataWorker"),l=t("./utf8"),h=t("./compressedObject"),c=t("./stream/GenericWorker");n.prototype={internalStream:function(m){var p=null,_="string";try{if(!m)throw new Error("No output type specified.");var b=(_=m.toLowerCase())==="string"||_==="text";_!=="binarystring"&&_!=="text"||(_="string"),p=this._decompressWorker();var A=!this._dataBinary;A&&!b&&(p=p.pipe(new l.Utf8EncodeWorker)),!A&&b&&(p=p.pipe(new l.Utf8DecodeWorker))}catch(x){(p=new c("error")).error(x)}return new r(p,_,"")},async:function(m,p){return this.internalStream(m).accumulate(p)},nodeStream:function(m,p){return this.internalStream(m||"nodebuffer").toNodejsStream(p)},_compressWorker:function(m,p){if(this._data instanceof h&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var _=this._decompressWorker();return this._dataBinary||(_=_.pipe(new l.Utf8EncodeWorker)),h.createWorkerFrom(_,m,p)},_decompressWorker:function(){return this._data instanceof h?this._data.getContentWorker():this._data instanceof c?this._data:new o(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<d.length;u++)n.prototype[d[u]]=f;s.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,s,i){(function(n){var r,o,l=n.MutationObserver||n.WebKitMutationObserver;if(l){var h=0,c=new l(m),d=n.document.createTextNode("");c.observe(d,{characterData:!0}),r=function(){d.data=h=++h%2}}else if(n.setImmediate||n.MessageChannel===void 0)r="document"in n&&"onreadystatechange"in n.document.createElement("script")?function(){var p=n.document.createElement("script");p.onreadystatechange=function(){m(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},n.document.documentElement.appendChild(p)}:function(){setTimeout(m,0)};else{var f=new n.MessageChannel;f.port1.onmessage=m,r=function(){f.port2.postMessage(0)}}var u=[];function m(){var p,_;o=!0;for(var b=u.length;b;){for(_=u,u=[],p=-1;++p<b;)_[p]();b=u.length}o=!1}s.exports=function(p){u.push(p)!==1||o||r()}}).call(this,typeof Th<"u"?Th:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,s,i){var n=t("immediate");function r(){}var o={},l=["REJECTED"],h=["FULFILLED"],c=["PENDING"];function d(b){if(typeof b!="function")throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,b!==r&&p(this,b)}function f(b,A,x){this.promise=b,typeof A=="function"&&(this.onFulfilled=A,this.callFulfilled=this.otherCallFulfilled),typeof x=="function"&&(this.onRejected=x,this.callRejected=this.otherCallRejected)}function u(b,A,x){n(function(){var k;try{k=A(x)}catch(C){return o.reject(b,C)}k===b?o.reject(b,new TypeError("Cannot resolve promise with itself")):o.resolve(b,k)})}function m(b){var A=b&&b.then;if(b&&(typeof b=="object"||typeof b=="function")&&typeof A=="function")return function(){A.apply(b,arguments)}}function p(b,A){var x=!1;function k(R){x||(x=!0,o.reject(b,R))}function C(R){x||(x=!0,o.resolve(b,R))}var P=_(function(){A(C,k)});P.status==="error"&&k(P.value)}function _(b,A){var x={};try{x.value=b(A),x.status="success"}catch(k){x.status="error",x.value=k}return x}(s.exports=d).prototype.finally=function(b){if(typeof b!="function")return this;var A=this.constructor;return this.then(function(x){return A.resolve(b()).then(function(){return x})},function(x){return A.resolve(b()).then(function(){throw x})})},d.prototype.catch=function(b){return this.then(null,b)},d.prototype.then=function(b,A){if(typeof b!="function"&&this.state===h||typeof A!="function"&&this.state===l)return this;var x=new this.constructor(r);return this.state!==c?u(x,this.state===h?b:A,this.outcome):this.queue.push(new f(x,b,A)),x},f.prototype.callFulfilled=function(b){o.resolve(this.promise,b)},f.prototype.otherCallFulfilled=function(b){u(this.promise,this.onFulfilled,b)},f.prototype.callRejected=function(b){o.reject(this.promise,b)},f.prototype.otherCallRejected=function(b){u(this.promise,this.onRejected,b)},o.resolve=function(b,A){var x=_(m,A);if(x.status==="error")return o.reject(b,x.value);var k=x.value;if(k)p(b,k);else{b.state=h,b.outcome=A;for(var C=-1,P=b.queue.length;++C<P;)b.queue[C].callFulfilled(A)}return b},o.reject=function(b,A){b.state=l,b.outcome=A;for(var x=-1,k=b.queue.length;++x<k;)b.queue[x].callRejected(A);return b},d.resolve=function(b){return b instanceof this?b:o.resolve(new this(r),b)},d.reject=function(b){var A=new this(r);return o.reject(A,b)},d.all=function(b){var A=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var x=b.length,k=!1;if(!x)return this.resolve([]);for(var C=new Array(x),P=0,R=-1,D=new this(r);++R<x;)M(b[R],R);return D;function M(U,$){A.resolve(U).then(function(L){C[$]=L,++P!==x||k||(k=!0,o.resolve(D,C))},function(L){k||(k=!0,o.reject(D,L))})}},d.race=function(b){var A=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var x=b.length,k=!1;if(!x)return this.resolve([]);for(var C=-1,P=new this(r);++C<x;)R=b[C],A.resolve(R).then(function(D){k||(k=!0,o.resolve(P,D))},function(D){k||(k=!0,o.reject(P,D))});var R;return P}},{immediate:36}],38:[function(t,s,i){var n={};(0,t("./lib/utils/common").assign)(n,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),s.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,s,i){var n=t("./zlib/deflate"),r=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/messages"),h=t("./zlib/zstream"),c=Object.prototype.toString,d=0,f=-1,u=0,m=8;function p(b){if(!(this instanceof p))return new p(b);this.options=r.assign({level:f,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},b||{});var A=this.options;A.raw&&0<A.windowBits?A.windowBits=-A.windowBits:A.gzip&&0<A.windowBits&&A.windowBits<16&&(A.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var x=n.deflateInit2(this.strm,A.level,A.method,A.windowBits,A.memLevel,A.strategy);if(x!==d)throw new Error(l[x]);if(A.header&&n.deflateSetHeader(this.strm,A.header),A.dictionary){var k;if(k=typeof A.dictionary=="string"?o.string2buf(A.dictionary):c.call(A.dictionary)==="[object ArrayBuffer]"?new Uint8Array(A.dictionary):A.dictionary,(x=n.deflateSetDictionary(this.strm,k))!==d)throw new Error(l[x]);this._dict_set=!0}}function _(b,A){var x=new p(A);if(x.push(b,!0),x.err)throw x.msg||l[x.err];return x.result}p.prototype.push=function(b,A){var x,k,C=this.strm,P=this.options.chunkSize;if(this.ended)return!1;k=A===~~A?A:A===!0?4:0,typeof b=="string"?C.input=o.string2buf(b):c.call(b)==="[object ArrayBuffer]"?C.input=new Uint8Array(b):C.input=b,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new r.Buf8(P),C.next_out=0,C.avail_out=P),(x=n.deflate(C,k))!==1&&x!==d)return this.onEnd(x),!(this.ended=!0);C.avail_out!==0&&(C.avail_in!==0||k!==4&&k!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(r.shrinkBuf(C.output,C.next_out))):this.onData(r.shrinkBuf(C.output,C.next_out)))}while((0<C.avail_in||C.avail_out===0)&&x!==1);return k===4?(x=n.deflateEnd(this.strm),this.onEnd(x),this.ended=!0,x===d):k!==2||(this.onEnd(d),!(C.avail_out=0))},p.prototype.onData=function(b){this.chunks.push(b)},p.prototype.onEnd=function(b){b===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},i.Deflate=p,i.deflate=_,i.deflateRaw=function(b,A){return(A=A||{}).raw=!0,_(b,A)},i.gzip=function(b,A){return(A=A||{}).gzip=!0,_(b,A)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,s,i){var n=t("./zlib/inflate"),r=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/constants"),h=t("./zlib/messages"),c=t("./zlib/zstream"),d=t("./zlib/gzheader"),f=Object.prototype.toString;function u(p){if(!(this instanceof u))return new u(p);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},p||{});var _=this.options;_.raw&&0<=_.windowBits&&_.windowBits<16&&(_.windowBits=-_.windowBits,_.windowBits===0&&(_.windowBits=-15)),!(0<=_.windowBits&&_.windowBits<16)||p&&p.windowBits||(_.windowBits+=32),15<_.windowBits&&_.windowBits<48&&!(15&_.windowBits)&&(_.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var b=n.inflateInit2(this.strm,_.windowBits);if(b!==l.Z_OK)throw new Error(h[b]);this.header=new d,n.inflateGetHeader(this.strm,this.header)}function m(p,_){var b=new u(_);if(b.push(p,!0),b.err)throw b.msg||h[b.err];return b.result}u.prototype.push=function(p,_){var b,A,x,k,C,P,R=this.strm,D=this.options.chunkSize,M=this.options.dictionary,U=!1;if(this.ended)return!1;A=_===~~_?_:_===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof p=="string"?R.input=o.binstring2buf(p):f.call(p)==="[object ArrayBuffer]"?R.input=new Uint8Array(p):R.input=p,R.next_in=0,R.avail_in=R.input.length;do{if(R.avail_out===0&&(R.output=new r.Buf8(D),R.next_out=0,R.avail_out=D),(b=n.inflate(R,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&M&&(P=typeof M=="string"?o.string2buf(M):f.call(M)==="[object ArrayBuffer]"?new Uint8Array(M):M,b=n.inflateSetDictionary(this.strm,P)),b===l.Z_BUF_ERROR&&U===!0&&(b=l.Z_OK,U=!1),b!==l.Z_STREAM_END&&b!==l.Z_OK)return this.onEnd(b),!(this.ended=!0);R.next_out&&(R.avail_out!==0&&b!==l.Z_STREAM_END&&(R.avail_in!==0||A!==l.Z_FINISH&&A!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(x=o.utf8border(R.output,R.next_out),k=R.next_out-x,C=o.buf2string(R.output,x),R.next_out=k,R.avail_out=D-k,k&&r.arraySet(R.output,R.output,x,k,0),this.onData(C)):this.onData(r.shrinkBuf(R.output,R.next_out)))),R.avail_in===0&&R.avail_out===0&&(U=!0)}while((0<R.avail_in||R.avail_out===0)&&b!==l.Z_STREAM_END);return b===l.Z_STREAM_END&&(A=l.Z_FINISH),A===l.Z_FINISH?(b=n.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===l.Z_OK):A!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(R.avail_out=0))},u.prototype.onData=function(p){this.chunks.push(p)},u.prototype.onEnd=function(p){p===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},i.Inflate=u,i.inflate=m,i.inflateRaw=function(p,_){return(_=_||{}).raw=!0,m(p,_)},i.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,s,i){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(l){for(var h=Array.prototype.slice.call(arguments,1);h.length;){var c=h.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(var d in c)c.hasOwnProperty(d)&&(l[d]=c[d])}}return l},i.shrinkBuf=function(l,h){return l.length===h?l:l.subarray?l.subarray(0,h):(l.length=h,l)};var r={arraySet:function(l,h,c,d,f){if(h.subarray&&l.subarray)l.set(h.subarray(c,c+d),f);else for(var u=0;u<d;u++)l[f+u]=h[c+u]},flattenChunks:function(l){var h,c,d,f,u,m;for(h=d=0,c=l.length;h<c;h++)d+=l[h].length;for(m=new Uint8Array(d),h=f=0,c=l.length;h<c;h++)u=l[h],m.set(u,f),f+=u.length;return m}},o={arraySet:function(l,h,c,d,f){for(var u=0;u<d;u++)l[f+u]=h[c+u]},flattenChunks:function(l){return[].concat.apply([],l)}};i.setTyped=function(l){l?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,r)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,o))},i.setTyped(n)},{}],42:[function(t,s,i){var n=t("./common"),r=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var l=new n.Buf8(256),h=0;h<256;h++)l[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function c(d,f){if(f<65537&&(d.subarray&&o||!d.subarray&&r))return String.fromCharCode.apply(null,n.shrinkBuf(d,f));for(var u="",m=0;m<f;m++)u+=String.fromCharCode(d[m]);return u}l[254]=l[254]=1,i.string2buf=function(d){var f,u,m,p,_,b=d.length,A=0;for(p=0;p<b;p++)(64512&(u=d.charCodeAt(p)))==55296&&p+1<b&&(64512&(m=d.charCodeAt(p+1)))==56320&&(u=65536+(u-55296<<10)+(m-56320),p++),A+=u<128?1:u<2048?2:u<65536?3:4;for(f=new n.Buf8(A),p=_=0;_<A;p++)(64512&(u=d.charCodeAt(p)))==55296&&p+1<b&&(64512&(m=d.charCodeAt(p+1)))==56320&&(u=65536+(u-55296<<10)+(m-56320),p++),u<128?f[_++]=u:(u<2048?f[_++]=192|u>>>6:(u<65536?f[_++]=224|u>>>12:(f[_++]=240|u>>>18,f[_++]=128|u>>>12&63),f[_++]=128|u>>>6&63),f[_++]=128|63&u);return f},i.buf2binstring=function(d){return c(d,d.length)},i.binstring2buf=function(d){for(var f=new n.Buf8(d.length),u=0,m=f.length;u<m;u++)f[u]=d.charCodeAt(u);return f},i.buf2string=function(d,f){var u,m,p,_,b=f||d.length,A=new Array(2*b);for(u=m=0;u<b;)if((p=d[u++])<128)A[m++]=p;else if(4<(_=l[p]))A[m++]=65533,u+=_-1;else{for(p&=_===2?31:_===3?15:7;1<_&&u<b;)p=p<<6|63&d[u++],_--;1<_?A[m++]=65533:p<65536?A[m++]=p:(p-=65536,A[m++]=55296|p>>10&1023,A[m++]=56320|1023&p)}return c(A,m)},i.utf8border=function(d,f){var u;for((f=f||d.length)>d.length&&(f=d.length),u=f-1;0<=u&&(192&d[u])==128;)u--;return u<0||u===0?f:u+l[d[u]]>f?u:f}},{"./common":41}],43:[function(t,s,i){s.exports=function(n,r,o,l){for(var h=65535&n|0,c=n>>>16&65535|0,d=0;o!==0;){for(o-=d=2e3<o?2e3:o;c=c+(h=h+r[l++]|0)|0,--d;);h%=65521,c%=65521}return h|c<<16|0}},{}],44:[function(t,s,i){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,s,i){var n=function(){for(var r,o=[],l=0;l<256;l++){r=l;for(var h=0;h<8;h++)r=1&r?3988292384^r>>>1:r>>>1;o[l]=r}return o}();s.exports=function(r,o,l,h){var c=n,d=h+l;r^=-1;for(var f=h;f<d;f++)r=r>>>8^c[255&(r^o[f])];return-1^r}},{}],46:[function(t,s,i){var n,r=t("../utils/common"),o=t("./trees"),l=t("./adler32"),h=t("./crc32"),c=t("./messages"),d=0,f=4,u=0,m=-2,p=-1,_=4,b=2,A=8,x=9,k=286,C=30,P=19,R=2*k+1,D=15,M=3,U=258,$=U+M+1,L=42,z=113,v=1,G=2,V=3,O=4;function dt(w,W){return w.msg=c[W],W}function Y(w){return(w<<1)-(4<w?9:0)}function ht(w){for(var W=w.length;0<=--W;)w[W]=0}function H(w){var W=w.state,j=W.pending;j>w.avail_out&&(j=w.avail_out),j!==0&&(r.arraySet(w.output,W.pending_buf,W.pending_out,j,w.next_out),w.next_out+=j,W.pending_out+=j,w.total_out+=j,w.avail_out-=j,W.pending-=j,W.pending===0&&(W.pending_out=0))}function N(w,W){o._tr_flush_block(w,0<=w.block_start?w.block_start:-1,w.strstart-w.block_start,W),w.block_start=w.strstart,H(w.strm)}function st(w,W){w.pending_buf[w.pending++]=W}function et(w,W){w.pending_buf[w.pending++]=W>>>8&255,w.pending_buf[w.pending++]=255&W}function Z(w,W){var j,I,T=w.max_chain_length,F=w.strstart,X=w.prev_length,q=w.nice_match,B=w.strstart>w.w_size-$?w.strstart-(w.w_size-$):0,J=w.window,rt=w.w_mask,Q=w.prev,ct=w.strstart+U,Dt=J[F+X-1],vt=J[F+X];w.prev_length>=w.good_match&&(T>>=2),q>w.lookahead&&(q=w.lookahead);do if(J[(j=W)+X]===vt&&J[j+X-1]===Dt&&J[j]===J[F]&&J[++j]===J[F+1]){F+=2,j++;do;while(J[++F]===J[++j]&&J[++F]===J[++j]&&J[++F]===J[++j]&&J[++F]===J[++j]&&J[++F]===J[++j]&&J[++F]===J[++j]&&J[++F]===J[++j]&&J[++F]===J[++j]&&F<ct);if(I=U-(ct-F),F=ct-U,X<I){if(w.match_start=W,q<=(X=I))break;Dt=J[F+X-1],vt=J[F+X]}}while((W=Q[W&rt])>B&&--T!=0);return X<=w.lookahead?X:w.lookahead}function kt(w){var W,j,I,T,F,X,q,B,J,rt,Q=w.w_size;do{if(T=w.window_size-w.lookahead-w.strstart,w.strstart>=Q+(Q-$)){for(r.arraySet(w.window,w.window,Q,Q,0),w.match_start-=Q,w.strstart-=Q,w.block_start-=Q,W=j=w.hash_size;I=w.head[--W],w.head[W]=Q<=I?I-Q:0,--j;);for(W=j=Q;I=w.prev[--W],w.prev[W]=Q<=I?I-Q:0,--j;);T+=Q}if(w.strm.avail_in===0)break;if(X=w.strm,q=w.window,B=w.strstart+w.lookahead,J=T,rt=void 0,rt=X.avail_in,J<rt&&(rt=J),j=rt===0?0:(X.avail_in-=rt,r.arraySet(q,X.input,X.next_in,rt,B),X.state.wrap===1?X.adler=l(X.adler,q,rt,B):X.state.wrap===2&&(X.adler=h(X.adler,q,rt,B)),X.next_in+=rt,X.total_in+=rt,rt),w.lookahead+=j,w.lookahead+w.insert>=M)for(F=w.strstart-w.insert,w.ins_h=w.window[F],w.ins_h=(w.ins_h<<w.hash_shift^w.window[F+1])&w.hash_mask;w.insert&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[F+M-1])&w.hash_mask,w.prev[F&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=F,F++,w.insert--,!(w.lookahead+w.insert<M)););}while(w.lookahead<$&&w.strm.avail_in!==0)}function yt(w,W){for(var j,I;;){if(w.lookahead<$){if(kt(w),w.lookahead<$&&W===d)return v;if(w.lookahead===0)break}if(j=0,w.lookahead>=M&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+M-1])&w.hash_mask,j=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),j!==0&&w.strstart-j<=w.w_size-$&&(w.match_length=Z(w,j)),w.match_length>=M)if(I=o._tr_tally(w,w.strstart-w.match_start,w.match_length-M),w.lookahead-=w.match_length,w.match_length<=w.max_lazy_match&&w.lookahead>=M){for(w.match_length--;w.strstart++,w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+M-1])&w.hash_mask,j=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart,--w.match_length!=0;);w.strstart++}else w.strstart+=w.match_length,w.match_length=0,w.ins_h=w.window[w.strstart],w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+1])&w.hash_mask;else I=o._tr_tally(w,0,w.window[w.strstart]),w.lookahead--,w.strstart++;if(I&&(N(w,!1),w.strm.avail_out===0))return v}return w.insert=w.strstart<M-1?w.strstart:M-1,W===f?(N(w,!0),w.strm.avail_out===0?V:O):w.last_lit&&(N(w,!1),w.strm.avail_out===0)?v:G}function mt(w,W){for(var j,I,T;;){if(w.lookahead<$){if(kt(w),w.lookahead<$&&W===d)return v;if(w.lookahead===0)break}if(j=0,w.lookahead>=M&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+M-1])&w.hash_mask,j=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),w.prev_length=w.match_length,w.prev_match=w.match_start,w.match_length=M-1,j!==0&&w.prev_length<w.max_lazy_match&&w.strstart-j<=w.w_size-$&&(w.match_length=Z(w,j),w.match_length<=5&&(w.strategy===1||w.match_length===M&&4096<w.strstart-w.match_start)&&(w.match_length=M-1)),w.prev_length>=M&&w.match_length<=w.prev_length){for(T=w.strstart+w.lookahead-M,I=o._tr_tally(w,w.strstart-1-w.prev_match,w.prev_length-M),w.lookahead-=w.prev_length-1,w.prev_length-=2;++w.strstart<=T&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+M-1])&w.hash_mask,j=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),--w.prev_length!=0;);if(w.match_available=0,w.match_length=M-1,w.strstart++,I&&(N(w,!1),w.strm.avail_out===0))return v}else if(w.match_available){if((I=o._tr_tally(w,0,w.window[w.strstart-1]))&&N(w,!1),w.strstart++,w.lookahead--,w.strm.avail_out===0)return v}else w.match_available=1,w.strstart++,w.lookahead--}return w.match_available&&(I=o._tr_tally(w,0,w.window[w.strstart-1]),w.match_available=0),w.insert=w.strstart<M-1?w.strstart:M-1,W===f?(N(w,!0),w.strm.avail_out===0?V:O):w.last_lit&&(N(w,!1),w.strm.avail_out===0)?v:G}function xt(w,W,j,I,T){this.good_length=w,this.max_lazy=W,this.nice_length=j,this.max_chain=I,this.func=T}function Yt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=A,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*R),this.dyn_dtree=new r.Buf16(2*(2*C+1)),this.bl_tree=new r.Buf16(2*(2*P+1)),ht(this.dyn_ltree),ht(this.dyn_dtree),ht(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(D+1),this.heap=new r.Buf16(2*k+1),ht(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*k+1),ht(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ot(w){var W;return w&&w.state?(w.total_in=w.total_out=0,w.data_type=b,(W=w.state).pending=0,W.pending_out=0,W.wrap<0&&(W.wrap=-W.wrap),W.status=W.wrap?L:z,w.adler=W.wrap===2?0:1,W.last_flush=d,o._tr_init(W),u):dt(w,m)}function Oe(w){var W=Ot(w);return W===u&&function(j){j.window_size=2*j.w_size,ht(j.head),j.max_lazy_match=n[j.level].max_lazy,j.good_match=n[j.level].good_length,j.nice_match=n[j.level].nice_length,j.max_chain_length=n[j.level].max_chain,j.strstart=0,j.block_start=0,j.lookahead=0,j.insert=0,j.match_length=j.prev_length=M-1,j.match_available=0,j.ins_h=0}(w.state),W}function Be(w,W,j,I,T,F){if(!w)return m;var X=1;if(W===p&&(W=6),I<0?(X=0,I=-I):15<I&&(X=2,I-=16),T<1||x<T||j!==A||I<8||15<I||W<0||9<W||F<0||_<F)return dt(w,m);I===8&&(I=9);var q=new Yt;return(w.state=q).strm=w,q.wrap=X,q.gzhead=null,q.w_bits=I,q.w_size=1<<q.w_bits,q.w_mask=q.w_size-1,q.hash_bits=T+7,q.hash_size=1<<q.hash_bits,q.hash_mask=q.hash_size-1,q.hash_shift=~~((q.hash_bits+M-1)/M),q.window=new r.Buf8(2*q.w_size),q.head=new r.Buf16(q.hash_size),q.prev=new r.Buf16(q.w_size),q.lit_bufsize=1<<T+6,q.pending_buf_size=4*q.lit_bufsize,q.pending_buf=new r.Buf8(q.pending_buf_size),q.d_buf=1*q.lit_bufsize,q.l_buf=3*q.lit_bufsize,q.level=W,q.strategy=F,q.method=j,Oe(w)}n=[new xt(0,0,0,0,function(w,W){var j=65535;for(j>w.pending_buf_size-5&&(j=w.pending_buf_size-5);;){if(w.lookahead<=1){if(kt(w),w.lookahead===0&&W===d)return v;if(w.lookahead===0)break}w.strstart+=w.lookahead,w.lookahead=0;var I=w.block_start+j;if((w.strstart===0||w.strstart>=I)&&(w.lookahead=w.strstart-I,w.strstart=I,N(w,!1),w.strm.avail_out===0)||w.strstart-w.block_start>=w.w_size-$&&(N(w,!1),w.strm.avail_out===0))return v}return w.insert=0,W===f?(N(w,!0),w.strm.avail_out===0?V:O):(w.strstart>w.block_start&&(N(w,!1),w.strm.avail_out),v)}),new xt(4,4,8,4,yt),new xt(4,5,16,8,yt),new xt(4,6,32,32,yt),new xt(4,4,16,16,mt),new xt(8,16,32,32,mt),new xt(8,16,128,128,mt),new xt(8,32,128,256,mt),new xt(32,128,258,1024,mt),new xt(32,258,258,4096,mt)],i.deflateInit=function(w,W){return Be(w,W,A,15,8,0)},i.deflateInit2=Be,i.deflateReset=Oe,i.deflateResetKeep=Ot,i.deflateSetHeader=function(w,W){return w&&w.state?w.state.wrap!==2?m:(w.state.gzhead=W,u):m},i.deflate=function(w,W){var j,I,T,F;if(!w||!w.state||5<W||W<0)return w?dt(w,m):m;if(I=w.state,!w.output||!w.input&&w.avail_in!==0||I.status===666&&W!==f)return dt(w,w.avail_out===0?-5:m);if(I.strm=w,j=I.last_flush,I.last_flush=W,I.status===L)if(I.wrap===2)w.adler=0,st(I,31),st(I,139),st(I,8),I.gzhead?(st(I,(I.gzhead.text?1:0)+(I.gzhead.hcrc?2:0)+(I.gzhead.extra?4:0)+(I.gzhead.name?8:0)+(I.gzhead.comment?16:0)),st(I,255&I.gzhead.time),st(I,I.gzhead.time>>8&255),st(I,I.gzhead.time>>16&255),st(I,I.gzhead.time>>24&255),st(I,I.level===9?2:2<=I.strategy||I.level<2?4:0),st(I,255&I.gzhead.os),I.gzhead.extra&&I.gzhead.extra.length&&(st(I,255&I.gzhead.extra.length),st(I,I.gzhead.extra.length>>8&255)),I.gzhead.hcrc&&(w.adler=h(w.adler,I.pending_buf,I.pending,0)),I.gzindex=0,I.status=69):(st(I,0),st(I,0),st(I,0),st(I,0),st(I,0),st(I,I.level===9?2:2<=I.strategy||I.level<2?4:0),st(I,3),I.status=z);else{var X=A+(I.w_bits-8<<4)<<8;X|=(2<=I.strategy||I.level<2?0:I.level<6?1:I.level===6?2:3)<<6,I.strstart!==0&&(X|=32),X+=31-X%31,I.status=z,et(I,X),I.strstart!==0&&(et(I,w.adler>>>16),et(I,65535&w.adler)),w.adler=1}if(I.status===69)if(I.gzhead.extra){for(T=I.pending;I.gzindex<(65535&I.gzhead.extra.length)&&(I.pending!==I.pending_buf_size||(I.gzhead.hcrc&&I.pending>T&&(w.adler=h(w.adler,I.pending_buf,I.pending-T,T)),H(w),T=I.pending,I.pending!==I.pending_buf_size));)st(I,255&I.gzhead.extra[I.gzindex]),I.gzindex++;I.gzhead.hcrc&&I.pending>T&&(w.adler=h(w.adler,I.pending_buf,I.pending-T,T)),I.gzindex===I.gzhead.extra.length&&(I.gzindex=0,I.status=73)}else I.status=73;if(I.status===73)if(I.gzhead.name){T=I.pending;do{if(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>T&&(w.adler=h(w.adler,I.pending_buf,I.pending-T,T)),H(w),T=I.pending,I.pending===I.pending_buf_size)){F=1;break}F=I.gzindex<I.gzhead.name.length?255&I.gzhead.name.charCodeAt(I.gzindex++):0,st(I,F)}while(F!==0);I.gzhead.hcrc&&I.pending>T&&(w.adler=h(w.adler,I.pending_buf,I.pending-T,T)),F===0&&(I.gzindex=0,I.status=91)}else I.status=91;if(I.status===91)if(I.gzhead.comment){T=I.pending;do{if(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>T&&(w.adler=h(w.adler,I.pending_buf,I.pending-T,T)),H(w),T=I.pending,I.pending===I.pending_buf_size)){F=1;break}F=I.gzindex<I.gzhead.comment.length?255&I.gzhead.comment.charCodeAt(I.gzindex++):0,st(I,F)}while(F!==0);I.gzhead.hcrc&&I.pending>T&&(w.adler=h(w.adler,I.pending_buf,I.pending-T,T)),F===0&&(I.status=103)}else I.status=103;if(I.status===103&&(I.gzhead.hcrc?(I.pending+2>I.pending_buf_size&&H(w),I.pending+2<=I.pending_buf_size&&(st(I,255&w.adler),st(I,w.adler>>8&255),w.adler=0,I.status=z)):I.status=z),I.pending!==0){if(H(w),w.avail_out===0)return I.last_flush=-1,u}else if(w.avail_in===0&&Y(W)<=Y(j)&&W!==f)return dt(w,-5);if(I.status===666&&w.avail_in!==0)return dt(w,-5);if(w.avail_in!==0||I.lookahead!==0||W!==d&&I.status!==666){var q=I.strategy===2?function(B,J){for(var rt;;){if(B.lookahead===0&&(kt(B),B.lookahead===0)){if(J===d)return v;break}if(B.match_length=0,rt=o._tr_tally(B,0,B.window[B.strstart]),B.lookahead--,B.strstart++,rt&&(N(B,!1),B.strm.avail_out===0))return v}return B.insert=0,J===f?(N(B,!0),B.strm.avail_out===0?V:O):B.last_lit&&(N(B,!1),B.strm.avail_out===0)?v:G}(I,W):I.strategy===3?function(B,J){for(var rt,Q,ct,Dt,vt=B.window;;){if(B.lookahead<=U){if(kt(B),B.lookahead<=U&&J===d)return v;if(B.lookahead===0)break}if(B.match_length=0,B.lookahead>=M&&0<B.strstart&&(Q=vt[ct=B.strstart-1])===vt[++ct]&&Q===vt[++ct]&&Q===vt[++ct]){Dt=B.strstart+U;do;while(Q===vt[++ct]&&Q===vt[++ct]&&Q===vt[++ct]&&Q===vt[++ct]&&Q===vt[++ct]&&Q===vt[++ct]&&Q===vt[++ct]&&Q===vt[++ct]&&ct<Dt);B.match_length=U-(Dt-ct),B.match_length>B.lookahead&&(B.match_length=B.lookahead)}if(B.match_length>=M?(rt=o._tr_tally(B,1,B.match_length-M),B.lookahead-=B.match_length,B.strstart+=B.match_length,B.match_length=0):(rt=o._tr_tally(B,0,B.window[B.strstart]),B.lookahead--,B.strstart++),rt&&(N(B,!1),B.strm.avail_out===0))return v}return B.insert=0,J===f?(N(B,!0),B.strm.avail_out===0?V:O):B.last_lit&&(N(B,!1),B.strm.avail_out===0)?v:G}(I,W):n[I.level].func(I,W);if(q!==V&&q!==O||(I.status=666),q===v||q===V)return w.avail_out===0&&(I.last_flush=-1),u;if(q===G&&(W===1?o._tr_align(I):W!==5&&(o._tr_stored_block(I,0,0,!1),W===3&&(ht(I.head),I.lookahead===0&&(I.strstart=0,I.block_start=0,I.insert=0))),H(w),w.avail_out===0))return I.last_flush=-1,u}return W!==f?u:I.wrap<=0?1:(I.wrap===2?(st(I,255&w.adler),st(I,w.adler>>8&255),st(I,w.adler>>16&255),st(I,w.adler>>24&255),st(I,255&w.total_in),st(I,w.total_in>>8&255),st(I,w.total_in>>16&255),st(I,w.total_in>>24&255)):(et(I,w.adler>>>16),et(I,65535&w.adler)),H(w),0<I.wrap&&(I.wrap=-I.wrap),I.pending!==0?u:1)},i.deflateEnd=function(w){var W;return w&&w.state?(W=w.state.status)!==L&&W!==69&&W!==73&&W!==91&&W!==103&&W!==z&&W!==666?dt(w,m):(w.state=null,W===z?dt(w,-3):u):m},i.deflateSetDictionary=function(w,W){var j,I,T,F,X,q,B,J,rt=W.length;if(!w||!w.state||(F=(j=w.state).wrap)===2||F===1&&j.status!==L||j.lookahead)return m;for(F===1&&(w.adler=l(w.adler,W,rt,0)),j.wrap=0,rt>=j.w_size&&(F===0&&(ht(j.head),j.strstart=0,j.block_start=0,j.insert=0),J=new r.Buf8(j.w_size),r.arraySet(J,W,rt-j.w_size,j.w_size,0),W=J,rt=j.w_size),X=w.avail_in,q=w.next_in,B=w.input,w.avail_in=rt,w.next_in=0,w.input=W,kt(j);j.lookahead>=M;){for(I=j.strstart,T=j.lookahead-(M-1);j.ins_h=(j.ins_h<<j.hash_shift^j.window[I+M-1])&j.hash_mask,j.prev[I&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=I,I++,--T;);j.strstart=I,j.lookahead=M-1,kt(j)}return j.strstart+=j.lookahead,j.block_start=j.strstart,j.insert=j.lookahead,j.lookahead=0,j.match_length=j.prev_length=M-1,j.match_available=0,w.next_in=q,w.input=B,w.avail_in=X,j.wrap=F,u},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,s,i){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,s,i){s.exports=function(n,r){var o,l,h,c,d,f,u,m,p,_,b,A,x,k,C,P,R,D,M,U,$,L,z,v,G;o=n.state,l=n.next_in,v=n.input,h=l+(n.avail_in-5),c=n.next_out,G=n.output,d=c-(r-n.avail_out),f=c+(n.avail_out-257),u=o.dmax,m=o.wsize,p=o.whave,_=o.wnext,b=o.window,A=o.hold,x=o.bits,k=o.lencode,C=o.distcode,P=(1<<o.lenbits)-1,R=(1<<o.distbits)-1;t:do{x<15&&(A+=v[l++]<<x,x+=8,A+=v[l++]<<x,x+=8),D=k[A&P];e:for(;;){if(A>>>=M=D>>>24,x-=M,(M=D>>>16&255)===0)G[c++]=65535&D;else{if(!(16&M)){if(!(64&M)){D=k[(65535&D)+(A&(1<<M)-1)];continue e}if(32&M){o.mode=12;break t}n.msg="invalid literal/length code",o.mode=30;break t}U=65535&D,(M&=15)&&(x<M&&(A+=v[l++]<<x,x+=8),U+=A&(1<<M)-1,A>>>=M,x-=M),x<15&&(A+=v[l++]<<x,x+=8,A+=v[l++]<<x,x+=8),D=C[A&R];s:for(;;){if(A>>>=M=D>>>24,x-=M,!(16&(M=D>>>16&255))){if(!(64&M)){D=C[(65535&D)+(A&(1<<M)-1)];continue s}n.msg="invalid distance code",o.mode=30;break t}if($=65535&D,x<(M&=15)&&(A+=v[l++]<<x,(x+=8)<M&&(A+=v[l++]<<x,x+=8)),u<($+=A&(1<<M)-1)){n.msg="invalid distance too far back",o.mode=30;break t}if(A>>>=M,x-=M,(M=c-d)<$){if(p<(M=$-M)&&o.sane){n.msg="invalid distance too far back",o.mode=30;break t}if(z=b,(L=0)===_){if(L+=m-M,M<U){for(U-=M;G[c++]=b[L++],--M;);L=c-$,z=G}}else if(_<M){if(L+=m+_-M,(M-=_)<U){for(U-=M;G[c++]=b[L++],--M;);if(L=0,_<U){for(U-=M=_;G[c++]=b[L++],--M;);L=c-$,z=G}}}else if(L+=_-M,M<U){for(U-=M;G[c++]=b[L++],--M;);L=c-$,z=G}for(;2<U;)G[c++]=z[L++],G[c++]=z[L++],G[c++]=z[L++],U-=3;U&&(G[c++]=z[L++],1<U&&(G[c++]=z[L++]))}else{for(L=c-$;G[c++]=G[L++],G[c++]=G[L++],G[c++]=G[L++],2<(U-=3););U&&(G[c++]=G[L++],1<U&&(G[c++]=G[L++]))}break}}break}}while(l<h&&c<f);l-=U=x>>3,A&=(1<<(x-=U<<3))-1,n.next_in=l,n.next_out=c,n.avail_in=l<h?h-l+5:5-(l-h),n.avail_out=c<f?f-c+257:257-(c-f),o.hold=A,o.bits=x}},{}],49:[function(t,s,i){var n=t("../utils/common"),r=t("./adler32"),o=t("./crc32"),l=t("./inffast"),h=t("./inftrees"),c=1,d=2,f=0,u=-2,m=1,p=852,_=592;function b(L){return(L>>>24&255)+(L>>>8&65280)+((65280&L)<<8)+((255&L)<<24)}function A(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function x(L){var z;return L&&L.state?(z=L.state,L.total_in=L.total_out=z.total=0,L.msg="",z.wrap&&(L.adler=1&z.wrap),z.mode=m,z.last=0,z.havedict=0,z.dmax=32768,z.head=null,z.hold=0,z.bits=0,z.lencode=z.lendyn=new n.Buf32(p),z.distcode=z.distdyn=new n.Buf32(_),z.sane=1,z.back=-1,f):u}function k(L){var z;return L&&L.state?((z=L.state).wsize=0,z.whave=0,z.wnext=0,x(L)):u}function C(L,z){var v,G;return L&&L.state?(G=L.state,z<0?(v=0,z=-z):(v=1+(z>>4),z<48&&(z&=15)),z&&(z<8||15<z)?u:(G.window!==null&&G.wbits!==z&&(G.window=null),G.wrap=v,G.wbits=z,k(L))):u}function P(L,z){var v,G;return L?(G=new A,(L.state=G).window=null,(v=C(L,z))!==f&&(L.state=null),v):u}var R,D,M=!0;function U(L){if(M){var z;for(R=new n.Buf32(512),D=new n.Buf32(32),z=0;z<144;)L.lens[z++]=8;for(;z<256;)L.lens[z++]=9;for(;z<280;)L.lens[z++]=7;for(;z<288;)L.lens[z++]=8;for(h(c,L.lens,0,288,R,0,L.work,{bits:9}),z=0;z<32;)L.lens[z++]=5;h(d,L.lens,0,32,D,0,L.work,{bits:5}),M=!1}L.lencode=R,L.lenbits=9,L.distcode=D,L.distbits=5}function $(L,z,v,G){var V,O=L.state;return O.window===null&&(O.wsize=1<<O.wbits,O.wnext=0,O.whave=0,O.window=new n.Buf8(O.wsize)),G>=O.wsize?(n.arraySet(O.window,z,v-O.wsize,O.wsize,0),O.wnext=0,O.whave=O.wsize):(G<(V=O.wsize-O.wnext)&&(V=G),n.arraySet(O.window,z,v-G,V,O.wnext),(G-=V)?(n.arraySet(O.window,z,v-G,G,0),O.wnext=G,O.whave=O.wsize):(O.wnext+=V,O.wnext===O.wsize&&(O.wnext=0),O.whave<O.wsize&&(O.whave+=V))),0}i.inflateReset=k,i.inflateReset2=C,i.inflateResetKeep=x,i.inflateInit=function(L){return P(L,15)},i.inflateInit2=P,i.inflate=function(L,z){var v,G,V,O,dt,Y,ht,H,N,st,et,Z,kt,yt,mt,xt,Yt,Ot,Oe,Be,w,W,j,I,T=0,F=new n.Buf8(4),X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!L||!L.state||!L.output||!L.input&&L.avail_in!==0)return u;(v=L.state).mode===12&&(v.mode=13),dt=L.next_out,V=L.output,ht=L.avail_out,O=L.next_in,G=L.input,Y=L.avail_in,H=v.hold,N=v.bits,st=Y,et=ht,W=f;t:for(;;)switch(v.mode){case m:if(v.wrap===0){v.mode=13;break}for(;N<16;){if(Y===0)break t;Y--,H+=G[O++]<<N,N+=8}if(2&v.wrap&&H===35615){F[v.check=0]=255&H,F[1]=H>>>8&255,v.check=o(v.check,F,2,0),N=H=0,v.mode=2;break}if(v.flags=0,v.head&&(v.head.done=!1),!(1&v.wrap)||(((255&H)<<8)+(H>>8))%31){L.msg="incorrect header check",v.mode=30;break}if((15&H)!=8){L.msg="unknown compression method",v.mode=30;break}if(N-=4,w=8+(15&(H>>>=4)),v.wbits===0)v.wbits=w;else if(w>v.wbits){L.msg="invalid window size",v.mode=30;break}v.dmax=1<<w,L.adler=v.check=1,v.mode=512&H?10:12,N=H=0;break;case 2:for(;N<16;){if(Y===0)break t;Y--,H+=G[O++]<<N,N+=8}if(v.flags=H,(255&v.flags)!=8){L.msg="unknown compression method",v.mode=30;break}if(57344&v.flags){L.msg="unknown header flags set",v.mode=30;break}v.head&&(v.head.text=H>>8&1),512&v.flags&&(F[0]=255&H,F[1]=H>>>8&255,v.check=o(v.check,F,2,0)),N=H=0,v.mode=3;case 3:for(;N<32;){if(Y===0)break t;Y--,H+=G[O++]<<N,N+=8}v.head&&(v.head.time=H),512&v.flags&&(F[0]=255&H,F[1]=H>>>8&255,F[2]=H>>>16&255,F[3]=H>>>24&255,v.check=o(v.check,F,4,0)),N=H=0,v.mode=4;case 4:for(;N<16;){if(Y===0)break t;Y--,H+=G[O++]<<N,N+=8}v.head&&(v.head.xflags=255&H,v.head.os=H>>8),512&v.flags&&(F[0]=255&H,F[1]=H>>>8&255,v.check=o(v.check,F,2,0)),N=H=0,v.mode=5;case 5:if(1024&v.flags){for(;N<16;){if(Y===0)break t;Y--,H+=G[O++]<<N,N+=8}v.length=H,v.head&&(v.head.extra_len=H),512&v.flags&&(F[0]=255&H,F[1]=H>>>8&255,v.check=o(v.check,F,2,0)),N=H=0}else v.head&&(v.head.extra=null);v.mode=6;case 6:if(1024&v.flags&&(Y<(Z=v.length)&&(Z=Y),Z&&(v.head&&(w=v.head.extra_len-v.length,v.head.extra||(v.head.extra=new Array(v.head.extra_len)),n.arraySet(v.head.extra,G,O,Z,w)),512&v.flags&&(v.check=o(v.check,G,Z,O)),Y-=Z,O+=Z,v.length-=Z),v.length))break t;v.length=0,v.mode=7;case 7:if(2048&v.flags){if(Y===0)break t;for(Z=0;w=G[O+Z++],v.head&&w&&v.length<65536&&(v.head.name+=String.fromCharCode(w)),w&&Z<Y;);if(512&v.flags&&(v.check=o(v.check,G,Z,O)),Y-=Z,O+=Z,w)break t}else v.head&&(v.head.name=null);v.length=0,v.mode=8;case 8:if(4096&v.flags){if(Y===0)break t;for(Z=0;w=G[O+Z++],v.head&&w&&v.length<65536&&(v.head.comment+=String.fromCharCode(w)),w&&Z<Y;);if(512&v.flags&&(v.check=o(v.check,G,Z,O)),Y-=Z,O+=Z,w)break t}else v.head&&(v.head.comment=null);v.mode=9;case 9:if(512&v.flags){for(;N<16;){if(Y===0)break t;Y--,H+=G[O++]<<N,N+=8}if(H!==(65535&v.check)){L.msg="header crc mismatch",v.mode=30;break}N=H=0}v.head&&(v.head.hcrc=v.flags>>9&1,v.head.done=!0),L.adler=v.check=0,v.mode=12;break;case 10:for(;N<32;){if(Y===0)break t;Y--,H+=G[O++]<<N,N+=8}L.adler=v.check=b(H),N=H=0,v.mode=11;case 11:if(v.havedict===0)return L.next_out=dt,L.avail_out=ht,L.next_in=O,L.avail_in=Y,v.hold=H,v.bits=N,2;L.adler=v.check=1,v.mode=12;case 12:if(z===5||z===6)break t;case 13:if(v.last){H>>>=7&N,N-=7&N,v.mode=27;break}for(;N<3;){if(Y===0)break t;Y--,H+=G[O++]<<N,N+=8}switch(v.last=1&H,N-=1,3&(H>>>=1)){case 0:v.mode=14;break;case 1:if(U(v),v.mode=20,z!==6)break;H>>>=2,N-=2;break t;case 2:v.mode=17;break;case 3:L.msg="invalid block type",v.mode=30}H>>>=2,N-=2;break;case 14:for(H>>>=7&N,N-=7&N;N<32;){if(Y===0)break t;Y--,H+=G[O++]<<N,N+=8}if((65535&H)!=(H>>>16^65535)){L.msg="invalid stored block lengths",v.mode=30;break}if(v.length=65535&H,N=H=0,v.mode=15,z===6)break t;case 15:v.mode=16;case 16:if(Z=v.length){if(Y<Z&&(Z=Y),ht<Z&&(Z=ht),Z===0)break t;n.arraySet(V,G,O,Z,dt),Y-=Z,O+=Z,ht-=Z,dt+=Z,v.length-=Z;break}v.mode=12;break;case 17:for(;N<14;){if(Y===0)break t;Y--,H+=G[O++]<<N,N+=8}if(v.nlen=257+(31&H),H>>>=5,N-=5,v.ndist=1+(31&H),H>>>=5,N-=5,v.ncode=4+(15&H),H>>>=4,N-=4,286<v.nlen||30<v.ndist){L.msg="too many length or distance symbols",v.mode=30;break}v.have=0,v.mode=18;case 18:for(;v.have<v.ncode;){for(;N<3;){if(Y===0)break t;Y--,H+=G[O++]<<N,N+=8}v.lens[X[v.have++]]=7&H,H>>>=3,N-=3}for(;v.have<19;)v.lens[X[v.have++]]=0;if(v.lencode=v.lendyn,v.lenbits=7,j={bits:v.lenbits},W=h(0,v.lens,0,19,v.lencode,0,v.work,j),v.lenbits=j.bits,W){L.msg="invalid code lengths set",v.mode=30;break}v.have=0,v.mode=19;case 19:for(;v.have<v.nlen+v.ndist;){for(;xt=(T=v.lencode[H&(1<<v.lenbits)-1])>>>16&255,Yt=65535&T,!((mt=T>>>24)<=N);){if(Y===0)break t;Y--,H+=G[O++]<<N,N+=8}if(Yt<16)H>>>=mt,N-=mt,v.lens[v.have++]=Yt;else{if(Yt===16){for(I=mt+2;N<I;){if(Y===0)break t;Y--,H+=G[O++]<<N,N+=8}if(H>>>=mt,N-=mt,v.have===0){L.msg="invalid bit length repeat",v.mode=30;break}w=v.lens[v.have-1],Z=3+(3&H),H>>>=2,N-=2}else if(Yt===17){for(I=mt+3;N<I;){if(Y===0)break t;Y--,H+=G[O++]<<N,N+=8}N-=mt,w=0,Z=3+(7&(H>>>=mt)),H>>>=3,N-=3}else{for(I=mt+7;N<I;){if(Y===0)break t;Y--,H+=G[O++]<<N,N+=8}N-=mt,w=0,Z=11+(127&(H>>>=mt)),H>>>=7,N-=7}if(v.have+Z>v.nlen+v.ndist){L.msg="invalid bit length repeat",v.mode=30;break}for(;Z--;)v.lens[v.have++]=w}}if(v.mode===30)break;if(v.lens[256]===0){L.msg="invalid code -- missing end-of-block",v.mode=30;break}if(v.lenbits=9,j={bits:v.lenbits},W=h(c,v.lens,0,v.nlen,v.lencode,0,v.work,j),v.lenbits=j.bits,W){L.msg="invalid literal/lengths set",v.mode=30;break}if(v.distbits=6,v.distcode=v.distdyn,j={bits:v.distbits},W=h(d,v.lens,v.nlen,v.ndist,v.distcode,0,v.work,j),v.distbits=j.bits,W){L.msg="invalid distances set",v.mode=30;break}if(v.mode=20,z===6)break t;case 20:v.mode=21;case 21:if(6<=Y&&258<=ht){L.next_out=dt,L.avail_out=ht,L.next_in=O,L.avail_in=Y,v.hold=H,v.bits=N,l(L,et),dt=L.next_out,V=L.output,ht=L.avail_out,O=L.next_in,G=L.input,Y=L.avail_in,H=v.hold,N=v.bits,v.mode===12&&(v.back=-1);break}for(v.back=0;xt=(T=v.lencode[H&(1<<v.lenbits)-1])>>>16&255,Yt=65535&T,!((mt=T>>>24)<=N);){if(Y===0)break t;Y--,H+=G[O++]<<N,N+=8}if(xt&&!(240&xt)){for(Ot=mt,Oe=xt,Be=Yt;xt=(T=v.lencode[Be+((H&(1<<Ot+Oe)-1)>>Ot)])>>>16&255,Yt=65535&T,!(Ot+(mt=T>>>24)<=N);){if(Y===0)break t;Y--,H+=G[O++]<<N,N+=8}H>>>=Ot,N-=Ot,v.back+=Ot}if(H>>>=mt,N-=mt,v.back+=mt,v.length=Yt,xt===0){v.mode=26;break}if(32&xt){v.back=-1,v.mode=12;break}if(64&xt){L.msg="invalid literal/length code",v.mode=30;break}v.extra=15&xt,v.mode=22;case 22:if(v.extra){for(I=v.extra;N<I;){if(Y===0)break t;Y--,H+=G[O++]<<N,N+=8}v.length+=H&(1<<v.extra)-1,H>>>=v.extra,N-=v.extra,v.back+=v.extra}v.was=v.length,v.mode=23;case 23:for(;xt=(T=v.distcode[H&(1<<v.distbits)-1])>>>16&255,Yt=65535&T,!((mt=T>>>24)<=N);){if(Y===0)break t;Y--,H+=G[O++]<<N,N+=8}if(!(240&xt)){for(Ot=mt,Oe=xt,Be=Yt;xt=(T=v.distcode[Be+((H&(1<<Ot+Oe)-1)>>Ot)])>>>16&255,Yt=65535&T,!(Ot+(mt=T>>>24)<=N);){if(Y===0)break t;Y--,H+=G[O++]<<N,N+=8}H>>>=Ot,N-=Ot,v.back+=Ot}if(H>>>=mt,N-=mt,v.back+=mt,64&xt){L.msg="invalid distance code",v.mode=30;break}v.offset=Yt,v.extra=15&xt,v.mode=24;case 24:if(v.extra){for(I=v.extra;N<I;){if(Y===0)break t;Y--,H+=G[O++]<<N,N+=8}v.offset+=H&(1<<v.extra)-1,H>>>=v.extra,N-=v.extra,v.back+=v.extra}if(v.offset>v.dmax){L.msg="invalid distance too far back",v.mode=30;break}v.mode=25;case 25:if(ht===0)break t;if(Z=et-ht,v.offset>Z){if((Z=v.offset-Z)>v.whave&&v.sane){L.msg="invalid distance too far back",v.mode=30;break}kt=Z>v.wnext?(Z-=v.wnext,v.wsize-Z):v.wnext-Z,Z>v.length&&(Z=v.length),yt=v.window}else yt=V,kt=dt-v.offset,Z=v.length;for(ht<Z&&(Z=ht),ht-=Z,v.length-=Z;V[dt++]=yt[kt++],--Z;);v.length===0&&(v.mode=21);break;case 26:if(ht===0)break t;V[dt++]=v.length,ht--,v.mode=21;break;case 27:if(v.wrap){for(;N<32;){if(Y===0)break t;Y--,H|=G[O++]<<N,N+=8}if(et-=ht,L.total_out+=et,v.total+=et,et&&(L.adler=v.check=v.flags?o(v.check,V,et,dt-et):r(v.check,V,et,dt-et)),et=ht,(v.flags?H:b(H))!==v.check){L.msg="incorrect data check",v.mode=30;break}N=H=0}v.mode=28;case 28:if(v.wrap&&v.flags){for(;N<32;){if(Y===0)break t;Y--,H+=G[O++]<<N,N+=8}if(H!==(4294967295&v.total)){L.msg="incorrect length check",v.mode=30;break}N=H=0}v.mode=29;case 29:W=1;break t;case 30:W=-3;break t;case 31:return-4;case 32:default:return u}return L.next_out=dt,L.avail_out=ht,L.next_in=O,L.avail_in=Y,v.hold=H,v.bits=N,(v.wsize||et!==L.avail_out&&v.mode<30&&(v.mode<27||z!==4))&&$(L,L.output,L.next_out,et-L.avail_out)?(v.mode=31,-4):(st-=L.avail_in,et-=L.avail_out,L.total_in+=st,L.total_out+=et,v.total+=et,v.wrap&&et&&(L.adler=v.check=v.flags?o(v.check,V,et,L.next_out-et):r(v.check,V,et,L.next_out-et)),L.data_type=v.bits+(v.last?64:0)+(v.mode===12?128:0)+(v.mode===20||v.mode===15?256:0),(st==0&&et===0||z===4)&&W===f&&(W=-5),W)},i.inflateEnd=function(L){if(!L||!L.state)return u;var z=L.state;return z.window&&(z.window=null),L.state=null,f},i.inflateGetHeader=function(L,z){var v;return L&&L.state&&2&(v=L.state).wrap?((v.head=z).done=!1,f):u},i.inflateSetDictionary=function(L,z){var v,G=z.length;return L&&L.state?(v=L.state).wrap!==0&&v.mode!==11?u:v.mode===11&&r(1,z,G,0)!==v.check?-3:$(L,z,G,G)?(v.mode=31,-4):(v.havedict=1,f):u},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,s,i){var n=t("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(c,d,f,u,m,p,_,b){var A,x,k,C,P,R,D,M,U,$=b.bits,L=0,z=0,v=0,G=0,V=0,O=0,dt=0,Y=0,ht=0,H=0,N=null,st=0,et=new n.Buf16(16),Z=new n.Buf16(16),kt=null,yt=0;for(L=0;L<=15;L++)et[L]=0;for(z=0;z<u;z++)et[d[f+z]]++;for(V=$,G=15;1<=G&&et[G]===0;G--);if(G<V&&(V=G),G===0)return m[p++]=20971520,m[p++]=20971520,b.bits=1,0;for(v=1;v<G&&et[v]===0;v++);for(V<v&&(V=v),L=Y=1;L<=15;L++)if(Y<<=1,(Y-=et[L])<0)return-1;if(0<Y&&(c===0||G!==1))return-1;for(Z[1]=0,L=1;L<15;L++)Z[L+1]=Z[L]+et[L];for(z=0;z<u;z++)d[f+z]!==0&&(_[Z[d[f+z]]++]=z);if(R=c===0?(N=kt=_,19):c===1?(N=r,st-=257,kt=o,yt-=257,256):(N=l,kt=h,-1),L=v,P=p,dt=z=H=0,k=-1,C=(ht=1<<(O=V))-1,c===1&&852<ht||c===2&&592<ht)return 1;for(;;){for(D=L-dt,U=_[z]<R?(M=0,_[z]):_[z]>R?(M=kt[yt+_[z]],N[st+_[z]]):(M=96,0),A=1<<L-dt,v=x=1<<O;m[P+(H>>dt)+(x-=A)]=D<<24|M<<16|U|0,x!==0;);for(A=1<<L-1;H&A;)A>>=1;if(A!==0?(H&=A-1,H+=A):H=0,z++,--et[L]==0){if(L===G)break;L=d[f+_[z]]}if(V<L&&(H&C)!==k){for(dt===0&&(dt=V),P+=v,Y=1<<(O=L-dt);O+dt<G&&!((Y-=et[O+dt])<=0);)O++,Y<<=1;if(ht+=1<<O,c===1&&852<ht||c===2&&592<ht)return 1;m[k=H&C]=V<<24|O<<16|P-p|0}}return H!==0&&(m[P+H]=L-dt<<24|64<<16|0),b.bits=V,0}},{"../utils/common":41}],51:[function(t,s,i){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,s,i){var n=t("../utils/common"),r=0,o=1;function l(T){for(var F=T.length;0<=--F;)T[F]=0}var h=0,c=29,d=256,f=d+1+c,u=30,m=19,p=2*f+1,_=15,b=16,A=7,x=256,k=16,C=17,P=18,R=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],D=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],M=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],$=new Array(2*(f+2));l($);var L=new Array(2*u);l(L);var z=new Array(512);l(z);var v=new Array(256);l(v);var G=new Array(c);l(G);var V,O,dt,Y=new Array(u);function ht(T,F,X,q,B){this.static_tree=T,this.extra_bits=F,this.extra_base=X,this.elems=q,this.max_length=B,this.has_stree=T&&T.length}function H(T,F){this.dyn_tree=T,this.max_code=0,this.stat_desc=F}function N(T){return T<256?z[T]:z[256+(T>>>7)]}function st(T,F){T.pending_buf[T.pending++]=255&F,T.pending_buf[T.pending++]=F>>>8&255}function et(T,F,X){T.bi_valid>b-X?(T.bi_buf|=F<<T.bi_valid&65535,st(T,T.bi_buf),T.bi_buf=F>>b-T.bi_valid,T.bi_valid+=X-b):(T.bi_buf|=F<<T.bi_valid&65535,T.bi_valid+=X)}function Z(T,F,X){et(T,X[2*F],X[2*F+1])}function kt(T,F){for(var X=0;X|=1&T,T>>>=1,X<<=1,0<--F;);return X>>>1}function yt(T,F,X){var q,B,J=new Array(_+1),rt=0;for(q=1;q<=_;q++)J[q]=rt=rt+X[q-1]<<1;for(B=0;B<=F;B++){var Q=T[2*B+1];Q!==0&&(T[2*B]=kt(J[Q]++,Q))}}function mt(T){var F;for(F=0;F<f;F++)T.dyn_ltree[2*F]=0;for(F=0;F<u;F++)T.dyn_dtree[2*F]=0;for(F=0;F<m;F++)T.bl_tree[2*F]=0;T.dyn_ltree[2*x]=1,T.opt_len=T.static_len=0,T.last_lit=T.matches=0}function xt(T){8<T.bi_valid?st(T,T.bi_buf):0<T.bi_valid&&(T.pending_buf[T.pending++]=T.bi_buf),T.bi_buf=0,T.bi_valid=0}function Yt(T,F,X,q){var B=2*F,J=2*X;return T[B]<T[J]||T[B]===T[J]&&q[F]<=q[X]}function Ot(T,F,X){for(var q=T.heap[X],B=X<<1;B<=T.heap_len&&(B<T.heap_len&&Yt(F,T.heap[B+1],T.heap[B],T.depth)&&B++,!Yt(F,q,T.heap[B],T.depth));)T.heap[X]=T.heap[B],X=B,B<<=1;T.heap[X]=q}function Oe(T,F,X){var q,B,J,rt,Q=0;if(T.last_lit!==0)for(;q=T.pending_buf[T.d_buf+2*Q]<<8|T.pending_buf[T.d_buf+2*Q+1],B=T.pending_buf[T.l_buf+Q],Q++,q===0?Z(T,B,F):(Z(T,(J=v[B])+d+1,F),(rt=R[J])!==0&&et(T,B-=G[J],rt),Z(T,J=N(--q),X),(rt=D[J])!==0&&et(T,q-=Y[J],rt)),Q<T.last_lit;);Z(T,x,F)}function Be(T,F){var X,q,B,J=F.dyn_tree,rt=F.stat_desc.static_tree,Q=F.stat_desc.has_stree,ct=F.stat_desc.elems,Dt=-1;for(T.heap_len=0,T.heap_max=p,X=0;X<ct;X++)J[2*X]!==0?(T.heap[++T.heap_len]=Dt=X,T.depth[X]=0):J[2*X+1]=0;for(;T.heap_len<2;)J[2*(B=T.heap[++T.heap_len]=Dt<2?++Dt:0)]=1,T.depth[B]=0,T.opt_len--,Q&&(T.static_len-=rt[2*B+1]);for(F.max_code=Dt,X=T.heap_len>>1;1<=X;X--)Ot(T,J,X);for(B=ct;X=T.heap[1],T.heap[1]=T.heap[T.heap_len--],Ot(T,J,1),q=T.heap[1],T.heap[--T.heap_max]=X,T.heap[--T.heap_max]=q,J[2*B]=J[2*X]+J[2*q],T.depth[B]=(T.depth[X]>=T.depth[q]?T.depth[X]:T.depth[q])+1,J[2*X+1]=J[2*q+1]=B,T.heap[1]=B++,Ot(T,J,1),2<=T.heap_len;);T.heap[--T.heap_max]=T.heap[1],function(vt,hs){var bo,Bs,yo,Wt,Ch,qc,ai=hs.dyn_tree,Bu=hs.max_code,wg=hs.stat_desc.static_tree,Ag=hs.stat_desc.has_stree,vg=hs.stat_desc.extra_bits,zu=hs.stat_desc.extra_base,_o=hs.stat_desc.max_length,kh=0;for(Wt=0;Wt<=_;Wt++)vt.bl_count[Wt]=0;for(ai[2*vt.heap[vt.heap_max]+1]=0,bo=vt.heap_max+1;bo<p;bo++)_o<(Wt=ai[2*ai[2*(Bs=vt.heap[bo])+1]+1]+1)&&(Wt=_o,kh++),ai[2*Bs+1]=Wt,Bu<Bs||(vt.bl_count[Wt]++,Ch=0,zu<=Bs&&(Ch=vg[Bs-zu]),qc=ai[2*Bs],vt.opt_len+=qc*(Wt+Ch),Ag&&(vt.static_len+=qc*(wg[2*Bs+1]+Ch)));if(kh!==0){do{for(Wt=_o-1;vt.bl_count[Wt]===0;)Wt--;vt.bl_count[Wt]--,vt.bl_count[Wt+1]+=2,vt.bl_count[_o]--,kh-=2}while(0<kh);for(Wt=_o;Wt!==0;Wt--)for(Bs=vt.bl_count[Wt];Bs!==0;)Bu<(yo=vt.heap[--bo])||(ai[2*yo+1]!==Wt&&(vt.opt_len+=(Wt-ai[2*yo+1])*ai[2*yo],ai[2*yo+1]=Wt),Bs--)}}(T,F),yt(J,Dt,T.bl_count)}function w(T,F,X){var q,B,J=-1,rt=F[1],Q=0,ct=7,Dt=4;for(rt===0&&(ct=138,Dt=3),F[2*(X+1)+1]=65535,q=0;q<=X;q++)B=rt,rt=F[2*(q+1)+1],++Q<ct&&B===rt||(Q<Dt?T.bl_tree[2*B]+=Q:B!==0?(B!==J&&T.bl_tree[2*B]++,T.bl_tree[2*k]++):Q<=10?T.bl_tree[2*C]++:T.bl_tree[2*P]++,J=B,Dt=(Q=0)===rt?(ct=138,3):B===rt?(ct=6,3):(ct=7,4))}function W(T,F,X){var q,B,J=-1,rt=F[1],Q=0,ct=7,Dt=4;for(rt===0&&(ct=138,Dt=3),q=0;q<=X;q++)if(B=rt,rt=F[2*(q+1)+1],!(++Q<ct&&B===rt)){if(Q<Dt)for(;Z(T,B,T.bl_tree),--Q!=0;);else B!==0?(B!==J&&(Z(T,B,T.bl_tree),Q--),Z(T,k,T.bl_tree),et(T,Q-3,2)):Q<=10?(Z(T,C,T.bl_tree),et(T,Q-3,3)):(Z(T,P,T.bl_tree),et(T,Q-11,7));J=B,Dt=(Q=0)===rt?(ct=138,3):B===rt?(ct=6,3):(ct=7,4)}}l(Y);var j=!1;function I(T,F,X,q){et(T,(h<<1)+(q?1:0),3),function(B,J,rt,Q){xt(B),st(B,rt),st(B,~rt),n.arraySet(B.pending_buf,B.window,J,rt,B.pending),B.pending+=rt}(T,F,X)}i._tr_init=function(T){j||(function(){var F,X,q,B,J,rt=new Array(_+1);for(B=q=0;B<c-1;B++)for(G[B]=q,F=0;F<1<<R[B];F++)v[q++]=B;for(v[q-1]=B,B=J=0;B<16;B++)for(Y[B]=J,F=0;F<1<<D[B];F++)z[J++]=B;for(J>>=7;B<u;B++)for(Y[B]=J<<7,F=0;F<1<<D[B]-7;F++)z[256+J++]=B;for(X=0;X<=_;X++)rt[X]=0;for(F=0;F<=143;)$[2*F+1]=8,F++,rt[8]++;for(;F<=255;)$[2*F+1]=9,F++,rt[9]++;for(;F<=279;)$[2*F+1]=7,F++,rt[7]++;for(;F<=287;)$[2*F+1]=8,F++,rt[8]++;for(yt($,f+1,rt),F=0;F<u;F++)L[2*F+1]=5,L[2*F]=kt(F,5);V=new ht($,R,d+1,f,_),O=new ht(L,D,0,u,_),dt=new ht(new Array(0),M,0,m,A)}(),j=!0),T.l_desc=new H(T.dyn_ltree,V),T.d_desc=new H(T.dyn_dtree,O),T.bl_desc=new H(T.bl_tree,dt),T.bi_buf=0,T.bi_valid=0,mt(T)},i._tr_stored_block=I,i._tr_flush_block=function(T,F,X,q){var B,J,rt=0;0<T.level?(T.strm.data_type===2&&(T.strm.data_type=function(Q){var ct,Dt=4093624447;for(ct=0;ct<=31;ct++,Dt>>>=1)if(1&Dt&&Q.dyn_ltree[2*ct]!==0)return r;if(Q.dyn_ltree[18]!==0||Q.dyn_ltree[20]!==0||Q.dyn_ltree[26]!==0)return o;for(ct=32;ct<d;ct++)if(Q.dyn_ltree[2*ct]!==0)return o;return r}(T)),Be(T,T.l_desc),Be(T,T.d_desc),rt=function(Q){var ct;for(w(Q,Q.dyn_ltree,Q.l_desc.max_code),w(Q,Q.dyn_dtree,Q.d_desc.max_code),Be(Q,Q.bl_desc),ct=m-1;3<=ct&&Q.bl_tree[2*U[ct]+1]===0;ct--);return Q.opt_len+=3*(ct+1)+5+5+4,ct}(T),B=T.opt_len+3+7>>>3,(J=T.static_len+3+7>>>3)<=B&&(B=J)):B=J=X+5,X+4<=B&&F!==-1?I(T,F,X,q):T.strategy===4||J===B?(et(T,2+(q?1:0),3),Oe(T,$,L)):(et(T,4+(q?1:0),3),function(Q,ct,Dt,vt){var hs;for(et(Q,ct-257,5),et(Q,Dt-1,5),et(Q,vt-4,4),hs=0;hs<vt;hs++)et(Q,Q.bl_tree[2*U[hs]+1],3);W(Q,Q.dyn_ltree,ct-1),W(Q,Q.dyn_dtree,Dt-1)}(T,T.l_desc.max_code+1,T.d_desc.max_code+1,rt+1),Oe(T,T.dyn_ltree,T.dyn_dtree)),mt(T),q&&xt(T)},i._tr_tally=function(T,F,X){return T.pending_buf[T.d_buf+2*T.last_lit]=F>>>8&255,T.pending_buf[T.d_buf+2*T.last_lit+1]=255&F,T.pending_buf[T.l_buf+T.last_lit]=255&X,T.last_lit++,F===0?T.dyn_ltree[2*X]++:(T.matches++,F--,T.dyn_ltree[2*(v[X]+d+1)]++,T.dyn_dtree[2*N(F)]++),T.last_lit===T.lit_bufsize-1},i._tr_align=function(T){et(T,2,3),Z(T,x,$),function(F){F.bi_valid===16?(st(F,F.bi_buf),F.bi_buf=0,F.bi_valid=0):8<=F.bi_valid&&(F.pending_buf[F.pending++]=255&F.bi_buf,F.bi_buf>>=8,F.bi_valid-=8)}(T)}},{"../utils/common":41}],53:[function(t,s,i){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,s,i){(function(n){(function(r,o){if(!r.setImmediate){var l,h,c,d,f=1,u={},m=!1,p=r.document,_=Object.getPrototypeOf&&Object.getPrototypeOf(r);_=_&&_.setTimeout?_:r,l={}.toString.call(r.process)==="[object process]"?function(k){process.nextTick(function(){A(k)})}:function(){if(r.postMessage&&!r.importScripts){var k=!0,C=r.onmessage;return r.onmessage=function(){k=!1},r.postMessage("","*"),r.onmessage=C,k}}()?(d="setImmediate$"+Math.random()+"$",r.addEventListener?r.addEventListener("message",x,!1):r.attachEvent("onmessage",x),function(k){r.postMessage(d+k,"*")}):r.MessageChannel?((c=new MessageChannel).port1.onmessage=function(k){A(k.data)},function(k){c.port2.postMessage(k)}):p&&"onreadystatechange"in p.createElement("script")?(h=p.documentElement,function(k){var C=p.createElement("script");C.onreadystatechange=function(){A(k),C.onreadystatechange=null,h.removeChild(C),C=null},h.appendChild(C)}):function(k){setTimeout(A,0,k)},_.setImmediate=function(k){typeof k!="function"&&(k=new Function(""+k));for(var C=new Array(arguments.length-1),P=0;P<C.length;P++)C[P]=arguments[P+1];var R={callback:k,args:C};return u[f]=R,l(f),f++},_.clearImmediate=b}function b(k){delete u[k]}function A(k){if(m)setTimeout(A,0,k);else{var C=u[k];if(C){m=!0;try{(function(P){var R=P.callback,D=P.args;switch(D.length){case 0:R();break;case 1:R(D[0]);break;case 2:R(D[0],D[1]);break;case 3:R(D[0],D[1],D[2]);break;default:R.apply(o,D)}})(C)}finally{b(k),m=!1}}}}function x(k){k.source===r&&typeof k.data=="string"&&k.data.indexOf(d)===0&&A(+k.data.slice(d.length))}})(typeof self>"u"?n===void 0?this:n:self)}).call(this,typeof Th<"u"?Th:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(_g);var bb=_g.exports;const vb=xg(bb);export{Ui as G,vb as J,Gm as g,Ab as p};
