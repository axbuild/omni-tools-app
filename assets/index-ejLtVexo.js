import{a as R,r as l,j as o,B as g,T as b}from"./index-7JCrVMyd.js";import{T as L}from"./ToolContent-DrkA_-Xz.js";import{f as I,F as P}from"./index-on_GoYzL.js";import{T as U}from"./ToolVideoInput-D0Q1Ed0Y.js";import{T as V}from"./ToolFileResult-Div6pbTm.js";import{l as F}from"./lodash-jIFHsyXN.js";import{A as $}from"./Alert-Bmk1WzvB.js";import{T as x}from"./TextField-DeGHHacn.js";import"./objectWithoutProperties-rK072Nhf.js";import"./BaseFileInput-CTIURbfW.js";import"./ContentPaste-CJSvfBhK.js";import"./InputFooter-Cia2zmGJ.js";import"./grey-pattern-DMflWW5d.js";import"./ResultFooter-DAeFmDVK.js";import"./index-Bb8_02NB.js";import"./Close-DxdBQUtL.js";const m=new P;async function B(c){return new Promise((e,d)=>{const n=document.createElement("video"),a=URL.createObjectURL(c);n.onloadedmetadata=()=>{URL.revokeObjectURL(a),e({width:n.videoWidth,height:n.videoHeight})},n.onerror=()=>{URL.revokeObjectURL(a),d(new Error("Failed to load video metadata"))},n.src=a})}async function S(c,e){m.loaded||await m.load({wasmURL:"https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.12.9/dist/esm/ffmpeg-core.wasm"});const d="input.mp4",n="output.mp4";await m.writeFile(d,await I(c));const a=[];if(e.width<=0||e.height<=0)throw new Error("Width and height must be positive");a.push("-i",d),a.push("-vf",`crop=${e.width}:${e.height}:${e.x}:${e.y}`),a.push("-c:v","libx264","-preset","ultrafast",n),await m.exec(a);const f=await m.readFile(n);return await new File([new Blob([f],{type:"video/mp4"})],`${c.name.replace(/\.[^/.]+$/,"")}_cropped.mp4`,{type:"video/mp4"})}const z={x:0,y:0,width:100,height:100};function ee({title:c}){const{t:e}=R("video"),[d,n]=l.useState(null),[a,f]=l.useState(null),[j,w]=l.useState(!1),[p,y]=l.useState(null),[v,h]=l.useState(""),C=t=>p?t.x<0||t.y<0?e("cropVideo.errorNonNegativeCoordinates"):t.width<=0||t.height<=0?e("cropVideo.errorPositiveDimensions"):t.x+t.width>p.width?e("cropVideo.errorBeyondWidth",{width:p.width}):t.y+t.height>p.height?e("cropVideo.errorBeyondHeight",{height:p.height}):"":"",T=async(t,i)=>{if(!i)return;const r=C(t);if(r){h(r);return}h(""),w(!0);try{const s=await S(i,t);f(s)}catch(s){console.error("Error cropping video:",s),h(e("cropVideo.errorCroppingVideo"))}finally{w(!1)}},D=l.useCallback(F.debounce(T,2e3),[p]),E=({values:t,updateField:i})=>[{title:e("cropVideo.videoInformation"),component:o.jsx(g,{children:p?o.jsx(b,{variant:"body2",sx:{mb:2},children:e("cropVideo.videoDimensions",{width:p.width,height:p.height})}):o.jsx(b,{variant:"body2",sx:{mb:2},children:e("cropVideo.loadVideoForDimensions")})})},{title:e("cropVideo.cropCoordinates"),component:o.jsxs(g,{sx:{display:"flex",flexDirection:"column",gap:2},children:[v&&o.jsx($,{severity:"error",sx:{mb:2},children:v}),o.jsxs(g,{sx:{display:"flex",gap:2},children:[o.jsx(x,{label:e("cropVideo.xCoordinate"),type:"number",value:t.x,onChange:r=>i("x",parseInt(r.target.value)||0),size:"small",inputProps:{min:0}}),o.jsx(x,{label:e("cropVideo.yCoordinate"),type:"number",value:t.y,onChange:r=>i("y",parseInt(r.target.value)||0),size:"small",inputProps:{min:0}})]}),o.jsxs(g,{sx:{display:"flex",gap:2},children:[o.jsx(x,{label:e("cropVideo.width"),type:"number",value:t.width,onChange:r=>i("width",parseInt(r.target.value)||0),size:"small",inputProps:{min:1}}),o.jsx(x,{label:e("cropVideo.height"),type:"number",value:t.height,onChange:r=>i("height",parseInt(r.target.value)||0),size:"small",inputProps:{min:1}})]})]})}];return o.jsx(L,{title:c,input:d,renderCustomInput:(t,i)=>o.jsx(U,{value:d,onChange:r=>{r?B(r).then(s=>{const u={x:s.width/4,y:s.height/4,width:s.width/2,height:s.height/2};i("x",u.x),i("y",u.y),i("width",u.width),i("height",u.height),y(s),h("")}).catch(s=>{console.error("Error getting video dimensions:",s),h(e("cropVideo.errorLoadingDimensions"))}):(y(null),h("")),n(r)},title:e("cropVideo.inputTitle")}),resultComponent:j?o.jsx(V,{title:e("cropVideo.croppingVideo"),value:null,loading:!0,extension:""}):o.jsx(V,{title:e("cropVideo.resultTitle"),value:a,extension:"mp4"}),initialValues:z,getGroups:E,compute:D,setInput:n})}export{ee as default};
