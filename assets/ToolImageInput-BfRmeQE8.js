import{r as v,W as p,j as H,B as K,ao as X}from"./index-7JCrVMyd.js";import{B as S}from"./BaseFileInput-CTIURbfW.js";const Y={x:0,y:0,width:0,height:0,unit:"px"},b=(c,t,e)=>Math.min(Math.max(c,t),e),P=(...c)=>c.filter(t=>t&&typeof t=="string").join(" "),_=(c,t)=>c===t||c.width===t.width&&c.height===t.height&&c.x===t.x&&c.y===t.y&&c.unit===t.unit;function R(c,t,e){return c.unit==="%"?{...Y,...c,unit:"%"}:{unit:"%",x:c.x?c.x/t*100:0,y:c.y?c.y/e*100:0,width:c.width?c.width/t*100:0,height:c.height?c.height/e*100:0}}function D(c,t,e){return c.unit?c.unit==="px"?{...Y,...c,unit:"px"}:{unit:"px",x:c.x?c.x*t/100:0,y:c.y?c.y*e/100:0,width:c.width?c.width*t/100:0,height:c.height?c.height*e/100:0}:{...Y,...c,unit:"px"}}function $(c,t,e,h,i,n=0,o=0,l=h,a=i){const r={...c};let d=Math.min(n,h),g=Math.min(o,i),w=Math.min(l,h),s=Math.min(a,i);t&&(t>1?(d=o?o*t:d,g=d/t,w=l*t):(g=n?n/t:g,d=g*t,s=a/t)),r.y<0&&(r.height=Math.max(r.height+r.y,g),r.y=0),r.x<0&&(r.width=Math.max(r.width+r.x,d),r.x=0);const u=h-(r.x+r.width);u<0&&(r.x=Math.min(r.x,h-d),r.width+=u);const x=i-(r.y+r.height);if(x<0&&(r.y=Math.min(r.y,i-g),r.height+=x),r.width<d&&((e==="sw"||e=="nw")&&(r.x-=d-r.width),r.width=d),r.height<g&&((e==="nw"||e=="ne")&&(r.y-=g-r.height),r.height=g),r.width>w&&((e==="sw"||e=="nw")&&(r.x-=w-r.width),r.width=w),r.height>s&&((e==="nw"||e=="ne")&&(r.y-=s-r.height),r.height=s),t){const C=r.width/r.height;if(C<t){const m=Math.max(r.width/t,g);(e==="nw"||e=="ne")&&(r.y-=m-r.height),r.height=m}else if(C>t){const m=Math.max(r.height*t,d);(e==="sw"||e=="nw")&&(r.x-=m-r.width),r.width=m}}return r}function B(c,t,e,h){const i={...c};return t==="ArrowLeft"?h==="nw"?(i.x-=e,i.y-=e,i.width+=e,i.height+=e):h==="w"?(i.x-=e,i.width+=e):h==="sw"?(i.x-=e,i.width+=e,i.height+=e):h==="ne"?(i.y+=e,i.width-=e,i.height-=e):h==="e"?i.width-=e:h==="se"&&(i.width-=e,i.height-=e):t==="ArrowRight"&&(h==="nw"?(i.x+=e,i.y+=e,i.width-=e,i.height-=e):h==="w"?(i.x+=e,i.width-=e):h==="sw"?(i.x+=e,i.width-=e,i.height-=e):h==="ne"?(i.y-=e,i.width+=e,i.height+=e):h==="e"?i.width+=e:h==="se"&&(i.width+=e,i.height+=e)),t==="ArrowUp"?h==="nw"?(i.x-=e,i.y-=e,i.width+=e,i.height+=e):h==="n"?(i.y-=e,i.height+=e):h==="ne"?(i.y-=e,i.width+=e,i.height+=e):h==="sw"?(i.x+=e,i.width-=e,i.height-=e):h==="s"?i.height-=e:h==="se"&&(i.width-=e,i.height-=e):t==="ArrowDown"&&(h==="nw"?(i.x+=e,i.y+=e,i.width-=e,i.height-=e):h==="n"?(i.y+=e,i.height-=e):h==="ne"?(i.y+=e,i.width-=e,i.height-=e):h==="sw"?(i.x-=e,i.width+=e,i.height+=e):h==="s"?i.height+=e:h==="se"&&(i.width+=e,i.height+=e)),i}const M={capture:!0,passive:!1};let A=0;const f=class y extends v.PureComponent{constructor(){super(...arguments),this.docMoveBound=!1,this.mouseDownOnCrop=!1,this.dragStarted=!1,this.evData={startClientX:0,startClientY:0,startCropX:0,startCropY:0,clientX:0,clientY:0,isResize:!0},this.componentRef=v.createRef(),this.mediaRef=v.createRef(),this.initChangeCalled=!1,this.instanceId=`rc-${A++}`,this.state={cropIsActive:!1,newCropIsBeingDrawn:!1},this.onCropPointerDown=t=>{const{crop:e,disabled:h}=this.props,i=this.getBox();if(!e)return;const n=D(e,i.width,i.height);if(h)return;t.cancelable&&t.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const o=t.target.dataset.ord,l=!!o;let a=t.clientX,r=t.clientY,d=n.x,g=n.y;if(o){const w=t.clientX-i.x,s=t.clientY-i.y;let u=0,x=0;o==="ne"||o=="e"?(u=w-(n.x+n.width),x=s-n.y,d=n.x,g=n.y+n.height):o==="se"||o==="s"?(u=w-(n.x+n.width),x=s-(n.y+n.height),d=n.x,g=n.y):o==="sw"||o=="w"?(u=w-n.x,x=s-(n.y+n.height),d=n.x+n.width,g=n.y):(o==="nw"||o=="n")&&(u=w-n.x,x=s-n.y,d=n.x+n.width,g=n.y+n.height),a=d+i.x+u,r=g+i.y+x}this.evData={startClientX:a,startClientY:r,startCropX:d,startCropY:g,clientX:t.clientX,clientY:t.clientY,isResize:l,ord:o},this.mouseDownOnCrop=!0,this.setState({cropIsActive:!0})},this.onComponentPointerDown=t=>{const{crop:e,disabled:h,locked:i,keepSelection:n,onChange:o}=this.props,l=this.getBox();if(h||i||n&&e)return;t.cancelable&&t.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const a=t.clientX-l.x,r=t.clientY-l.y,d={unit:"px",x:a,y:r,width:0,height:0};this.evData={startClientX:t.clientX,startClientY:t.clientY,startCropX:a,startCropY:r,clientX:t.clientX,clientY:t.clientY,isResize:!0},this.mouseDownOnCrop=!0,o(D(d,l.width,l.height),R(d,l.width,l.height)),this.setState({cropIsActive:!0,newCropIsBeingDrawn:!0})},this.onDocPointerMove=t=>{const{crop:e,disabled:h,onChange:i,onDragStart:n}=this.props,o=this.getBox();if(h||!e||!this.mouseDownOnCrop)return;t.cancelable&&t.preventDefault(),this.dragStarted||(this.dragStarted=!0,n&&n(t));const{evData:l}=this;l.clientX=t.clientX,l.clientY=t.clientY;let a;l.isResize?a=this.resizeCrop():a=this.dragCrop(),_(e,a)||i(D(a,o.width,o.height),R(a,o.width,o.height))},this.onComponentKeyDown=t=>{const{crop:e,disabled:h,onChange:i,onComplete:n}=this.props;if(h)return;const o=t.key;let l=!1;if(!e)return;const a=this.getBox(),r=this.makePixelCrop(a),d=(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)?y.nudgeStepLarge:t.shiftKey?y.nudgeStepMedium:y.nudgeStep;if(o==="ArrowLeft"?(r.x-=d,l=!0):o==="ArrowRight"?(r.x+=d,l=!0):o==="ArrowUp"?(r.y-=d,l=!0):o==="ArrowDown"&&(r.y+=d,l=!0),l){t.cancelable&&t.preventDefault(),r.x=b(r.x,0,a.width-r.width),r.y=b(r.y,0,a.height-r.height);const g=D(r,a.width,a.height),w=R(r,a.width,a.height);i(g,w),n&&n(g,w)}},this.onHandlerKeyDown=(t,e)=>{const{aspect:h=0,crop:i,disabled:n,minWidth:o=0,minHeight:l=0,maxWidth:a,maxHeight:r,onChange:d,onComplete:g}=this.props,w=this.getBox();if(n||!i)return;if(t.key==="ArrowUp"||t.key==="ArrowDown"||t.key==="ArrowLeft"||t.key==="ArrowRight")t.stopPropagation(),t.preventDefault();else return;const s=(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)?y.nudgeStepLarge:t.shiftKey?y.nudgeStepMedium:y.nudgeStep,u=D(i,w.width,w.height),x=B(u,t.key,s,e),C=$(x,h,e,w.width,w.height,o,l,a,r);if(!_(i,C)){const m=R(C,w.width,w.height);d(C,m),g&&g(C,m)}},this.onDocPointerDone=t=>{const{crop:e,disabled:h,onComplete:i,onDragEnd:n}=this.props,o=this.getBox();this.unbindDocMove(),!(h||!e)&&this.mouseDownOnCrop&&(this.mouseDownOnCrop=!1,this.dragStarted=!1,n&&n(t),i&&i(D(e,o.width,o.height),R(e,o.width,o.height)),this.setState({cropIsActive:!1,newCropIsBeingDrawn:!1}))},this.onDragFocus=()=>{var t;(t=this.componentRef.current)==null||t.scrollTo(0,0)}}get document(){return document}getBox(){const t=this.mediaRef.current;if(!t)return{x:0,y:0,width:0,height:0};const{x:e,y:h,width:i,height:n}=t.getBoundingClientRect();return{x:e,y:h,width:i,height:n}}componentDidUpdate(t){const{crop:e,onComplete:h}=this.props;if(h&&!t.crop&&e){const{width:i,height:n}=this.getBox();i&&n&&h(D(e,i,n),R(e,i,n))}}componentWillUnmount(){this.resizeObserver&&this.resizeObserver.disconnect(),this.unbindDocMove()}bindDocMove(){this.docMoveBound||(this.document.addEventListener("pointermove",this.onDocPointerMove,M),this.document.addEventListener("pointerup",this.onDocPointerDone,M),this.document.addEventListener("pointercancel",this.onDocPointerDone,M),this.docMoveBound=!0)}unbindDocMove(){this.docMoveBound&&(this.document.removeEventListener("pointermove",this.onDocPointerMove,M),this.document.removeEventListener("pointerup",this.onDocPointerDone,M),this.document.removeEventListener("pointercancel",this.onDocPointerDone,M),this.docMoveBound=!1)}getCropStyle(){const{crop:t}=this.props;if(t)return{top:`${t.y}${t.unit}`,left:`${t.x}${t.unit}`,width:`${t.width}${t.unit}`,height:`${t.height}${t.unit}`}}dragCrop(){const{evData:t}=this,e=this.getBox(),h=this.makePixelCrop(e),i=t.clientX-t.startClientX,n=t.clientY-t.startClientY;return h.x=b(t.startCropX+i,0,e.width-h.width),h.y=b(t.startCropY+n,0,e.height-h.height),h}getPointRegion(t,e,h,i){const{evData:n}=this,o=n.clientX-t.x,l=n.clientY-t.y;let a;i&&e?a=e==="nw"||e==="n"||e==="ne":a=l<n.startCropY;let r;return h&&e?r=e==="nw"||e==="w"||e==="sw":r=o<n.startCropX,r?a?"nw":"sw":a?"ne":"se"}resolveMinDimensions(t,e,h=0,i=0){const n=Math.min(h,t.width),o=Math.min(i,t.height);return!e||!n&&!o?[n,o]:e>1?n?[n,n/e]:[o*e,o]:o?[o*e,o]:[n,n/e]}resizeCrop(){const{evData:t}=this,{aspect:e=0,maxWidth:h,maxHeight:i}=this.props,n=this.getBox(),[o,l]=this.resolveMinDimensions(n,e,this.props.minWidth,this.props.minHeight);let a=this.makePixelCrop(n);const r=this.getPointRegion(n,t.ord,o,l),d=t.ord||r;let g=t.clientX-t.startClientX,w=t.clientY-t.startClientY;(o&&d==="nw"||d==="w"||d==="sw")&&(g=Math.min(g,-o)),(l&&d==="nw"||d==="n"||d==="ne")&&(w=Math.min(w,-l));const s={unit:"px",x:0,y:0,width:0,height:0};r==="ne"?(s.x=t.startCropX,s.width=g,e?(s.height=s.width/e,s.y=t.startCropY-s.height):(s.height=Math.abs(w),s.y=t.startCropY-s.height)):r==="se"?(s.x=t.startCropX,s.y=t.startCropY,s.width=g,e?s.height=s.width/e:s.height=w):r==="sw"?(s.x=t.startCropX+g,s.y=t.startCropY,s.width=Math.abs(g),e?s.height=s.width/e:s.height=w):r==="nw"&&(s.x=t.startCropX+g,s.width=Math.abs(g),e?(s.height=s.width/e,s.y=t.startCropY-s.height):(s.height=Math.abs(w),s.y=t.startCropY+w));const u=$(s,e,r,n.width,n.height,o,l,h,i);return e||y.xyOrds.indexOf(d)>-1?a=u:y.xOrds.indexOf(d)>-1?(a.x=u.x,a.width=u.width):y.yOrds.indexOf(d)>-1&&(a.y=u.y,a.height=u.height),a.x=b(a.x,0,n.width-a.width),a.y=b(a.y,0,n.height-a.height),a}renderCropSelection(){const{ariaLabels:t=y.defaultProps.ariaLabels,disabled:e,locked:h,renderSelectionAddon:i,ruleOfThirds:n,crop:o}=this.props,l=this.getCropStyle();if(o)return p.createElement("div",{style:l,className:"ReactCrop__crop-selection",onPointerDown:this.onCropPointerDown,"aria-label":t.cropArea,tabIndex:0,onKeyDown:this.onComponentKeyDown,role:"group"},!e&&!h&&p.createElement("div",{className:"ReactCrop__drag-elements",onFocus:this.onDragFocus},p.createElement("div",{className:"ReactCrop__drag-bar ord-n","data-ord":"n"}),p.createElement("div",{className:"ReactCrop__drag-bar ord-e","data-ord":"e"}),p.createElement("div",{className:"ReactCrop__drag-bar ord-s","data-ord":"s"}),p.createElement("div",{className:"ReactCrop__drag-bar ord-w","data-ord":"w"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-nw","data-ord":"nw",tabIndex:0,"aria-label":t.nwDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"nw"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-n","data-ord":"n",tabIndex:0,"aria-label":t.nDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"n"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-ne","data-ord":"ne",tabIndex:0,"aria-label":t.neDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"ne"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-e","data-ord":"e",tabIndex:0,"aria-label":t.eDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"e"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-se","data-ord":"se",tabIndex:0,"aria-label":t.seDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"se"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-s","data-ord":"s",tabIndex:0,"aria-label":t.sDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"s"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-sw","data-ord":"sw",tabIndex:0,"aria-label":t.swDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"sw"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-w","data-ord":"w",tabIndex:0,"aria-label":t.wDragHandle,onKeyDown:a=>this.onHandlerKeyDown(a,"w"),role:"button"})),i&&p.createElement("div",{className:"ReactCrop__selection-addon",onPointerDown:a=>a.stopPropagation()},i(this.state)),n&&p.createElement(p.Fragment,null,p.createElement("div",{className:"ReactCrop__rule-of-thirds-hz"}),p.createElement("div",{className:"ReactCrop__rule-of-thirds-vt"})))}makePixelCrop(t){const e={...Y,...this.props.crop||{}};return D(e,t.width,t.height)}render(){const{aspect:t,children:e,circularCrop:h,className:i,crop:n,disabled:o,locked:l,style:a,ruleOfThirds:r}=this.props,{cropIsActive:d,newCropIsBeingDrawn:g}=this.state,w=n?this.renderCropSelection():null,s=P("ReactCrop",i,d&&"ReactCrop--active",o&&"ReactCrop--disabled",l&&"ReactCrop--locked",g&&"ReactCrop--new-crop",n&&t&&"ReactCrop--fixed-aspect",n&&h&&"ReactCrop--circular-crop",n&&r&&"ReactCrop--rule-of-thirds",!this.dragStarted&&n&&!n.width&&!n.height&&"ReactCrop--invisible-crop",h&&"ReactCrop--no-animate");return p.createElement("div",{ref:this.componentRef,className:s,style:a},p.createElement("div",{ref:this.mediaRef,className:"ReactCrop__child-wrapper",onPointerDown:this.onComponentPointerDown},e),n?p.createElement("svg",{className:"ReactCrop__crop-mask",width:"100%",height:"100%"},p.createElement("defs",null,p.createElement("mask",{id:`hole-${this.instanceId}`},p.createElement("rect",{width:"100%",height:"100%",fill:"white"}),h?p.createElement("ellipse",{cx:`${n.x+n.width/2}${n.unit}`,cy:`${n.y+n.height/2}${n.unit}`,rx:`${n.width/2}${n.unit}`,ry:`${n.height/2}${n.unit}`,fill:"black"}):p.createElement("rect",{x:`${n.x}${n.unit}`,y:`${n.y}${n.unit}`,width:`${n.width}${n.unit}`,height:`${n.height}${n.unit}`,fill:"black"}))),p.createElement("rect",{fill:"black",fillOpacity:.5,width:"100%",height:"100%",mask:`url(#hole-${this.instanceId})`})):void 0,w)}};f.xOrds=["e","w"],f.yOrds=["n","s"],f.xyOrds=["nw","ne","se","sw"],f.nudgeStep=1,f.nudgeStepMedium=10,f.nudgeStepLarge=100,f.defaultProps={ariaLabels:{cropArea:"Use the arrow keys to move the crop selection area",nwDragHandle:"Use the arrow keys to move the north west drag handle to change the crop selection area",nDragHandle:"Use the up and down arrow keys to move the north drag handle to change the crop selection area",neDragHandle:"Use the arrow keys to move the north east drag handle to change the crop selection area",eDragHandle:"Use the up and down arrow keys to move the east drag handle to change the crop selection area",seDragHandle:"Use the arrow keys to move the south east drag handle to change the crop selection area",sDragHandle:"Use the up and down arrow keys to move the south drag handle to change the crop selection area",swDragHandle:"Use the arrow keys to move the south west drag handle to change the crop selection area",wDragHandle:"Use the up and down arrow keys to move the west drag handle to change the crop selection area"}};let N=f;function U({showCropOverlay:c=!1,cropShape:t="rectangular",cropPosition:e={x:0,y:0},cropSize:h={width:100,height:100},onCropChange:i,...n}){const o=v.useRef(null),[l,a]=v.useState(0),[r,d]=v.useState(0),[g,w]=v.useState({unit:"px",x:0,y:0,width:0,height:0}),s=o.current?l/o.current.width:1,u=m=>{const{naturalWidth:k,naturalHeight:I}=m.currentTarget;if(a(k),d(I),!g.width&&!g.height&&i){const E={unit:"px",x:Math.floor(k/4),y:Math.floor(I/4),width:Math.floor(k/2),height:Math.floor(I/2)};w(E),i({x:E.x,y:E.y},{width:E.width,height:E.height})}};v.useEffect(()=>{l&&r&&(e.x!==0||e.y!==0||h.width!==100||h.height!==100)&&w({unit:"px",x:e.x/s,y:e.y/s,width:h.width/s,height:h.height/s})},[e,h,l,r,s]);const x=m=>{w(m)},C=m=>{i&&i({x:Math.round(m.x*s),y:Math.round(m.y*s)},{width:Math.round(m.width*s),height:Math.round(m.height*s)})};return H.jsx(S,{...n,type:"image",children:({preview:m})=>H.jsx(K,{width:"100%",height:"100%",sx:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden"},children:c?H.jsx(N,{crop:g,onChange:x,onComplete:C,circularCrop:t==="circular",style:{maxWidth:"100%",maxHeight:X},children:H.jsx("img",{ref:o,src:m,alt:"Preview",style:{maxWidth:"100%",maxHeight:X},onLoad:u})}):H.jsx("img",{ref:o,src:m,alt:"Preview",style:{maxWidth:"100%",maxHeight:X},onLoad:u})})})}export{U as T};
