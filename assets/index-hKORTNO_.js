import{a as b,r as c,j as s,B as f}from"./index-7JCrVMyd.js";import{c as g,d as w,a as F}from"./index.esm-Cob4-rpC.js";import{T as y}from"./ToolFileResult-Div6pbTm.js";import{T as C}from"./ToolContent-DrkA_-Xz.js";import{l as T}from"./lodash-jIFHsyXN.js";import{T as j,S}from"./ToolVideoInput-D0Q1Ed0Y.js";import{f as R,F as q}from"./index-on_GoYzL.js";import{S as $}from"./SimpleRadio-BbIGpl0h.js";import"./ContentPaste-CJSvfBhK.js";import"./grey-pattern-DMflWW5d.js";import"./ResultFooter-DAeFmDVK.js";import"./TextField-DeGHHacn.js";import"./objectWithoutProperties-rK072Nhf.js";import"./BaseFileInput-CTIURbfW.js";import"./InputFooter-Cia2zmGJ.js";import"./Radio-Clz2uSlr.js";import"./SwitchBase-CZaFkbti.js";const l=new q;async function k(m,e){l.loaded||await l.load({wasmURL:"https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.12.9/dist/esm/ffmpeg-core.wasm"});const o="input.mp4",a="output.mp4";await l.writeFile(o,await R(m));const p=`scale=${e.width}:-2`,u=["-i",o,"-vf",p,"-c:v","libx264","-crf",e.crf.toString(),"-preset",e.preset,"-c:a","aac",a];try{await l.exec(u)}catch(n){console.error("FFmpeg execution failed:",n)}const d=await l.readFile(a);return new File([new Blob([d],{type:"video/mp4"})],`${m.name.replace(/\.[^/.]+$/,"")}_compressed_${e.width}p.mp4`,{type:"video/mp4"})}const E={width:480,crf:23,preset:"medium"},B=g({width:w().oneOf([240,360,480,720,1080],"Width must be one of the standard resolutions").required("Width is required"),crf:w().min(0,"CRF must be at least 0").max(51,"CRF must be at most 51").required("CRF is required"),preset:F().oneOf(["ultrafast","superfast","veryfast","faster","fast","medium","slow","slower","veryslow"],"Preset must be a valid ffmpeg preset").required("Preset is required")}),O=[{value:240,label:"240p"},{value:360,label:"360p"},{value:480,label:"480p"},{value:720,label:"720p"},{value:1080,label:"1080p"}];function X({title:m}){const{t:e}=b("video"),[o,a]=c.useState(null),[p,u]=c.useState(null),[d,n]=c.useState(!1),h=async(r,i)=>{if(i){n(!0);try{const t=await k(i,{width:r.width,crf:r.crf,preset:r.preset});u(t)}catch(t){console.error("Error compressing video:",t)}finally{n(!1)}}},x=c.useCallback(T.debounce(h,1e3),[]),v=({values:r,updateField:i})=>[{title:e("compress.resolution"),component:s.jsx(f,{children:O.map(t=>s.jsx($,{title:t.label,checked:r.width===t.value,onClick:()=>{i("width",t.value)}},t.value))})},{title:e("compress.quality"),component:s.jsx(f,{sx:{mb:2},children:s.jsx(S,{min:0,max:51,style:{width:"90%"},value:r.crf,onChange:t=>{i("crf",typeof t=="number"?t:t[0])},marks:{0:e("compress.lossless"),23:e("compress.default"),51:e("compress.worst")}})})}];return s.jsx(C,{title:m,input:o,inputComponent:s.jsx(j,{value:o,onChange:a,title:e("compress.inputTitle")}),resultComponent:s.jsx(y,{title:e("compress.resultTitle"),value:p,extension:"mp4",loading:d,loadingText:e("compress.loadingText")}),initialValues:E,getGroups:v,compute:x,setInput:a,validationSchema:B})}export{X as default,E as initialValues,B as validationSchema};
