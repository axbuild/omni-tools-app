import{a as F,r as w,j as i,B as h}from"./index-7JCrVMyd.js";import{T as x}from"./ToolContent-DrkA_-Xz.js";import{T as S}from"./ToolAudioInput-yQIa9QyJ.js";import{T as g}from"./ToolFileResult-Div6pbTm.js";import{T as v}from"./TextFieldWithDesc-D98LnRRi.js";import{F as j,f as b}from"./index-on_GoYzL.js";import{R as T}from"./RadioGroup-C6kaQY45.js";import{F as y}from"./FormControlLabel-Bkvpm43S.js";import{R as C}from"./Radio-Clz2uSlr.js";import"./TextField-DeGHHacn.js";import"./BaseFileInput-CTIURbfW.js";import"./ContentPaste-CJSvfBhK.js";import"./InputFooter-Cia2zmGJ.js";import"./grey-pattern-DMflWW5d.js";import"./lodash-jIFHsyXN.js";import"./ResultFooter-DAeFmDVK.js";import"./FormGroup-DuLNvNQv.js";import"./SwitchBase-CZaFkbti.js";function R(o){if(o<=2&&o>=.5)return`atempo=${o}`;const s=[];let e=o;for(;e>2;)s.push("atempo=2.0"),e/=2;for(;e<.5;)s.push("atempo=0.5"),e/=.5;return s.push(`atempo=${e.toFixed(2)}`),s.join(",")}async function A(o,s){if(!o)return null;const{newSpeed:e,outputFormat:a}=s;let n=null,u=!1;try{n=new j,u||(await n.load({wasmURL:"https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.12.9/dist/esm/ffmpeg-core.wasm"}),u=!0);const l=o.name,p=`output.${a}`;await n.writeFile(l,await b(o));const d=R(e);let m=["-i",l,"-filter:a",d];a==="mp3"?m.push("-b:a","192k","-f","mp3",p):a==="aac"?m.push("-c:a","aac","-b:a","192k","-f","adts",p):a==="wav"&&m.push("-acodec","pcm_s16le","-ar","44100","-ac","2","-f","wav",p),await n.exec(m);const f=await n.readFile(p);let r="audio/mp3";a==="aac"&&(r="audio/aac"),a==="wav"&&(r="audio/wav");const c=new Blob([f],{type:r}),t=new File([c],l.replace(/\.[^/.]+$/,`-${e}x.${a}`),{type:r});return await n.deleteFile(l),await n.deleteFile(p),t}catch(l){return console.error(`Failed to process audio: ${l}`),null}}const $={newSpeed:2,outputFormat:"mp3"},I=[{label:"MP3",value:"mp3"},{label:"AAC",value:"aac"},{label:"WAV",value:"wav"}];function K({title:o,longDescription:s}){const{t:e}=F("audio"),[a,n]=w.useState(null),[u,l]=w.useState(null),[p,d]=w.useState(!1),m=async(r,c)=>{d(!0);try{const t=await A(c,r);l(t)}catch{l(null)}finally{d(!1)}},f=({values:r,updateField:c})=>[{title:e("changeSpeed.newAudioSpeed"),component:i.jsx(h,{children:i.jsx(v,{value:r.newSpeed.toString(),onOwnChange:t=>c("newSpeed",Number(t)),description:e("changeSpeed.speedDescription"),type:"number"})})},{title:e("changeSpeed.outputFormat"),component:i.jsx(h,{mt:2,children:i.jsx(T,{row:!0,value:r.outputFormat,onChange:t=>c("outputFormat",t.target.value),children:I.map(t=>i.jsx(y,{value:t.value,control:i.jsx(C,{}),label:t.label},t.value))})})}];return i.jsx(x,{title:o,input:a,inputComponent:i.jsx(S,{value:a,onChange:n,title:e("changeSpeed.inputTitle")}),resultComponent:p?i.jsx(g,{title:e("changeSpeed.settingSpeed"),value:null,loading:!0}):i.jsx(g,{title:e("changeSpeed.resultTitle"),value:u,extension:u?u.name.split(".").pop():void 0}),initialValues:$,getGroups:f,setInput:n,compute:m,toolInfo:{title:e("changeSpeed.toolInfo.title",{title:o}),description:s}})}export{K as default};
