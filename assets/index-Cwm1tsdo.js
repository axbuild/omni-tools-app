import{a as I,r as u,j as a,B as R}from"./index-7JCrVMyd.js";import{T as B}from"./ToolContent-DrkA_-Xz.js";import{T as L}from"./ToolVideoInput-D0Q1Ed0Y.js";import{T as w}from"./ToolFileResult-Div6pbTm.js";import{T as N}from"./TextFieldWithDesc-D98LnRRi.js";import{f as E,F as A}from"./index-on_GoYzL.js";import"./TextField-DeGHHacn.js";import"./objectWithoutProperties-rK072Nhf.js";import"./BaseFileInput-CTIURbfW.js";import"./ContentPaste-CJSvfBhK.js";import"./InputFooter-Cia2zmGJ.js";import"./grey-pattern-DMflWW5d.js";import"./lodash-jIFHsyXN.js";import"./ResultFooter-DAeFmDVK.js";const D={newSpeed:2};function Z({title:c,longDescription:x}){const{t:n}=I("video"),[d,f]=u.useState(null),[F,S]=u.useState(null),[v,g]=u.useState(!1),T=o=>{if(o<=2&&o>=.5)return`atempo=${o}`;const e=[];let t=o;for(;t>2;)e.push("atempo=2.0"),t/=2;for(;t<.5;)e.push("atempo=0.5"),t/=.5;return e.push(`atempo=${t.toFixed(2)}`),e.join(",")},j=(o,e)=>{if(!e)return;const{newSpeed:t}=o;let i=null,h=!1;(async(l,s)=>{if(s===0)return;g(!0),i||(i=new A),h||(await i.load({wasmURL:"https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.12.9/dist/esm/ffmpeg-core.wasm"}),h=!0);const p=l.name,m="output.mp4";try{i.writeFile(p,await E(l));const r=`setpts=${1/s}*PTS`,y=T(s);await i.exec(["-i",p,"-vf",r,"-filter:a",y,"-c:v","libx264","-preset","ultrafast","-c:a","aac",m]);const C=await i.readFile(m),V=new Blob([C],{type:"video/mp4"}),$=new File([V],l.name.replace(".mp4",`-${s}x.mp4`),{type:"video/mp4"});await i.deleteFile(p),await i.deleteFile(m),S($)}catch(r){throw console.error(`Failed to process video: ${r}`),r}finally{g(!1)}})(e,t)},b=({values:o,updateField:e})=>[{title:n("changeSpeed.newVideoSpeed"),component:a.jsx(R,{children:a.jsx(N,{value:o.newSpeed.toString(),onOwnChange:t=>e("newSpeed",Number(t)),description:n("changeSpeed.defaultMultiplier"),type:"number"})})}];return a.jsx(B,{title:c,input:d,inputComponent:a.jsx(L,{value:d,onChange:f,title:n("changeSpeed.inputTitle")}),resultComponent:v?a.jsx(w,{title:n("changeSpeed.settingSpeed"),value:null,loading:!0}):a.jsx(w,{title:n("changeSpeed.resultTitle"),value:F,extension:"mp4"}),initialValues:D,getGroups:b,setInput:f,compute:j,toolInfo:{title:n("changeSpeed.toolInfo.title",{title:c}),description:x}})}export{Z as default};
